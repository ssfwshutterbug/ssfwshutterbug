[{"title":"20220605","url":"/2022/06/05/20220605/","content":"2022-06-05\n现在已经是凌晨1点了，但是因为放假，所以就不管时间了，我发现晚上才适合学习，比较清醒和有灵感。\n之前每天早上都是8点左右到公司，有一个小时的时间拿来看王阳明的书。但是最近早上都在搞锻炼，所以没有时间去看书了。本来打算好好总结书中的道理的，但是我还没有开始：）\n因为搞锻炼，所以认识了两个非常有名的人：大卫・戈金斯；泰森。其实泰森我初中好像就听过了只是没留意。戈金斯是美国海豹突击队的成员，创造了许多的记录，用3个月的时间减重90多斤，我在bilibili上看他的视频，首先是被他那喜欢说脏话所吸引，然后随着看得视频越多越发现他说的话真的很有道理，他是一个真正的man。\n他说了一个观点我是深有体会：你可能是个强者，比如你可以跑马拉松拿第一，你可以做200个俯卧撑，你可以成为一个在普通人看来很有毅力的人。但你真的是强者吗？上面所说的这些并不是真正的强者的判断标准，跑马拉松或者做200个俯卧撑，你有一个确定的目标，虽然大多数人连这个也做不到，但是真正的考验在于这些目标都失去后，前路一片黑暗的时候你是否可以坚持下去。不把希望寄托在别人身上或者别人制定的规则身上，才是强者的第一步。你能做10个俯卧撑，那是你的极限，我能做80个，那是我的极限。但是并不能说我比你强，而是说到达极限之后谁能坚持的更久谁才是强者。只有锻炼到一定程度后才发现自己是有多么的weakness，才能更加清楚的认识到自己。\n从上面的观点延伸，如果总是需要将自己的行动力寄托在什么身上，那么是非常容易被打败的，比如你锻炼需要音乐来刺激你，那么如果没有音乐的环境你怎么办？你早上晨跑需要寄托在天气上，如果今天下暴雨呢？你就不锻炼不跑步了吗？他说世界是残酷的，大多数时候我们都会面对不可预料的问题，而真正的强者是不需要寄托与外界。只有这样我们才可能变强。\n他说的这两个观点真的是直击灵魂，而且我也深有感触。不要寄托与希望，不要依靠外界的环境，才能让我们成为一个强者。太多生活中的人当然也包括我，总是在说如果…那么我就…，我们总是需要某些条件ready我们才会do it。而这样真的是一个非常非常弱的人。\n戈金斯的观点太多了，先就说这么两个吧。然后说说泰森，叫他拳皇是真的一点都不为过，40战39胜1败。我主要是被他的力量和灵活的躲闪所吸引，看他的比赛，真的可以看到那种原始的狂野与力量，每一拳都感觉能把一个普通人打晕过去。他的光环与天赋与坚韧不是我想说的重点，我更想说的是他的那些缺点。没错他有很多缺点，如果用我们的观点来看的话，比如随意挥霍金钱，交往20多个女人，在比赛中咬对手的耳朵。很多人因为这些鄙视他，我们其实根本没有权利去指责，因为我们总是站在一个第三者的视角去看待问题。是想一下如果他的人生换成了我们，我们就不会那么去做吗？我想大多数人只会做的更离谱。相反我觉得这样的人生才算是真正的人生，起起伏伏，有辉煌有哀伤，这样才不枉来过这个宇宙一场。\n其实一个人的一生真的会犯很多的错误，那个人敢说自己真的就是正义的化身呢，我们不能总是拿完美无缺的标准去看待这些不平凡的人。说白了他们也是一个普通人，只不过他们更加有机会接近那些丑陋。对于他们自己来说关键在于他们是否会改正，能否摆脱困境。对于我们来说才是体现我们的包容，我想如果我们能够理解这点，那么就能明白仁慈代表的含义是什么了。仁慈不是我们友善，不是你有多么热爱小动物，不是你有多么爱戴老人，而是在动物咬了你一口后，老人碰磁你之后你的表现。他们伤害了我们，我们还能够用平常心对待，这才是仁慈才是包容。\n当然看视频的时候有很多人就如果和李小龙打谁会赢而争吵起来，对于这些观点在我看来有两个问题：\n\n这种假设不会发生，争论真的毫无意义，觉得谁赢这完全是主观判断\n说这种话的人既不了解泰森，也不了解李小龙\n\n我就简单说说我所认识的李小龙吧，从小学开始因为开了《李小龙传奇》就非常迷，希望自己也可以有他那样的功夫。一直到今年，直到我在youtube上开了李小龙的采访，我才明白李小龙并不是我想象中的那样，他更加的伟大。而电视剧真的是误解了李小龙，看了他的采访才知道他是一个多么和蔼的人并不是电视剧中表现的那种争强好胜，也并没有那种愤世嫉俗。虽然他的功夫很强，但真正让我觉得他的伟大无法被超越的却是他的思想。没错，和想象中的不一样李小龙读的是哲学系。他的功夫中无处不蕴含着哲学思想。并没有说因为别人叫他东亚病夫，他就多么仇恨外国人，那只是拍电影，虽然那时美国的思想对他确实有很多歧视，但他在看待国家名族的这些问题上，早已超越时代了。直到今天很多人的思想都赶不上李小龙，比如现在很多人都对日本，美国怀有仇恨。什么打砸日本汽车，抵制这个抵制那个。他们始终没有超越国家的观念，没有更高的眼界，没看到我们同是地球人。而李小龙则并没有给自己贴上一个国家的标签，他所看见的是we are human.\n","categories":["think"],"tags":["思绪"]},{"title":"20220612-善良是如何消失的","url":"/2022/06/12/20220612-%E5%96%84%E8%89%AF%E6%98%AF%E5%A6%82%E4%BD%95%E6%B6%88%E5%A4%B1%E7%9A%84/","content":"20220612yes, today is Sunday. what a pretty name: the day with sunshine in summer, i can even feel the hot and clean wind of outside which has a long way for me now. I am so sad that i live in such a society where forbid us to do almost everything such as ride road bike.\n忧伤像风一样拂过，在这美丽的季节，这遥远的星河。我从未觉得一个人是如此的渺小，我们属于历史，我们被命运束缚，生活在某个特定的时代，无论我们多么强大，也逃不过属于宇宙的一粒尘埃。所以是什么让生活绚烂？\n我相信所有的美好，是他们让生活绚烂。\n在大学的周末，我和芳哥一起去我哥的学校玩，回去的时候在一家饭店吃饭，虽然不记得是在哪里遇到的某个乞讨的人，但是我记得芳哥给了他十/二十块钱。我当时想得是我是不会给这些人钱的，他们明明可以自己去工作，为什么要乞讨？而且那个时候十块或者二十块钱对我来说真的很多，因为我总是要计算一天吃饭只要花十七八块钱。\n毕业整整三年时间里，我也遇到过乞讨的人，然而在我每次遇到的时候，我都感觉自己好慌乱，就像女生主动找我说话。来不及思考他们是骗人的还是真的需要帮助，来不及如何用对话分辨他们的真伪。去年遇到三个女生，在我下班的路上主动找到我，希望我给他们支付一个晚上酒店的钱，她们说身上没有钱了，但是我看他们的穿着打扮就是那种我高攀不起的人。而且在南山区住酒店实在是太贵了，所以我让他们去找社区寻求帮助（虽然我也不知道怎么才能找到社区服务人员，或者他们是否会搭理这几个人）。她们找了一些理由不去找社区，虽然主观上告诉我他们并不是缺钱，但是最后我还是请他们吃了一顿饭，仅仅是因为我实在找不到任何理由来推脱他们的哀求。事后我反思自己要如何在下一次遇到这种情况的时候要像福尔摩斯一样，不要像一个刷卡机器一样。\n前几天我有遇到了这样一种情况，一个打扮的像建筑工地的人，乞讨回家的火车费。那时候我要赶公交车，时间比较紧，所以我直接走过去没理会他，但是突然有一种同情的感觉。因为我想起我的老爸了，这个人也是某个孩子的父亲，没有足够的车票钱他一定很焦急。所以我跑回去把拿了50多块的现金（也是唯一的现金）给了他，我很欣慰有足够的现金，他可以买到票回家了。而且对于有工作的我，这个数量完全比不上大学的时候那个十块钱那么宝贵。然后那一个上午我都沉浸在自我满足的开心中。但是很快我就快乐不起来了，我开始担心这个人会不会也是骗子呢？当时完全是被同情蒙蔽了双眼，没有思考太多。我只能希望这次是真的帮助了对的人。\n然而，现实让一切都显得很苍白，很遗憾过了几天后我又看到他了，同样的穿着，只是稍微换了个地方。当时我觉得好悲伤，为什么我好不容易积攒的一点善良就要被如此的践踏。\n诚实的说，我并没有多么善良，如果需要我给的钱超过200块了，估计我就不会付出了。就像如此的我，也还是希望可以在自己的能力范围内帮助一些人，然而现实的社会显得更加可悲。\n我知道，社会上却是有那么有些人，他们真的需要帮助，然而更多的是骗子，正是这些骗子让人内心深处仅存的一点善良逐渐流失。我们没有精力、能力去分辨真伪。可是，在我们需要用思考来衡量他们是否是骗子的时候，我已经感受到这个社会的可悲了。因为你很难去想象一个gentleman，在英国的街头慷慨的给乞讨的人一些钱，他是需要去判断你是否是一个骗子的。善良本来就是一件不需要思考的事，它是人的天性，我很同情你，在我的能力范围内，我很乐意去帮助你，仅此而已。然而在我们国家呢？大多数人宁愿抚养一个流浪猫，也不会施舍一个乞讨的人。这就是一个社会的性格，我们被教育的不要轻易相信他人，而且被现实一遍一遍的验证这个说法的正确性，而这是一个名族的悲哀。\n很久没看王阳明的书了，但是依旧记得他无数次谈论起当时的社会，快要病入膏肓了。而现在的社会呢？还有好转的可能吗？\n最近很火的一个话题是唐山流氓欺负女生打人的事件，网上有很多人对那些坐在旁边无动于衷的人口诛笔伐。然而，我不会，如果我也在现场，那么我一定是哪个坐在角落默默干饭的人，我承认这种做法是多么的让人无耻。但是各位键盘侠总是站在上帝的角度，他们不会反思，为什么坐在那个角落的人就不能是你呢？那些冷漠的人也是和我们一样的人啊，we share the same blood. 键盘侠们只看到表面，无法深入思考，为什么我们是如此的冷漠？这就是一个社会的习性，这个社会告诉我们无法保护伸张正义的人，只要我们参与了这个事情，那么我们就会陷入危机。那么一个陌生人为什么要让我们陷入危机？我们就是如此自私的思考方式。我无法趾高气扬的指责这些人，我很同情他们，也很可悲。这就是我们生活的环境，一段让人失望的历史阶段。就像开头所说的那样，我们无法左右历史，如果无法磨练自己，那么只会被历史改变。\n最近，我真的很迷david goggins，他说的这句话我印象很深：life is not easy, we must stay hard. 我无法用中文翻译这句话，因为没有合适的语言可以描述他的内涵，就像我们的古诗一样，古诗就是古诗，没法翻译成白话文，如果翻译成了白话文，那就表达不出古诗的含义。是啊，纵观历史，很难说有一个好的时代，so life is not easy, from past to future. we must stay hard, train our mind, our body, make it strong, when the bad situation happened in our life, our group, our members, our family, there comes me who is strong enough to defend all of this. that’s it. stay hard is not to say we need to challenge a task which we don’t wanna to. in some of an aspect  it’s to say we get a plan, whatever something happens, i gonna not to change forever. in some of an aspect it’s to say we cannot make ourselves suitable too long, cause it will make us lazy, we need do something to remind ourselves we are so weakness in this, so never stop our steps.\n当我和同事说起生活不能太舒服要stay hard的时候，他说那么我为什么不跑回家，其实当时我就被他这种提问题的方式惊讶到了，事情并不是说只有正反两个方面，如果你不这样….那么就不怎么样。我只能说他没明白这句话的意义，而且他的这种思考方式也有点让我无法理解，stay hard并不是说马上就要做一个什么一般人无法做到的事情来证明，也不是说要让自己难受，而是一种思想，在心里我们要意识到stay hard，同样在我们做事的时候也要stay hard，不要让放弃这个词出现在脑海。如果某天我真的想从公司跑回家，那么stay hard就可以这么说了。\n","categories":["think"],"tags":["boring"]},{"title":"anaconda","url":"/2022/04/23/anaconda/","content":"Anacondaone year ago, i heared anaconda when i learned python in oneline video tutorial. and how, what is anaconda, it is just a virtual environment of python. why i need it? i have python in my local machine! seems useless\ntoday, i finally realized that it is a amazing tool. since i wrote a python script with python3, it runs perfect locally. however in the real environment(remote machine), i cannot run it. because remote machine is python2.6 and also cannot install modules oneline. i tried several ways: such as packing modules, compiling python3 from source. all failed!\nfinally, i remember it, yeah, anaconda! and it is really so good, it can be installed in different os without dependent error and includes all modules which i need. amazing!\nfeatures\neasily in use\n\npurely installed without dependence error in whatever os\n\ninclude many modules what we used daily\n\nmulti different virtual environment, each of them without any relation\n\nwithout any affect to local environment\n\n\ninstalldownload from website, it has two choice:\n\nanaconda: include 1500+ modules, especially scientific packages and 3 GB storage disk needed \nminianaconda: without scientific packages, but enough for daily usage and 400Mib storage disk needed\n\ni download the minimal package\nthe installation in linux is easy\n\ndownload package\n\ngrant priviledge and execute\nchmod u+x Miniconda3-py39_4.9.2-Linux-x86_64.sh\n./Miniconda3-py39_4.9.2-Linux-x86_64.sh\n\n\nstep by step\n\nnote: \n   the place anaconda installed should be a folder that doesn’t exist\n\nDo you accept the license terms? [yes|no]\n[no] &gt;&gt;&gt; yes\n\nMiniconda3 will now be installed into this location:\n/home/blueocean/miniconda3\n\n  - Press ENTER to confirm the location\n  - Press CTRL-C to abort the installation\n  - Or specify a different location below\n\n[/home/blueocean/miniconda3] &gt;&gt;&gt; /home/blueocean/.local/apps/minicanda\n\nDo you wish the installer to initialize Miniconda3\nby running conda init? [yes|no]\n[no] &gt;&gt;&gt; yes\n\nmodified      `/home/blueocean/.zshrc`\n\n\nreopen terminal or source the environment variables where conda’s config stores, in my case it is in ~/.zshrc \n\ndisable auto enter conda base environment\nin default conda will auto active when we start up a terminal. that’s not i want, so change it.\nconda config --set auto_activate_base false\n# and check\nconda config --show|grep base\n\n\n\nusagefull document follow this page\nlogin/logout environmentafter installation completes without error, we can reopen terminal or source the file where installation modified with source ~/.zshrc\n~ » source .zshrc                                                                         \n(base) ~ »         \n\nit is obviously that the promt changed, we can also modify prompt with --set env_prompt\nconda config --set env_prompt &#39;(&#123;conda&#125;)&#39;\n\nafter source file, we enter the default base environment which was created while installing. we can list the environment that we have created with conda env list\n(base) ~ » conda env list                                                                 \n# conda environments:\n#\nbase                  *  /home/blueocean/.local/apps/minicanda\n\ncheck conda version\n(base) ~ » conda --version                                                               \nconda 4.9.2\n\n\nif versions prior to 4.6\n\nenter environment\nsource activate conda_env_name\n\n\nexit environment\nsource deactivate\n\n\n\n\nif versions higher than 4.6\n\nenter environment\nconda activate conda_env_name\n\n\nexit environment\nconda deactivate\n\n\n\n\n\ncreate new environmentbefore we install packages, we need config download mirrors, without configure will lead to installation failed for slowly download speed.\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2\n\nif the channel added is wrong, we can remove it by\nconda config --remove channels mirrors_url\n# such as\nconda config --remove channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r\n\ncheck channels config now\nconda config --show channels\n\ncreate environment \n# syntax\nconda create --name conda_env_name install_module_name\n\nwhen we don’t specify python version, conda will install the newest python version. if we want to use a different versin of python, for example python 2.6, simply create a new environment and specify the version of Python that you want.\nconda create --name snowflakes python2.6\n\nif we have multi modules need to be installed, we should write in one line to avoid depences missing.\n# such as install pandas xlwt pathlib module\nconda create --name sky pandas xlwt pathlib\n\ncheck new environment\nconda env list\n\npack environmentwith conda-pack, we can pack environment to any other location and any other os.\n\nnote:\n   os means the same platform, such as cannot pack one linux environment to windows\n\ninstall conda-pack with conda\nit is recommended to install conda-pack into base environment, since it can be used in all other sub environment\nconda install conda-pack\n\npack environment\n# pack into ./env_name.tar.gz\nconda pack --name env_name\n\n# pack into /specified/location/path/env_name.tar.gz\nconda pack --prefix /store/location/path\n\n# change out name\nconda pack --output my_env_name.tar.gz\n\nunpack environment\nthe condition we can use conda-pack is that there has a conda installed on the target machine.\n\nnote:\nthe place we unpack can be two parts:\n1. under base environment `envs` floder\n2. any other folder\n\n\n# create a folder named the same as package\nmkdir /environment/stored/env_name\n\n# or store it in default base envs\nmkdir /path/to/base/envs\n\n# extract package\ntar -xzf env_name.tar.gz -C /path/to/create/folder\n\n# if not in base envs, activate environment, this will add env_name/bin to your path\nsource env_name/bin/activate\n# if in base envs, activate environment with conda directory\nconda activate env_name\n\n# unpack \nconda-unpack\n\n# deactivate if not in default base envs, this will remove it from you path\nsource env_name/bin/deactivate\n# if in base envs, activate environment with conda directory\nconda deactivate\n\n","categories":["learn"],"tags":["anaconda"]},{"title":"anbox","url":"/2022/04/23/anbox/","content":"AnboxIn this article i will show you how to install anbox with snap and compare snap with flatpak.  anbox is a container-based software for running Android in linux. be different from virtual machine, anbox uses kernel module binder and ashmem to share and devide system source, thus it starts up very quickly.\nsnap vs flatpaksnap or flatpak is a cross platform package manager in different linux OS, which stores packages in a independent environment and improves security of system. whatever to say, both of them are not perfect as what i want. why i use it? i hope to install large size software in another disk partition but not the system tree in linux, if there is a need to reinstall the system, i don’t need to reinstall the software itself, one thing i need  is installing the snap package.\ndisadvantages:\n\nsnap doesn’t allow to specify package location, so we need to mount bind to that location.\nflatpak doesn’t have above disadvantages but the software size is too large and has less software than snap.\n\ni choose snap at last, the main reason in this case is that only snap has anbox package.\nchange kernelkernel module\ndefault linux kernel doesn’t has anbox needed modules, a simple way is installing a linux-zen kernel\npacman -S linux-zen\n\nthen we need edit /boot/grub/grub.cfg file, adding a sub entry with the new kernel. once we boot in grub, we can choose the  new kernel by hand.\n    menuentry &#39;Arch Linux, with Linux-zen linux&#39; --class arch --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-linux-advanced-20f94885-274b-4a99-b067-a0adf09a1723&#39; &#123;\n        .\n        .\n        .\n        echo    &#39;Loading Linux-zen linux ...&#39;\n        linux    /boot/vmlinuz-linux-zen root=UUID=20f94885-274b-4a99-b067-a0adf09a1723 rw  loglevel=3 quiet\n        echo    &#39;Loading initial ramdisk ...&#39;\n        initrd    /boot/initramfs-linux-zen.img\n    &#125;\n\nsnap installsnap package location change\nsnap has no method to specify package location, but we can use mount bind to mount other location to the package folder\n# snap package folder is  /var/lib/snapd\n# before install snap, mount folder to that folder\nmkdir /home/healer/Public/snapd\nsudo mkdir /var/lib/snapd\nsudo mount --bind /home/healer/Public/snapd /var/lib/snapd\n\nabove command will make effect until reboot, so we need write mount command to /etc/fstab in order to auto mount after system reboot.\nsudo vim /etc/fstab\n\n/home/healer/Public/snapd    /var/lib/snapd    none    bind    0 0\n\ninstall snap\nparu -S snapd\n\nstart snap\nsudo systemctl enable --now snapd.socket\n\nadd hosts entry\nby default the speed snap downloads is slow, we need add dns to hosts file\necho &quot;151.101.62.217  fastly.cdn.snapcraft.io&quot; &gt;&gt; /etc/hosts\n\nsome snap commands\n# update\nsnap refresh\n# search\nsnap find package-name\n# install\nsnap install package-name\n# uninstall\nsnap uninstall package-name\n# list installed package \nsnap list\n\nanbox installwe can find all snap packages in this website\nsnap install --devmode --beta anbox\n\nrun anbox first time\n/var/lib/snapd/snap/bin/anbox launch --package=org.anbox.appmgr --component=org.anbox.appmgr.AppViewActivity\n\nafter system reboot we can start anbox via system launch app or dmenu\ninstall apk in anboxby default, anbox has no app store in it, so we need install a app store to it. the method we use is adb\n# adb is part of android-tools package\nsudo pacman -S android-tools\n\n# such as download a coolan apk from web browser and install it to anbox\nadb install Coolapk-11.4.2-2109281-coolapk-app-sign.apk\n\nflatpakinstall\nat last, i want to record the flatpak installation and usage. in a fact that flatpak is really easy to install or use.\n# install\nsudo pacman -S flatpak\n\nadd repo\nwe need to know that the package store location is defined by --user parameter. however the parameter takes effect only when we specify the user repo before. by default our repository is system, so we need add user repository manually.\n# system\nflatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo\n# user\nflatpak remote-add --user --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo\n# check repo\nflatpak remotes\n\nusage\nfind support packages and package install commands in this website\n# eg:\n# install firefox in user location\nflatpak install --user flathub org.mozilla.firefox\n\nuser package location is ~/.local/share/flatpak\n# start with command\nflatpak run org.mozilla.firefox\n\n# or directly\nfirefox\n\n# or find it in package launch manager such as dmenu or rofi\n\nsome commands\n# update\nflaptak update\n# search \nflatpak search package-name\n# install\nflatpak install package-name\n# uninstall\nflatpak uninstall package-name\n# list installed package\nflatpak list\n\n","categories":["learn"],"tags":["anbox"]},{"title":"ansible","url":"/2022/04/23/ansible/","content":"Ansibleansible is a software without the concept of server or client, but it can do the job of cluster management. the magic is that it uses ssh to connect to other os, that’s it. it can do all of the thing what you do in hosts.\nfeatures\nno client\nvia ssh\nmoduled\nyaml file\nparallel\n\nfunction\nsoftware deployment, install software via ansible\nconfiguration management, configure system via ansible\nsoftware provisioning\n\ninstallin centos\nyum install epel-release -y\nyum install ansible -y\n\nin archlinux\npacman -S ansible\n\nsyntaxansible host_pattern action\n# or\nansible-playbook host_pattern\n\ninventory fileif only one ip address to connect, we can write it directly. if more than one ip address we can write it in a special file called inventory file.\ninventory file is a file that ansible store variable messages(such as ip, login user name, password etc). the default file is /etc/ansible/hosts. we can simplily put ip in the file, however the way much better is group hosts.\n[group_name]\nhost_ip_1\nhost_ip_2\nhost_ip_3\n\neg:\n[testCentos]\n192.168.31.114\n\nthen we can list all host in this file by\n# ansible all --list-hosts\n  hosts (1):\n    192.168.31.114\n\nif we know group name, we can specify group to show\n# ansible testCentos --list-hosts\n  hosts (1):\n    192.168.31.114\n\nwe can also specify ourself inventory file. there are two methords.\n\nchange the default location in /etc/ansible/ansible.cfg\ninventory      = /any/other/file/location\n\n\nspecify by parameter\nmake personal inventory file\necho &quot;\n[testCentos]\n192.168.31.114\n&quot; &gt;&gt; ip_addr.txt\n\nuse --inventory to define.\nansible --inventory ./ip_addr.txt all --list-hosts\n\n\n\nmodulemodule in ansible is command collection. we can find module help by\nansible-doc module_name\n\nsuch as find shell module usage \nansible-doc shell\n\ncheck total module in local machine\nansible-doc --list | wc -l\n\nwe can use those modules by --module-name.\nAd-hocAd-hoc commands in ansible means those one-line commands run in hosts. it is easy, simple without multi tasks to run. so if we just wanna to do a simple task, we can write Ad-hoc. for example check connection with machine.\none ip can write directly\nansible 192.168.31.114 --module-name ping\n\n# ansible all --module-name ping\nThe authenticity of host &#39;192.168.31.114 (192.168.31.114)&#39; can&#39;t be established.\nECDSA key fingerprint is SHA256:LzEdo+P7rgs1gJgODVWJaPFgHKk+Zl8/9ULzGN6z/8Q.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? no\n192.168.31.114 | UNREACHABLE! =&gt; &#123;\n    &quot;changed&quot;: false,\n    &quot;msg&quot;: &quot;Failed to connect to the host via ssh: Host key verification failed.&quot;,\n    &quot;unreachable&quot;: true\n&#125;\n\nif we have ever not connect to the hosts, it may get an error msg, at this time we need to type password by adding --ask-pass\n# ansible all --module-name ping --ask-pass\nSSH password: \n192.168.31.114 | FAILED! =&gt; &#123;\n    &quot;msg&quot;: &quot;Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host&#39;s fingerprint to your known_hosts file to manage this host.&quot;\n&#125;\n\nokay, it says that the default config has enabled host key check, so we need disable it\nvim /etc/ansible/ansible.cfg\n\n# uncomment to disable host key check\nhost_key_checking = False\n\nthen, run command again\n# ansible all --module-name ping --ask-pass\nSSH password: \n192.168.31.114 | SUCCESS =&gt; &#123;\n    &quot;ansible_facts&quot;: &#123;\n        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;\n    &#125;,\n    &quot;changed&quot;: false,\n    &quot;ping&quot;: &quot;pong&quot;\n&#125;\n\nyes, we get it. &quot;changed&quot;: false above means we don’t change anything in remote machine.\n\nNote:\n\ninstead of typing password every times, the recommand way is configuring ansible machine connects to remote machine without password (put ansible ssh public key to remote machine).\nif we don’t specify a login user, it will use ansible machine login user name, we can use --user user_name to specify other login user.\nwe can use --ask-pass to input login user password\n\n\n# ansible testCentos --ask-pass --user root --module-name shell --args &quot;ip -c -br a&quot;           \nSSH password: \n192.168.31.114 | CHANGED | rc=0 &gt;&gt;\nlo               UNKNOWN        127.0.0.1/8 ::1/128 \nenp0s3           UP             192.168.31.114/24 fe80::cd8e:43e4:458d:9ab3/64\n\n\nNote:\ncommand module can only be used in one command with its parameter, one liner command(several commands connected with &amp;&amp;, ;, |, &gt;) need use shell module.\n\nsometimes, we cannot login directly with root user, but we need root priviledge. there are two ways:\n\n if the login user has sudo priviledge\n\nansible all --user login_user --ask-pass --become --become-user root --ask-become-pass --module-name shell --args &quot;systemctl restart network&quot;\n\n\nif the login user has no sudo priviledge, then we need to change to root user with su\nansible all --user login_user --ask-pass --become --become-user root --become-method su --ask-become-pass --module-name shell --args &quot;systemctl restart network&quot;\n\n\n\nvariable of user name and passwordokay, as we write above, if we want to execute some command in remote machine, a login user and password is needed. we can use --user and --ask-pass then typing in terminal, and there is another way without typing.\nansible has already defined this variables. the thing that we need to do is sign a value to it. there are four  ways.\n\nwrite in inventory file.\nif we only specify a group login info, we can use [group_name:vars]. if we define global login info, we can use [all:vars].\n[testCentos]\n192.168.31.114\n\n[testCentos:vars]\nansible_ssh_user=test\nansible_ssh_pass=123\nansible_become_pass=123456\n\nthen execute without password input\nansible --inventory ./hosts all --module-name shell --args &quot;ps -ef|grep sshd&quot; --become --become-user root --become-method su\n\n\nwrite in playbook file playbook.yml\ntouch playbook.yml\n\n---\n- hosts: testCentos\n  vars:\n    ansible_ssh_user: test\n    ansible_ssh_pass: 123\n    ansible_become_pass: 123456\n  gather_facts: no\n  tasks:\n    - name: copy file to remote\n      become: yes\n      become_user: root\n      become_method: su\n      copy:\n          src: /tmp/hosts\n       dest: /root\n\nthen execute\nansible --inventory ./hosts playbook.yml\n\n\nwrite in a seperate variable file\nin this way , we need to import the file in playbook\n# touch ansible_vars.yml\n\n---\nansible_ssh_user=test\nansible_ssh_pass=123\nansible_become_pass=123456\n\n# import variable file in playbook\n\n- hosts: testCentos\n  vars_files:\n    - ./ansible_vars.yml\n  gather_facts: no\n  tasks:\n    - name: check sshd status\n      become: yes\n      become_user: root\n      become_method: su\n      shell: ps -ef|grep sshd|grep -v grep\n\n\nwrite in specify floder group_vars\nin the way, we write a yaml variable’s file in group_vars and named with the same group name as inventory file.  and we don’t need to import the variable file by this way.\n# in ansible working folder make a folder named group_vars\nmkdir group_vars\n\n# in group_vars, make group name file and write variables\ntouch testCentos\necho &quot;\n---\nansible_ssh_user=test\nansible_ssh_pass=123\nansible_become_pass=123456\n&quot; &gt;&gt; testCentos\n\nnote: if we wanna to define global variable, we need to make a file named all\n\n\n\nNote:\nbecome_method: su is very useful , default is use sudo method, however most of time we are not in sudo group. but with su method, we login with root then execute command.\n\n\nvars: collection of variables\nname: what kind of thing the task does\nansible_ssh_user: login user name\nansible_ssh_pass: login user password\nansible_become_pass: root user password\ngather_facts: whether will we collect remote machine info, don’t gather saves lot of time\nbecome: change user or not \nbecome_user:  default \nuse sudo to run the tasks\nbecome_method: su: don’t use sudo, login with root. it is very userful when we have no sudo priviledge \nshell: run linux shell command.\n\nplaybookwhat is playbook? playbook is a set of Ad-hoc tasks writing in a yaml file. the method to execute playbook different from Ad-hoc. use ansible-playbook instead of ansible\n# such as i make a playbook file named playbook.yml\nansible-playbook playbook.yml\n\nfor example\n# hosts file\n\n[testCentos]\n192.168.31.114\n\n# playbook\n\n---\n- hosts: testCentos\n  gather_facts: no\n  become: yes\n  become_user: root\n  become_method: su\n  vars:\n    ansible_ssh_user: test\n    ansible_ssh_pass: 123\n    ansible_become_pass: 123456\n    pkgname: nginx\n  tasks:\n    - name: add nginx resource\n      shell: rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n    - name: install &#123;&#123;pkgname&#125;&#125;\n      yum: name=&#123;&#123;pkgname&#125;&#125; state=present\n      notify:\n        - restart &#123;&#123;pkgname&#125;&#125;\n    - name: start at boot\n      systemd: name=&#123;&#123;pkgname&#125;&#125; state=started enabled=yes\n    - name: open firewalld 80 port\n      shell: |\n        firewall-cmd --zone=public --permanent --add-port=80/tcp\n        firewall-cmd --reload\n  handlers:\n    - name: restart &#123;&#123;pkgname&#125;&#125;\n      systemd: name=&#123;&#123;pkgname&#125;&#125; state=restarted\n\nexecute\nansible-playbook --inventroy hosts playbook.yml\n\nthen we can visit nginx web page at http://192.168.31.114\nabove we used modules: \n​    shell to execute shell command \n​    yum to download nginx \n​    systemd to start and enable nginx auto start.\nwe also used notify: when task execute successfully, it will raise a notify.\nwe also used handlers: to receive notify and execute others\nwe also used vars: it anounced serveral variables, and we can call it with &#123;&#123;variable_name&#125;&#125;\n\nnote:\nwe may say we can use shell instead of yum or systemd module, yeah, you can do it like that, but the best way is using available modules.\nuse | to combine multi line into one line. it is useful to execute more than one command.\n\nconditionwe use when condition to do logical judge. register to store return value. failed_when:no to continue when return value isn’t true(in default task will stop when return value is false).\nas we write above, if we execute again, it may failed because we already have a nginx repo. so what should we do? we need to check whether exists nginx repo. if exists then jump\n...\n  tasks:\n    - name: check whether nginx repo added\n      shell: ls /etc/yum.repos.d/ | grep nginx\n      register: repo\n      failed_when: no\n    - name: add nginx resource\n      shell: rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n      when: repo.rc == 1\n...\n\nloopwe can use loop syntax in ansible playbook. use with_items to loop list. the variable default \n---\n- hosts: testCentos\n  gather_facts: no\n  become: yes\n  become_user: root\n  become_method: su\n  tasks:\n    - name: install software\n      yum: name=&#123;&#123; item &#125;&#125; state=present\n      with_items:\n        - curl\n        - wget\n\nansible » ansible-playbook --inventory hosts playbook.yml                                                                         \n\nPLAY [testCentos] **************************************************************************************************************************************************************************\n\nTASK [install software] ********************************************************************************************************************************************************************\nchanged: [192.168.31.114] =&gt; (item=[&#39;curl&#39;, &#39;wget&#39;])\n\nPLAY RECAP *********************************************************************************************************************************************************************************\n192.168.31.114             : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\ntagswith tags, we can specify which task to be execute in shell command\n\nwrite tag at the end of task\n---\n- hosts: testCentos\n  gather_facts: no\n  become: yes\n  become_user: root\n  become_method: su\n  tasks:\n    - name: install curl\n      yum: name=curl state=present\n      tags:\n        - curl\n    - name: install wget\n      yum: name=wget state=present\n      tags:\n        - wget\n\n\nspecify which task should be execute by using --tags tag_name\n\n\nansible » ansible-playbook --inventory hosts playbook.yml --tags wget                                                         \n \n PLAY [testCentos] **************************************************************************************************************************************************************************\n \n TASK [install wget] ************************************************************************************************************************************************************************\n ok: [192.168.31.114]\n \n PLAY RECAP *********************************************************************************************************************************************************************************\n 192.168.31.114             : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   \n\nblockblock can help us execute multi task in one condition.\n---\n- hosts: testCentos\n  gather_facts: no\n  become: yes\n  become_user: root\n  become_method: su\n  tasks:\n    - name: check network\n      shell: ping www.baidu.com -c 3\n      register: connect\n    - name: install curl\n      block:\n        - yum: name=curl state=present\n        - yum: name=wget state=present\n      when: connect.rc == 0\n\nAnsible Toweransible tower is a paid software(not free) aiming provide an easy usage gui for ansible. before install, we need to know the minimal machine requirement\n\ncpu: 2 core\nmem: 4Gib\nsoftware size: almost 2 Gib\n\ninstalldownload tar.gz it from this website, then extract\ntar -xzf ansible-tower-setup-3.6.0-1.tar.gz -C /opt\n\nbefore installing, we need to add password to inventory configure file\ncd /opt/ansible-tower-setup-3.6.0-1\n\n# for example, not exactly the same as below. but need to fill all empty password\nadmin_password=&#39;ansible&#39;\npg_password=&#39;ansible&#39;\nrabbitmq_password=&#39;ansible&#39;\n\nthen install with a shell script. may be a coffee time\n./setup.sh\n\nwhen all tasks execute successfully. we can visit the web page with https://ip\n\nthe default user name is admin, and the password is what you typed in inventory file.\nlicense hackas we mentioned before, ansible tower is a paid software, so we cannot login the main page. however there is a way to hack the license and making it valid forever.\n# add epel repo\nyum -y install epel-release\n\n# install pip\nyum -y install python-pip\n\n# download reverse compile module\npip install uncompyle6\n\n# change to license diretory\ncd /var/lib/awx/venv/awx/lib/python3.6/site-packages/tower_license\n\n# reverse compile init file\nuncompyle6 __init__.pyc &gt; __init__.py\n\n# change reversed compile file\nvi __init__.py\n\n# at line 84, remove last character &quot;L&quot;\n\n# after line 89, add a new line with &quot;return True&quot;\n\n# compile it\npython -m py_compile __init__.py\npython -O -m py_compile __init__.py\n\n# restart ansible-tower-service\nansible-tower-service restart\n\nfile __init__.py changed like this:\n\nthen we can login the main page, and check it’s license.\n\nthe default main page of ansible tower looks like this\n\ntemplatea template to execute command in remote and check remote service status\nip_info\n[client1]\n192.168.31.197\n192.168.31.196\n\n[client2]\n192.168.31.182\n\n[client1:vars]\nansible_ssh_user=ngus\nansible_ssh_pass=123\nansible_become_pass=123456\n\n[client2:vars]\nansible_ssh_user=dba\nansible_ssh_pass=321\nansible_become_pass=654321\n\nyaml file: playbook.yaml\n---\n- hosts: all\n  gather_facts: no\n  become: yes\n  become_user: root\n  become_method: su\n  tasks:\n      - name: install client\n        shell: &#123;&#123;command here&#125;&#125;\n        register: install_status\n        failed_when: no\n        tags:\n          - install\n      - name: check client status\n        shell: ps -ef |grep service_name\n        tags: \n          - check\n...\n\nrun with command\n## install\nansible-playbook --inventory ip_info playbook.yaml --tag install\n## check\nansible-playbook --inventory ip_info playbook.yaml --tag check\n\n","categories":["learn"],"tags":["ansible"]},{"title":"bing壁纸设置","url":"/2022/05/29/bing%E5%A3%81%E7%BA%B8%E8%AE%BE%E7%BD%AE/","content":"The way to set wallpaper with bing daily img之前写过一个shell脚本，用来设置bing的每日壁纸作为桌面壁纸，但是发现失效了，只能下载当天的，没法选择以前的。所以今天重新写一遍\n之前使用的是api链接后面添加数字来表示天数，但是现在不是这样的方式了。而是用一个api获取所有数据。\n\n\n所以重新写了一遍（发现很长时间不用就有很多不熟悉的知识）\n#!/bin/bash\n#               _ _                             \n#__      ____ _| | |_ __   __ _ _ __   ___ _ __ \n#\\ \\ /\\ / / _` | | | &#39;_ \\ / _` | &#39;_ \\ / _ \\ &#39;__|\n# \\ V  V / (_| | | | |_) | (_| | |_) |  __/ |   \n#  \\_/\\_/ \\__,_|_|_| .__/ \\__,_| .__/ \\___|_|   \n#                  |_|         |_|              \n\n\n# specify download tmp location\ntmp_dir=&quot;/tmp&quot;\n# sepcify store location\ndefault_dir=&quot;$&#123;HOME&#125;/Pictures/background&quot;\n# specify default picture local dir\ndefault_pic=&quot;$&#123;HOME&#125;/Pictures/background/splash.png&quot;\n# specify bing image gallery api\napi=&quot;https://cn.bing.com/hp/api/v1/imagegallery?format=json&quot;\n# specify dynamic change time\ndynamic_time=&quot;600&quot;\n\n\n# save args\nmethod=$&#123;1:-&quot;&quot;&#125;\nlocation=$&#123;2:-&quot;&quot;&#125;\ndownload_or_not=$&#123;3:-&quot;&quot;&#125;\n\n# function for sure no backend exists\nfunction no_backend()&#123;\n    [[ `ps -ef | grep wallpaper | grep -v grep | wc -l` -gt 2 ]] &amp;&amp; &#123;\n        kill `ps -ef | grep wallpaper | head -1 | awk &#39;&#123;print $2&#125;&#39;`\n    &#125; \n&#125;\n\n# function for notify\nfunction notify()&#123;\n    info=$@\n    notify-send &quot;$&#123;info&#125;&quot;\n&#125;\n\n# function for setting static wallpaper\nfunction static_bg()&#123;\n    [[ -f $&#123;location&#125; ]] &amp;&amp; feh --bg-scale $&#123;location&#125; || &#123;\n        feh --bg-scale $&#123;default_pic&#125;\n        notify &quot;wrong picture path!&quot; \n    &#125;\n&#125;\n\n# function for setting dynamic wallpaper\nfunction dynamic_bg()&#123;\n    &#123;\n        while :\n        do\n            [[ -d $&#123;location&#125; ]] &amp;&amp; feh -D 1 -z --bg-scale $&#123;location&#125; || &#123;\n                static_bg $&#123;default_pic&#125;\n                notify &quot;no specify directory or wrong path!&quot;\n            &#125;\n            sleep $&#123;dynamic_time&#125;\n        done\n    &#125; &amp; \n&#125;\n\n# function for setting bing wallpaper\nfunction bing_bg()&#123;\n    day=$1\n    download_or_not=$2\n    timeout 1 ping -c 1 -q www.bing.com &amp;&gt;/dev/null &amp;&amp; &#123;\n        urls=`curl -s &quot;$&#123;api&#125;&quot; |jq &#39;[.data.images[] | .imageUrls | .landscape | .wallpaper]&#39;`\n        url=`echo $urls |jq &quot;.[$&#123;day&#125;]&quot; |tr -d &#39;&quot;&#39;`\n        link=&quot;https://www.bing.com$&#123;url&#125;&quot;\n        wallpaper_name=`echo $&#123;link&#125; |cut -d. -f4 |cut -d_ -f1`\n        [[ $&#123;download_or_not&#125; == &quot;download&quot; ]] &amp;&amp; &#123;\n            &#123;\n                wget $&#123;link&#125; -P $&#123;tmp_dir&#125; &amp;&gt;/dev/null &amp;&amp; &#123;\n                    mv /tmp/*$&#123;wallpaper_name&#125;* /tmp/$&#123;wallpaper_name&#125;.jpg\n                    mv /tmp/$&#123;wallpaper_name&#125;.jpg $&#123;default_dir&#125;\n                    notify &quot;download $&#123;wallpaper_name&#125; to $&#123;default_dir&#125;&quot;\n                &#125;\n            &#125; || notify &quot;download error!&quot;\n        &#125;\n    &#125; \n    feh --bg-scale $&#123;link&#125;\n&#125;\n\n# function for help message\nfunction exit_with_help()&#123;\n    echo &quot;parameter error! try:\n    wallpaper static /file/location\n    wallpaper dynamic /folder/location\n    wallpaper bing\n    wallpaper bing 0~6\n    wallpaper bing 0~6 download&quot;\n    exit 1\n&#125;\n\n# choose which methods to use\n[[ $&#123;method&#125; != &quot;&quot; ]] &amp;&amp; &#123;\n    [[ $&#123;location&#125; != &quot;&quot; ]] &amp;&amp; &#123;\n        if [ $&#123;method&#125; == &quot;static&quot; ];then\n            no_backend\n            static_bg $&#123;location&#125;\n        elif [ $&#123;method&#125; == &quot;dynamic&quot; ];then\n            no_backend\n            dynamic_bg $&#123;location&#125;\n        elif [ $&#123;method&#125; == &quot;bing&quot; ];then\n            no_backend\n            bing_bg $&#123;location&#125; $&#123;download_or_not&#125;\n        fi\n    &#125; || exit_with_help\n&#125; || exit_with_help\n\n","categories":["learn"],"tags":["shell"]},{"title":"create-cursor","url":"/2022/06/24/create-cursor/","content":"Self Define Cursor ThemeBecause i use a pen tablet rather than a regular mouse, so i wanna to find a cursor theme suit for my need which has a circle rather than pointer, however i find no, then i decide to create myself cursor theme.\nFinally i find the method, with the command xcursorgen we can easily create a cursor from a png image or a series of png images to create a animated cursor.\nMain Steps\nuse image editor to create square png image, i choose gimp.\nusually use 32x32 pixels, i just choose 12x12 pixels for a little circle. save with background transparency circle.png.\n\nfind the pointer’s tip with x,y coordinate(gimp will show the x,y when hover image position).\ni choose 6 6 which the center of circle\n\n create a configure file circle.cursor\n\n\nimage-size x y image-name\n\n# eg:\n12 6 6 circle.png\n\n\nproduct the final cursor file\nxcursorgen configure-file final-cursor-name\n\n# eg:\nxcursorgen circle.cursor circle\n\n\nput final cursor file to personal cursor folder\nmkdir ~/.icons/my-cursor\ncp circle ~/.icons/my-cursor/circle\n\n\nlink to new created cursor\nthe cursor pointer is called left_ptr under ~/.icons/Layan-cursors/cursors (the folder name maybe different, it is depend on your cursor theme), which is linked to default by default.\nwe need relink to our new cursor\nln -sf ~/.icons/my-cursor/circle left_ptr\n\n\nmake it effect\nxsetroot -cursor_name left_ptr\n\n\n\nAnimate Cursoranimate cursor is also simple to create, the only difference is we need create more than one png images and give them a showing time in configure file.\nsuch as i create two png images:\ncircle.png\ncircle-light.png\n\nand then in configure file\n12 6 6 circle.png 5000\n12 6 6 circle-light.png 100\n\nnote that the showing time unit is microseconds\nabove means showing circle.png 5 seconds and then circle-light.png 0.1 seconds, and then repeat.\n","categories":["linux"],"tags":["cursor theme"]},{"title":"ed","url":"/2022/04/23/ed/","content":"EDed是一个unix默认的编辑器，是操作系统自带的编辑器，如果在某些场景下没有vim编辑器，那么ed就可以派上用场的\n大多数ed的命令和vim一致\nsimple open / quit file\n# ed without parameter open a text buffer\ned\n\n# ed with a filename open a file and make changes to the copy of file buffer\ned file.txt\n\n# exit ed with warn\nq\n\n# exit without warn\nQ\n\n# write changes to file\nw\n\n# open content to file\nf filename\n\n# open content file and write to file\nf filename\nw\n\n# or\nw filename\n\nprompt/command mode and input mode\nwhile opening file, will locate in the last line of file with prompt mode\n# default will enter prompt mode, in this mode we can execute command\n# `P` toggles prompt on or off \nP\n\n# trun display error message on\nH\n\n# !command allow us to execute shell command\n!command\n\n# read output of command and write to buffer\nr !command\n\n# enter input mode: `a` append; `i` insert; `c` change\na\ni\nc\n\n# `.` exit input mode\n.\n\n, usage\n# `,` means all lines\n\n# print last line, in default, will show the last line\np\n\n# print all lines\n,p\n\n# delete one line\nd\n\n# delete all lines\n,d\n\n# usage\n# `#` in prompt mode means ignore\n# this line will be ignored\n\n# `#` in input mode means nothing but a character\n\nnum to locate\n# in default, will locate the last line, num will locate other line\n# 1 locate line 1\n1\n\n# enter will locate to end line one by one\n\n# move option after num\n2s/hell/hello\n\n# move current line to line 1\nm0\n\n# move line 10 to line 1 and print\n10m0p\n\nline address\n.    #The current line (address) in the buffer.\n$    #The last line in the buffer.\nn    #The nth line in the buffer, where n is a number in the range &#39;0,$&#39;.\n+n   #The nth next line, where n is a non-negative number.\n-n   #The nth previous line, where n is a non-negative number.\n+    #The next line. This is equivalent to &#39;+1&#39; and may be repeated with cumulative effect.\n-    #The previous line. This is equivalent to &#39;-1&#39; and may be repeated with cumulative effect.\n,    #The first through last lines in the buffer. This is equivalent to the address range &#39;1,$&#39;.\n;    #The current through last lines in the buffer. This is equivalent to the address range &#39;.;$&#39;.\n/re/ #The next line containing the regular expression re. The search wraps to the beginning of the               buffer and continues down to the current line, if necessary.\n?re? #The previous line containing the regular expression re. The search wraps to the end of the buffer      and continues up to the current line, if necessary.\n&#39;x   #The apostrophe-x character pair addresses the line previously marked by a &#39;k&#39; (mark) command,           where &#39;x&#39; is a lower case letter from the portable character set &#39;[a-z]&#39;.\n\nother important command\n# print line with line number\n,n\n\n# undo changes\nu\n\n# copy current line to specified line\nt2\n\n# show content with keyword position. eg:display content from starting with `#` to now.\n?^#?,.p\n\n# global search\n1,$g/&lt;pattern&gt;/p\n# or\n,g/&lt;pattern&gt;/p\n\n","categories":["learn"],"tags":["ed"]},{"title":"firefox-extension","url":"/2022/05/24/firefox-extension/","content":"firefox extension\nI may never wondering there comes a day that i will learn to write a firefox extension, because all most the time i need is to download some one for adds on. But when i get a job, and need to view one web page ten to hundred times, then i really want to do some optimize with the page just wish to improve the usability. And when i write this note, i only learned a little, however i think it is better to do rather than not.\n\nThe main goals that i want to achieve are:\n\nedit the color style of a page\nautomatically choose/click button\nintelligent filling/adjust what i typed in\n\nthe way to realize\ninject css file to web page when we open one url, to customize page style \ninject js file to web page(we all know how powerful the js is) to do everything else\n\nmy first extension with temporary loadingat first we need a folder to store all files\ntouch chcolor\n\nthen create folder and file like this\n── chcolor\n   ├── icons\n   │  ├── 32.png\n   │  ├── 48.png\n   ├── manifest.json\n   └── scripts\n      ├── modify.js\n      └── theme.css\n\n\nmanifest.json is the main file to describe everything else\nicons folder includes all the icons used in adds on\nscripts folder store our main js and css file\n\nmainfest.jsondescribe which icon the extension use and which url will be match, which js and css file we use.\n&#123;\n    &quot;manifest_version&quot;: 2,\n    &quot;name&quot;: &quot;chcolor&quot;,\n    &quot;version&quot;: &quot;1.0&quot;,\n\n    &quot;description&quot;: &quot;testing and learning&quot;,\n\n    &quot;icons&quot;: &#123;\n        &quot;48&quot;: &quot;icons/48.png&quot;\n    &#125;,\n\n    &quot;content_scripts&quot;:[\n        &#123;\n            &quot;matches&quot;:[&quot;*://*.baidu.com/*&quot;],\n            &quot;js&quot;:[&quot;scripts/modify.js&quot;],\n            &quot;css&quot;:[&quot;scripts/theme.css&quot;]\n        &#125;\n    ]\n&#125;\n\ninject css file to web pageif we want to customized the style of web page, at first we need to find the css in web page and then change to what we want in our local css file. note that we only need copy the one we need, not all of them.\n\ntheme.css\n.s-top-left-new &#123;\n    display: none;\n&#125; \n\n.s-hotsearch-wrapper &#123;\n    display: none;\n&#125;\n\n#head_wrapper #kw &#123;\n    border: 2px solid #a65d31;\n    background: #c0b29c52;\n&#125;\n\n#head_wrapper .s_btn &#123;\n    background-color: #a65d31;\n    border-radius: 0 20px 20px 0;\n&#125;\n\ninject js to web pageanother way hiding some elements of page is to use js’s  function removeChild()\nnote that the parent element must be the direct father element of child, otherwise it will make no sense.\nmodify.js\n// change whole webpage background color\ndocument.body.style.backgroundColor = &quot;#eef2e8&quot;;\n\n// use console.log to debug\nconsole.log(&quot;start&quot;);\n\nmenu_father = document.getElementById(&quot;head&quot;);\nmenu = document.getElementById(&quot;s-top-left&quot;);\nmenu_father.removeChild(menu);\n\nhot_search = document.getElementById(&quot;s-hotsearch-wrapper&quot;);\n\nhot_search_father = document.getElementsByClassName(&quot;s_form_wrapper soutu-env-nomac soutu-env-index&quot;)[0];\nhot_father.removeChild(hot_search);\n\nconsole.log(&quot;done&quot;);\n\nif we cannot find an element by id, we can find it by classname, and remember that we need to use index figuring out it.\nin console, we can find whether it is done.\n\ntemporary load our extension to firefoxin about:debugging of firefox, click This Firefox to load our extension, then reload the web page, we will find it makes effect.\nnow it will look like this:\n\npack file to an shared extensionwith the above method, we can only make it effect when the browser opens, once it reopens then it will not work until we add it by hand.\nso we need to pack it up to an .xpi file, one important thing is we need compress our file to a zip file first and then send it to AMO to sign. Once it be signed, we can install it like other online adds on.\nbefore compress file, we need add some info to manifest.json\n&quot;browser_specific_settings&quot;: &#123;\n  &quot;gecko&quot;: &#123;\n    &quot;id&quot;: &quot;ssfwshutterbug@gmail.com&quot;\n  &#125;\n&#125;\n\ncompress file\n# compress file without unnecessary file such as .git folder\nzip -r -FS ../my-extension.zip * --exclude &#39;*.git*&#39;\n\nopen AMO web page, login our account, then click developer hub, upload our zip file. once it done, we can download it from this page.\n","categories":["learn"],"tags":["inject js/css"]},{"title":"git","url":"/2022/04/23/git/","content":"gitgit是一个版本控制软件，可以仅仅在本地进行版本管理，也可以连接github进行多终端访问协作\ncommon command quick lookgit init                    #initialize a new repo\ngit status                    #check modified/stage area status\n    git checkout &lt;file&gt;        #reverse modified\ngit add                     #add changes to stage area\n    git reset HEAD &lt;file&gt;    #reverse changes out of stage area\ngit commit                    #commit as a check point\ngit log                        #check commit info\n    git reset                #reverse to a specified commit(check point)\n    \ngit branch --list            #show all branchs\ngit branch &lt;branchname&gt;        #create new branch\ngit checkout &lt;branchname&gt;    #change to new branch\ngit checkout -b &lt;branchname&gt;#easily create new branch and change to it\ngit merge &lt;branchname&gt;        #merge from branch\ngit branch -d &lt;branchname&gt;    #delete a branch\n\ngit tag                        #show tag\ngit tag &lt;tagname&gt;            #create tag\ngit tag -d &lt;tagname&gt;        #delete tag\n\nchange defalut branch name在使用git之前，非常值得做的一件事就是修改默认branch的名字，如你所知的一些事，master通常是一个不能体现平等的词，所以github上可以看见创建的默认repo也是main。但是git命令在本地创建仓库的时候还是master，所以为了避免这些麻烦，需要手动修改一下配置\n# change default branch name from master to main\ngit config --global init.defaultBranch main\n\n# if you already have a branch named master, it&#39;s easy to change it to main\ngit branch -m main\n\ninitializegit仓库的初始化，可以是一个空的文件夹，或者是有文件的文件夹，git的初始化仅仅在在当前目录下创建一个.git目录\ngit init\n\nconfiguration\nconfiguration level\ncreateing your identity includes username and email\nsetting up default editor\n\ngit config分为三个等级，而通常使用global就可以了\n\nlocal：配置仅仅对当前的目录起作用，配置写入.git/config\nglobal：配置对一个系统的当前用户起作用，配置写入~/.gitconfig\nsystem：配置对操作系统的所有用户起作用，配置写入/etc/gitconfig\n\ngit config的用户和邮件地址的作用仅仅是在git commit时作为一个用户标识，是必须设置的，但是并不需要和github上的一致\n# this only need to be configured once\ngit config --global user.name &quot;your_user_name&quot;\ngit config --global user.email &quot;your_email_addr&quot;\n\ngit config可设置默认的编辑器，因为在使用某些命令时会调用编辑器（比如运行git commit时）\n# this is optional but suggests to config\ngit config --global core.editor &quot;vim&quot;\n\n查看所有的配置\n# show all config\ngit config --list\n\n# or only show the one you wanna to see: eg. user.name\ngit config user.name\n\n# or we can directly cat the config file\ncat ~/.gitconfig\n\nadd to git包含两个方面：\n\n初始化将目录或文件加入git track，可以是整个目录，或者是一部分\n\n将修改过的文件加入stage area\n\n\n# added file will be put in a stage area, waitting for commit\ngit add .\n\n# or only one specified file\ngit add readme.md\n\n当add之后，可以回退\ngit reset HEAD &lt;file_name&gt;\n\nignore some dir/file如果某些文件或者目录是我们不想通过git进行管理的，可以进行设置\n# create a new file named .gitignore where .git directory exists\ntouch .gitignore\n\n# then add file name or directory name to .gitignore, cannot write in one line\n# each line only one file name or directory\n\ncommit changes通常我们的修改不会进行提交，提交的目的是作为一个check point，方便我们回退。只有在加入一个新的特性或者整体作为一个备份点，这时才有必要提交\n# without any argument will open a text editor for writing comments\ngit commit\n\n# sure can write comment directly\ngit commit . -m &quot;your comments&quot;\n\n# before we commit, we can checkout what is the differenct between now and last time before we change\ngit diff\n\nreverse changes每次提交都会被git记录，uuid作为唯一标识符，可以通过查看log找到回退的点\n# show all the message we commit\ngit log\n\n# or only show simple nice oneline\ngit log --pretty=oneline\n\n# reverse with the uuid before we find\ngit reset --hard &lt;uuid&gt;\n\n# a simple way to reverse one version before without check uuid\ngit reset --hard HEAD^\n\n通过上面的方式回到了某个之前的版本，但所有的这些修改并不会被git删除，所以在回退之后还可以前进到最新的版本，方式同上，只需找到对应的uuid即可\nuse github as remote repo本地使用git可以满足一个人的需求，如果在多个终端/多个人协作就需要一个公共访问的远端仓库，github就满足这个要求\n# at first create a empty repository in github , such as named test\n\n# second make sure locally has created a local repo and commited all the changes\n\n# checkout whether exists remote configure\ngit remote --verbose\n\n# then config remote repo&#39;s info，where the url link finds will be described below\n# now we can use origin instead of the long url link\ngit remote add origin &lt;https://github.com/your_github_username/test.git&gt;\n\n# push local to remote repo&#39;s(origin) main branch\ngit push -u origin main\n\ngithub仓库的链接地址可以通过点击code找到\n\n或者直接在web的url后面添加.git即可\n\n通常会需要输入github的username，password。当然可以在github上进行配置省去输入:\n\n本地生成id_rsa.pub公钥并上传到github指定repo的配置中或者github的配置（适用于所有的repo）\n修改git remove中origin的url链接方式为ssh\n\n# first, create a ssh public key locally in ~/.ssh/id_rsa.pub\nssh-keygen\n\n# then add the content of ~/.ssh/id_rsa.pub to github config\n\n\n选择ssh方式\n\n修改本地remote link配置\n# first remove exist config\ngit remote remove origin\n\n# add ssh link to configuration\ngit remote add origin &lt;git@github.com:ssfwshutterbug/note.git&gt;\n\n然后就不需要输入username和password了\nclone from github existing repo前面是本地仓库同步到github，如果github仓库已有内容，那么只需要clone下来即可\n# the github repo link described above, use https\ngit clone &lt;https://github.com/your_github_username/test.git&gt;\n\n# use ssh link without username and password needed\ngit clone &lt;git@github.com:ssfwshutterbug/note.git&gt;\n\n# clone a specified branch\ngit clone --single-branch --branch &lt;main&gt; &lt;git@github.com:ssfwshutterbug/note.git&gt;\n\ncreate/delete branch分支通常作为beta测试，稳定后会融入stable版本main\n# create branch\ngit branch &lt;branch_name&gt;\n\n# display all the branch\ngit branch --list\n\n# change to specified branch\ngit checkout &lt;branch_name&gt;\n\n# delete a specified branch\ngit branch --delete &lt;branch_name&gt;\n\n删除github上的分支\n# locally delete github branch\ngit push origin --delete &lt;branch_name&gt;\n\nmerge branch切换到分支对其它的分支进行合并：只需记住从别的分支融合到当前分支（merge from）\n# merge to main and auto create a commit, has the ability to reverse\ngit merge --no-ff -m &quot;your comments&quot;\n\n# simple merge without commit, cannot reverse, not suggest\ngit merge &lt;branch_name&gt;\n\nshow difference我们可以通过对比两个分支，两个commit，当前修改与最后一次修改的不同……\n# shou difference between now with last commit\ngit diff\n\n# or specified a file to compare\ngit diff &lt;file_name&gt;\n\n# show difference between two commits\ngit diff &lt;uuid1&gt; &lt;uuid2&gt;\n\n# show difference between two branchs\ngit diff &lt;branch1&gt; &lt;branch2&gt;\n\ndiscusswhile pull main branch to local, show this error message:\ngit pull origin main    \n\nFrom github.com:ssfwshutterbug/note\n * branch            main       -&gt; FETCH_HEAD\nfatal: refusing to merge unrelated histories\n\nfixed with below\ngit pull origin main --allow-unrelated-histories\n\ncredentialI am in a work with azure devops platform. And sometimes some users ask for my help of git authorized issues.\nThere are two ways that a user can be used to authorize:\n\nssh\nhttp\n\nwith ssh method, i clearly know that we need produce a pub key in local machine, and store the pub key to azure devops platform. After that we can download repository without username and password typing.\nhowever, i really don’t know how the way of http works. I searched online and get nothing. Until one day i see my teamwork to modify the username and password in control pannel, and i finally know that.\nThere are two ways of http authorization works:\n\nwith no configure, then we need to type username and password each time we download\nwith a credential helper, and this can be split with three methods:\ncache: store username and password in memory, with a timeout.\nstore: store username and password in a file, permanently.\nother softwares: in win10, is called manager. in win11, called manger-core\n\n\n\ncache and store methods will use the OS’s own ability to encrypt username and password\nwith configure, there are three kinds of level:\n\nsystem: write in /etc/gitconfig\nglobal: write in ~/.gitconfig\nlocal: write in repo’s .git/config\n\nthe low level can override the above level, for example: if we write a configre in local repo, then user local configure instead of system’s.\nand if no low level setting, the above level can be used by whole system.\n# list all system config\ngit config --system --list\n\n# list all global config\ngit config --global --list\n\n# list all local config\ngit config --local --list\ngit config --list\n\n# set win10 credential helper to manager\ngit config --system credential.helper manager\n# set win11 credential helper to manager-core\ngit config --system credential.helper manager-core\n# and then we can find stored info in contrl pannel&#39;s windows credental\n\n# set local credential helper to cache(default 900 seconds)\ngit config credential.helper &quot;cache --timeout 900&quot;\n\n# clean cached username and password\ngit config --unset credential.helper\n# then reset to cache\ngit config credential.helper cache\n# or kill the process\npkill git-credential-helper\n\n# if we set several method credential helper and want to clean\ngit config --unset-all credential.helper\n\n\nwhy we use git bash without configure and it used windows credential in default?\nbecause when we install git bash, there comes a config setting in default\n\n","categories":["learn"],"tags":["git"]},{"title":"archlinux","url":"/2022/04/23/archlinux/","content":"archlinuxThis document includes all the knowledges of using archlinux, from basic installing to daily using, all in one.\n[TOC]\nbase system installfirst of all, we need to install the system. take it ease, step by  step, and you can own it.\nadjust console fontmay be the default console font is too small, we can change it temporarily and make it much bigger.\ncd /usr/share/kbd/consolefonts\nsetfont iso01-12x22.psfu.gz\n\nconnect network\nif plug in the cabel, use dhcpcd to get a ip address.\n\nif use wireless, use iwctl to config the netwrok\n# the iwd.server is running by default\niwctl\n# list network interface\ndevice list\n# start scaning network\nstation device scan\n# show scan result\nstation device get-networks\n# connect to one wifi\nstation device connect ssid\n# get dynamic ip address\ndhcpcd\n\n\n\nchange mirror listmodify /etc/pacman.d/mirrorlist file, move China mirror list to the head.\n\nnote: this configure will sync to new installed system.\n\nhead /etc/pacman.d/mirrorlist\n\n## China\nServer = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch\nServer = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch\nServer = http://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch\nServer = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch\nServer = http://mirrors.163.com/archlinux/$repo/os/$arch\nServer = http://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch\nServer = https://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch\n\nupdate system clockenable ntp to ensure the system clock is accurate.\ntimedatectl set-ntp true\n\npartition diskwe can use tools like cfdisk ,parted to parted disk. whatever tool we choose, there are some things need to be done the same.\n\nformat entire disk with gpt table\none efi partition to install grub\n\n\nnote: efi partition cannot used as lvm part, lvm can only be recognized after grub loading.\n\nlvm example: \n\nesp: 100M\nroot(lvm): 30G\nhome(lvm):  last space\n\nparted /dev/nvme0n1 mktable gpt\nparted /dev/nvme0n1 mkpart fat 0% 100Mib\nparted /dev/nvme0n1 mkpart ext4 100Mib 100%\n\npvcreate /dev/nvme0n1p2\nvgcreate linux /dev/nvme0n1p2\nlvcreate -L 30G linux -n root \nlvcreate -l +100%FREE linux -n home\n\nmkfs.fat -F 32 /dev/nvme0n1p1\nmkfs.ext4 /dev/linux/root\nmkfs.ext4 /dev/linux/home\n\nmount partition and install system# mount root and home partition\nmount /dev/linux/root /mnt\nmkdir /mnt/home &amp;&amp; mount /dev/linux/home /mnt/home\n\n# chroot mnt and install base system\npacstrap /mnt base linux linux-firmware lvm2 vim\n\ngenerate mount configure\nnote: efi partition not need to be mount.\n\ngenfstab -U /mnt &gt;&gt; /mnt/etc/fstab\n\nchroot new systemarch-chroot /mnt\n\ntimezoneln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nhwclock --systohc\n\nsystem languageuncomment /etc/locale.gen  with en_us.UTF-8 and zh_CN.UTF-8 then run\nlocale-gen\n\n# set default system language\necho &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf\n\nnetwork# add hostname\necho &quot;notebook&quot; &gt; /etc/hostname\n\n# add hosts\necho &quot;\n127.0.0.1    localhost\n::1        localhost\n127.0.1.1    hostname.localdomain    hostname\n&quot; &gt;&gt; /etc/hosts\n\ninitramfs\nnote: if we don’t use lvm, this step can be ignored.\n\nedit /etc/mkinitcpio.conf, add lvm2 between block and filesystems\nmkinitcpio -P\n\ninstall netwrok toolwe can choose iwd or netctl to configure network\n\niwd\n\npacman -S iwd dhcpcd\nsystemctl enable iwd\n\n\nnetctl\n\npacman -S netctl wpa_supplicant dialog  dhcpcd\n\ninstall grubfirst mount efi partition to /boot/efi\nmkdir /boot/efi\nmount /dev/nvme0n1p1 /boot/efi\n\npacman -S grub efibootmgr\ngrub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB --removable\ngrub-mkconfig -o /boot/grub/grub.cfg\n\nset root passwdpasswd root\n\numount and rebootexit and umount -R /mnt\nreboot\n\ngeneral configurethe step below is general configure, that is to say it’s basic and cannot be ignored.\nconnect network\nwe can use iwd to set wifi connection, only need using dhcpcd to get a dynamic ip address\nstatic ip\ncreate a config file  /etc/iwd/main.conf to enable static network config by adding\ncat /etc/iwd/main.conf\n\n[General]\nEnableNetworkConfiguration=true\n\nadd static ip address config to wifi_name.psk file under /var/lib/iwd\ncat &gt;&gt; /var/lib/iwd/qiyue.psk\n\n[IPv4]\nAddress=192.168.31.31\nNetmask=255.255.255.0\nGateway=192.168.31.1\n\n\nif we use netctl(wifi/ethernet), we can use a gui tool named wifi-menu to connect network\nsudo wifi-menu\n\nwhen we connect correct there will be a configure file in /etc/netctl, in order to auto connect network, we need enable it.\ncd /etc/netctl\n# it must be file name not localtion path and without super priviledge\nnetctl enable confirure_file_name\n\nstatic ip\nsudo cp /etc/netctl/examples/wireless-wpa-static /etc/netctl\n\nDescription=&#39;A simple WPA encrypted wireless connection using a static IP&#39;\nInterface=wlo1\nConnection=wireless\nSecurity=wpa\nESSID=&#39;wifi-essid&#39; # modify\nKey=&#39;password&#39; # modify\nIP=static\nAddress=&#39;192.168.0.104/24&#39; # modify\nGateway=&#39;192.168.0.1&#39;    # modify\nDNS=(&#39;114.114.114.114&#39;) # modify\n\nsome command of netctl\nnetctl disable wireless-wpa-static-old\nnetctl enable wireless-wpa-static\nnetctl restart wireless-wpa-static\n\n\n\ninstall some softwareif there comes some error message shows cannot find package, we need to config China repository first.\n\nman page\npacman -S man-db man-pages texinfo\n\n\nbase-devel\nit includes sudo, gcc, make, sed, grep, which and etc usual command\npacman -S base-devel\n\n\ninstall doas or sudo\npacman -S sudo\npacman -S doas\n\nthen create a file /etc/doas.conf and write something to it\necho &quot;permit nopass :wheel&quot; &gt; /etc/doas.conf\n\n\nxmonad window manager\nxmonad window manager uses xterm by default.\npacman -S xmonad xmonad-contrib xmobar xterm\n\n\npoybar\ni use it with xmonad as default status bar\npacman -S polybar\n\n\ninput method\ninstall all of packages of fcitx5-im, fcitx5-material-color is the skin which really likes windows 10\npacman -S fcitx5-im fcitx5-material-color fcitx5-rime\n\n\ntransparent tools\ntransset-df can transparent the xterm\nyay -S transset-df\n\n\nanimate action\npicom has some good effect like fade in fade out and etc. and aur’s picom-jonaburg-git has motion effect\nyay -S picom-jonaburg-git\n\n\n\npackage search tool\nwe can use dmenu or rofi, i use dmenu much more, but rofi can help me to find how many applications i have ever installed and which one should i launch once a time forgot its name with some keywords.\npacman -S dmenu rofi\n\n\nfont\nproper font will make some software works well like xterm and polybar\n# the font can show icons in terminal, and font for vscode\n# Cascadia and Firacode become my favorite fonts now, even use it as system application font\npacman -S nerd-fonts-iosevka nerd-fonts-fira-code nerd-fonts-cascadia-code\n\n# the two fonts can show chinese and korean proper in polybar\npacman -S adobe-source-han-sans-cn-fonts adobe-source-han-sans-kr-fonts \n\n\nnotify tool\nit can show notify message in desktop with highly configurable.\npacman -S dunst\n\n\nclip tool\nit is a clip tool with great useage, such as clip standard output, one file even though an image\npacman -S xclip\n\n\nyoudao dictionary\ni have wrote a shell translate copy sentense which depends on this\npacman -S ydcv-rs-git\n\n\nscreenshot\nuseful screenshot tool\npacman -S flameshot\n\n\nfile manager\nw3m is a plug in to show photo\npacman -S ranger w3m\n\n\ndownload tool\npacman -S wget curl\n\n\naudio and video player\npacman -S mpg123 mplayer\n\n\nperformance monitor\npacman -S glances htop neofetch\n\n# htim is a replace of htop with vim typle keybing, after install it, type htop as usual\nyay -S htim\n\n\nbrowser\npacman -S firefox\n\n\nwriter\n# use marktext-git instead of typora, since typora is not open source\npacman -S marktext-git\n\n\ncode\npacman -S visual-studio-code-bin\n\n\nscreen capture\npacman -S obs-studio\n\n\nsql client tool\npacman -S dbeaver\n\n\nstickypad\npacman -S xpad\n\n\nchat\npacman -S skypeforlinux-stable-bin\n\n\ngui dialog tool\npacman -S yad\n\n\nsimulate\npacman -S xdotool\n\n\ncli music player \npacman -S cmus\n\n\nchinese date\npacman -S cdate\n\n\ncpu information\npacman -S cpufetch\n\n\nimage viewer\npacman -S gthumb\n\n\nwire sniff tool\npacman -S wireshark\n\n\nfake like hackers tool\ncmatrix no-more-secrets-git\n\n\nanalysis disk usage\npacman -S ncdu\n\n\n\nadd userinstall zsh shell first\nsudo pacman -S zsh oh-my-zsh-git\n\nadd user with wheel group and zsh as default shell\nuseradd -m -G wheel -s /bin/zsh username\n\nset passwd\npasswd username\n\nthen adjust priviledges, such as sudo priviledge, run command without password\n# uncomment below in /etc/sudoers\n%wheel ALL=(ALL) ALL\n%wheel ALL=(ALL) NOPASSWD: ALL\n\ninstall xorgpacman -S xorg\n\nin order to use startx to login to gui, we need to install xorg-xinit\npacman -S xorg-xinit\n\nvideothere comes three choice: \n\nintel with video card integrated\nnvidia indepedent\namd video driver\n\nif we use intel video card, we need to install intel drive\npacman -S xf86-video-intel\n\n# install package to adjust screen backlight, only intel works\npacman -S xorg-xbacklight\n\n# we can also adjust screen backlight by hand, only intel works\nvim /sys/class/backlight/intel_backlight\n\nif we use nvidia video card, we need to install nvidia drive\npacman -S nvidia\n\namd gpu\npacman -S xf86-video-amdgpu\n\naudiosudo pacman -S pulseaudio pulseaudio-alsa pamixer\n\nwhen we installed those software, we can also not get voice, because it is mute by default. so we need enable it\npamixer --unmute\n\npersonal configurewhy it is personal? because there are too many choice for user to choose, and i myself use the system serveral years and have wrote a shell script to copy the old configure file to the system without configure it step by step. so i will describe it in two part.\n\none is auto config\nanother is step by step\n\nauto config all my backup file locate in ~/Data/linux, so i need to copy old data to new machine. there are several ways to do the thing, such as a usb drive, use scp, startup a ftp in old machine…\nand find a script named filesync in linux/.local/bin which we copied from old machine. and run:\n./filesync install\n\n most of things will be done automaticly.\nstep by stepthe section below will show you how to config system step by step.\ninstall AUR package installerusing yay or paru we can download software in AUR. and suggest use paru, because it can search both pacman and aur at the same time.\npacman -S paru\n# pacman -S yay\n\nadd China repositorypacman repository\nwrite info to /etc/pacman.conf\n[archlinuxcn]\nServer = https://mirrors.aliyun.com/archlinuxcn/$arch\n\nthen refresh the database\npacman -Sy\n\nwe don’t need to install chinese keyring right now, just install it while there is a message shows we need to import some keyring.\npacman -S archlinuxcn-keyring\n\naur repository\n# if use yay to download aur package\nyay --aururl &quot;https://aur.tuna.tsinghua.edu.cn&quot; --save\n\nthis will create yay config in ~/.config/yay/config.json\n# can check config with commands\nyay -P -g\n\ndefault location configwhen we use xorg, there is a way to config where the data to be stored. even though not all the software follow the rules, but it is much better than no.\nadded to ~/.pam_environment\n# environment variable to set xdg base directory\nXDG_CONFIG_HOME=/home/blueocean/.config\nXDG_CACHE_HOME=/home/blueocean/.cache\nXDG_DATA_HOME=/home/blueocean/.local/share\nXDG_DATA_DIRS=/usr/local/share:/usr/share\nXDG_CONFIG_DIRS=/etc/xdg\n\nfcitx5 configurein order to make fcitx5 works well, there are several variable to be configed in ~/.pam_environment\n# environment variable for fcitx5\nINPUT_METHOD  DEFAULT=fcitx5\nGTK_IM_MODULE DEFAULT=fcitx5\nQT_IM_MODULE  DEFAULT=fcitx5\nXMODIFIERS    DEFAULT=\\@im=fcitx5\n\nadd startup command to ~/.xinitrc file :fcitx5 &amp; \nshort keys: ctrl +alt +h  :enable/disable completion\nif not simple chinese, use “ctrl+`” to change\nxmonad configcopy configure file xmonad.hs  to ~/.xmonad/\nthen compile it:\nxmonad --recompile\n\nwrite start xmonad command to ~/.xinitrc\n# if home directory has no .xinitrc then copy \n[ ! -f ~/.xinitrc ] &amp;&amp; cp /etc/X11/xinit/xinitrc ~/.xinitrc\n\n# write to the end of the file\nexec xmonad    \n\npolybar configif there has no configure file, we can download configure from website\n[ ! -f ~/.config/polybar/config ] &amp;&amp; touch ~/.config/polybar/config\n\nadd start command in ~/.xinitrc\nsh ~/.config/polybar/launch.sh\n\ndisable touchpadif we have a touchpad and don’t wanna use, we can disable it\nfirst of all, install the command:\npacman -S xorg-xinput\n\nadd below to ~/.xinitrc to disable it\nxinput | grep Touchpad | grep -E &#39;=[0-9]&#123;2&#125;&#39; -o | grep -E &#39;[0-9]&#123;2&#125;&#39; -o | xargs xinput disable\n\ncursor stylemake sure xsetroot tools has been installed\npacman -S xorg-xsetroot\n\nwrite below to ~/.xinitrc\nxsetroot -cursor_name left_ptr\n\nwindow effectmake sure picom has been installed, then write below to ~/.xinitrc\npicom  --experimental-backends --config .config/picom/picom.conf -b\n\nxterm transparentmake sure transset-df has been installed, then write below to ~/.zshrc. we can change transparent with -m parameter.\n[ -n &quot;$XTERM_VERSION&quot; ] &amp;&amp; transset-df -m 0.95 --id &quot;$WINDOWID&quot; --dec 0.1 &gt;/dev/null\n\nntfs file system recognizein order to recognize windows file system, the tool need to be installed. and without it we cannot modify windows file by normal user.\npacman -S ntfs-3g\n\n# mount example\nmount -t ntfs-3g /dev/sdaX /mnt\n\nhome directorywith xdg-user-dirs add “well known” user directories in /home/user\npacman -S xdg-user-dirs\n\nthen run xdg-user-dirs-update to product\nxdg-user-dirs-update\n\nfat partition recognizein order to mount fat partition or use mkfs.fat format a disk, we need to install dosfstools first.\npacman -S dosfstools\n\nother settingssome configure which seems not very important.\ngrub theme\ngnome look or pacman\n   download from the web site or install by pacman and mv to /boot/grub/theme directory\nunzip arch-silence-master.zip                    \nmv arch-silence-master /boot/grub/theme/    \n\n   now tell grub use the new theme, modify /etc/default/grub    \nGRUB_THEME=&quot;/boot/grub/themes/arch-silence-master/theme/theme.txt&quot;\n\n   rebuild grub.cfg\ngrub-mkcofig -o /boot/grub/grub.cfg\n\n\ngit hub\n   download from website, unzip and change directory to it and run\nsudo ./install.sh -b -t tela\n\n   \n   uninstall run sudo ./install.sh -r -t tela\n\n\nshow boot messagein default the boot message is hidden, we can make it showing again.modify /etc/default/grub, remove quiet flag\nGRUB_CMDLINE_LINUX_DEFAULT=&quot;loglevel=3&quot;\n\nrebuild grub.cfg\ngrub-mkconfig -o /boot/grub/grub.cfg\n\ncoloize pacmanin default the search result of pacman has no colors, we can change it. modify /etc/pacman.conf, uncomment color\ncolorlsit is a colorized ls command which can show icons (make sure u have patched font with graph support. such as nerd-fonts-iosevka)\n# it is writed in rube\npacman -S ruby\n\n# then use gem which ruby package manager install colorls\ngem install colorls\n\n# follow install output config environment. such as add to .zshrc\nsource $(dirname $(gem which colorls))/tab_complete.sh\n\n# add path to /etc/profile\nappend_path &#39;/home/blueocean/.local/share/gem/ruby/2.7.0/bin&#39;\n\nalias ls to colorls\n# in .zshrc\nalias ls=&quot;colorls&quot;\n\n# make effect\nsource /etc/profile\nsource ~/.zshrc\n\n\nif ruby upgrades, run gem install colorls to upgrade colorls also.\nbluetoothinstall base package\nuse bluetooth to connect device. intall package first\npacman -S bluez\n\nprovide cli tool\npacman -S bluez-utils\n\nprovide sounds for bluetooth\npacman -S pulseaudio-bluetooth\n\nadd user to lp group\nit is needed to add user to lp group\nusermod -a -G lp `whoami`\n\nstart bluetooth\ncheck whether or not driver has been launched\nlsmod | grep btusb\n\nif not launched by hand\nmodprobe btusb\n\nlaunch service, a reboot needed\nsystemctl enable bluetooth.service\nsystemctl start bluetooth.service\n\n\nnote: we need enable bluetooth to start up automaticly, otherwise there will be a error msg of failed\n\nconnect devices the first time\nbluetoothctl\nagent KeyboardOnly\ndefault-agent\npower on\nscan on\npair xxxx\nconnect xxxx\n\na paired device can be connect directory\n# show paired devices\ndevices\n# then connect\nconnect xxxx\n\nadjust video fan speedmake sure nvidia-settings has been installed already.\n# enable fan speed adjust\nnvidia-xconfig --cool-bits=4\n\n# then add below to ~/.xinitrc, replace n with the fan speed percentage. such as 10\nnvidia-settings -a &quot;[gpu:0]/GPUFanControlState=1&quot; -a &quot;[fan:0]/GPUTargetFanSpeed=n&quot;\n\ncursor themefull document can visit arch wiki page.\nthe default cursor theme is bad, i need to change it. before start up, i need to make it clearly there are 3 part should be changed\n\nxdg settting for X11\ngtk theme setting\nterminal setting\n\nfirst download cursor theme you liked in this website\nxdg setting\n# create ~/.icons folder\nmkdir ~/.icons\n\n# extract theme folder to ~/.icons\ntar -xzf theme.tar.gz -C ~/.icons\n\n# create theme configure file\nmkdir ~/.icons/default\ntouch ~/.icons/default/index.theme\n\necho &quot;\n[icon theme]\nInherits=oreo_spark_blue_cursors\n&quot; &gt; ~/.icons/default/index.theme\n\ngtk setting\n# create theme config file\ntouch ~/.config/gtk-3.0/settings.ini\n\necho &quot;\n[Settings]\ngtk-cursor-theme-name=oreo_spark_blue_cursors\n&quot; &gt; ~/.config/gtk-3.0/settings.ini\n\n# polybar use gtk-2.0, so we need copy above setting to gtk2 folder\ncp ~/.config/gtk-3.0/settings.ini ~/.config/gtk-2.0/settings.ini\n\nterminal setting\n# write this in ~/.Xresources\nXcursor.theme: oreo_spark_blue_cursors\nXcursor.size: 16\n\nmake it effect\nxrdb ~/.Xresources\n\nthen relogin desktop\ngtk application theme and icon themeit is a long time for google, and cannot find how to set system application theme and icon theme. finally i get it.\nFirst, we need to know there are two different frames in our application:\n\nGTK style\nQT style\n\nit depends on what kind of language the application to be wrote. not depends on our theme chooseing.\nSecond, we need to know there are there kind of themes we can download:\n\napplication theme. the frame of application which stores in ~/.themes or /usr/share/themes\nicon theme, the icon of application which stores in ~/.icons or /usr/share/icons\ncursor theme, cursor style which stores in ~/.icons or /usr/share/icons\n\nI follow wiki page to configure themes:\n\ndownload theme from this website\n\nthen extract gtk theme in~/.themes. \nextract icon theme in ~/.icons\ntar -xJf Downloads/WhiteSur-light.tar.xz -C ~/.themes\n\ntar -xJf 01-WhiteSur.tar.xz -C ~/.icons\n\n\nedit two files\n\nNote:\ni find a more beautiful font rather than Cantarell\nuse CaskaydiaCove Nerd Font 10 instead of Cantarell 11\n\ngtk2 application need to edit file /usr/share/gtk-2.0/gtkrc or .config/gtk-2.0/gtkrc\ncat /usr/share/gtk-2.0/gtkrc \ngtk-icon-theme-name = &quot;WhiteSur-light&quot;\ngtk-theme-name = &quot;WhiteSur-light&quot;\ngtk-font-name = &quot;Cantarell 11&quot;\n\ngtk3 application can edit /usr/share/gtk-3.0/settings.ini or .config/gtk-3.0/settings.ini\ncat ~/.config/gtk-3.0/settings.ini \n[Settings]\ngtk-cursor-theme-name = oreo_spark_blue_cursors\ngtk-icon-theme-name = WhiteSur-light\ngtk-theme-name = WhiteSur-light\ngtk-font-name = Cantarell 11\n\n\n\nthen relogin desktop, most of applications will show specified theme correctly. however some of applications such as vbox still the same as before shows like this:\n\nand at last i find that it is because the application writes by QT, so we cannot apply GTK theme to it. and i find the fixed method: make QT application use GTK theme in this page\n# write this to ~/.xinitrc if i use window manager\nexport DESKTOP_SESSION=gnome\n\nrelogin desktop, and then the virtualbox shows correct themes, it is really amazing!\n\nonly for one specified app\nabove setting will change all app theme, however we can define some app with specified theme.\n# go to this folder\ncd /usr/share/applications\n# find which app should be change\nvim leafpad.desktop\n\n# find Exec line\nExec=leafpad %F\n# change it to specified theme\nExec=env GTK_THEME=WhiteSur-light:light leafpad %F\n\nrestart app, theme will make effect. but it seems that it’s only make effect if we have no theme setting by default.\nfont settingat first, we need to know the category of fonts.\n\nbitmap: often used in system console\nlatin script:\nserif: shows great in large font, no good in small font. often used in title and printing.\nsans-serif: shows great in small font and web page.\nmonospace: often used in coding.\nfamily: include above there fonts.\n\n\nnon-latin script: chinese/japanese and others\nemoji and symbols\nmath\nother operating system fonts\n\nso in a GUI operation system, we often use latin for english and non-latin for chinese. emoji and math is optional. notice that console can use bitmap only.\n\nuser font can be set in ~/.local/share/fonts\nthen use fc-cache to build font cache.\n\nin order to configure font manually, we need two step:\n\n make effect of user setting\n\nmkdir ~/.config/fontconfig/conf.d\nln -s /usr/share/fontconfig/conf.avail/50-user.conf ~/.config/fontconfig/conf.d\n\n\nmanually font setting\ntouch ~/.config/fontconfig/fonts.conf\n\n&lt;?xml version=&quot;1.0&quot;?&gt;\n&lt;!DOCTYPE fontconfig SYSTEM &quot;fonts.dtd&quot;&gt;\n&lt;fontconfig&gt;\n    &lt;match target=&quot;font&quot;&gt;\n        &lt;edit name=&quot;autohint&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;false&lt;/bool&gt; &lt;/edit&gt;\n        &lt;edit name=&quot;antialias&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;true&lt;/bool&gt; &lt;/edit&gt;\n        &lt;edit name=&quot;hinting&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;true&lt;/bool&gt; &lt;/edit&gt;\n        &lt;edit name=&quot;hintstyle&quot; mode=&quot;assign&quot;&gt; &lt;const&gt;hintslight&lt;/const&gt; &lt;/edit&gt;\n        &lt;edit name=&quot;rgba&quot; mode=&quot;assign&quot;&gt; &lt;const&gt;rgb&lt;/const&gt; &lt;/edit&gt;\n        &lt;edit name=&quot;lcdfilter&quot; mode=&quot;assign&quot;&gt; &lt;const&gt;lcddefault&lt;/const&gt; &lt;/edit&gt;\n        &lt;edit name=&quot;embeddedbitmap&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;false&lt;/bool&gt; &lt;/edit&gt;\n    &lt;/match&gt;\n\n    &lt;!--fallback font order--&gt;\n    &lt;alias&gt;\n        &lt;family&gt;serif&lt;/family&gt;\n        &lt;prefer&gt;\n            &lt;family&gt;DejaVu Serif&lt;/family&gt;\n            &lt;family&gt;Source Han Sans CN&lt;/family&gt;\n        &lt;/prefer&gt;\n    &lt;/alias&gt;\n    &lt;alias&gt;\n        &lt;family&gt;sans-serif&lt;/family&gt;\n        &lt;prefer&gt;\n            &lt;family&gt;Inter&lt;/family&gt;\n            &lt;family&gt;Source Han Sans CN&lt;/family&gt;\n        &lt;/prefer&gt;\n    &lt;/alias&gt;\n    &lt;alias&gt;\n        &lt;family&gt;monospace&lt;/family&gt;\n        &lt;prefer&gt;\n            &lt;family&gt;Ubuntu&lt;/family&gt;\n            &lt;family&gt;Source Han Sans CN&lt;/family&gt;\n        &lt;/prefer&gt;\n    &lt;/alias&gt;\n&lt;/fontconfig&gt;\n\n\n\ni use DejaVu Serif for serif, Inter for sans-serif, Ubuntu for monospace. the same setting for firefox and it shows great.\nvirtual machinevirtualboxload kernel module\nbefore we can run virtual machine, we need load vboxdrv kernel module before\nmodprobe vboxdrv\n\nwhen we launch a virtualbox os with desktop environment, the most import thing is the size of window, for what the default size is to small.\nif we use windows we can directily click the top bar menu and choose install third extension, after finish, we can login windows and click install extension.\nscreen size with command\nhowever in linux, it is much complex, one method i find good enough is use command to specify to size without install extension and working fine.\n# first use cvt to product the screen size info\ncvt length width\n\n# second install xorg-xrandr and use it to set size\npacman -S xorg-xrandr\n\n# add the standout of cvt \nxrandr --newmode \n\n# add a new mode\nxrandr --addmode Virtual-1 lengthxwidth_refreshrate\n\n# change screen size\nxrandr --output Virtual-1 --mode lengthxwidth_refreshrate\n\n\n# for example\ncvt 2550 1406\nxrandr --newmode &quot;2552x1406_60.00&quot;  302.75  2552 2736 3008 3464  1406 1409 1419 1458 -hsync +vsync\nxrandr --addmode Virtual-1 2552x1406_60.00\nxrandr --output Virtual-1 --mode 2552x1406_60.00\n\nscreen size with iso file\nyeah, there comes another method which work most of the time i find in the website.The most important thing, do not use THE “GUEST  ADDITIONS CD” come along with the Oracle VirtualBox, which you usually  find in the menu “Devices” - “Insert Guest Additions CD Image”. But download the latest VBoxAdditions iso file from the official webpage, mount the image file in your virtual machine and then run the shell file “VBoxLinuxAdditions.run”:\nsudo sh  VBoxLinuxAdditions.run\n\nType in the password when prompted. Restart your virtual machine, then everything should work now.\nkvmI have used virtualbox so many years when i first heard of it, it is quiet simple, free and i like it very much. However today when i see DT’s video, he introduces virt-manager to manager virtual machine, i think i need try it. Because kvm is the kernel based virtual machine, its performance may improved a lot then virtualbox. At first we need to know some concept:\n\nkvm: kernel based virtual machine,  provide the ability to start virtual machine.\n\nqemu: machine emulator which can use kvm hypervisor or others. \n\nlibvirt: libs(network, storage and etc), daemon, command utility(virsh)\n\nvirt-manager: gui tool for easily build/manage virtual machine.\n\n\nat first, check whether support kvm\nLC_ALL=C lscpu | grep Virtualization\n\nif the output not empty, then we can install the needed tools\n# virt-manager includes libvirt\npacman -S qemu virt-manager\n\n# other tool that libvirtd need\npacman -S ebtables dnsmasq dmidecode\n\n\nNote: \n\nebtables and dnsmasq is very important for virt-manager to manage/build host network bridge and dnsmasq in iptables, without them the network in virtual machine may be faild to connect.\n\ndmidecode used for showing host information in virt-manager.\n\nso,  in host machine iptables must be enabled and started for virt-manager to manage virtual machine network.\n\n\n\nthen enable and start libvirtd daemon\nsystemctl enable --now libvirtd\n\nafter start up, we need add our user to libvirt group. \n\n Note: without this step, there may be some auth errors.\n\nusermod -a -G libvirt [user_name]\n\nfinally, we can launch virt-manager to build/manage virtual machine.\nadd new image location\nthe default image location is /var/lib/libvirt/images, we can add a new storage location via virt-manager\n\nconvert virtualbox images to kvm images\n# for example convert archlinux.vdi to archlinux\n# er, i convert serveral images from vdi to qcow2 and all of them faild in find disk with UUID\nqemu-img convert -f vdi -O qcow2 archlinux.vdi ~/Public/kvm/images/archlinux\n\nadd uefi support\ninstall edk2-ovmf to support uefi\npacman -S edk2-ovmf\n\n# then restart libvertd\nsystemctl restart libvertd\n\nget mouse back from virt-manager\nuse left ctrl + left alt to release focus in virt-manager. or left ctrl + left alt + g when use GTK fronted of qemu.\nsome important virsh command\nvirsh is libvirt’s command line tool, include commands which can operate the virtual machine instead of virt-manager, however it is much complex.\nvirtual machine is called domain in libvirt\n# list all running machines/domains (include id/domain-name)\nsudo virsh list\n\n# list all machines/domains\nsudo virsh list --all\n\n# list all networks\nsudo virsh net-list\n\n# list all pools/images storage position\nsudo virsh pool-list\n\n# list all volumes/images\nsudo virsh vol-list [pool-name]\n\n# list domain/machine info\nsudo virsh dominfo [domain-name/id]\n\n# list domain/machine ipaddress\nsudo virsh domifaddr [domain-name/id]\n\n# start/shutdown/suspend domain/machine\nsudo virsh start/shutdown/suspend [domain-name/id]\n\n# start network\nsudo virsh net-start [network-name]\n\nuser comand line to start up a virtual machine\n# start up network\nsudo virsh net-list\nsudo virsh net-start [network-name]\n# start virtual machine\nsudo virsh list --all\nsudo virsh start [domain-name/id]\n# get virtual machine&#39;s ip address\nsudo virsh domifaddr [domain-name/id]\n# then use ssh to connect remote linux or rdesktop to connect windows\n\nfix cannot adjust resolution\nmost of time we start up a new virtual machine in virt-manager, the resolution cannot adjust correctly, the way to fix it is change virt-manager video model.\nwe can change QXL to Virtio or VGA\nshare folder\nfor example make host’s Desktop folder as a share folder, we need to change Desktop folder’s permistion to 777\nchmod 777 ~/Desktop\n\nin virt-manager create a new file filesystem and mount to /mnt for example\nin virtual machine use command to mount the new share folder\n# for example mount share folder to Desktop\nmount -t 9p -o trans=virtio /mnt Desktop\n\nuse qemu command to create/start virtual machine with GUI\nshortcut:\n\nfullscreen: ctrl+alt+f\nmenu: ctrl+alt+m\ngrab mouse: ctrl+alt+g (effect only when menu bar shows)\n\n# create a file block to install virtual machine\nqemu-img create -f qcow2 [virtual-name] [disk-size]\n\n# eg:\nqemu-img create -f qcow2 android.img 10G\n\n\n# install OS to file block\nqemu-system-x86_64 -enable-kvm -cdrom android.iso -drive file=./android.img \n\n# start virtual machine\n# cpu: host has the best performance\n# smp: cpu thread\n# m: memory\n# vga: video method\n# soundhw: sound device\n\n# eg:\nqemu-system-x86_64 -enable-kvm -drive file=./android.img -cpu host -smp 4 -m 4G -vga virtio -display sdl,ql=on -soundhw=hda\n\nqemu-system-x86_64 -enable-kvm -drive file=win11.qcow2 -cpu host -smp 4 -m 4G -vga virtio -display gtk,gl=on,full-screen=on -soundhw hda\n\nconnect remote windowswindows remote desktop via udp/3389, so if i wanna to connect to windows in linux machine, i need to install a client with the ability to connect windows supported protocol. there are a lot of tools, but i choose the rdesktop, since it is a simple command line tool.\npacman -S rdesktop\n\n# better rander\nrdesktop -g 100% -r sound:local -x l -M -K  -P -z 192.168.122.157:3389\n\n\n-g 100%: automatically scale the geometry to fit screen.\n\n-r sound:local: redirect remote machine sound to local.\n\n-M: use linux system’s mouse instead of remote machine’s mouse.\n\n-K: use linux window manager instead of remote machine’s window manager.\n\n-x l: rander remote desktop’s wallpaper, window motion. \n\n-P: enable bitmap cache to disk to improve performance.\n\n-z: enable compress rdp datastream.\n\n192.168.122.157:3389: remote mahine’s ip and port.\n\n\n# low level rander\nrdesktop -g 100% -r sound:local -x m -M -K -P -z -b 192.168.122.157:3389\n\n\nNote: when use -P option, will create a directory  ~/.rdesktop/cache, in order to speed up the access time, we can mount this directory to memory.\n\n# nvim /etc/fstab\n\ntmpfs    /home/healer/.rdesktop/cache    tmpfs   rw,nodev,nosuid    0 0\n\nauto loginarchlinux use agetty to manage virtual console, we can use it to automatic login system without password. \nmkdir /etc/systemd/system/getty@tty1.service.d\ntouch /etc/systemd/system/getty@tty1.service.d/override.conf\n\n# change username with login user name\necho &quot;\n[Service]\nExecStart=\nExecStart=-/usr/bin/agetty --autologin username --noclear %I $TERM\n&quot; &gt; /etc/systemd/system/getty@tty1.service.d/override.conf\n\nrelogin system will make effect.\nif we also want to login desktop environment, we can do it like this.\necho &quot;\nif [[ ! $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]]; then\n    exec startx &amp;&gt;/dev/null\nfi\n&quot; &gt; ~/.zprofile\n\nconnect remote linuxin linux, there is no default remote service installed by default, so if we wanna to connect to remote linux with GUI interface, we need install a VNC server in remote linux and then install a VNC client in local machine to connect to remote.\nin remote\nthe easiest way is to install x11vnc\npacman -S x11vnc\n\nthen create a connection passwd\nx11vnc -storepasswd\n\nthe command above will create a passwd file in ~/.vnc/passwd by default.\nthen start vnc server\nx11vnc -display :0\n\nin local\nremmina is a common GUI tool that support lots of protocol\npacman -S remmina\npacman -S libvncserver\n\nauto suspendin order to save power while we don’t use computer with a specified time. we can use slock and xautolock\nsuspend with shortcut\n# write this in xmonad.hs and triger with shortcut\n((0 , xK_l), spawn &quot;slock &amp; systemctl suspend&quot;)\n\nauto suspend with specified time\nrun xautolock while system startup and auto sleep with specified time\n# write this in xmonad.hs which will run while login desktop (30 minites)\nspawnOnce &quot;xautolock -time 30 -locker &#39;systemctl suspend&#39; -detectsleep&quot;\n\n# or write this in .xinitrc\nxautolock -time 30 -locker &#39;systemctl suspend&#39; -detectsleep\n\ncache browser data to memoryinstall\n# install psd\npacman -S  profile-sync-daemon\n\n# first run create configure file\n~ » psd                                                                                                                                                                                               ~  \n First time running psd so please edit /home/healer/.config/psd/psd.conf to your liking and run again.\n\nconfigure\n# enable\nsystemctl --user enable psd\n\n# configure overlay and browser\nvim ~/.config/psd/psd.conf\n\nUSE_OVERLAYFS=&quot;yes&quot;\nBROWSERS=(firefox)\n\ncache anything to RAMthe benefit of asd is that it can speed the access of some folder (not file) and makes the file to store in physical possible.\nsudo pacman -S anything-sync-daemon\n\nedit /etc/asd.conf\n# put the folder which i want to load to memory\nWHATTOSYNC=(\n&#39;/home/healer/.oh-my-zsh/his&#39;\n)\n\n\nNote:\nby default .zsh_history stores in $HOME, but asd can only sync folders. And there is a way to set history to another folder: define HISTFILE variable before oh-my-zsh in ~/.zshrc\nHISTFILE=~/.oh-my-zsh/his/.zsh_history\nsource $ZSH/oh-my-zsh.sh\n\n\nat last enable asd service at boot time and start asd\nsudo systemctl enable --now asd\n\nscreen rotationuse xrandr described in wiki page\n# add a key binding in xmonad\n# output name can be find with xrandr\nxrandr --output HDMI-A-0 --rotate left\nxrandr --output HDMI-A-0 --rotate normal\n\nfirefox adds-onsome useful adds-on\n\nburn dvdI have to say that the idea why i want to use dvd is because of one youtuber called DT, he has a video told why he uses dvd still today, and i thought it is a perfect idea.\nThe main reason i use dvd is that can store long times without information lose, and has a feeling of old life in such a fast society.\nthere are two things need to be noticed:\n\nnew blank DVD-R cannot be mounted, it needs to burn data first.\na toolset dvd+rw-tools contains the tool growisofs which can burn data to DVD-R.\n\n# install toolset\npacman -S dvd+rw-tools\n\n# insert new DVD-R to DVD burn machine\n# burn data to new DVD-R\ngrowisofs -Z /dev/sr0 -R -J /some/files\n\n# append data to DVD-R\ngrowisofs -M /dev/dvd -R -J /more/files\n\nafter burning data to DVD-R we can mount it\nmount /dev/sr0 /mnt\n\nemail receivingmutt is a linux CLI application of email client. although GUI mail applications such as MailSpring, BlueMail are very friendly use, but the size of GUI packages are much bigger than CLI applications.\nsudo pacman -S mutt\n\nmutt’s default configure can be set in ~/.config/mutt/muttrc\n# create local mail store loction and mutt configuration file\nmkdir ~/.local/share/Mail ~/.config/mutt\ntouch ~/.config/mutt/muttrc\n\nmuttrc configuration \n# RECEIVING EMAIL SETTING (IMAP)\n# user and password\nset imap_user       = 1025096440@qq.com\nset imap_pass       = lcfqrejgdeggbcic\n# address of colud mailbox\nset folder          = imaps://1025096440@imap.qq.com/\nset spoolfile       = +INBOX\n# architure of cloud mailbox checking\nmailboxes           = +INBOX +SENT\n# receiving of sending file local store position\nset folder          = &quot;$HOME/.local/share/Mail&quot;; set record=&quot;+sent&quot;\nset imap_keepalive  = 300\nset mail_check      = 5\nset sort            = reverse-date\n\n# SENDING EMAIL SETTING (SMAP)\n# user name of sending from\nset realname        = shutterbug\n# address and password of sending from\nset from            = $imap_user\nset smtp_pass       = $imap_pass \n# cloud SMAP server address\nset smtp_url        = smtps://1025096440@qq.com@smtp.qq.com\n# use ssl enforce\nset ssl_force_tls   = yes\n\n\n\n# style and editor define\nset arrow_cursor\n#set folder_format=&quot;%2C %t %N %8s %d %f&quot;\nset sidebar_short_path  = yes\nset sidebar_width       = 22\nset sidebar_visible     = yes\nset sidebar_format      = &quot;%B%* %N/%S &quot;\nset index_format=&quot;%3C %-5Z %&#123;%b %d      &#125; %-25.20L (%?l?%4l&amp;%4c?) %s&quot;\nset editor          = vim\n# html render with w3m\nset mailcap_path    = $HOME/.config/mutt/mailcap\nauto_view text/html\nalternative_order text/plain text/html\n# key binding\nbind pager j next-line\nbind pager k previous-line\nbind attach,index,pager \\CD next-page\nbind attach,index,pager \\CU previous-page\nbind pager g top\nbind pager G bottom\nbind attach,index g first-entry\nbind attach,index G last-entry\nbind index,pager B sidebar-toggle-visible \n# color scheme\ncolor hdrdefault blue black\ncolor quoted blue black\ncolor signature blue black\ncolor attachment red black\ncolor prompt brightmagenta black\ncolor message brightred black\ncolor error brightred black\ncolor indicator red black \ncolor status brightgreen blue\ncolor tree blue black\ncolor normal white black\ncolor markers red black\ncolor search white black\ncolor tilde brightmagenta black\ncolor index blue black ~F\ncolor index red black &quot;~N|~O&quot;\n\nby default mutt cannot render html page, however we can use w3m to resolve it with the configuration file $HOME/.config/mutt/mailcap\ntext/html; w3m -I %&#123;charset&#125; -T text/html; copiousoutput;\n\nwe can type mutt to launch the email client use space key to open the content of email\nsending email is little difference\n# launch text editor to edit message\nmutt -s &#39;tile&#39; user@email.com\n\n# or message from file content\nmutt -s &quot;Subject&quot; somejoeorjane@someserver.com &lt; /var/log/somelog\n\n# or append some file\nmutt -s &quot;Subject&quot; somejoeorjane@someserver.com -a somefile &lt; /tmp/sometext.txt\n\n\nNote:\nchange sidebar folder press c, then press tab twice\n\nexternal monitor brightnesswhen i use a monitor display, i cannot adjust the brightness with xbacklight tool. today, i find the reason why i cannot adjust it in this website. simple to say, external monitor needs other tools to change brightness.\n# it need a kernel module to be loaded\nsudo modprobe i2c-dev\n\n# install a tool called ddcutil\nsudo pacman -S ddcutil\n\n# then find which feature can adjust the brightness\nsudo ddcutil capabilities |grep -i brightness\n\n\n➜  acpi_video0 sudo ddcutil capabilities |grep -i brightness\n   Feature: 10 (Brightness)\n# i find it is 10, then i can adjust it\n# 10 is the feature number\nsudo ddcutil setvcp 10 30\n# increase/decrease\nsudo ddcutil setvcp 10 + 5\nsudo ddcutil setvcp 10 - 5\n\n# and check it\nsudo ddcutil getvcp 10\n\nfinally i need the module to be loaded at boot time, we can add this feature as describe in this website. \nsudo touch /etc/modules-load.d/i2c-dev.conf\nsudo echo i2c_dev &gt; /etc/modules-load.d/i2c-dev.conf\n\nchange ddcutil permission to let normal user can execute it\n# setuid can make normal user execute some file with the file&#39;s owner permission\nsudo chmod u+s /usr/bin/ddcutil\n\nthen add shortcut to xmonad\n((mod1Mask, xK_F6), spawn &quot;ddcutil setvcp 10 - 5&quot;)\n((mod1Mask, xK_F8), spawn &quot;ddcutil setvcp 10 + 5&quot;)\n\ncommand/software usagecommon command and software usage.\njournaljournal is the logging system of systemd. default log location in /var/log/journal. in default setting the size of log will increate until 10% of total disk.\n# we can change the default setting, unit Mib\nvim /etc/systemd/journald.conf\n\nSystemMaxFiles=10\n\nwe can clean by hand\n# show disk usage\njournalctl --disk-usage\n\n# clean \n# vacuum cannot remove active or unarchived file. and rotate can archive active file.\njournalctl --rotate --vacuum-size=1\njournalctl --rotate --vacuum-time=1\n\nformat convert\nnote:\n   utf-8 and gbk are both character encoding, and they are differect, we need to know utf-8 is much better than gbk, for utf-8 support more.\n\nif software cannot show text normally, we have two method to repair it.\n\nchange software setting to display normally if software has the ability\nchange file encoding to which software use with tools\n\nfor example:\nas we know windows file encode with gbk, and it cannot display normally in linux vim editor in default, we can add vim setting to support it\nvim ~/.vimrc\n\nset fileencodings=utf-8,gb18030,gbk\n\nanother method is change file encoding\niconv -f gbk -t utf-8 1.txt -o 2.txt\n\n\n-f from\n-t to\n-o output file\n\nqv2ray &amp; v2ray-core\nNote:\n\nbuy proxy, i buy though iGG. with iGG i can get scribe url\ninstall software to config scribe url\n\n\nbecause yay cannot download software from github, most time will failed to install some software. so need to install a software to proxy.\nQv2ray is a v2ray client gui tool for configing v2ray. and v2ray-core is the core of v2ray.\n\ndownload\ndownload qv2ray , i choose appimage, it can be run directory without install\ndownload v2ray-core, a 64bit zip file\n\nconfigure qv2ray\nfollow this website\n# create a app folder\nmkdir .local/apps/qv2ray\n# move appimage to qv2ray\nmv Downloads/Qv2ray.v2.6.3.linux-x64.AppImage .local/apps/qv2ray\n# then run this app\nchmod u+x ./Qv2ray.v2.6.3.linux-x64.AppImage\n./Qv2ray.v2.6.3.linux-x64.AppImage\n\n# create v2ray-core folder\nmkdir .local/apps/qv2ray/vcore\n# unzip v2ray-core to new folder\nunzip Download/v2ray-linux-64.zip -d .local/apps/qv2ray/vcore\n# then configure in gui app\n\nchange file location and click “ok”\n\n\nand follow website to add scribe address, then we can use proxy to visit website\n\nthe way to allow yay(git) to proxy follow this website\n-- git\n# http https\ngit config --global http.proxy http://127.0.0.1:8889\ngit config --global https.proxy https://127.0.0.1:8889\n# socks5\ngit config --global http.proxy socks5://127.0.0.1:1089\ngit config --global https.proxy socks5://127.0.0.1:1089\n\n– speed github\n\n\nconfigure http https proxy  git config –global http.https://github.com.proxy https://127.0.0.1:8889  git config –global https.https://github.com.proxy https://127.0.0.1:8889\nconfigure socks5 proxy, this is what yay used  git config –global http.https://github.com.proxy socks5://127.0.0.1:1089  git config –global https.https://github.com.proxy socks5://127.0.0.1:1089\nthe port we can find in gui configure\n\n![image-20210505014434826](.images/image-20210505014434826.png)\n\n- after configure, if i need to use yay, first choose a proxy and enable it, then use yay to download software, speed fast.\n\n![image-20210505015404595](.images/image-20210505015404595.png)\n\n- at last create a soft link to appimage\n\n```shell\ncd .local/bin\nln -sf ~/.local/apps/qv2ray/Qv2ray.v2.7.0-pre2.linux-x64.AppImage v2ray\n\n# usage: such as reconnect last connect\nv2ray --reconnect\n\nterminal proxyabove v2ray setting can allow git / github /browser proxy, but terminal cannot. below will show how to proxy terminal.\nthe setting can work correctly depend on above v2ray work fine\nsudo pacman -S proxychains-ng \n\nmodify configure file\n# add this to file end\n#socks4         127.0.0.1 9050\nhttp    127.0.0.1 8889\nsocks5  127.0.0.1 1089\n\nproxy terminal\nproxychains bash\n\n\n\ncronie notifyi use cronie to edit time task\npacman -S cronie\n\nin default, cronie use vi to edit task. we can change it vim\nEDITOR=vim crontab -e\n\nthere are some principles we need to follow:\n\nmessage cannot send to dbus directorily\ncrontab don’t know system variables, we need to announce it\nstdout not support pipline\ncannot recognize local command such as ~/.local/bin\n\nin order to use notify and sound we need announce variables either in script or crontab command\n## sound variable\n# check variable&#39;s value\necho $XDG_RUNTIME_DIR\n# 1. write in script\nexport XDG_RUNTIME_DIR=/run/user/1000\n\n# 2. or announce in crontab\nenv XDG_RUNTIME_DIR=/run/user/1000\n\n\n## nofify\n# check variable&#39;s value\necho $DBUS_SESSION_BUS_ADDRESS\n# 1. write in script\nexport DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus\n# 2. or announce in crontab\nenv DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus\n\nwe can write crontab like this:\n* * * * * env DBUS_SESSION_BUS_ADDRESS=unix:path=&quot;/run/user/1000/bus&quot; XDG_RUNTIME_DIR=&quot;/run/user/1000&quot; dunstify &quot;`~/.local/bin/filesync`&quot;\n\nhowever, there is a problem. if we send nothing, the dunst will also show a none notify. we can fix it by writing command in script, and then execute script\nfunction log()&#123;\n    exec 1&gt;&amp;4\n    if [ $# -gt 0 ];then\n        info=$@\n        echo &quot;[$(date &#39;+%F %H:%M&#39;)] :: $info&quot;\n        # send notify in script\n        dunstify &quot;[$(date &#39;+%F %H:%M&#39;)] :: $info&quot;\n    fi\n    exec 1&gt;/dev/null\n    unset info\n&#125;\n\nthen execute script with crontab\n* * * * * env DBUS_SESSION_BUS_ADDRESS=unix:path=&quot;/run/user/1000/bus&quot; XDG_RUNTIME_DIR=&quot;/run/user/1000&quot; ~/.local/bin/filesync\n\nonekooneko is a application that displays a cute cat chases cursor.\n# AUR install\nparu -S oneko\n\n# add to xmonad startup app\nspawnOnce &quot;oneko &amp;&quot;\n\ndowngrade applicationsometimes we want to use an old version application, we can use downgrade command to downgrade.\npacman -S downgrade\n\n# downgrade a software\ndowngrade app_name\n# then choose a number to downgrade\n\n使用shoadowsocks上google安装shadowsocks代理以及proxychains协议转换\nsudo pacman -S proxychains-ng shadowsocks\n\n修改proxychains配置文件\nsudo vim /etc/proxychains.conf\n#socks4         127.0.0.1 9050        #注释\nsocks5  127.0.0.1 1080                #添加\n\n添加本地域名解析\nsudo vim /etc/hosts\n#添加\n104.31.74.55  youneed.win\n104.31.74.54  www.youneed.win\n\n添加脚本变量路径\nvim .xinitrc\nexport PATH=$PATH:~/.local/bin\n\n在~/.local/bin下建立软链接，指向脚本\ncd ~/.local/bin\nln -s ~/Documents/script/shell/shadowshocks.sh sslink\n\n运行脚本启动代理\nproxychains firefox        #浏览器代理\nproxychains bash        #终端代理\n\n安装virtualbox#由于使用的是linux内核，所以选择virtualbox-host-modules-arch \nsudo pacman -S virtualbox virtualbox-host-modules-arch \n\n在启动虚拟机之前，需要加载模块\nmodprobe vboxdrv\n\n启动virtualbox的几种方式：\n1.GUI图形界面的启动，这也是大部分时候都在使用的方式，即运行virtualbox软件\n2.命令启动，即使用命令无界面启动。后来发现这种方式启动和xmonad很搭，因为不会存在热键冲突的问题，那么xmonad中的所有窗口操作的快捷键依然有效。\nvboxsdl --startvm &#39;kali linux&#39;        #由于系统名字中有空格，所以要使用引号\n\n3.同样是命令启动，但这种大多数时候是作为服务器使用的方式，即没有任何界面，只能通过ssh去连接主机（就像在windows中使用xshell一个意思）\nvboxheadless -s &#39;kali linux&#39;\n\n解决xorg问题自从安装系统之后就发现一个问题，那就是xorg每次启动都要花个20多秒。所以首先是查看日志\n#xorg的日志在家目录下\nvim .local/share/xorg/Xorg.0.log\n#然后查看EE报错的地方，发现每次都是在启动nouveau驱动的时候卡了20多秒，然后启动失败了\n#原因是我没有安装nouveau驱动，没有安装的原因就是安装之后启动倒是挺迅速的，但是退出xorg之后，或者想要关机的时候就会卡住。\n#我想为什么就不能让它不去检测这个驱动呢？终于google到了答案：就是强制让xorg使用intel显卡，而忽略n卡\n\ncd /etc/X11/xorg.conf.d/\ntouch nonvidia.conf\n#添加如下代码：\nSection &quot;Device&quot;\n    Identifier  &quot;Intel Card&quot;\n    Driver      &quot;intel&quot;\nEndSection\n\nSection &quot;Device&quot;\n    Identifier  &quot;Nvidia Card&quot;\n    Driver      &quot;nouveau&quot;\nEndSection\n\nSection &quot;Screen&quot;\n    Identifier  &quot;My Screen&quot;\n    Device      &quot;Intel Card&quot;\nEndSection\n\n然后reboot，startx，果然一下子就打开了图形界面，虽然查看了一下日志，依然有报错，但是它直接跳过之后的等待以及检测了。以上介绍在wiki上也有讲，只是我不知道咋写啊。这也算是基本完成了系统安装以及之后的错误修复了吧！\n安装系统之后博客迁移安装必要软件\n#这些都要安装\nsudo pacman -S git nodejs npm\nsudo npm install -g hexo-cli\nnpm install --save hexo-deployer-git\nnpm audit fix\nnpm audit fix --force\nnpm install hexo-generator-searchdb --save\n\n当然我又安装了这个加密插件，结果我错了\nnpm install --save hexo-blog-encrypt    #然后我哭了\n\n搞了半天老是报错，什么tostring不能为空，我的密码明明有啊，查看了一下js配置文件，发现确实有password.tostring()这个\n然后我用数字做密码试了一下不报错，但是我之前加密的文章全部没加密了？我觉得这是一个bug，至少前面应该做一下判断。所以去你的加密，索性不用了，然后一切都好了。\nssh-keygen\ncat ~/.ssh/id_rsa.pub\n\n然后在github设置中将sshkey添加进去\n当然这后面还有两步，如果没有这两步，推送的时候会提示的\ngit config --global user.email &quot;2935549510@qq.com&quot;\ngit config --global user.name &quot;narcissus&quot;\n\n再编译，推送\nhexo g\nhexo d\n\n与Android手机连接这里是使用了USB与手机连接\nsudo pacman -S android-file-transfer    #安装软件\n\n手机通过USB与电脑连接，同时开启MTP传输。\nsudo aft-mtp-mount /mnt                    #挂载\n\n然后就可以直接进入/mnt目录查看手机中的文件了\n\n更新key失败加入archlinuxcn源后，下载archlinuxcn-keyring时失败。\n# 删除gpg数据库\nrm -rf /etc/pacman.d/gunpg\n# 重新获取\npacman-key --init\npacman-key --populate\npacman-key --refresh-keys\npacman -Syu\n\n另外一个解决方法是通过调整时间，出问题的根本原因在于时间不一致，但是这次时间看似都正常，因此用第一种方法解决了\n# 查看系统时间\ndate\n# 查看硬件时钟\nhwclock --show\n# 修改硬件时钟\ntimedatectl set-time &quot;2019-11-24 09:56:00&quot;\n# 重新更新\npacman -Syu\n\ndiscusssome problems i meet while installing the system.\ncannot find the grub info in biosthis time i installed system in msi, grub installation and configuration were right, but cannot find the grub in bios. \ni know the boot info was stored in NVRAM, so i find wheather it has the boot info with my archlinux.\nefibootmgr -v\n\n there has nothing info of my archlinux, so i added it by myself.\n# the efi partition is /dev/sda1 and efi installed in /boot/efi with directory /boot/efi/EFI/GRUB/grubx64.efi\nefibootmgr --create --disk /dev/sda --part 1 --loader /EFI/GRUB/grubx64.efi --label &quot;archlinux bootloader&quot; --verbose\n\nthen i checked weather it has the archlinux boot info, and got correct info\nefibootmgr -v\n\nBoot0006* archlinux bootloader  PciRoot(0x0)/Pci(0x17,0x0)/Sata(2,65535,0)/HD(1,GPT,fd816945-085d-4dca-aabc-734244e1ff5f,0x800,0x31800)/File(\\EFI\\BOOT\\BOOTX64.EFI)\n\nhowever when i reboot the system, there has nothing what i added before.\nat last i find the problem:\n\nthat’s why the info i added disappeard. so while installing the grub, i need add a removable parameter. and then the grub configure will rename to BOOTX and store in another directory where the UEFI firmware can recognize.\n# correctly command\ngrub-install --efi-directory=/boot/efi --bootloader-id=GRUB --removable\n\n now the directory likes this:\n/boot/efi\n└── EFI\n    └── BOOT\n        └── BOOTX64.EFI\n\nthe grub configure  producted before can be removed or leave it alone since it will not be used.\nxterm or ranger cannot show iconssometimes while installing nerd-font and ranger plug-icons we may find terminal cannot show icons, and the problem was leaded by error system font  setting. we need to change whether the configure properly\n~ » cat /etc/locale.conf                                                                                                                                                                              ~  \nLANG=en_US.UTF-8\n\nxterm cannot show Chineseat first, checking whether we have setted the correct locale\n# make sure exist &quot;en_US.UTF-8&quot;\nlocale -a\n\n# make sure have &quot;LANG=en_US.UTF-8&quot;\ncat /etc/locale.conf\n\n# if not run this\necho &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf\n# or use localectl\nlocalectl set-locale LANG=en_US.UTF-8\n\nif locale setting makes no effect, we need force xterm use utf8\n# add this to .Xresource\n\nXTerm*locale: false\nXTerm*utf8: true\n\nrun xrdb .Xresource to make effect of changes \nAMD virtualize failedwhen use virtualbox to launch a virtual machine, there comes a error, it is leaded by disabled cpu virtual in bios which is in default.\nERROR MSG: AMD-V is disabled in the BIOS (or by the host OS) (VERR_SVM_DISABLED).\nFIX: enable svm mode\n\nyay install failed with strip binaryERROR: Cannot find the strip binary required for object file stripping.\nWHY: miss some application\nFIX: install base-devel\nmirror version errorERROR:  error while loading shared libraries: libicui18n.so.69\nWHY: version problem\nFIX: uncomment community mirror and run system update: pacman -Syu\npycharm error in xmonadif in windows environment, it works fine. but in xmonad, there comes a error: WARN - s.impl.EditorColorsManagerImpl - Cannot find scheme: Vibrant Ink from plugin: com.intellij.database.\nfixed by exporting a environment variable\nexport _JAVA_AWT_WM_NONREPARENTING=1\n\nin order to simply usage, write it with alias\nalias pycharm=&#39;export _JAVA_AWT_WM_NONREPARENTING=1 &amp;&amp; ~/pycharm-2019.3.3/bin/pycharm.sh &amp;&gt;/dev/null &amp;&#39;\n\nobs cannot record microphone soundthe default setting after installing obs-studio cannot record microphone. In a fact that it’s not the problem of obs, it is the error of system sound setting. The default system setting mutes the sound of microphone, we need install a software called pavucontrol to configure it.\ngui tool\n\npacman -S pavucontrol\n\nclick the icon to disable muting, then every thing works fine.\n\n\ncli tool\nanother method is install a cli tool, much light than gui tool.\n# install\npacman -S pulsemixer\n\n# list all audio device\npulsemixer --list\n\n# find the mute one and unmute it\npulsemixer --id &lt;source-2&gt; --unmute\n\ninvalid or corrupted package(pgp signature)after adding china mirror to pacman.conf and running update, package install will meet this problem\nerror: jansson: signature from &quot;Eli Schwartz &lt;eschwartz@archlinux.org&gt;&quot; is marginal trust\n:: File /var/cache/pacman/pkg/jansson-2.10-3-x86_64.pkg.tar.xz is corrupted (invalid or corrupted package (PGP signature)).\n\nmethod to resolve the problem\n# eg:\npacman-key --list-sigs |rg &#39;Eli&#39;\npacman-key --delete 91FFE0700E80619CEB73235CA88E23E377514E00\npacman-key --populate archlinux\n\n","categories":["learn"],"tags":["archlinux"]},{"title":"go","url":"/2022/04/23/go/","content":"GOinstallfollow this document, download compressed file and extract to the place where application stores.\n# i install go in .local/apps.\ntar -xzf Downloads/go1.16.3.linux-amd64.tar.gz -C .local/apps\n\nconfigure go env\n# add to /etc/profile or ~/.zshrc. i put it in .xinitrc\nexport PATH=$PATH:/home/blueocean/.local/apps/go/bin\n\nafter source configure file we can check whether it makes effect\ngo env\n\nconfig workspaceGOPATH is the place of our workspace which can be find by running go env, we can change it by running\ngo env -w GOPATH=&quot;$HOME/Public/code/go&quot;\n\nthe command will write go environment variable to ~/.config/go/env file.\nbelow is the standard workspace structure\nPublic/code/go\n├── bin\n├── pkg\n└── src\n    └── github.com\n        └── blueocean\n            └── go_project_1\n                └── helloworld\n                    └── main.go\n\n\nbin: compiled file stores, when we run go install xx.go will create binary file to the folder\npkg: other people package, the package/module we download will store in the folder\nsrc: source code file, the place we write go code\n\nwhy there are github.com/username? it is useful when we work in a team. the folder name is the same as github.\nvscode go plugini will write code with vscode editor, first install go extension. then when we write go code, there will be a prompt suggests us to install other extensions. and just click install all. however it may failed because we can not access github file in our country.\nbut there comes a method can resolve this problem with proxy. goproxy.io is a proxy of go\ngo env -w GO111MODULE=on\ngo env -w GOPROXY=https://goproxy.io,direct\n\nthen reinstall all will be fine\n\nNote:\nwhile install go plugin, there comes a error message: Writing login information to the keychain failed with error ‘The name org.freedesktop.secrets was not provided by any .service files’.\nresolve method:\nsudo pacman -S gnome-keyring libsecret\n\n\nrun or compile filethough go is a compile language, go tools allow us to run code without compile. we can just type\ngo run go_file.go\n\nif we wanna to compile it to binary file\n# this will product a binary file in current location\ngo build go_file.go\n\nwe can also compile file with go install, and it will put binary file to bin directory\ngo install go_file.go\n\nhello worldpackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    fmt.Println(&quot;hello world!&quot;)\n&#125;\n\nwe need to know that in an application there are many go files and each of them need to belong to a package. the name of package can be customized, however there must to be a package name main for progarm will start running with this file. and there must be a function named main for program will start running with main function.\nwe can import other packages by keyword import. neither build in packages or download from internet with go get\nimport &quot;fmt&quot;\nimport &quot;math&quot;\n\n// or use parenthense\nimport (\n    &quot;fmt&quot;\n    &quot;math&quot;\n)\n\nnaming rulein Go, a name is exported if it begins with a capital letter.\n\nfunction name and variable always begins with lowercase。\nexcept the package need to be imported by other packages as a module, then function name begin with capital letter\n\nconstanthe value that can not be changed is called constan. we can define it by const\nconst name = &quot;john&quot;\n\nvariablesas we know go is a compile language, we need to define a variable before we use it.\nthere are two principles we need follow:\n\ndefine a variable before we use it.\nevery defined variable need to be used\n\nthere are three ways to define a variable:\n\nuse var keyword\nvar variable_name type\n\neg:\nvar name string\nvar age int\nvar high float32\nvar ptr *int\n\n\ninitialize without type\nvar variable_name = value\n\neg:\nvar name = &quot;Azon&quot;\nvar age = 12\nvar ptr = &amp;age\n\n\ninside function use short sign\n\nNote:\nthis method can only used inside function\n\nvariable_name := value\n\neg:\nname := &quot;Azon&quot;\nage := 12\nptr = &amp;age\n\n\n\ndefine same type variables in one line\nvar name, age int\n\ndefine serveral variables with parentheses\nvar (\n    name string\n    age int\n    ptr *int\n)\n// or sign value\nvar (\n    name = &quot;Azon&quot;\n    age = 12\n    ptr = &amp;age\n)\n\n\nnote:\n​    second and third used often. and third can only be used in function\n\nbasic typebool\n\nstring\n\nint  int8  int16  int32  int64\nuint uint8 uint16 uint32 uint64 uintptr\n\nbyte // alias for uint8\n\nrune // alias for int32\n     // represents a Unicode code point\n\nfloat32 float64\n\ncomplex64 complex128\n\narraythe length of array is part of array’s type. and the size can not be changed\ndefine array with fixed size\nvar array_name [length]type\n\ndefine array with values\nvar array_name = [length]type &#123;value1, value2...&#125;\n// or use `...`, in this way the length of array is the initial length of value elements. it may common to use\nvar array_name = [...]type&#123;v1,v2,v3,v4&#125;\n\nuse short syntax\narray_name := [length]type &#123;value1, value2...&#125;\n\nchange array value\nnums := [2]int&#123;1, 2&#125;\nnums[0] = 2\n\narray index\narr[0] //first\narr[len(arr)-1] //last\n\ntwo ways to loop array value\npackage main\n\nimport (\n    &quot;fmt&quot;\n)\n\nfunc main() &#123;\n    dataJson := [...]string&#123;&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;&#125;\n    // range\n    for _, v := range dataJson &#123;\n        fmt.Println(v)\n    &#125;\n    // index\n    for i := 0; i &lt; len(dataJson); i++ &#123;\n        fmt.Println(dataJson[i])\n    &#125;\n&#125;\n\ncompare two arrays\nif the element type of the array is comparable, then the array type is also compartable\npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    arr1 := [...]int&#123;1, 2, 3&#125;\n    arr2 := [3]int&#123;1, 2, 3&#125;\n    fmt.Println(arr1 == arr2)\n&#125;\n\nsliceslice is the reference of array, it doesn’t store any data but the describe of data. \n\nno specified size\nchange slice will change array which slice describes\n\ndefine array with changeable length\nslice []type&#123;v1,v2,v3&#125; truely creates an array [3]type&#123;v1,v2,v3&#125; and then builds a slice that references it\nvar slice_name = []type&#123;value1, value2...&#125;\n\n// or\nslice_name := []type&#123;value1, value2...&#125;\n\n// use pointer\nslice_name := &amp;[]type&#123;&#125;\n\n// specified with exist array\nvar array_name = [3]int&#123;v1,v2,v3&#125;\nslice_name1 := array_name[0:2]\nslice_name2 := array_name[:]\nslice_name3 := array_name[0:]\nslice_name4 := array_name[:2]\n\n// use make to create slice\nslice_name := make([]type, len_of_array, cap_of_array)\n// eg:\nnum := make([]int, 0, 5)\n\npackage main\n\nimport &quot;fmt&quot;\n\n\nfunc main() &#123;\n    var num = [4]int&#123;1, 2, 3, 4&#125;\n    a := num[0:4]\n    a[0] = 8\n    fmt.Println(num)\n&#125;\n//[8 2 3 4]\n\nadd value to changeable length array\nnums := []int&#123;1, 2&#125;\nnums = append(nums, 3)\n\nslice has length and capacity\n\nThe length of a slice is the number of elements it contains.  \n\nThe capacity of a slice is the number of elements in the underlying array,     counting from the first element in the slice.  \n\n\nvar sum = []int&#123;1, 2, 3, 4, 5&#125;\nnum := sum[:0]\nfmt.Println(len(num), cap(num))\n\nslice of slice\npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    nums := [][]int&#123;\n        []int&#123;&#125;,\n        []int&#123;&#125;,\n        []int&#123;&#125;,\n    &#125;\n    fmt.Println(nums)\n&#125;\n// [[] [] []]\n\nnilThe zero value of a slice is nil.  \nA nil slice has a length and capacity of 0  and has no underlying array.  \npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    var num []int\n    if num == nil &#123;\n        fmt.Println(num, len(num), cap(num))\n    &#125;\n&#125;\n\nrange_ used to ignore some value\npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    nums := [][]int&#123;\n        []int&#123;1, 2, 3&#125;,\n        []int&#123;4, 5, 6&#125;,\n        []int&#123;7, 8, 9&#125;,\n    &#125;\n    fmt.Println(nums)\n    for _, v := range nums &#123;\n        fmt.Println(v)\n    &#125;\n&#125;\n\nmap// define syntax\nvar map_name = make(map[key_type]value_type)\n\nvar student = make(map[string]int)\nstudent[&quot;xiaozhan&quot;] = 23\nstudent[&quot;xiaoli&quot;] = 22\nfmt.Println(student, student[&quot;xiaozhan&quot;])\n\n// without define\nvar student = map[string]int&#123;\n    &quot;xiaozhan&quot;: 23,\n    &quot;xiaoli&quot;:   22,\n&#125;\nfmt.Println(student, student[&quot;xiaozhan&quot;])\n\nhowever the way map most useful is combining with struct\nimport &quot;fmt&quot;\n\ntype People struct &#123;\n    name      string\n    age       int\n    graduate  bool\n    email     string\n    address   string\n    telephone string\n&#125;\n\nfunc main() &#123;\n    var student = map[int]People&#123;\n        1: &#123;&quot;xiaozhan&quot;, 12, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;,\n        2: &#123;&quot;johnsemi&quot;, 23, false, &quot;johnsemi@gmail.com&quot;, &quot;American&quot;, &quot;98234222&quot;&#125;,\n    &#125;\n\n    // update value\n    student[1] = People&#123;&quot;xiaozhan&quot;, 18, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;\n    fmt.Println(student[1].age)\n\n    // delete element\n    delete(student,2)\n\n    // check whether key exist\n    _, exist := student[2]\n    fmt.Println(exist)\n&#125;\n\n\nNote: \ncan’t change values associated with keys in a map, only if we use pointer\n\npackage main\n\nimport &quot;fmt&quot;\n\ntype People struct &#123;\n    name      string\n    age       int\n    graduate  bool\n    email     string\n    address   string\n    telephone string\n&#125;\n\nfunc main() &#123;\n    var student = map[int]*People&#123;\n        1: &#123;&quot;xiaozhan&quot;, 12, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;,\n        2: &#123;&quot;johnsemi&quot;, 23, false, &quot;johnsemi@gmail.com&quot;, &quot;American&quot;, &quot;98234222&quot;&#125;,\n    &#125;\n    student[1] = &amp;People&#123;&quot;xiaozhan&quot;, 18, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;\n    student[1].age = 22\n    fmt.Println(student[1].age)\n&#125;\n\nstructA struct is a collection of fields.  \n\nStruct fields are accessed using a dot.\nStruct fields can be accessed through a struct pointer.  and has a short write (*p).x with p.x\nStruct literal  used to make new data field\n\npackage main\n\nimport &quot;fmt&quot;\n\ntype People struct &#123;\n    name  string\n    age   int\n    email string\n&#125;\n\nfunc main() &#123;\n    no1 := People&#123;&quot;xiaoming&quot;, 12, &quot;823739@qq.com&quot;&#125;\n    no2 := People&#123;name: &quot;xiaozhan&quot;, age: 13&#125;\n    no3 := &amp;People&#123;age: 12&#125;\n    fmt.Println(no1, no1.age+no2.age, no3.age)\n&#125;\n\nfor loopin golang, there is no while loop, however for loop can do the same thing as while.\n// infinite loop\nfor &#123;\n\n&#125;\n\n// for each\nfor i,v := range xxx &#123;\n\n&#125;\n\n// break or continue\nfor &#123;\n    if ...... &#123;\n        break\n    &#125; else &#123;\n        continue\n    &#125;\n&#125;\n\nbasic functionthe way to define function with keyword func\nfunc func_name(arg type) return_type &#123;\n    //function content\n&#125;\n\n// more than one return value use `()`\nfunc func_name(arg1 type, arg2 type) (return_type, return_type) &#123;\n    //function content\n&#125;\n\n// named return\n// combine same type\nfunc func_name(arg1, arg2 type) (x,y return_type) &#123;\n    x = xxx\n    y = xxx\n    return\n&#125;\n\neg:\npackage main\n\nimport (\n    &quot;fmt&quot;\n)\n\nfunc sum(a, b int) int &#123;\n    return a + b\n&#125;\n\nfunc reverse(a, b string) (string, string) &#123;\n    return b, a\n&#125;\n\nfunc minormax(a, b int) (max1, min1 int) &#123;\n    var max, min int\n    if a &gt; 0 &amp;&amp; b &gt; 0 &#123;\n        if a &gt; b &#123;\n            max = a\n            min = b\n        &#125; else &#123;\n            max = b\n            min = a\n        &#125;\n        for i := min; i &gt; 1; i-- &#123;\n            if max%i == 0 &amp;&amp; min%i == 0 &#123;\n                max1 = i\n            &#125;\n        &#125;\n        for i := max; i &gt; 0; i++ &#123;\n            if i%max == 0 &amp;&amp; i%min == 0 &#123;\n                min1 = i\n                // add break here or it cannot stop\n                break\n            &#125;\n        &#125;\n    &#125;\n    return\n&#125;\n\nfunc main() &#123;\n    a := sum(1, 2)\n    b, c := reverse(&quot;hello&quot;, &quot;world&quot;)\n    d, e := minormax(8, 10)\n    fmt.Println(a, &quot;\\t&quot;, b, c, &quot;\\t&quot;, d, e)\n&#125;\n\n... usagetwo ways:\n\npass ... before function input type: this way can let function accept values which the number we are not sure\npass ... after array/slice: this way can parse them out of array/slice without for loop\n\n// pass ... to function type\npackage main\n\nimport &quot;fmt&quot;\n\nfunc Sum(a ...float32) float32 &#123;\n    var sum float32 = 0\n    for _, v := range a &#123;\n        sum = sum + v\n    &#125;\n    return sum\n&#125;\n\nfunc main() &#123;\n    fmt.Println(Sum(56, 78, 60.5, 89.5, 93, 76))\n    // or \n    // fmt.Println(Sum(score...))\n&#125;\n\n// pass ... to array/slice\npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    score := []float32&#123;56, 78, 60.5, 89.5, 93, 76&#125;\n    var array = []float32&#123;&#125;\n    array = append(array, score...)\n    fmt.Println(array)\n&#125;\n\nfunction value\nFunctions are values too. They can be passed around just like other values.  \nFunction values may be used as function arguments and return values.  \n\npackage main\n\nimport &quot;fmt&quot;\n\nfunc plu(fn1 func(float32, float32) float32, fn2 func(float32, float32) float32) float32 &#123;\n    return fn1(2, 3) * fn2(2, 3)\n&#125;\n\nfunc main() &#123;\n    a := func(x, y float32) float32 &#123;\n        return x + y\n    &#125;\n    b := func(x, y float32) float32 &#123;\n        return x - y\n    &#125;\n\n    c := plu(a, b)\n    fmt.Println(c)\n&#125;\n\nexampleinitialize struct data with functions and return a struct data type.package main\n\nimport &quot;fmt&quot;\n\n// define a struct type\ntype people struct &#123;\n    name string\n    age  int\n&#125;\n\n// initialize struct with function and return a struct\nfunc who(name string, age int) *people &#123;\n    people := &amp;people&#123;\n        name: name,\n        age:  age,\n    &#125;\n    return people\n&#125;\n\n// function to get struct data\nfunc (p people) getName() string &#123;\n    return p.name\n&#125;\n\nfunc main() &#123;\n    // used like this: method().method()\n    res := who(&quot;libai&quot;, 12).getName()\n    fmt.Println(res)\n&#125;\n\nread from file and write filepackage main\n\nimport (\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    // read content form ori and write to filePath file\n    var filePath string = &quot;/mnt/c/Users/qiyue/Desktop/test.txt&quot;\n    var ori string = &quot;/mnt/c/Users/qiyue/Desktop/go.md&quot;\n\n    // open write file\n    new_file, err := os.OpenFile(filePath, os.O_WRONLY|os.O_TRUNC, 0777)\n    defer new_file.Close()\n    if err != nil &#123;\n        log.Fatal(err)\n    &#125;\n\n    // open content file\n    ori_file, err := os.ReadFile(ori)\n    if err != nil &#123;\n        log.Fatal(err)\n    &#125;\n\n    // write content\n    if _, err := new_file.Write(ori_file); err != nil &#123;\n        log.Fatal(err)\n    &#125;\n&#125;\n\nmethodsGo does not have classes. However, you can define methods on types.  \n\nA method is a function with a special receiver argument.  \nThe receiver appears in its own argument list between the func keyword and  the method name.\n\n// method with struct\ntype type_name struct &#123;&#125;\nfunc (v type_name) func_name() return_type &#123;&#125;\n\n// use method\nv := type_name&#123;&#125;\nv.func_name()\n\n// method with none-struct type\ntype type_name value_type\nfunc (v type_name) func_name() return_type&#123;&#125;\n\n// use method\nv := type_name()\nv.func_name()\n\npointer receiver\n// with pointer receiver, we can change struct data self\ntype type_name struct &#123;&#125;\nfunc (v *type_name) func_name() return_type&#123;&#125;\n\n// change struct data with function\nv := type_name&#123;&#125;\nv.func_name()\n\nmethod with pointer receiver can be called either a value or a pointer\n// method with pointer receiver\ntype type_name struct &#123;&#125;\nfunc (v *type_name) func_name() return_type&#123;&#125;\n\n// called by value\nv := type_name&#123;&#125;\nv.func_name()\n// callled by pointer\nv := &amp;type_name&#123;&#125;\nv.func_name()\n\nmethod with value receiver can be called either a value or a pointer\n// normal value receiver\ntype type_name struct &#123;&#125;\nfunc (v type_name) func_name() return_type &#123;&#125;\n\n// can be call with value or pointer\nv1 := type_name&#123;&#125;\nv1.func_name()\n\nv2 := &amp;type_name&#123;&#125;\nv2.func_name()\n\n\nNote:\n1. even though both can work fine, however only pointer receiver has the capacity to change struct data itself\n2. pointer receiver don&#39;t copy data struct, which can minimize memory usage\n\n\ninterfacesAn interface type is defined as a set of method signatures.  \n\nA value of interface type can hold any value that implements those methods.  \n\npackage main\n\nimport &quot;fmt&quot;\n\ntype Cal interface &#123;\n    Abs() float32\n&#125;\n\ntype Sum struct &#123;\n    a, b float32\n&#125;\n// function of sum implement Cal interface\nfunc (s *Sum) Abs() float32 &#123;\n    return float32(s.a + s.b)\n&#125;\n\ntype Div struct &#123;\n    a, b float32\n&#125;\n// function of div implement Cal interface\nfunc (d *Div) Abs() float32 &#123;\n    return float32(d.a / d.b)\n&#125;\n\nfunc main() &#123;\n    // apply any value to interface variable which has implemented interface methods\n    var a Cal\n    a = &amp;Sum&#123;2, 3&#125;\n    fmt.Println(a.Abs())\n    a = &amp;Div&#123;2, 3&#125;\n    fmt.Println(a.Abs())\n&#125;\n//5\n//0.6666667\n\nThe interface type that specifies zero methods is known as the empty interface\ninterface&#123;&#125;\n\n\nAn empty interface may hold values of any type.     (Every type implements at least zero methods.)  \n\nEmpty interfaces are used by code that handles values of unknown type.     For example, fmt.Print takes any number of arguments of type interface&#123;&#125;.  \n\n\npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    // empty interface `interface&#123;&#125;` as a value type\n    var num interface&#123;&#125;\n    num = 5\n    fmt.Println(num)\n    num = &quot;justin&quot;\n    fmt.Println(num)\n&#125;\n\ntype assertions\n// define a variable of empty interface\nvar i interface&#123;&#125;\ni = &quot;hello&quot;\n\n// use i.(type) to check the type of i is true. ok&#39;s value is true || false\n_,ok := i.(type)\n\n// eg :\npackage main\n\nimport &quot;fmt&quot;\n\nfunc main() &#123;\n    var i interface&#123;&#125;\n    i = &quot;hello&quot;\n    _, ok := i.(int)\n    fmt.Println(ok)\n&#125;\n//false\n\ntype switch\nuse type assertions with switch case to ignore value’s type or deal value with different types.\npackage main\n\nimport &quot;fmt&quot;\n\nfunc do(i interface&#123;&#125;) &#123;\n    switch t := i.(type) &#123;\n    case int:\n        fmt.Println(t * 2)\n    case string:\n        fmt.Println(&quot;words:&quot;, t)\n    default:\n        fmt.Println(&quot;noknown type !&quot;)\n    &#125;\n&#125;\n\nfunc main() &#123;\n    do(20)\n    do(&quot;hello world&quot;)\n    do(12.232)\n&#125;\n\n\nNote:\ntype Stringer interface &#123;\n    String() string\n&#125;\n\nfmt package will look for Stringer interface to print values by default. it is be defined in fmt package\n\n// Exercise: Stringer\n// Make the IPAddr type implement fmt.Stringer to print the address as a dotted quad.\n// For instance, IPAddr&#123;1, 2, 3, 4&#125; should print as &quot;1.2.3.4&quot;. \n\npackage main\n\nimport &quot;fmt&quot;\n\ntype IPAddr [4]byte\n\nvar hosts = map[string]IPAddr&#123;\n    &quot;loopback&quot;:  &#123;127, 0, 0, 1&#125;,\n    &quot;googledns&quot;: &#123;8, 8, 8, 8&#125;,\n&#125;\n\nfunc (ip IPAddr) String() string &#123;\n    return fmt.Sprintf(&quot;%v.%v.%v.%v&quot;, ip[0], ip[1], ip[2], ip[3])\n&#125;\n\nfunc main() &#123;\n    for name, ip := range hosts &#123;\n        fmt.Printf(&quot;%v:\\t%v\\n&quot;, name, ip)\n    &#125;\n&#125;\n\ngoroutinesA goroutine is a lightweight thread managed by the Go runtime.  \npackage main\n\nimport &quot;fmt&quot;\n\nvar num = [10]int&#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10&#125;\n\nfunc main() &#123;\n    for _, j := range num &#123;\n        go fmt.Println(j)\n        fmt.Println(j)\n        fmt.Println(&quot;ordered&quot;)\n    &#125;\n&#125;\n\nchannelChannels are a typed conduit through which you can send and receive values with the channel operator, &lt;-.  \n// create channel\nch := make(chan int)\n\n// send v to channel ch\nch &lt;- v\n// receive from ch, and assign value to v\nv := &lt;- ch\n\nbuffered channels\nChannels can be buffered.  Provide the buffer length as the second argument to make to initialize a buffered channel:  \nch := make(chan int, 100)\n\nSends to a buffered channel block only when the buffer is full. Receives block when the buffer is empty.  \nexecute shell commandgo has a built in module os/exec, which can execute shell command in the system.\n\nOutput(): run command and show stdout, exit code\nRun(): run command and wait it to finish, only show stderr\nStart(): run command in background, only show stderr\n\n// 1. use log.Printf() to pretty output with date showing\n// 2. check command exists in system first\n// 3. output isn&#39;t string, use string() converts\n// 4. exec.Command() can not use `|` and multi commands, so \n// we need use `bash -c` to wrap multi commands and pipeline\n// 5. use `return` to exit program while error appears\n\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot; // output with date\n    &quot;os/exec&quot;\n)\n\nvar commands = [3]string&#123;&quot;/bin/bash&quot;, &quot;ps&quot;, &quot;wc&quot;&#125;\n\nfunc main() &#123;\n    // LookPath to check whether the system contains this commands\n    for _, c := range commands &#123;\n        _, err := exec.LookPath(c)\n        if err != nil &#123;\n            log.Printf(&quot;%v: not find in path&quot;, c)\n            return\n        &#125;\n    &#125;\n\n    // Command execute, output is stream\n    cmd := exec.Command(&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;ps -ef |wc -l&quot;)\n    stream, err := cmd.Output()\n    if err != nil &#123;\n        log.Println(err)\n        return\n    &#125;\n    // convert to character with string function\n    fmt.Println(string(stream))\n\n    // Run() don&#39;t show a stdout value\n    error := exec.Command(&quot;ls&quot;, &quot;-l&quot;).Run()\n    if error != nil &#123;\n        log.Println(error)\n    &#125;\n&#125;\n\nfind the type of variable3 ways to check\n\nUsing reflect.TypeOf Function\nUsing reflect.ValueOf.Kind() Function\nUsing %T with Printf\n\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n    &quot;reflect&quot;\n)\n\nfunc main() &#123;\n    file, err := os.Open(&quot;./test/examples/README.md&quot;)\n    defer file.Close()\n    if err != nil &#123;\n        log.Println(err)\n    &#125;\n\n    // first\n    fmt.Printf(&quot;%T\\n&quot;, file)\n\n    // second\n    tp := reflect.TypeOf(file)\n    fmt.Println(tp)\n\n    // third\n    tp = reflect.ValueOf(file).Type()\n    fmt.Println(tp)\n&#125;\n\ndeal with fileread fileread file include two parts:\n\nopen a file handler\nget the content with handler\n\nhowever some function combine the two parts into one, and that’s fine\n\nNote:\nwhile opening a file, need to colse it\n\nsimple open a file, leave a file handler, without dealing with it.\npackage main\n\nimport (\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    file, err := os.Open(&quot;./test/examples/README.md&quot;)\n    defer file.Close()\n    if err != nil &#123;\n        log.Println(err)\n    &#125;\n\n    // show file state\n    fmt.Println(file.Stat())\n&#125;\n\nread whole file content with one function at once, don’t use it with large file\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    // don&#39;t need to colse file manually\n    content, err := os.ReadFile(&quot;./test/examples/README.md&quot;)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n    fmt.Println(string(content))\n&#125;\n\nread file by chunks\nwe don’t take it all completely in memory but instead we load it by  chunking. It’s very important to read large files in chunk to avoid out  of memory errors.\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;io&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    file, err := os.Open(&quot;./test/examples/README.md&quot;)\n    defer file.Close()\n    if err != nil &#123;\n        log.Print(err)\n    &#125;\n\n    // create slice\n    chunk := make([]byte, 8)\n\n    // for loop\n    for &#123;\n        // read content to chunk and return a chunk size\n        size, err := file.Read(chunk)\n        if err != nil &#123;\n            if err != io.EOF &#123;\n                log.Print(err)\n            &#125;\n            return\n        &#125;\n        fmt.Printf(string(chunk[:size]))\n    &#125;\n&#125;\n\nuse bufio\nline by line\npackage main\n\nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    file, err := os.Open(&quot;./test/examples/README.md&quot;)\n    defer file.Close()\n    if err != nil &#123;\n        log.Print(err)\n    &#125;\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() &#123;\n        fmt.Println(scanner.Text())\n    &#125;\n&#125;\n\nread file word by word\npackage main\n\nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    file, err := os.Open(&quot;./test/examples/README.md&quot;)\n    defer file.Close()\n    if err != nil &#123;\n        log.Print(err)\n    &#125;\n\n    scanner := bufio.NewScanner(file)\n    scanner.Split(bufio.ScanWords) // add one line to split line into word\n    for scanner.Scan() &#123;\n        fmt.Println(scanner.Text())\n    &#125;\n&#125;\n\nwrite filesimplest way, easy for writing small size file\npackage main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    loc := &quot;./data.txt&quot;\n    file, err := os.OpenFile(loc, os.O_CREATE|os.O_APPEND|os.O_RDWR, 0755)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n    defer file.Close()\n\n    // write to file directorily\n    file.WriteString(&quot;hello world!&quot;)\n\n    // read file\n    content, err := os.ReadFile(loc)\n    fmt.Println(string(content))\n&#125;\n\nwe can use bufio to write content to file, more useful for large file to write\n\nuse os.OpenFile() for more control\nit does a write when writer.Fulsh() is called\n\npackage main\n\nimport (\n    &quot;bufio&quot;\n    &quot;fmt&quot;\n    &quot;os&quot;\n)\n\nfunc main() &#123;\n    // create file if none with permistion of 0755, or append to a exist file \n    loc := &quot;./data.txt&quot;\n    file, err := os.OpenFile(loc, os.O_CREATE|os.O_APPEND|os.O_RDWR, 0755)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n    defer file.Close()\n\n    // store string to buffer\n    writer := bufio.NewWriter(file)\n    writer.WriteString(&quot;hello world!&quot;)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n    // write buffer all at once to file when we use flush function\n    writer.Flush()\n\n    // reopen file to show content\n    file, _ = os.Open(loc)\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() &#123;\n        fmt.Println(&quot;text:&quot;, scanner.Text())\n    &#125;\n    file.Close()\n&#125;\n\nget request and json convertpackage main\n\nimport (\n    &quot;crypto/tls&quot;\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;net/http&quot;\n)\n\nvar URL string = &quot;https://192.168.31.214:8080&quot;\nvar USER string = &quot;admin&quot;\nvar PASSWD string = &quot;xFkwBNzwtA6ufGGLwSXzCwU8k9VGX4hcbhxemEUhBxyUkesSupynBBemEX8CK3Do&quot;\n\n// join string\nfunc url(api string) string &#123;\n    return URL + api\n&#125;\n\nfunc get(url string) []byte &#123;\n    http.DefaultTransport.(*http.Transport).TLSClientConfig = &amp;tls.Config&#123;InsecureSkipVerify: true&#125;\n\n    r, err := http.NewRequest(&quot;GET&quot;, url, nil)\n    r.SetBasicAuth(USER, PASSWD)\n\n    c := &amp;http.Client&#123;&#125;\n    resp, err := c.Do(r)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n    defer resp.Body.Close()\n\n    // return resp.Body, remove `[]`\n    content, _ := ioutil.ReadAll(resp.Body)\n    return content[1 : len(content)-2]\n&#125;\n\n// create struct to parse json, notice captial case\ntype Data struct &#123;\n    Code             string `json:&quot;code&quot;`\n    virtual          string\n    state            string\n    agentsetgroup    string\n    labelgroup       string\n    agentsetrole     string\n    agentsetfwstate  string\n    microfwstate     string\n    usernumber       int\n    expiredtimestamp int\n    blocklog         string\n    updateduser      string\n    updatedtimestamp int\n&#125;\n\nfunc main() &#123;\n    content := get(url(&quot;/default/activationcode&quot;))\n    fmt.Println(string(content))\n\n    var md Data\n    // convert to json\n    json.Unmarshal(content, &amp;md)\n    fmt.Println(md.Code)\n&#125;\n\npracticepackage main\n\nimport (\n    &quot;crypto/tls&quot;\n    &quot;encoding/json&quot;\n    &quot;flag&quot;\n    &quot;fmt&quot;\n    &quot;io&quot;\n    &quot;net/http&quot;\n    &quot;time&quot;\n)\n\n// define some variables\nvar NEW Data\nvar OLD Data\n\n// create data struct of service request [&#123;k:v,k:[&#123;k:v&#125;,&#123;k:v&#125;...]&#125;,k:v]\ntype Data []struct &#123;\n    Uuid             string  `json:&quot;uuid&quot;`\n    Service          Service `json:&quot;service&quot;`\n    Updatedtimestamp int     `json:&quot;updatedtimestamp&quot;`\n&#125;\ntype Service []struct &#123;\n    Protocol string `json:&quot;protocol&quot;`\n    Port     string `json:&quot;port&quot;`\n    Listen   string `json:&quot;listen&quot;`\n    Name     string `json:&quot;name&quot;`\n    Exe      string `json:&quot;exe&quot;`\n&#125;\n\n// commind line parse\nfunc parseCmd() (string, uint, string, string) &#123;\n    url := flag.String(&quot;url&quot;, &quot;192.168.31.53&quot;, &quot;QCC url&quot;)\n    interval := flag.Uint(&quot;time&quot;, 300, &quot;interval time(seconds)&quot;)\n    api := flag.String(&quot;api&quot;, &quot;rh8FeGiGZhGBFWawrCvFYLaMHHQBVr9ZEmKmLAJAiCfqkB5kRkGs4cwgToELFV5L&quot;, &quot;qcc api&quot;)\n    user := flag.String(&quot;user&quot;, &quot;admin&quot;, &quot;api user name&quot;)\n    flag.Parse()\n    return *url, *interval, *api, *user\n&#125;\n\n// function of api url\nfunc apiUrl(url, api string) string &#123;\n    return &quot;https://&quot; + url + &quot;:8080&quot; + api\n&#125;\n\n// get http request raw data\nfunc rawData(url, user, api string) []byte &#123;\n    http.DefaultTransport.(*http.Transport).TLSClientConfig = &amp;tls.Config&#123;InsecureSkipVerify: true&#125;\n\n    r, err := http.NewRequest(&quot;GET&quot;, url, nil)\n    r.SetBasicAuth(user, api)\n\n    c := &amp;http.Client&#123;&#125;\n    resp, err := c.Do(r)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n    defer resp.Body.Close()\n\n    // return resp.Body\n    content, _ := io.ReadAll(resp.Body)\n    return content\n&#125;\n\n// compare data with x minutes interval\nfunc compareData(data Data, tsleep uint) string &#123;\n    NEW = data\n    for &#123;\n        if OLD == nil &#123;\n            OLD = NEW\n            continue\n        &#125;\n        // condition\n        time.Sleep(time.Duration(tsleep) * time.Second)\n        return &quot;one&quot;\n    &#125;\n&#125;\n\n// main function\nfunc main() &#123;\n    url, interval, api, user := parseCmd()\n    fmt.Println(url, interval, api, user, apiUrl(url, &quot;/default/workloadservice&quot;))\n    content := rawData(apiUrl(url, &quot;/default/workloadservice&quot;), user, api)\n    // fmt.Println(apiUrl(&quot;/default/workloadservice&quot;))\n    // fmt.Printf(&quot;%T\\n&quot;,content)\n    // fmt.Printf(&quot;%s\\n&quot;,content)\n\n    var data Data\n    err := json.Unmarshal(content, &amp;data)\n    if err != nil &#123;\n        fmt.Println(err)\n    &#125;\n\n    result := compareData(data, interval)\n    fmt.Println(result)\n    // fmt.Printf(&quot;%T\\n&quot;,data)\n    // fmt.Println(data[0].Service)\n&#125;\n\n","categories":["learn"],"tags":["go"]},{"title":"haskell","url":"/2022/04/23/haskell/","content":"HASKELLwhat is haskell?Haskell is a purely functional programming language. don’t tell the computer what to do as such but rather you tell it what stuff is\nfeature\nunchangeable variable \nno side-effects\npure function\nfunction must return value\ntype static\ncompile language\nlazy calculate\nelegant and concise\n\nenvironmenthaskell的环境搭建包含了三个部分：\n\n编译器\n\n编译器使用ghc或者hugs（在使用包管理器或安装脚本时会自动安装）\n\n\n模块\n模块安装有多种方法：\n\n如果是使用debian，ubuntu等操作系统，包管理器提供的有完整安装包，这种安装方式会自动安装后面代码提示所需要的后台服务\n\n如果所使用的系统不在列表中，可使用官方提供的一键安装脚本，安装所有组件，包含了ghc以及包管理cabal/stack（安装完有2Gib多的空间占用）\n\n如果觉得上面安装的文件太大，可使用系统提供的包管理器安装选择性的安装，例如archlinux可以直接使用pacman安装。我使用的就是这种方式，比较轻量，需要什么就安装什么。\n\n\n\n编辑器的代码提示\n包含两个部分：\n\n后台服务：模块安装后在vscode中编辑是没有代码提示的，因为还缺少一个haskell-language-server，这个软件会在后台提供自动补全等功能\npacman -S haskell-language-server\n\n\nIDE插件：vscode中安装对应的扩展插件：\n\n\n\n\n\nrun虽然haskell是编译型语言，但编译器提供了直接运行的方式。虽然速度比编译后的慢\nrunhaskell file.hs\n\n编译后运行\nhaskell的编译器有很多，但是这里使用ghc，archlinux下安装很简单:\npacman -S ghc\n\n\nNote: \n由于xmonad是使用haskell语言写的，所以安装xmonad时，已经安装了ghc，所以不需要再次下载了\n\n交互命令行\n输入ghci进入交互式界面，输入:quit进行退出\n➜  ~  ghci\nGHCi, version 8.10.4: https://www.haskell.org/ghc/  :? for help\nPrelude&gt; :quit\nLeaving GHCi.\nPrelude&gt; :set prompt &quot;ghci &gt; &quot;\nghci &gt;\n\nhaskell的脚本后缀为.hs，ghci中加载脚本文件为：:l file.hs. :r重新加载文件\narithmetic+    --add\n-    --subtract\n*    --multiply\n/    --divide\nmod    --remainder\nrem    --remainder\n\nboolean algebra与：&amp;&amp;\n或：||\n非：not\n等：==\n不等：/=\nghci &gt;&gt; False &amp;&amp; True\nFalse\nghci &gt;&gt; False || True\nTrue\nghci &gt;&gt; not False\nTrue\nghci &gt;&gt; 1 == 0\nFalse\nghci &gt;&gt; &quot;a&quot; == &quot;b&quot;\nFalse\nghci &gt;&gt; &quot;a&quot; == &quot;a&quot;\nTrue\n\nlist\nlist use []\nvalue in list must be the same type\nString is a syntactic sugar of list\nuse ++ put lists together\n++ method will work though the first list. however : cons will not\nlist can be compared if the stuff they contain can be compared\nuse !! to get element out of a list by index. the begin index is 0\nenumerated value can use .. to expand needed value\ndon’t use .. operation with float value\n[1..] explains all the values of nature\n_ will ignore one value (means drop)\n\nsome built in function:\nPrelude&gt; list = [1..10]\nPrelude&gt; head list\n1\nPrelude&gt; tail list\n[2,3,4,5,6,7,8,9,10]\nPrelude&gt; init list\n[1,2,3,4,5,6,7,8,9]\nPrelude&gt; last list\n10\nPrelude&gt; list !! 4\n5\nPrelude&gt; length list\n10\nPrelude&gt; null list\nFalse\nPrelude&gt; reverse list\n[10,9,8,7,6,5,4,3,2,1]\nPrelude&gt; take 4 list\n[1,2,3,4]\nPrelude&gt; drop 4 list\n[5,6,7,8,9,10]\nPrelude&gt; maximum list\n10\nPrelude&gt; minimum list\n1\nPrelude&gt; sum list\n55\nPrelude&gt; product list\n3628800\nPrelude&gt; elem 5 list\nTrue\nPrelude&gt; 5 `elem` list\nTrue\n\n\nNote:\nsome function be write in the middle of two value, such as `5 elem [1..10]`\n\n\n-- expand value\nPrelude&gt; [1..10]\n[1,2,3,4,5,6,7,8,9,10]\nPrelude&gt; [&#39;a&#39;..&#39;z&#39;]\n&quot;abcdefghijklmnopqrstuvwxyz&quot;\nPrelude&gt; [&#39;A&#39;..&#39;Z&#39;]\n&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;\n\n-- define steps\nPrelude&gt; [1,3..20]\n[1,3,5,7,9,11,13,15,17,19]\nPrelude&gt; [&#39;A&#39;,&#39;D&#39;..&#39;Z&#39;]\n&quot;ADGJMPSVY&quot;\n\n\nNote:\nreverse order list must define step\n\n\nPrelude&gt; [10..1]\n[]\nPrelude&gt; [10,9..1]\n[10,9,8,7,6,5,4,3,2,1]\n\n\nNote:\n`take` function is very important, it works well with haskell&#39;s lazy feather\n                                \n`take 5 [1,5..]`\n\n\nPrelude&gt; take 20 $ cycle [1..5]\n[1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5]\nPrelude&gt; take 4 $ repeat [1..5]\n[[1,2,3,4,5],[1,2,3,4,5],[1,2,3,4,5],[1,2,3,4,5]]\nPrelude&gt; replicate 20 1\n[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]\n\nlist comprehension\nlist comprehension allows us do more operations with each element or filter them and return a new list.\n\nNote:\n`[ return expression | variable &lt;- list, filter1, filter2]`\n                                \n`&lt;-` means bind each element to variable\n\n\nPrelude&gt; [ x^2 | x &lt;- [1..10]]\n[1,4,9,16,25,36,49,64,81,100]\nPrelude&gt; [ x^2 | x &lt;- [1..10], x `mod` 3 /= 0]\n[1,4,16,25,49,64,100]\nPrelude&gt; [ x^2 | x &lt;- [1..10], x `mod` 3 /= 0, x `mod` 2 == 0]\n[4,16,64,100]\nPrelude&gt; [ x+y | x &lt;- [1..3], y &lt;- [(-1),(-2)..(-3)]]\n[0,-1,-2,1,0,-1,2,1,0]\n\n\nNote:\nwe can use function to deliver list with parameter\n\n\nPrelude&gt; plus2 xs = [ x*2 | x &lt;- xs]\nPrelude&gt; plus2 [1..5]\n[2,4,6,8,10]\n\n\nNote:\nwe can not only operator list itself, but also use list as a condition\n\n\nPrelude&gt; color xs = [ if x==0 then &quot;red&quot; else if x==1 then &quot;yellow&quot; else &quot;blue&quot; | x &lt;- xs, x==0 || x==1 || x==2]\nPrelude&gt; color [1,4,0,3,2,10]\n[&quot;yellow&quot;,&quot;red&quot;,&quot;blue&quot;]\n\n\nNote:\nwe can use `_` to ignore some value\n\n\nPrelude&gt; length&#39; xs = sum [ 1 | _ &lt;- xs]\nPrelude&gt; length&#39; [1..10]\n10\n\n\nNote:\ndeal with list of lists\n\n\nPrelude&gt; lists = [[2,3,4],[3,4,5],[4,5,6]]\nPrelude&gt; [[x+1 | x&lt;-xs] | xs &lt;- lists]\n[[3,4,5],[4,5,6],[5,6,7]]\n\ntuple\ntuple use ()\ncan contain different type values\ntuple’s type depend on the length of tuple (means different length of tuple stands of different type) and the type of tuple’s value\n\n\nNote:\n\ni still not find a good way to index the tuple, one way to index tuple is use _ to filter no needed data. one little complex way is using pattern match\n\nbut if the tuple only has two value, we can use two function get the value\n\n\n\nyohe = (20,170,&quot;12312823@gmail.com&quot;)\n\n-- define function with pattern match\ngetAge xs =\n    let (age,_,_) = xs\n    in  print age\n-- haskell will return last value be default, so `print` is optional\ngetScho0l xs = let (_,school,_) = xs in school\n-- a more convient way is \ngetEmail (_,_,email) = email\n\n\n-- we can write above in a file, then we can call it by function\ngetAge yohe\ngetSchool yohe\ngetEmail yohe\n\nPrelude&gt; yohe = (20, &quot;2398422@gmail.com&quot;)\nPrelude&gt; fst yohe\n20\nPrelude&gt; snd yohe\n&quot;2398422@gmail.com&quot;\n\n\nNote:\n`zip` to combine two list into one tuple\n                                \n`unzip` can abstract tuple into two list\n\n\nPrelude&gt; zip [1..10] [&#39;a&#39;..&#39;z&#39;]\n[(1,&#39;a&#39;),(2,&#39;b&#39;),(3,&#39;c&#39;),(4,&#39;d&#39;),(5,&#39;e&#39;),(6,&#39;f&#39;),(7,&#39;g&#39;),(8,&#39;h&#39;),(9,&#39;i&#39;),(10,&#39;j&#39;)]\n\nPrelude&gt; a = zip [1..10] [&#39;a&#39;..&#39;z&#39;]\nPrelude&gt; unzip a\n([1,2,3,4,5,6,7,8,9,10],&quot;abcdefghij&quot;)\n\ntype and typeclassin other languages such as python, data also has type, if we write 1 - True in file will lead a error in compile time. so how about haskell? okay, we need to say in haskell everything has a type, data, function, expression (in fact, data is included in expression)\nPrelude&gt; :t 3\n3 :: Num p =&gt; p\nPrelude&gt; :t sum\nsum :: (Foldable t, Num a) =&gt; t a -&gt; a\nPrelude&gt; :t (1+1)\n(1+1) :: Num a =&gt; a\n\nbenefit of type\n\ntype told the expression or function what data type it needs\nmake it much easier to know what the function/expression means while reading type define\ncheck syntax in compile time\n\n\nNote:\n\ntype is capital case in start : Int, Integer, Float, Double, Bool, Char, String\nuse :: to announce type definition\nuse -&gt; to separate parameters\nthere are two ways:\nwith function, function_name :: parameter1_type -&gt; parameter2_type -&gt; return_type\nwith data, data :: data_type\n\n\n\n\ngetEmail :: String -&gt; String\ngetEmail xs = let (_,_,email) = xs in  email\n\nPrelude&gt; 3 + 4\n7\nPrelude&gt; 3 + 4 :: Float\n7.0\n\ntype variable\nsome functions not only allow one unchanged data type, this kind of function called polymorphic function. we need to use type variable, often use single lower case character (a~z). it stands for all kinds of types\n-- head allow String and Int type and others...\nPrelude&gt; :t head\nhead :: [a] -&gt; a\nPrelude&gt; head &quot;string&quot;\n&#39;s&#39;\nPrelude&gt; head [1..10]\n1\nPrelude&gt; head [1.0..10.0]\n1.0\n\ntypeclass\nA typeclass is a sort of interface that defines some behavior. If a type is a part of a typeclass, that means that it supports and implements the behavior the typeclass describes.\nPrelude&gt; :t (==)\n(==) :: Eq a =&gt; a -&gt; a -&gt; Bool\n\nEverything before the =&gt; symbol is called a class constraint. We can read the previous type declaration like this: the equality function takes any two values that are of the same type and returns a Bool. The type of those two values must be a member of the Eq class (this was the class constraint)\n\nwe use =&gt; to announce typeclass\n\nbasic typeclass:\nEq             used for comparing:it&#39;s implement has method of `==` `/=`\nOrd             ordering: `&gt;` `&lt;` `&gt;=` `&lt;=`\nShow        present as string    `show`\nRead        read string and return a type of Read    `read`\nEnum        sequentially ordered types    `succ` `pred`\nBounded        have an upper and a lower bound\nNum            numeric typeclass\nIntegral    only integral (whole) numbers    `fromIntegral`\nFloating    includes only floating point numbers\n\n\nif one type belongs to one typeclass, then this type can act like other type the typeclass defined.\n-- 5 belongs to Num typeclass, so it can be Int or Float or Double\nPrelude&gt; :t 5\n5 :: Num p =&gt; p\nPrelude&gt; 5 :: Int\n5\nPrelude&gt; 5 :: Float\n5.0\nPrelude&gt; 5 :: Double\n5.0\n\n\n\n\nNote:\n\nlength function will return a Int value, which may lead many inconvenient\nPrelude&gt; :t length\nlength :: Foldable t =&gt; t a -&gt; Int\n                                \nPrelude&gt; length &quot;hello&quot; + 4.5\n                                \n&lt;interactive&gt;:235:18: error:\n    • No instance for (Fractional Int) arising from the literal ‘4.5’\n    • In the second argument of ‘(+)’, namely ‘4.5’\n      In the expression: length &quot;hello&quot; + 4.5\n      In an equation for ‘it’: it = length &quot;hello&quot; + 4.5\n\nso why fromIntegral comes up\nPrelude&gt; :t fromIntegral\nfromIntegral :: (Integral a, Num b) =&gt; a -&gt; b\nPrelude&gt; fromIntegral (length &quot;hello&quot;) + 4.5\n9.5\n\n\n\n\ntype annotations\nsome functions don’t know what kind of type it will return, so we need to tell it, that’s type annotations\nuse :: data_type after data\nPrelude&gt; :t read\nread :: Read a =&gt; String -&gt; a\nPrelude&gt; read &quot;3&quot; :: Int\n3\n\nfunction\nfunction will return last calculate value by default, so  return keyword is optiona\nreturn keyword only told function return a value rather than pause, so the code below return will run continue\nfunction name starts with lower case\nargs split with blank space\n\npattern matching\nmuch more different than any other languages, this feature in my opinion is really cool for it can do some match with parameters.\n-- how sum comes\n-- for list end with [], this may lead function runs error, with pattern match, we can avoid it\nsum&#39; [] = 0\n-- with pattern match, we can sperate list into two parts: head value and the rest of value\nsum&#39; (x:xs) = x + sum&#39; xs\n\n-- without pattern match, function like this\nyeho = (20，170，“293848389@gmail.com”)\ngetEmail xs = let (_,_,email) = xs in email\n\n-- however we can directly match with parameter,cool?\nyeho = (20，170，“293848389@gmail.com”)\ngetEmail (_,_,email) = email\n\n-- without pattern match, head like this\nhead&#39; [] = error &quot;empty list&quot;\nhead&#39; x = x !! 0\n-- with parameter match, head like this, cool?\nhead&#39; [] = error &quot;empty list&quot;\nhead&#39; (x:_) = x\n\npattern matching also can act like if statement\ncolor 0 = &quot;red&quot;\ncolor 1 = &quot;yellow&quot;\ncolor 2 = &quot;blue&quot;\ncolor _ =  &quot;not origion triple color&quot;\n\nguard\nguards are a way of testing whether some property of a value (or several of them) are true or false. much more like if statement.\n\nno = sign after parameter\nuse | to sign begin\n\nadjudge :: (Ord a, Num a) =&gt; a -&gt; [Char]\nadjudge score\n    | score &gt;= 90 = &quot;perfect&quot;\n    | score &gt;= 80 = &quot;good&quot;\n    | score &gt;= 60 = &quot;not bad&quot;\n    | score &gt;= 0 = &quot;not pass&quot;\n    | otherwise = &quot;error score&quot;\n\notherwise is optional, but it is often useful for catching everything\nwith where we can also use local variables in guard\ntotal :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a -&gt; [Char]\ntotal math english history\n    | score &gt; lineup = &quot;perfect&quot;\n    | score &gt; passline = &quot;good&quot;\n    | otherwise = &quot;hurry up&quot;\n    where score = math + english + history\n          lineup = 400\n          passline = 200 \n\n\nNote:\n\nthe indent below where is hard to specify, for it is not 2 tab but 6 blank space (1tab + 2black space)\nin where binding, we can define variable\nin where binding, we can use pattern match\nin where binging, we can use function\n\n\ntotal :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a -&gt; [Char]\ntotal math english history\n    | score &gt; lineup = &quot;perfect&quot;\n    | score &gt; passline = &quot;good&quot;\n    | otherwise = &quot;hurry up&quot;\n    where score = math + english + history\n          (lineup,passline) = (400,200)\n\nimport Data.List.Split\n\nemail :: [Char] -&gt; [Char]\nemail addr\n    | end == &quot;gmail.com&quot; = &quot;gmail&quot;\n    | end == &quot;qq.com&quot; = &quot;qq&quot;\n    | end == &quot;163.com&quot; = &quot;163&quot;\n    | otherwise = &quot;error email address&quot;\n    where [_,end] = splitOn &quot;@&quot; addr\n \n-- run result\n*Main&gt; email &quot;20398442@qq.com&quot;\n&quot;qq&quot;\n\nzip&#39; xs ys = [f x y | x &lt;- xs, y &lt;- ys]\n    where f x y = (x, y)\n\nlet works similar like where, but it can write in anywhere in function not only in the end\nsyntax: let binding in expression\nthe difference between let and where is that let binding itself is expression\n(let (a,b,c) = (1,2,3) in a+b+c) * 100\n\nif else statement is an expression and we can cram it in almost anywhere, so do let binding. and i wanna to say let binding is so flexible and cool\n-- simple calculate expression\n3 + (let a=2 in a^2) + 1\n\n-- list expression\n[ m | x &lt;- [1..10], let m = x * 2 + 1, m &gt; 8]\n\n-- function expression\nlet add1 x = x + 1 in (add1 1, add1 2, add1 3)\n\n-- pattern match\nlet (a,b,c) = (1,2,3) in a^2 + b^2 + c^2\n\ncase expressioncase is expression,so what about it? that means we can use pattern matching with case value\n-- syntax\ncase expression of pattern -&gt; result\n                   pattern -&gt; result\n                   pattern -&gt; result\n                   ...\n\nhead&#39; :: [a] -&gt; a\nhead&#39; xs = case xs of [] -&gt; error &quot;empty list&quot;\n                      (x:xs) -&gt; x\n\nrecursionfor haskell is a language that higher than any other languages, and it ignores how to do it but tells what it is, so the implementation of loop will be instead of recursion. that is why recursion so important in haskell.\nmax&#39; :: Ord a =&gt; [a] -&gt; a \n-- edge condition with pattern match\nmax&#39; [] = error &quot;empty list&quot;\nmax&#39; [x] = x\nmax&#39; (x:xs)\n-- don&#39;t need to do loop condition, but to say head number greater than \n-- tail numbers (rest of the list number)\n    | x &gt; restList = x\n    | otherwise = restList\n    where restList = max&#39; xs\n\ntake&#39; :: Int -&gt; [a] -&gt; [a]\ntake&#39; _ [] = []\ntake&#39; n (x:xs)\n    | n &lt;= 0 = []\n    | otherwise = x : take&#39; (n-1) xs\n\nreverse&#39; :: [a] -&gt; [a]\nreverse&#39; [] = []\nreverse&#39; (x:xs) = reverse&#39; xs ++ [x]\n\nrepeat&#39; :: a -&gt; [a]\nrepeat&#39; x = x:repeat&#39; x\n\n-- notice the type define\nzip&#39; :: [a] -&gt; [b] -&gt; [(a,b)]\nzip&#39; [] _ = []\nzip&#39; _ [] = []\nzip&#39; (x:xs) (y:ys) = (x,y) : zip&#39; xs ys\n\nelem&#39; :: Eq a =&gt; a -&gt; [a] -&gt; Bool \nelem&#39; m [] = False\nelem&#39; m (x:xs) \n    | m == x = True \n    | otherwise = elem&#39; m xs\n\ndropBlank&#39; :: String -&gt; String\ndropBlank&#39; [] = []\ndropBlank&#39; (x:xs)\n    | x == &#39; &#39; = &quot;&quot; ++ dropBlank&#39; xs\n    | otherwise = x:dropBlank&#39; xs\n\nquick sort\nquicksort :: Ord a =&gt; [a] -&gt; [a]\nquicksort [] = []\nquicksort (x:xs) =\n    let smallsort = quicksort [m | m &lt;- xs, m &lt;= x]\n        bigsort = quicksort [m | m &lt;- xs, m &gt; x]\n    in smallsort ++ [x] ++ bigsort\n\nmodules importsyntax for importing modules\n-- in haskell file\n-- in this way, we can call the module&#39;s function name directly\nimport module_name\n\n-- in ghci\n:m + module_name\n\n-- import some of function in module\nimport module_name (func1,func2)\n\n-- import all function in module expect someone\nimport module_name hiding (func)\n\n-- in some case, two or more modules contains the function with the same name\n-- in order to distinguish the function, we can use qualified keyword\n-- if the module imported with qualified, the way to call function need to \n-- be prefixed with module name\nimport qualified module_name\n-- call function\nmodule_name.func\n\n-- in order to simplify above calling style, we can use alias to instead the \n-- long syntax of calling function\nimport qualified module_name as alias_name\n-- call function\nalias_name.func\n-- eg:\nimport qualified Data.Map as M\nM.filter\n\nhigher order functioncurried function\nanother part that function program is different with other language is curried function (one function takes more than one parameters). it is a concept  which helps us to think functions in another way. in order to understand the concept, we need to know the following point:\n\nputting a space between two things is simply function application\nevery function in haskell officially only takes one parameter\nif a function need more than one parameters, the one we write that function with too few parameters is called function on the fly (or called partial application) . we can pass it to another function as parameter\n\nso, we may though, okay, i know that’s it, and what does it helpful for my coding? let’s see this function and you will understand how powerful this concept\n-- * is also a function which need two parameters\n-- (*2) is a function on the fly\nplus2 xs = map (*2) xs\n\n-- / is a function which need two parameters\n-- (/10) is a function on the fly\ndivideByTen x = (/10) x\n\nif without curried function, above may need to be write as this\nsum&#39; (x:xs) = x + sum&#39; xs\nplus2 xs = map (\\x -&gt; x*2) xs\n\nwith this concept we can though a function with many parameters is a function take one parameter then return a new function, the new function takes another parameter and then return a new function and so on…\nmultithree :: Num a =&gt; a -&gt; a -&gt; a -&gt; a\nmultithree x y z = x * y * z\n\n-- with curried function concept, we can write type as this\nmultithree :: Num a =&gt; a -&gt; (a -&gt; (a -&gt; a))\nmultithree x y z = x * y * z\n\n\nNote:\nfunction on the fly don’t means a function only takes one parameter,  it can take more than one parameter. both of them can be called function on the fly.\neg: multithree x is a function on the fly, multithree x y is also a function on the fly\n\nvariable name of function on the fly\nhave we notice that a function takes one (or more) parameter returns a new function, how great this means? now we can write above function like this:\nplus2 = map (*2)\ndivideByTen = (/10)\n\n\nNote:\nit is not means we ignore function parameters, left side is just a new function name (yeah a variable)\nin this way, function can be greatly simplified.\n\nfunction as a parameter\nwe know that function can take function as parameter and also return functions\napplyTwice :: (a -&gt; a) -&gt; a -&gt; a  \napplyTwice f x = f (f x)  \n\n-- then we can pass function to it\napplyTwice (3:) 1\n\nnotice that the function we pass to it is a function on the fly. in this way we abstract function as a variable or called parameter, so we can pass different function to it.\nzipWith&#39; :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith&#39; _ [] _ = []\nzipWith&#39; _ _ [] = []\nzipWith&#39; f (x:xs) (y:ys) = f x y : zipWith&#39; f xs ys\n\nhigher order function\n-- combine two list into one list with specified function\nzipWith f x y\n\nzipWith&#39; :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]\nzipWith&#39; _ [] _ = []\nzipWith&#39; _ _ [] = []\nzipWith&#39; f (x:xs) (y:ys) = f x y : zipWith&#39; f xs ys\n\n-- apply specified function to all elements of list\nmap f x\n\nmap&#39; :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmap&#39; _ [] = []\nmap&#39; f (x:xs) = f x : map&#39; f xs\n\n-- filter all list elements to specified function\nfilter f x\n\nfilter&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilter&#39; _ [] = []\nfilter&#39; f (x:xs)\n    | f x = x : filter&#39; f xs\n    | otherwise = filter&#39; f xs\n\nlambda\nwe know higher order function need a parameter of function, normally, we pass a lambda to it.\n-- syntax\n(\\parameter1 parameter2 -&gt; function body)\n\n\nNote\npartial application can do the same thing as lambda when the function is simple. so consider use partial application first if it can\n\n-- we can do simple pattern match in lambda\nmap (\\(a,b) -&gt; a + b) [(1,2),(3,4),(4,5),(5,6)]\n\nfold\nsome functions encapsulate common pattern (x:xs) with edge condition (such as map) and return one value are called fold.\n-- fold function need a start value and a accumulator\n-- eg : start value &quot;False&quot; accumulator &quot;acc&quot;\nelem&#39; :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool \nelem&#39; m xs = foldl (\\acc x -&gt; if m == x then True else acc) False xs\n\n-- this function can be simplified to \nelem&#39; :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool \nelem&#39; m = foldl (\\acc x -&gt;  m == x || acc) False\n\nfoldl work though list from left, foldr work though list from right. \nsum&#39; xs = foldl (\\acc x -&gt; acc + x) 0 xs\n\nsum&#39; xs = foldr (\\x acc -&gt; x + acc) 0 xs\n\nacc‘s position is very important.\n-- foldr will take start value as the second parameter\nmap&#39; f xs = foldr (\\x acc -&gt; f x : acc) [] xs\n-- foldl will take start value as the first parameter\nmap&#39; f xs = foldl (\\acc x -&gt; acc ++ [f x]) [] xs\n\nfoldl1 foldr1 almost the same as foldl foldr. only foldl1 and foldr1 take list’s first/last value as the starting value, so we don’t need to write. with this, we need to confirm the list is not empty, or it may crash\nsum&#39; xs = foldl1 (\\acc x -&gt; acc + x) xs\nsum&#39; xs = foldr1 (\\x acc -&gt; x + acc) xs\n\nfunction application with $\nfunction application with $ is right-associative, which act as ()\nsum ([1..10] ++ [2..20])\n-- with $\nsum $ [1..10] ++ [2..20]\n\nfunction composition with .\nfunction composition with . compose two functions into one, and it is also right-associative\nf . g = \\x f (g x)\n\nmap (\\x -&gt; (+1) (x/10)) [1..10]\nmap ((+1) . (/10)) [1..10]\n\n\nNote:\n\nthe principle that we can write compose function is the right function return value’s type is the same as left function parameter\n\nif the right function takes more than one value, we need pass other parameters to the function\n\n\n\nshow . replicate 3 . max 6 $ 8\n\ntype and typeclassso, what the data type can help me?\n\nwith value constructor, help me to store data with associate relationship and with default method to get them out\nwithout value constructor, help me to store data with the value name\n\ndata typehaskell has already provided us basic data type like Int, Float, Bool, String. we can also define ourself data type\n-- syntax: \n-- type_name should be capital case\ndata type_name = value_constructor\n\nvalue parameterafter value constructor, we can add some data types define the value it will contain\n-- Circle , Rectangle are value constructor\ndata Shape = Circle Float Float Float | Rectangle Float Float Float Float \n\n\nNote:\n\nwe can thought value constructor as function, it returns a data type\n\nhowever we can not directly call value constructor, because it has no method to display our data.\n\nwe can apply deriving (basic typeclass) to data type, then the data type will has the properity of basic typeclass\n\nwe can use pattern match with value constructor\n\n\n\ndata Shape = Circle Float Float Float | Rectangle Float Float Float Float deriving (Show)\n\nsurface :: Shape -&gt; Float\nsurface (Circle _ _ r) = pi * r ^ 2\nsurface (Rectangle x1 y1 x2 y2) = (abs $ x1 -x2) * (abs $ y1 -y2)\n\n*Main&gt; surface $ Circle 3 4 5\n78.53982\n*Main&gt; Circle 3 4 5\nCircle 3.0 4.0 5.0\n\nfor value constructor can act as function, we can use partial application with it\n*Main&gt; map (Circle 3 4) [1..5]\n[Circle 3.0 4.0 1.0,Circle 3.0 4.0 2.0,Circle 3.0 4.0 3.0,Circle 3.0 4.0 4.0,Circle 3.0 4.0 5.0]\n\n\nNote:\noften we write data type name  the same as value constructor name if there is only one value constructor\n\ndata Point = Point Float Float deriving (Show)\n\nwe can use the data type in other data type define\ndata Shape = Circle Point Float | Rectangle Point Point deriving (Show)\n\nin this way, we can make Shape data type more readable\nsurface :: Shape -&gt; Float\nsurface (Circle _ r) = pi * r ^ 2\nsurface (Rectangle (Point x1 y1) (Point x2 y2)) = (abs $ x1 -x2) * (abs $ y1 -y2)\n\nrecord syntaxthe way above data type define is not bad, but there are some inconvenient : \nsuch as :\n\nhow to get the value of a data type?  \n\nhow to easily distinguish each value?\n\n\n-- sign each type a variable name, seperate with comma\ndata Person = Person &#123; age :: Int  \n                     , height :: Float  \n                     , phoneNumber :: String  \n                     &#125; deriving (Show)   \n\nBy using record syntax to create this data type, Haskell automatically make these functions with the name of type name: age height phoneNumber\n\nNote:\nwith the default method, we can get specified value we need out of the data type\n\njohn = Person &#123;age=20, height=170, phoneNumber=&quot;2837109292&quot;&#125;\n\n*Main&gt; age john\n20\n*Main&gt; phoneNumber john\n&quot;2837109292&quot;\n\nclass = map (Person 20 170) [&quot;4532232&quot;, &quot;9023482&quot;, &quot;0923842&quot;]\n*Main&gt; map phoneNumber classes\n[&quot;4532232&quot;,&quot;9023482&quot;,&quot;0923842&quot;]\n*Main&gt; phoneNumber $ classes !! 0\n&quot;4532232&quot;\n\ntype parameterthe same as value parameter,  type constructors can take types as parameters to produce new types\n-- eg: a after Maybe is a type parameter\ndata Maybe a = Nothing | Just a  \n\nwith a parameter, we call data type as data constructor\nthe benefit of type parameter is that the data type depends on what we pass to it.\ndata Person a b c = Person &#123; age :: a  \n                             , height :: b  \n                             , phoneNumber :: c  \n                             &#125; deriving (Show) \n\nwithout value constructor store data with value name\ndata Day = Monday | Tuesday | Wednesday | Thursday | Friday | Saturday | Sunday   \n    deriving (Eq, Ord, Show, Read, Bounded, Enum)  \n\nMonday --with Show, call directly\nMonday == Monday --with Eq, compare directly\nread &quot;Monday&quot; :: Day --with Read, convert value from String\nMinBound --with Bounded, get min/max value\n[Monday..Sunday] --with Enum, list range with value\n\ntype synonymsdata type’s alias, with it we can make our type declaration more clearly\n-- String is alias of [Char]\ntype String = [Char]\n\n-- can have parameters\ntype AssocList k v = [(k,v)]  \n-- can partically apply type parameters\ntype IntMap v = Map Int v  \n-- or ignore\ntype IntMap = Map Int  \n\nthird modulehaskell官方提供了丰富的模块，可以根据需要选择对应的模块进行下载。\nShell Scripthaskell的turtle模块嵌入了shell脚本，实现了很多的unix命令，方便我们使用haskell写shell脚本。同时还支持直接调用系统的命令\n# install turtle in archlinux\npacman -S haskell-turtle\n\nprint text to screen\n-- 不使用turtle模块,使用内置的System.IO\nmain = do\n    putStrLn &quot;hello world!&quot;\n    print &quot;hello world!&quot;\n    \n-- 使用turtle模块的echo命令\nimport Turtule\nimport qualified Data.Text as T\nimport Data.Maybe\n\nmain = do\n    -- echo 需要Line数据类型,使用repr可获得Line\n    echo $ repr &quot;hello world!&quot;\n    -- 或者使用Data.Text来获取Text，使用textToLine获取Maybe Line,使用fromJust 获取Line\n    -- 需要导入Data.Maybe Data.Text\n    echo $ fromJust $ textToLine $ T.pack &quot;hello world!&quot;\n\n上面这种方式太麻烦，实际上是在文件开头添加&#123;-# LANGUAGE OverloadedStrings #-&#125;，这样String会成为Text类型\n&#123;-# LANGUAGE OverloadedStrings #-&#125;\n\nimport Turtle\n\nmain = do\n    shell &quot;ls -alh /home&quot; empty\n\nget command output\nimport Turtle\n\nmain = do\n    dir &lt;- pwd \n    echo $ repr dir\n\n    time &lt;- date \n    echo $ repr time\n\nexecute system command\nimport Turtle\nimport qualified Data.Text as T\n\nmain = do\n    -- 打开浏览器\n    -- shell需要接受一个Text数据类型\n    let cmd = T.pack &quot;firefox&quot;\n    shell cmd empty\n    \n    -- ps查看进程\n    shell (T.pack &quot;ps -ef |grep firefox&quot;)  empty\n    \n    -- 调用ls命令，内置的ls命令无法添加参数，使用这种方式可以加参数\n    shell (T.pack &quot;ls -alh $HOME&quot; |grep rc)  empty\n\nErrorproblem of dynamic linkErr：vscode中运行正常，但是编译报错无法找到Prelude\n\nCause: ghc 8.0.2-1版本只支持动态链接库，而编译默认使用的是静态链接。\nFix:\n\n编译的时候添加动态链接参数\nghc --dynamic file_name.hs\n\n为了方便，可以用alias重写ghc\n# add to ~/.zshrc\nalias ghc=&quot;ghc -dynamic&quot;\n\n\n配置cabal/stack使用动态库，配置方法参考arch wiki\n\n\n\ncannot find module which has been installedErr: 使用cabal安装模块后，依然无法导入，报错无法找到模块\nCause: 在安装cabal之前系统已经存在ghc，导致安装cabal时编译的是系统的ghc\nFix：解决方法很简单，使用系统的ghc就可以了（注释掉安装时配置的环境变量）\n","categories":["learn"],"tags":["haskell"]},{"title":"ip_route","url":"/2022/04/23/ip-route/","content":"IP addr and routeip address settingMost of time we login a new system, there has no ip address and we cannot connect to the web and also cannot download packages with package manager. At this time, we have so many methods to configure a system with ip address.\nif we have dhcpcd client or have network/NetworkManager installed\n\nthe easily way is using dhcpcd or dhcpcd network_interface command to get a dynamic ip address. for instance:\ndhcpcd \n# or\ndhcpcd wlan0\n\n\nif the system use network or NetworkManager to manage network, we can configure static or dynamic ip address. for instance:\ncat /etc/sysconfig/network-scripts/ifcfg-enp0s3\n\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=static        # static mathod\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nNAME=enp0s3\nUUID=9362a50a-b4fc-4943-ab54-a865b328ef0f\nDEVICE=enp0s3\nONBOOT=yes                # auto start\n\nIPADDR=10.10.10.10        # ip\nPREFIX=24                # netmask\nGATEWAY=10.10.10.1        # gateway\n\nor simple dynamic ip\ncat /etc/sysconfig/network-scripts/ifcfg-enp0s3\n\nTYPE=Ethernet\nPROXY_METHOD=none\nBROWSER_ONLY=no\nBOOTPROTO=dhcp            # dhcp mathod\nDEFROUTE=yes\nIPV4_FAILURE_FATAL=no\nNAME=enp0s3\nUUID=9362a50a-b4fc-4943-ab54-a865b328ef0f\nDEVICE=enp0s3\nONBOOT=yes                # auto start\n\n\nNote: if we have a requirement of visiting website, we need set local DNS in /etc/resolv.conf \n​          eg: echo nameserver 192.168.31.1 &gt; /etc/resolv.conf\n\n\n\nif there has no dhcpcd and network/NetworkManager\n\nadd a ip address and route by hand\nip address add 192.168.31.33 dev enp0s3\n\nthen add route\nip route add 192.168.31.0/24 dev enp0s3\n\nadd nameserver\necho nameserver 192.168.31.1 &gt; /etc/resolv.conf\n\n\nNote: the configuration above we write is temporary, when we reboot the computer or restart network service the configuration will lost. \n\nIf we use network/NetworkManager, the way to store route configuration is writing command to /etc/sysconfig/network-scripts/route-*, store ip configuration is writing command to /etc/sysconfig/network-scripts/ifcfg-eth*.\nif we don’t use network service, the easiest way is writing commands to a start script such as .xinitrc or  setting a service with scripts to execute those commands.\n\n\nFor Example:\n# add ip address\nip address add 192.168.31.31 dev enp0s3\nip address add 10.10.10.10 dev enp0s3\n# add route\nip route add 10.10.10.0/24 dev enp0s3\nip route add 192.168.31.0/24 dev enp0s3\nip route add default via 192.168.31.1 dev enp0s3\n\n# store route configure\ncat /etc/sysconfig/network-scripts/route-enp0s3\n10.10.10.0/24 dev enp0s3\n192.168.31.0/24 dev enp0s3\ndefault via 192.168.31.1 dev enp0s3\n\n# store ip address\ncat /etc/sysconfig/network-scripts/ifcfg-enp0s3\nIPADDR1=192.168.31.31\nPREFIX1=24\nGATEWAY1=192.168.31.1\n\nIPADDR2=10.10.10.10\nPREFIX2=24\nGATEWAY2=10.10.10.1\n\n\n\nTipsif there has more than one network device and we need to configure it by hand where can we  find network interface and mac address?\n if ip link show cannot find, we can find it in /sys/class/net.\nwhere to find network interface mac address?\nwe can find it in /sys/class/net/network_interface/address.\nip address aliaswe can add more then one ip address to a network interface using\nip address add 10.10.10.1 dev enp0s3\n\nit may look like this\n\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:a9:ce:40 brd ff:ff:ff:ff:ff:ff\n    inet 10.10.10.10/24 brd 10.10.10.255 scope global enp0s3\n       valid_lft forever preferred_lft forever\n    inet 192.168.31.33/32 scope global enp0s3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:fea9:ce40/64 scope link \n       valid_lft forever preferred_lft forever\n\nor we can use ip alias by using\nip address add 12.12.12.12/24 dev enp0s3 label enp0s3:1\n\nit may look like this\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:a9:ce:40 brd ff:ff:ff:ff:ff:ff\n    inet 10.10.10.10/24 brd 10.10.10.255 scope global enp0s3\n       valid_lft forever preferred_lft forever\n    inet 192.168.31.33/32 scope global enp0s3\n       valid_lft forever preferred_lft forever\n    inet 12.12.12.12/24 scope global enp0s3:1    # alias\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:fea9:ce40/64 scope link \n       valid_lft forever preferred_lft forever\n\nthe way to save ip alias configure is\ncd /etc/sysconfig/network-scripts/\ncp ifcfg-enp0s3 ifcfg-enp0s3:1\n\ncat ifcfg-enp0s3:1\n\nIPADDR=12.12.12.12\nPREFIX=24\nGATEWAY=12.12.12.1\n\nnat 路由转发可以连接外网的网段是192.168.31.0/24，自己组建局域网的网段是10.10.10.0/24，要用一个linux主机做路由转发，让10.10.10.0/24网段的主机可以连接外网。\n设备\n一台做路由的linux主机，有两张网卡，分别为192网段和10网段ip\n其它10.10.10.0/24网段的主机\n\n步骤用virtualbox启动两个centos7的系统：centos-nat分配两张网卡，centos7.1分配一张网卡。\ncentos-nat需要关闭默认的防火墙firewalld，然后才能使用iptables\ncentos-nat\n# centos-nat步骤\n\n\n## 设置ip\nip address add 192.168.31.33/24 dev enp0s3\nip address add 10.10.10.10/24 dev enp0s8\n\n## 设置路由\nip route add 192.168.31.0/24 dev enp0s3\nip route add 10.10.10.0/24 dev enp0s8\nip route add default via 192.168.31.33 dev enp0s3\n\n## 关闭防火墙\nsystemctl stop firewalld\n\n## 开启路由\necho 1 &gt; /proc/sys/net/ipv4/ip_forward\n\n## 设置iptables nat转发策略\niptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE\n\ncentos7.1\n# centos7.1步骤\n\n## 设置ip\nip address add 10.10.10.11/24 dev enp0s3\n\n## 设置默认路由\nip address add default via 10.10.10.10 dev enp0s3\n\n## 设置DNS解析\necho nameserver 192.168.31.1 &gt; /etc/resolv.conf\n\n然后centos7.1（10.10.10.0/24的主机）就可以连接外网了,done.\n","categories":["learn"],"tags":["route"]},{"title":"iptables","url":"/2022/04/23/iptables/","content":"IPTABLESiptables is a powerful tool(front of kernel netfilter module) to manually change the way that network connection of our computer. we can do everything with the network connection such as port forward, nat network transfer, load balancer and etc.\ntablesas first we need to know that there are 5 tables for us to store our ip table rules:\n\n\n\ntable\naims\n\n\n\nraw\nexempt from connection tracking\n\n\nfilter\ncommon to adjust input and output policy\n\n\nnat\ncommon to do network address translation\n\n\nmangle\nspecialized packet alterations\n\n\nsecurity\nsecurity access\n\n\nthe most important thing is that the life of packet working though isn’t from one table to another table, so, table is just a group of rules that have the same effective function. in order to make the configuration much easier, there comes chain concept. each table has different chains.\nstartup and savein my archlinux, it isn’t enabled by default.\n# enable iptables and start\nsudo systemctl enable --now iptables\n\nterminal setting of iptables will not store in disk, in order to make it effect after reboot we need to save it.\nsudo iptables-save -f /etc/iptables/iptables.rules\n\nin general, we don’t modify this file directly. however if we do that a reload is needed.\nsudo iptables-restart /etc/iptables/iptables.rules\n\nlist rules--list: list all rules with DNS resolve, don’t use this along since it will display for a long time.\n--numeric: don’t resolve DNS, display ip directly.\n--list-rules: list all origin commands.\n--line-number: list rules with line number.\n--verbose: show packet account.\nsudo iptables --table filter --list --numeric\nsudo iptables --table nat --list --numeric --line-number\nsudo iptables --table mangle --list-rules\n\n\nNote:\nuse list with numeric together, or it will spend lots of time to reverse ip address to DNS/hostname\n\nimport modulesIn iptables, there are lots of modules we can use. For example --protocol tcp will import a module named tcp in backend. If we want to use other modules, we can use --module module_name to import.\nModule comment is very useful for us to add a comment to a rule in case of forgotten.\nsudo iptables --table filter --append FORWARD --jump DROP --module comment --comment &quot;disable all forward traffice by default&quot;\n\ndisable input requestin order to enhance personal PC security, i want to disable all request to my PC but only allow local area ssh connect.\nif i disable all input traffic, though all output traffic is allowed i cannot access any web site via browser. The reason is that when i send a request to remote web server, the remote server need reply the information that i need, but i already disabled all input traffic, so i cannot visit any web site. Since all connection have a state, if the connection is established, the state will be changed. So i can use this feature.\n# disable all input traffic by default\nsudo iptables --table filter --policy INPUT DROP\n\n# allow established connection\nsudo iptables --table filter --append INPUT --module state --state ESTABLISHED --jump ACCEPT --module comment --comment &quot;allow established connection&quot;\n\n# allow local area network ssh connectin\nsudo iptables --table filter --append INPUT --protocol tcp --dport 22 --jump ACCEPT --module comment --comment &quot;allow local area network ssh connection&quot;\n\nflush old rule and modify default chain policywe can choose which one to flush, all table/ one table/ a chain?\n# flush all table\nsudo iptables --flush\n# flush specified table\nsudo iptables --table [table_name] --flush\n# flush specified table&#39;s chain\nsudo iptables --table [table_name] --flush [chain_name]\n\nthere are two ways to change the default chain policy:\n\ndirectly change chain policy\nadd a global policy at the end of one chain\n\n# eg: change default ACCEPT to DROP of filter table INPUT chain\nsudo iptables --table filter --policy INPUT DROP\nsudo iptables --table filter --append INPUT --jump DROP\n\nNAT tablelearn from youtube video. net table is used to forward packet, much powerful in port forward, ip forward, even load balance.\nport forwardall traffic coming to local network will work though nat’s PREROUTING chain. in this chain, we can modify access port to other port realizing port forward.\nfor example i want other people access my PC’s 8080 port to really visit 80  port.\nsudo iptables --table nat --append PREROUTING --protocol tcp --dport 8080 --jump REDIRECT --to 80 --module comment --comment &quot;redirect 8080 to 80 port&quot;\n\nnow other people visit my PC’s 8080 port will redirect to 80 port.\nit is very useful, yeah? one hand, we can enhance security, on the other hand, we can start several same applications with different ports in one machine.\nip forward\n环境：192.168.31.235主机安装了nginx服务，可以进行web页面80端口访问。现在需要在192.168.31.31（本机）访问192.168.31.114的80端口来间接访问192.168.31.235的nginx服务\n所有iptables策略在转发192.168.31.114主机上进行配置\n# 将来自114：80端口的请求转发到235:80端口\niptables --table nat \\\n--append PREROUTING \\\n--protocol tcp \\\n--dport 80 \\\n--destination 192.168.31.114 \\\n--jump DNAT \\\n--to-destination 192.168.31.235:80\n\n# 将转发到235:80端口的数据源地址31（本机）地址修改为114\niptables --table nat \\\n--append POSTROUTING \\\n--protocol tcp \\\n--dport 80 \\\n--destination 192.168.31.235 \\\n--jump SNAT \\\n--to-source 192.168.31.114\n\n\nNote: \n默认主机的ip转发是关闭的，需要手动开启。如果需要永久开启需要在/etc/sysctl.conf中添加\nnet.ipv4.ip_forward=1\n\necho 1 &gt; /proc/sys/net/ipv4/ip_forward\n\n","categories":["learn"],"tags":["iptables"]},{"title":"k8s","url":"/2022/04/23/k8s/","content":"kubernetescore component\netcd：分布式存储，保存集群状态\napiserver：api操作接口\ncontroller manager：维护集群状态\nscheduler：资源调度\nkubelet：容器生命周期，volume和网络管理\ncontainer runtime：镜像管理，pod和容器管理\nkube-proxy：内部服务发现和负载均衡\n\nbasic conceptcontainer: k8s构建在容器之上，容器被k8s所管理，容器间采用namespace进行隔离\npod: k8s使用pod来管理容器，一个pod中一般运行相同的程序，因为pod内的容器共享网络（处于同网段）和文件系统，可进行进程间通信和文件共享\nnode: node是部署pod的地方，所以node的大小决定能够部署虚拟机的多少\nservice: 服务可以跨越pod，每个服务会分配一个内部的cluster ip和dns，供其它容器访问\nlabel &amp; annotation: label用来标识对象，annatation用来做注释\nvolume: 为了pod的启停不对数据造成损坏，volume可实现数据持久化\n确保pod数量的方式\nrc (replication controller): 保证pod的高可用，申明确定的pod数量，并维持pod数量不变\nrs (replica set): 新一代的rc，支持更多种类的匹配模式\ndeployment：比rs应用更广，用于创建、更新、滚动升级服务\n服务发现和负载均衡\nservice提供了pod对外服务的确定ip和端口，不需要考虑pod新建和销毁所引起的ip地址变化\njob:用来控制批处理型任务，执行一次完成后自动退出\ncommandskubectl get                # list pods\nkubectl describe         # detail info\nkubectl logs            # logs\nkubectl exec            # execute command in container\nkubectl run                # run a simple container\nkubectl create -f xx.yaml # run container commonly\n\ninstall成功安装kubernetes的前提条件：\n\n安装k8s的机器保证cpu个数大于等于2\n内存不使用swap分区\n多节点的时候需要有主机名与对应ip的映射关系\n关闭防火墙setenforce firewalld\n对应版本的docker和k8s\n\n\n这里使用的版本为：\ndocker:\n​    docker-ce-19.03.0-3.el7 \n​    docker-ce-cli-19.03.0-3.el7 \n​    containerd.io-1.4.4-3.1.el7\nk8s:\n​    kubelet-1.20.0-0 \n​    kubeadm-1.20.0-0 \n​    kubectl-1.20.0-0 \n\ninstall修改主机名# leader\nhostnamectl set-hostname k8l\n# node\nhostnamectl set-hostname k8n1\n\n设置主机与ip的映射关系\nNote:\n\nk8s的节点主机最好设置为静态ip，因为ip变化之后node节点也会消失\n一般多节点最好是奇数个，但这里采用2个\n\n\n# 建立映射关系\ncat &gt;&gt; /etc/hosts &lt;&lt; EOF\n192.168.31.11 k8l\n192.168.31.12 k8n1\nEOF\n\necho nameserver 114.114.114.114 &gt; /etc/resolv.conf\n\n关闭防火墙&amp;swap分区# 关闭firewalld\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n# 关闭selinux\nsetenforce 0\nsed -i &#39;s/=enforcing/=permissive/&#39; /etc/sysconfig/selinux\n\n# 关闭swap分区\nswapoff -a\nsed -i &#39;/swap/s/^/#/&#39; /etc/fstab\n\ndocker安装&amp;配置# 配置docker源\nyum install -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\n# 安装docker\nyum install docker-ce-19.03.0-3.el7 docker-ce-cli-19.03.0-3.el7 containerd.io-1.4.4-3.1.el7 -y\n\n\nNote:\n查看版本：yum list containerd.io –showduplicates | sort -r\n\n修改dockercgroupdriver为systemd (默认为cgroupfs)\nmkdir /etc/docker\ncat &gt; /etc/docker/daemon.json &lt;&lt; EOF\n&#123;\n  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]\n&#125;\nEOF\n\n启动docker，配置自启动\nsystemctl enable docker\nsystemctl start docker\n\nk8s安装&amp;配置# 允许k8s进行流量代理\ncat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\n# 添加国内k8s镜像源\ncat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF\n[kubernetes]\nname=Kubernetes Repo\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\ngpgcheck=0\nenabled=1\nEOF\n\n# 安装k8s\nyum install -y kubelet-1.20.0-0 kubeadm-1.20.0-0 kubectl-1.20.0-0 \n\n允许k8s自启动\nsystemctl enable kubelet\n\n\nNote:\n这里不需要启动k8s，现在启动会报错\n\n主节点配置主节点初始化\n# 修改apiserver-advertise-address为master的ip\nkubeadm init --kubernetes-version=1.20.0  \\\n--apiserver-advertise-address=192.168.31.11   \\\n--image-repository registry.aliyuncs.com/google_containers  \\\n--service-cidr=10.10.0.0/16 --pod-network-cidr=10.122.0.0/16\n\n\nNote:\n主节点初始化失败后可以重新初始化，不过需要先清空之前初始化的配置\nkubeadm reset\nrm -rf /etc/cni\nrm -rf $HOME/.kube/config\n\n\n初始化完成后会在终端打印一些重要信息，需要记录下来。比如node接入的命令\n mkdir -p $HOME/.kube\n sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n sudo chown $(id -u):$(id -g) $HOME/.kube/config\n export KUBECONFIG=/etc/kubernetes/admin.conf\n\n修改端口\nsed -i &#39;s/insecure-port=0/insecure-port=8080/&#39; /etc/kubernetes/manifests/kube-apiserver.yaml\n\n启动kubelet\nsystemctl start kubelet\n\n安装网络管理插件\nkubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\n\n\nNote:The connection to the server 192.168.31.11:6443 was refused - did you specify the right host or port?\n遇到以上报错时，需要重新初始化，一般是某些k8s的docker启动失败。\nsystemctl stop kubelet\nsystemctl stop docker\n\nkubeadm reset\nrm -rf /etc/cni\nrm -rf $HOME/.kube/config\n\nsystemctl start docker\nsystemctl start kubelet\n\nkubeadm init --kubernetes-version=1.20.0  \\\n--apiserver-advertise-address=192.168.31.11   \\\n--image-repository registry.aliyuncs.com/google_containers  \\\n--service-cidr=10.10.0.0/16 --pod-network-cidr=10.122.0.0/16\n\n\nnode接入主节点# node上运行\nkubeadm join 192.168.31.11:6443 --token nfb8gw.46gfska1dhfevlg9 --discovery-token-ca-cert-hash sha256:5ca678d7bcda290d7a692474711cbf1e5d5a11bc51969cbd453561e1f3186476\n\n如果忘记了以上命令，那么需要重新获取\n# 查看token的值\nkubeadm token list\n\n# 如果过期了重新生成\nkubeadm token create\n\n# 获取ca证书的sha256编码hash值\nopenssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssdgst -sha256 -hex | sed &#39;s/^.* //&#39;\n\n# 组装\nkubeadm join 192.168.31.11:6443 --token &#123;&#123;token&#125;&#125; --discovery-token-ca-cert-hash sha256:&#123;&#123;hash&#125;&#125;\n\n查看状态kubectl get nodes\nkubectl get pods -n kube-system\nkubectl get namespace\nkubectl get pods\n\n需要等待一会才是ready状态\n[root@k8l ~]# kubectl get nodes\nNAME   STATUS   ROLES                  AGE     VERSION\nk8l    Ready    control-plane,master   25m     v1.20.0\nk8n1   Ready    &lt;none&gt;                 8m33s   v1.20.0\n\n创建nginxkubectl create deployment nginx --image=nginx\nkubectl expose deployment nginx --port=80 --type=NodePort\nkubectl get pod,svc\n\n# 查看80映射端口\n[root@k8s-master ~]# kubectl get pod,svc\nNAME                         READY   STATUS              RESTARTS   AGE\npod/nginx-6799fc88d8-7rgq6   0/1     ContainerCreating   0          16s\n\nNAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE\nservice/kubernetes   ClusterIP   10.10.0.1      &lt;none&gt;        443/TCP        34m\nservice/nginx        NodePort    10.10.78.172   &lt;none&gt;        80:31613/TCP   7s\n\n# web界面访问\nhttp://192.168.31.111:31613\n\ndaskboardinstall\nfollow this website) to install dashboard\n# run this command \nkubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml\n\n# 如果上面下载不下来也可以用我的gitee文件。内容和上面一样\nkubectl apply -f https://gitee.com/ulomo/some-config-file/raw/master/recommended.yaml\n\nedit settting\nin default we cannot access dashboard outsite the host machine where k8s installed. with [this method](How To Access Kubernetes Dashboard Externally – The Geek Diary) we can access dashboard with host ip address \n# change service “type” from ClusterIP to NodePort\nkubectl -n kubernetes-dashboard edit service kubernetes-dashboard\n\nthen find port to visit. it is 31235\n[root@k8m ~]# kubectl get services --all-namespaces\nNAMESPACE              NAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)                  AGE\ndefault                kubernetes                  ClusterIP   10.10.0.1      &lt;none&gt;        443/TCP                  74m\nkube-system            kube-dns                    ClusterIP   10.10.0.10     &lt;none&gt;        53/UDP,53/TCP,9153/TCP   74m\nkubernetes-dashboard   dashboard-metrics-scraper   ClusterIP   10.10.27.176   &lt;none&gt;        8000/TCP                 59m\nkubernetes-dashboard   kubernetes-dashboard        NodePort    10.10.222.86   &lt;none&gt;        443:31235/TCP            59m\n\ncreate user\n[follow this website](dashboard/creating-sample-user.md at master · kubernetes/dashboard · GitHub) to create user\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\nEOF\n\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kubernetes-dashboard\nEOF\n\nget tocken\nget tocken login needed\nkubectl -n kubernetes-dashboard get secret $(kubectl -n kubernetes-dashboard get sa/admin-user -o jsonpath=&quot;&#123;.secrets[0].name&#125;&quot;) -o go-template=&quot;&#123;&#123;.data.token | base64decode&#125;&#125;&quot; |less\n\nat last, we can visit dashboard with k8s master ip address: https://192.168.31.11:31235/\n","categories":["learn"],"tags":["k8s"]},{"title":"kubernetes","url":"/2022/04/23/kubernetes/","content":"kubernetesfeature\nhigh availablity or no downtime\nscalability or high performance\ndisaster recovery (backup and restore)\n\nprocess of worker nodesthere are three processes in worker loads\n\nkubectl: operate on pods, with the ability of resource devision\nkube proxy: communicate with nodes, with the ability of load balance\ncontainer runtime: run container\n\nprocess of main nodesthere are four processes in master nodes\n\napi server: access all web ui or ctl operation commands\nscheduler: calculate worker nodes resource and decide which worker node the pod will start up\ncontroller manager: monitor pods’s availability and restart/rebuild the broken pods\netcd: the database of master nodes, stores all collected information from worker  nodes\n\nmain kubernetes components\n\n\ncomponents\nfeature\n\n\n\npod\nthe smallest unit in k8s\n\n\nservice\nadd permanent ip address for deployment\n\n\ningress\nmap url with service\n\n\nconfigmap\n\n\n\nsecret\nstore secret user name/password (encoded with base64)\n\n\nvolume\nadd persistence data storage\n\n\ndeployment\nthe method(blueprint) deploy pod\n\n\nstatefulset\nthe method(blueprint) deploy pod, with the ability of data sync\n\n\ninstall minikubeminikube has kubernetes’s all availability but tool installed in one machine.\n# install in centos with new docker version\n# don&#39;t install docker with yum default repo, for the version is too old\n# follow this link :https://docs.docker.com/engine/install/centos/\nsudo yum install -y yum-utils\n\nsudo yum-config-manager \\\n    --add-repo \\\n    https://download.docker.com/linux/centos/docker-ce.repo\n    \nsudo yum install docker-ce docker-ce-cli containerd.io -y\nsudo systemctl enable --now docker\n  \n\n\n# install minikube\ncurl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-latest.x86_64.rpm\nsudo rpm -Uvh minikube-latest.x86_64.rpm\n\n\n# start minikube with none root priviledge user\nuseradd -G docker kube &amp;&amp; newgrp docker &amp;&amp; su - kube\nminikube start\n\ncreate podsthere are two ways to create pods:\n\ncommand line: simple usage  \nconfigure file: full feature\n\nvia command lineget information of default configuration\nalias kubectl=&quot;minikube kubectl --&quot;\nkubectl get nodes/deployment/pods/configmap/services/replicaset/all [-o wide] [--watch]\n\ncreate new pod\nkubectl create deployment nginx --image=nginx\n\n\nNote:\nkubernetes doesn’t create pod directly, but the layer: deployment\n\nthe command above creates a blueprint of nginx automatically, we can edit it\nkubectl edit deployment nginx\n\ncheck pod’s detail information\n# deploy info\nkubectl describe pod [pod-name]\n# running log\nkubectl logs [pod-name]\n\nlogin container\nkubectl exec -it [pod-name] -- /bin/bash\n\ndelete deployment\nkubectl get deployment\nkubectl delete [deployment-name]\n\n\nNote:\nwe can only delete pod at the deployment layer, for deployment will restart new pod if we delete the pod with kubectl delete pod [pod-name]\n\nvia configure fileconfigure file include three parts\n\nmetadata\nspecification\nstatus(kubernetes auto generate)\n\nif we create pod via command line deployment, we can export the configuration file created by kubernetes.\nkubectl get deployment [deploy-name] -o yaml &gt; [deploy-name].yaml\n\ncreate or delete deployment\nkubectl create -f [deploy-name].yaml\nkubectl delete -f [deploy-name].yaml\n\nmongodb.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: mongodb-deployment\n  labels:\n    app: mongodb\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: mongodb\n  template:\n    metadata:\n      labels:\n        app: mongodb\n    spec:\n      containers:\n      - name: mongodb\n        image: mongo\n        ports:\n          - containerPort: 27017\n        env:\n        - name: MONGO_INITDB_ROOT_USERNAME\n          valueFrom:\n            secretKeyRef:\n              name: mongodb-secret\n              key: root-username\n        - name: MONGO_INITDB_ROOT_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: mongodb-secret\n              key: root-password\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mongodb-service\nspec:\n  selector:\n    app: mongodb\n  ports:\n    - protocol: TCP\n      port: 3306\n      targetPort: 27017\n\nmongo-express.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: mongo-express\n  labels:\n    app: mongo-express\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: mongo-express\n  template:\n    metadata:\n      labels:\n        app: mongo-express\n    spec:\n      containers:\n      - name: mongo-express\n        image: mongo-express\n        ports:\n          - containerPort: 8081\n        env:\n          - name: ME_CONFIG_MONGODB_ADMINUSERNAME\n            valueFrom:\n              secretKeyRef: \n                name: mongodb-secret\n                key: root-username\n          - name: ME_CONFIG_MONGODB_ADMINPASSWORD\n            valueFrom:\n              secretKeyRef: \n                name: mongodb-secret\n                key: root-username\n          - name: ME_CONFIG_MONGODB_SERVER  \n            valueFrom:\n              configMapKeyRef:\n                name: mongodb-configmap\n                key: database_url\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: mongo-express-service\nspec:\n  selector:\n    app: mongo-express\n  type: LoadBalancer\n  ports:\n    - protocol: TCP\n      port: 8081\n      targetPort: 8081\n      nodePort: 30000\n\nmongodb-configmap.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: mongodb-configmap\ndata:\n  database_url: mongodb-service\n\nmongodb-secret.yaml\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mongodb-secret\ntype: Opaque\ndata:\n  root-username: bW9uZ28=\n  root-password: bW9uZ28=\n\nnetwork realizationresource link:\nhttps://github.com/kristenjacobs/container-networking\nhttps://static.sched.com/hosted_files/kccna18/c1/slides.pdf\nhttps://www.youtube.com/watch?v=6v_BDHIgOY8\ncommunication between network namespaceseach network namespace has its own network stack, they cannot communicate with each other directly\n\npod is the group of containers, all the containers in a pod share the same network  stack, owns one ip and localhost address\nso, how can we resolve the problem that host machine(root  namespace) communicates with container /pod (another new created namespace)?\nand the answer is veth pair(virtual network device), with veth pair two network namespaces can be connected together. packet can flow between the two ethernet interfaces. \nin this example, i will use one network namespace instaead of a pod’s or containers’ network stack.\n\nNote:\n\nvia virtual network technology, eth1-1 is the same as veth1\n\nhost(eth0) can ping each container network, but reverse cannot. because all namespace transparency to host \n\n\n\n\npod_namespace=cont1\npod_interface=eth1-1\npod_ip=10.10.0.11\nvpair=veth1\n\n# create network namespace\nsudo ip netns add $&#123;pod_namespace&#125;\n\n# create veth pairs in host root namespace\nsudo ip link add $&#123;vpair&#125; type veth peer name $&#123;pod_interface&#125;\n\n# add interface to new network namespace\nsudo ip link set $&#123;pod_interface&#125; netns $&#123;pod_namespace&#125;\n\n# add ip address for new interface\nsudo ip netns exec $&#123;pod_namespace&#125; ip addr add $&#123;pod_ip&#125;/24 dev $&#123;pod_interface&#125;\n\n# start new namespace loopback up\nsudo ip netns exec $&#123;pod_namespace&#125; ip link set lo up\n\n# start new namespace ethernet up\nsudo ip netns exec $&#123;pod_namespace&#125; ip link set dev $&#123;pod_interface&#125; up\n\n# start root namespace vpair interface up\nsudo ip link set dev $&#123;vpair&#125; up\n\n# add default route for new namespace via ethernet interface\nsudo ip netns exec $&#123;pod_namespace&#125; ip route add default via $&#123;pod_ip&#125; dev $&#123;pod_interface&#125;\n\n# add route for root namespace vpair interface\nsudo ip route add $&#123;pod_ip&#125; dev $&#123;vpair&#125;\n\n# ping new namespace ethernet ip address in host\nping -c 2 $&#123;pod_ip&#125;\n\ncommunication between podsabove veth pair can resolve the problem of two network namespaces communication, but not two pods, for there are lots of pods in kubernetes node, we cannot establish veth pairs for each two pods. \nand the bridge network device can resolve this problem, a bridge has its own ip address and route table, so pod can communication with each other once they connect to the bridge, it acts just like a router(switch). another benefit of bridge is that bridge device and the host net device are in the same root namespace, both have ip address, so they can communicate directly.\n\nNote:\n\nvia bridge network technology, eth1-1 and eth2-2 can ping each other\neth1-1 can ping host eth0, because br0 and eth0 both in the same root namespace\n\n\n\npod1_namespace=cont1\npod1_interface=eth1-1\npod1_ip=10.10.0.11\nvpair1=veth1\n\nbridge_interface=br0\nbridge_ip=10.10.0.1\n\npod2_namespace=cont2\npod2_interface=eth2-2\npod2_ip=10.10.0.22\nvpair2=veth2\n\n\n# create network namespace\nsudo ip netns add $&#123;pod1_namespace&#125;\nsudo ip netns add $&#123;pod2_namespace&#125;\n\n# create veth pairs in host root namespace\nsudo ip link add $&#123;vpair1&#125; type veth peer name $&#123;pod1_interface&#125;\nsudo ip link add $&#123;vpair2&#125; type veth peer name $&#123;pod2_interface&#125;\n\n# add interface to new network namespace\nsudo ip link set $&#123;pod1_interface&#125; netns $&#123;pod1_namespace&#125;\nsudo ip link set $&#123;pod2_interface&#125; netns $&#123;pod2_namespace&#125;\n\n# add ip address for new interface\nsudo ip netns exec $&#123;pod1_namespace&#125; ip addr add $&#123;pod1_ip&#125;/24 dev $&#123;pod1_interface&#125;\nsudo ip netns exec $&#123;pod2_namespace&#125; ip addr add $&#123;pod2_ip&#125;/24 dev $&#123;pod2_interface&#125;\n\n# start new namespace loopback up\nsudo ip netns exec $&#123;pod1_namespace&#125; ip link set lo up\nsudo ip netns exec $&#123;pod2_namespace&#125; ip link set lo up\n\n# start new namespace ethernet up\nsudo ip netns exec $&#123;pod1_namespace&#125; ip link set dev $&#123;pod1_interface&#125; up\nsudo ip netns exec $&#123;pod2_namespace&#125; ip link set dev $&#123;pod2_interface&#125; up\n\n# start root namespace vpair interface up\nsudo ip link set dev $&#123;vpair1&#125; up\nsudo ip link set dev $&#123;vpair2&#125; up\n\n# create a bridge\nsudo ip link add name $&#123;bridge_interface&#125; type bridge\n\n# assign a IP address to the bridge\nsudo ip addr add $&#123;bridge_ip&#125;/24 dev $&#123;bridge_interface&#125;\n\n# add two veth pair interface to bridge\nsudo ip link set dev $&#123;vpair1&#125; master $&#123;bridge_interface&#125;\nsudo ip link set dev $&#123;vpair2&#125; master $&#123;bridge_interface&#125;\n\n# start the bridge up\nsudo ip link set dev $&#123;bridge_interface&#125; up\n\n# add the default route in two network namespaces\nsudo ip netns exec $&#123;pod1_namespace&#125; ip route add default via $&#123;bridge_ip&#125; dev $&#123;pod1_interface&#125;\nsudo ip netns exec $&#123;pod2_namespace&#125; ip route add default via $&#123;bridge_ip&#125; dev $&#123;pod2_interface&#125;\n\n# two containers ping each other\nip netns exec $&#123;pod1_namespace&#125; ping -c 3 $&#123;pod2_ip&#125;\nip netns exec $&#123;pod2_namespace&#125; ping -c 3 $&#123;pod1_ip&#125;\n\ncommunication between nodes with different subnetwith veth pair and bridge network technology, the container can reach host network and other pod’s network in one node. so communication in two nodes, the only thing we need to do is assigning a route table.\nrun script in one node. node ip is 192.168.31.100/24 and ether interface is eth0\n\nNote:\n\ncontainer network can reach the host point already, we only need to specify each node to other node’s route table\n\n\n\npod1_namespace=cont1\npod1_interface=eth1-1\npod1_ip=10.10.0.11\nvpair1=veth1\n\nbridge_interface=br0\nbridge_ip=10.10.0.1\n\npod2_namespace=cont2\npod2_interface=eth2-2\npod2_ip=10.10.0.22\nvpair2=veth2\n\n\n# create network namespace\nsudo ip netns add $&#123;pod1_namespace&#125;\nsudo ip netns add $&#123;pod2_namespace&#125;\n\n# create veth pairs in host root namespace\nsudo ip link add $&#123;vpair1&#125; type veth peer name $&#123;pod1_interface&#125;\nsudo ip link add $&#123;vpair2&#125; type veth peer name $&#123;pod2_interface&#125;\n\n# add interface to new network namespace\nsudo ip link set $&#123;pod1_interface&#125; netns $&#123;pod1_namespace&#125;\nsudo ip link set $&#123;pod2_interface&#125; netns $&#123;pod2_namespace&#125;\n\n# add ip address for new interface\nsudo ip netns exec $&#123;pod1_namespace&#125; ip addr add $&#123;pod1_ip&#125;/24 dev $&#123;pod1_interface&#125;\nsudo ip netns exec $&#123;pod2_namespace&#125; ip addr add $&#123;pod2_ip&#125;/24 dev $&#123;pod2_interface&#125;\n\n# start new namespace loopback up\nsudo ip netns exec $&#123;pod1_namespace&#125; ip link set lo up\nsudo ip netns exec $&#123;pod2_namespace&#125; ip link set lo up\n\n# start new namespace ethernet up\nsudo ip netns exec $&#123;pod1_namespace&#125; ip link set dev $&#123;pod1_interface&#125; up\nsudo ip netns exec $&#123;pod2_namespace&#125; ip link set dev $&#123;pod2_interface&#125; up\n\n# start root namespace vpair interface up\nsudo ip link set dev $&#123;vpair1&#125; up\nsudo ip link set dev $&#123;vpair2&#125; up\n\n# create a bridge\nsudo ip link add name $&#123;bridge_interface&#125; type bridge\n\n# assign a IP address to the bridge\nsudo ip addr add $&#123;bridge_ip&#125;/24 dev $&#123;bridge_interface&#125;\n\n# add two veth pair interface to bridge\nsudo ip link set dev $&#123;vpair1&#125; master $&#123;bridge_interface&#125;\nsudo ip link set dev $&#123;vpair2&#125; master $&#123;bridge_interface&#125;\n\n# start the bridge up\nsudo ip link set dev $&#123;bridge_interface&#125; up\n\n# add the default route in two network namespaces\nsudo ip netns exec $&#123;pod1_namespace&#125; ip route add default via $&#123;bridge_ip&#125; dev $&#123;pod1_interface&#125;\nsudo ip netns exec $&#123;pod2_namespace&#125; ip route add default via $&#123;bridge_ip&#125; dev $&#123;pod2_interface&#125;\n\n# two containers ping each other\nip netns exec $&#123;pod1_namespace&#125; ping -c 3 $&#123;pod2_ip&#125;\nip netns exec $&#123;pod2_namespace&#125; ping -c 3 $&#123;pod1_ip&#125;\n\n######################################## above almost the same ############################################################\n# add route to another node&#39;s bridge\nsudo ip route add 10.10.1.0/24 via 192.168.31.200 dev eth0\nsudo sysctl -w net.ipv4.ip_forward=1\n\n# test \nip netns exec $&#123;pod1_namespace&#125; ping -c 3 10.10.1.11\n\nrun script in another node, node ip is 192.168.31.200/24 and ether interface is eth0\npod1_namespace=cont1\npod1_interface=eth1-1\npod1_ip=10.10.1.11\nvpair1=veth1\n\nbridge_interface=br0\nbridge_ip=10.10.1.1\n\npod2_namespace=cont2\npod2_interface=eth2-2\npod2_ip=10.10.1.22\nvpair2=veth2\n\n\n# create network namespace\nsudo ip netns add $&#123;pod1_namespace&#125;\nsudo ip netns add $&#123;pod2_namespace&#125;\n\n# create veth pairs in host root namespace\nsudo ip link add $&#123;vpair1&#125; type veth peer name $&#123;pod1_interface&#125;\nsudo ip link add $&#123;vpair2&#125; type veth peer name $&#123;pod2_interface&#125;\n\n# add interface to new network namespace\nsudo ip link set $&#123;pod1_interface&#125; netns $&#123;pod1_namespace&#125;\nsudo ip link set $&#123;pod2_interface&#125; netns $&#123;pod2_namespace&#125;\n\n# add ip address for new interface\nsudo ip netns exec $&#123;pod1_namespace&#125; ip addr add $&#123;pod1_ip&#125;/24 dev $&#123;pod1_interface&#125;\nsudo ip netns exec $&#123;pod2_namespace&#125; ip addr add $&#123;pod2_ip&#125;/24 dev $&#123;pod2_interface&#125;\n\n# start new namespace loopback up\nsudo ip netns exec $&#123;pod1_namespace&#125; ip link set lo up\nsudo ip netns exec $&#123;pod2_namespace&#125; ip link set lo up\n\n# start new namespace ethernet up\nsudo ip netns exec $&#123;pod1_namespace&#125; ip link set dev $&#123;pod1_interface&#125; up\nsudo ip netns exec $&#123;pod2_namespace&#125; ip link set dev $&#123;pod2_interface&#125; up\n\n# start root namespace vpair interface up\nsudo ip link set dev $&#123;vpair1&#125; up\nsudo ip link set dev $&#123;vpair2&#125; up\n\n# create a bridge\nsudo ip link add name $&#123;bridge_interface&#125; type bridge\n\n# assign a IP address to the bridge\nsudo ip addr add $&#123;bridge_ip&#125;/24 dev $&#123;bridge_interface&#125;\n\n# add two veth pair interface to bridge\nsudo ip link set dev $&#123;vpair1&#125; master $&#123;bridge_interface&#125;\nsudo ip link set dev $&#123;vpair2&#125; master $&#123;bridge_interface&#125;\n\n# start the bridge up\nsudo ip link set dev $&#123;bridge_interface&#125; up\n\n# add the default route in two network namespaces\nsudo ip netns exec $&#123;pod1_namespace&#125; ip route add default via $&#123;bridge_ip&#125; dev $&#123;pod1_interface&#125;\nsudo ip netns exec $&#123;pod2_namespace&#125; ip route add default via $&#123;bridge_ip&#125; dev $&#123;pod2_interface&#125;\n\n# two containers ping each other\nip netns exec $&#123;pod1_namespace&#125; ping -c 3 $&#123;pod2_ip&#125;\nip netns exec $&#123;pod2_namespace&#125; ping -c 3 $&#123;pod1_ip&#125;\n\n######################################## above almost the same ############################################################\n# add route to another node&#39;s bridge\nsudo ip route add 10.10.0.0/24 via 192.168.31.100 dev eth0\nsudo sysctl -w net.ipv4.ip_forward=1\n\n# test\nip netns exec $&#123;pod1_namespace&#125; ping -c 3 10.10.0.11\n\n\nNote:\n\nit is a huge work if there are hundreds of nodes, so instead of manually configure, there are lots of CNI plugin for us to choose. such as flannel, calico…\n\n\n\n","categories":["learn"],"tags":["k8s"]},{"title":"learn_from_shield","url":"/2022/04/23/learn-from-shield/","content":"I watched “agents of SHIELD”, and learned a lot from it. Especially Skye’s response when Coulson told her the truth of her past life.\nCoulson said: “what i told her shattered her world,her lifelong search led to stories of murder and now it’s too difficult to continue. her search is over, her story ends here. but you know what she said? she said no, her story started here. her whole life, she though she wasn’t wanted, that she didn’t belong, that every family that took her in, didn’t want her to stay, didn’t care. but all that time, it was shield protecting her, looking after her, that’s what she took away from the story, not the family she’ll never have but the one she’s always had. here i am telling her something that could destroy her faith in humanity. and somehow, she manages to repair a little piece of mine. “\nthe world is full of evil and lies and pain and death, and you can’t hide from it, you can only face it. the question is, when you do, how do you respond? who do you become? \nI have a great inspiration of that. There has a long time i just feel so disappointed and can not  find any happiness of life, because i realize that the government i live is full of lies, they don’t treat people as human, there is on faith, no fair, on freedom and so on.\nHowever when i see the story of Skye, i realize that i need to change my mind. I know the country is so bad, it is truth. And i cannot change any thing, i can’t hide from it, can only face it. And the question is how i respond.  If i feel sad every day then my life is broke, whatever to say, it is not the worst  situation. I can alive, can do almost the thing which i wanna to dive in, there is no war, no death of threat. And that’s enough. \nEach day on earth is the day need to be treasured, since it can never come back. The really bad is not the environment but the heart of failure. \n","categories":["think"],"tags":["shield"]},{"title":"magic-of-xmonad","url":"/2022/06/25/magic-of-xmonad/","content":"magic of xmonad\nXmonad似乎永远都能带来意想不到的惊喜，只要你不断的探索\n\ntypora从1.0版本开始后就不再是免费软件了，所以曾经我卸载了他。每次打开它的时候就有一个窗口需要点击，有点烦。不过还是比其它收费软件好一些，毕竟这个也只是提示你，并没有强制不升级正版就不能用。\n然而我昨天发现xmonad居然可以轻松的帮我去掉点击弹框的这一步，太神奇，太惊讶了。而且非常简单。\n\n正常打开typora，并且打开终端，在终端输入xprop，然后点击这个弹框获取到它的WM_NAME\n\n在xmonad的manageHook中添加条件，将匹配到这个名字的窗口隐藏\nmyManageHook = composeOne \n            [ title     =? &quot;License Info&quot;               -?&gt; doHideIgnore\n            ]\n\n\n重新编译xmonad，启动就可以了，只能说xmonad太强了\n\n\n","categories":["linux"],"tags":["xmonad"]},{"title":"noResponseGrub","url":"/2022/04/23/noResponseGrub/","content":"issue在grub双启动界面无法用键盘进行上下移动选择需要的启动项，并且也无法用del键进入bios\nanalysize无论是方向键还是del键都不起作用，推测是grub启动的时候未识别到键盘，或者配置了什么参数导致grub freeze。google搜索了一下，发现有人遇到过这个问题，是因为在bios中设置了快速启动，所以我需要进bios中将快速启动关掉试试。然而现在的问题是无法进入bios\nresolve那么现在需要解决如何进入bios的问题，键盘没有反应肯定是不行了。之前设置过usb始终作为第一个启动项，所以将usb插上后可能就会进入usb的启动界面，或许键盘可以用。然而usb似乎是没有识别出来，所以还是只能在之前的grub上面进行修改。幸好grub是可以自定义启动顺序的，所以将进入bios的启动项配置为第一个就可以了。\nif [ $&#123;grub_platform&#125; == &quot;efi&quot; ]; then\n        menuentry &quot;Firmware setup&quot; &#123;\n                fwsetup\n        &#125;\nfi\n\n将以上代码写入/boot/grub/grub.cfg中，放到第一个启动位置。然后重启，顺利进入bios。最终找到了问题所在\n\nMSI的fast boot会导致在bios加载过程中不进行usb，硬盘识别，由于键盘/启动盘是用usb连接的，所以识别不到。将MSI快速关机禁止掉之后就解决了问题。\n所以如果是台式机，这个选项一定不能开启，否则bios都进入不了。笔记本电脑才能开启这个选项。不管怎么说，这个功能确实很不错，开启这个选项后进入系统的时间确实会减少很多。\n","categories":["learn"],"tags":["grub"]},{"title":"openssh","url":"/2022/04/23/openssh/","content":"opensshinstallin archlinux, openssh is a ssh toolkit, includes client ssh and server sshd. \npacman -S openssh\n\nclientusage examples.\nremote connectconnect to remote pc with default port 22.\nssh user@ip\n\nconnect to remote pc with specified port.\nssh -p port user@ip\n\nfile copywe can download file from server and upload file to server in client.\n\nNote:\nwhatever we download or upload, we only need a ssh client tool called scp  in local machine, needless server in local. and server runs in remote machine\n\ndownload file from server\nscp server_user@server_ip:/file/directory /local/file/directory\n\nupload file to server\nscp /local/file/directory server_user@server_ip:/file/directory\n\nroot loginadd following to allow root user login\nPermitRootLogin yes\n\nchange default portchange default port 22 to other ports\nnvim /etc/ssh/sshd_config\n\nPort 40000\n\nnow, connect to the machine need specify port\nssh -p 40000 user@ip\n\nlogin without password\nmachine A: who want to connect to B\n\nmachine B: with ssh service running\n\n\nif we use ssh command often, we can configure it without password to login(A=&gt;B). there are two things we need to do:\n\nin machine A: need to product a public key\nssh-keygen\n# or Specifies the type of key to create.  The possible values are “dsa”, “ecdsa”, “ecdsa-sk”, “ed25519”, “ed25519-sk”, or “rsa”.\nssh-keygen -t rsa\n\n# this step will create a public key (id_rsa.pub) in ~/.ssh\nls ~/.ssh\n  id_rsa       id_rsa.pub       known_hosts\n\n\nin machine A: copy public key id_rsa.pub  to B’s ~/.ssh/authorized_keys\n# in machine A we can use a command to do it, this will copy content to B automaticly\nssh-copy-id user_B@ip_B\n\n# or we can login machine B, and copy content of id_rsa.pub to ~/.ssh/authorized_keys\nscp .ssh/id_rsa.pub user_B@ip_B:/tmp\nssh user_B@ip_B\nmkdir ~/.ssh\ntouch ~/.ssh/authorized_keys\ncat /tmp/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys\n\n\n\nafter the two steps, A can connect to B without password.\nissuesconnect to an old version ssh serverUnable to negotiate with x.x.x.x port 22: no matching host key type found. Their offer: ssh-rsa fatal: Could not read from remote repository.\nthis problem comes when the remote ssh encryption method is too old/weak such as isa1. since isa1 method  will be regarded unsafe.\nin order to resolve this problem, there comes two methods:\n\nupgrade remote ssh version and then use the new encryption method such as isa2\n\nwrite a config in ~/.ssh/config, allow the connection specified\n\n\nHost 192.168.1.80\n    User root\n    PubkeyAcceptedAlgorithms +ssh-rsa\n    HostkeyAlgorithms +ssh-rsa\n\nssh tunnelthere are two parts.\n\nlocal port forwarding\nremote port forwarding\n\n\n\nlocal port forwarding\n\naccess local ip with port 8888 with redirect to remote server 192.168.1.3 with port 8080 though ssh server 44.11.22.33\nssh -L local_port:remote_ip:remote_port ssh_user@ssh_ip\n\neg:\nssh -L 10000:192.168.31.84:8080 root@192.168.31.116\n\nabove means i can visit http://localhost:10000 in my pc to visit remote http://192.168.31.84:8080 though ssh server 192.168.31.116. it builds a ssh tunnel between local and ssh server.\nremote port forwarding\nif any outside machine wanna to access local network service, we can create a ssh tunnel between local network machine with a outside ssh server, then any request to ssh server will redirect to local network service.\nany request to ssh server 44.11.22.33 with port 8888 will redirect to 10.0.0.3 with port 8080.\nssh -R remote_port:local_ip:local_port user@remote_ssh_ip\n\nmuch more important for remote port forwarding\n# 192.168.31.214 has a website\n# my machine and 192.168.31.214 are the same network, my machine and 192.168.31.221 are the other same network\n# execute this command in my machine will create a ssh tunnel between my machine and 221\n# then we can visit the website though https://192.168.31.221:4444\n\nssh -R 4444:192.168.31.214:443 healer@192.168.31.221 -N -f\n# -N : don&#39;t allow to execute command in remote machine\n# -f : run in background\n\n\nNote:\nwhen the ssh tunnel created successfully, we can only access  website in 214 with localhost(described in this article), becase ssh disabled gatewayport by default and it only listen on 127.0.0.1:port [::1]:port. such as:\n\n\nin order to access remote machine with ip address, we need enable gatewayport\nvim /etc/ssh/sshd_config\n\nGatewayPorts yes\n\nthen recreate ssh tunnel in my machine and  restart sshd of 214\n\nthen all will be okay\n","categories":["learn"],"tags":["ssh"]},{"title":"our-body-may-cheat-ourselves.md","url":"/2022/10/23/our-body-may-cheat-ourselves-md/","content":"Our body may cheat ourselves好几个月没有写笔记了，事实上看了很多电视剧或者电影之后都有很多感想需要去写，但是总有一种想法在脑海里，觉得花这个时间好浪费，或者是我已经很久没有calm down了。\n今天主要是想写看《the adam project》亚当计划之后的感想和之前听goggins说的一句话的理解。\ngoggins之前说过一句话：我们的身体会欺骗我们，给我们发送一些虚假的信息，并且他说可以通过大脑控制身体，当身体告诉他已经很累了，但是他可以用大脑告诉身体分泌更多的肾上腺素让自己充满力量。这是需要一个艰苦的训练过程，这也是为什么他说我们其实有能力开发更多的大脑的能力。\n我相信他的观点，我意识到了身体和意识是分离的，当我和别人发生冲突的时候，脚会不自主的抖，也就是胆怯所体现出来的，但是我的意识并没有任何胆怯，身体发送了错误的信息，而且我无法用意识来控制身体平静下来。那么在锻炼的时候身体也会欺骗我们也就不难理解了，他告诉我们很累了，但是其实并没有我们想象中的那么累。这也让我明白the true weak is not our body, but our mind.\nadam project，未来的自己回到2022年，告诉2022年的他，他人生中最美好的时光就是现在。让我有些感触，我想未来的我看到如今的我是怎么样的呢？事实上我们现在的想法和做法决定了未来的自己，而我不想未来的自己回忆起来全是遗憾叹息，我希望未来的自己会为今天所做的决定感到骄傲。这也是为什么我周末还会早起去跑步的原因，我不想和大多数人一样，被慵懒和惬意围绕，在未来回忆起现在的时候会觉得后悔。我不会让whatif发生，因为我要决定未来的样子。\na man is about his memory, 对于这句话有了更多的理解，honor or shame defines a man who we are, but not the future. if we want our future have more worth memory, we need do something now.\n","categories":["think"],"tags":["mind"]},{"title":"pdnsd","url":"/2022/06/05/pdnsd/","content":"PdnsdToday, i find something new, a tool called pdnsd. It stands for persistent dns daemon. With the tool, we can cache normally visit domain (dns) information in our local computer to reduce the time resolving domain name from remote server.\ninstallpacman -S pdnsd\n\nconfigurecp /usr/share/doc/pdnsd/pdnsd.conf /etc/pdnsd.conf\n\nAt first we need to know something about the format of configuration file.\n\n # and /* */ means comment.\nin &#123;&#125; block, we write our configuration.\nthere are several block of server, and we only need one, we need comment others.\nthe rest of the configuration file we don’t need modify and it can work perfect.\n\nwe need to modify server block of dial-up\n\nchange label to resolvconf\nadd ip with our dns\nchange file to our /etc/resolv.conf\n\nat last it looks like this:\nglobal &#123;\n    perm_cache=1024;\n    cache_dir=&quot;/var/cache/pdnsd&quot;;\n#    pid_file = /var/run/pdnsd.pid;\n    run_as=&quot;pdnsd&quot;;\n    server_ip = 127.0.0.1;  # Use eth0 here if you want to allow other\n                # machines on your network to query pdnsd.\n    status_ctl = on;\n#    paranoid=on;       # This option reduces the chance of cache poisoning\n                       # but may make pdnsd less efficient, unfortunately.\n    query_method=udp_tcp;\n    min_ttl=15m;       # Retain cached entries at least 15 minutes.\n    max_ttl=1w;        # One week.\n    timeout=10;        # Global timeout option (10 seconds).\n    neg_domain_pol=on;\n    udpbufsize=1024;   # Upper limit on the size of UDP messages.\n&#125;\n\n# The following section is more appropriate for dial-up connections.\n# Read about how to use pdnsd-ctl for dynamic configuration in the documentation.\nserver &#123;\n    label= resolvconf;\n    ip = 114.114.114.114;\n    file = &quot;/etc/resolv.conf&quot;;  # Preferably do not use /etc/resolv.conf\n    proxy_only=on;\n    timeout=4;\n    uptest=if;\n    interface = enp37s0;\n    interval=10;       # Check the interface every 10 seconds.\n    purge_cache=off;\n    preset=off;\n&#125;\n\nsource &#123;\n    owner=localhost;\n#    serve_aliases=on;\n    file=&quot;/etc/hosts&quot;;\n&#125;\n\n/*\ninclude &#123;file=&quot;/etc/pdnsd.include&quot;;&#125;    # Read additional definitions from /etc/pdnsd.include.\n*/\n\nrr &#123;\n    name=localhost;\n    reverse=on;\n    a=127.0.0.1;\n    owner=localhost;\n    soa=localhost,root.localhost,42,86400,900,86400,86400;\n&#125;\n\n/*\nneg &#123;\n    name=doubleclick.net;\n    types=domain;   # This will also block xxx.doubleclick.net, etc.\n&#125;\n*/\n\n/*\nneg &#123;\n    name=bad.server.com;   # Badly behaved server you don&#39;t want to connect to.\n    types=A,AAAA;\n&#125;\n*/\n\nAnd we also need to change our /etc/resolv.conf‘s  nameserver to 127.0.0.1.\n# cat /etc/resolv.conf\n\nnameserver 127.0.0.1\n\nenable and start servicesudo systemctl enable pdnsd\nsudo systemctl start pdnsd\n\ncheck whether it workswe need a command called nslookup which belongs to a toolset bind.\nsudo pacman -S bind\n\nnow check whether it works\n# nslookup bing.com\n\nServer:         127.0.0.1\nAddress:        127.0.0.1#53\n\nNon-authoritative answer:\nName:   bing.com\nAddress: 13.107.21.200\nName:   bing.com\nAddress: 204.79.197.200\nName:   bing.com\nAddress: 2620:1ec:c11::200\n\n# nslookup google.com\nServer:         127.0.0.1\nAddress:        127.0.0.1#53\n\nNon-authoritative answer:\nName:   google.com\nAddress: 59.24.3.174\n\nwhen the server shows 127.0.0.1 that means it works.\nnow when we visit some websites, our computer can directly go to the stored ip address without resolve it from remote dns server. cheers!\n","categories":["learn"],"tags":["optimized"]},{"title":"pandas","url":"/2022/04/23/pandas/","content":"pandaspandas是python中一个数据处理和科学分析的工具，最为强大的就是数据处理。由于它可以很轻松的处理excel数据，所以也是自动化办公的一个神器。\ninstall使用pip来安装pandas，pip需要先配置国内源，不然下载速度很慢\npip install pandas\n\n处理excel数据，还需要一个插件（openpyxl）来读取/写入excel\n# openpyxl (3.0.3)    - A Python library to read/write Excel 2010 xlsx/xlsm files\npip install openpyxl\n\nthree data type\n\n\n数据结构\n维度\n特点\n\n\n\nSeries\n一维\n同构（数据类型相同），表示一列column\n\n\nDataFrame\n二维\n异构，表示一个表格table\n\n\nPanel\n三维\n异构，使用的少\n\n\n由于具有DataFrame这种二维数据结构，所以可以处理很多类似数据结构的文件，比如：excel，sql，json等\nsimple read write读取数据的时候可以直接指定index列index_col=\n数据如果太长显示不了，可以设置显示宽度pandas.options.display.max_columns=num\nexcelimport pandas as pd\n\n# 写入数据到excel\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,22,24], &quot;score&quot;:[80,90,100]&#125;\ndf = pd.DataFrame(data)\ndf.to_excel(&#39;/home/narcissus/Desktop/1.xlsx&#39;)\n\n# 从excel读取数据\npe = pd.read_excel(&quot;/home/narcissus/Desktop/1.xlsx&quot;, index_col=&#39;name&#39;)\nprint(pe)\n\nmysql需要安装数据库连接驱动\npip install pymysql\n\nimport pandas\nimport pymysql\n\nhost = &#39;192.168.0.105&#39;\nuser = &#39;pi&#39;\npassword = input(&quot;password for mysql connection: &quot;)\ndatabase = &#39;mytestdb&#39;\ncon = pymysql.connect(host,user,password,database)\n\n# 读取数据\ndf = pd.read_sql_query(&#39;select * from ssacount limit 0,10&#39;,con)\nprint(df)\n\n# 可以将数据库中读取到的数据直接写入excel中\ndf.to_excel(&#39;~/Desktop/1.xlsx&#39;)\n\nsqliteimport sqlite3\n\ncon = sqlite3.connect(&quot;testdatabase.db&quot;)\ndf = pd.read_sql_query(&quot;SELECT * FROM ssacount&quot;, con)\nprint(df)\n\njsondf = pd.read_json(&#39;test.json&#39;)\n\ncsv/tsv/txtpandas只有一个read_csv()函数，但是却可以读取这三种文件（文本文件都可以），默认读取csv文件，其分隔符为逗号，所以在读取tsv和txt的时候，要手动设置分隔符sep=&#39;&#39;\ndf = pd.read_csv(&#39;1.csv&#39;)\ndf = pd.read_csv(&#39;1.tsv&#39;, sep=&#39;\\t&#39;)\ndf = pd.read_csv(&#39;1.txt&#39;, sep=&#39;文件中的特殊分隔符号&#39;)\n\n写入值得注意的是在写入文件之前要确保去掉默认的index，需要设置成自己指定的index，否则再读取文件时，会有一个unamed的列（之前的index列）。其实可以用后面学习的skiprows在读取时指定跳过多少行，以及usecols来跳过指定列\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,None,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,None,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\n# 写入文件之前需要去掉默认的index\ndf.set_index(&#39;name&#39;, inplace=True)\ndf.to_excel(&#39;~/Desktop/1.xlsx&#39;)\n# 读取数据时指定index\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, index_col=&#39;name&#39;)\nprint(df)\n\ndf.to_excel(&#39;~/Desktop/1.xlsx&#39;)\n\ndf.to_json(&#39;~/Desktop/test.json&#39;)\n\ndf.to_sql(&#39;ssacount&#39;, con)\n\nPS: 按照目前我的理解，pandas可以完美的完成这些数据文件之间的转换。可以将json，数据库中的数据导入到excel中进行可视化操作。\nDataFrame作为最重要的一个部分，DataFrame包含了几百种方法和操作，可以对数据进行任何的分析与处理。\n创建创建的方式比较多，但通常都是使用dict来创建。\nimport pandas as pd\n\ndata = &#123;\n        &quot;name&quot;:[&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], \n        &quot;age&quot;:[21,22,24], \n        &quot;score&quot;:[80,90,100]\n       &#125;\ndf = pd.DataFrame(data)\nprint(df)\n\n每一对key-value作为一个Series(column)，key作为表头，value作为数据\n自己指定index默认会自动创建一个index列，为从0开始的连续数据。可以自己指定某列为索引列\n# 使用set_index()方法\ndf = df.set_index(&quot;name&quot;)\n\n# 或者在DataFrame中指定index\ndf = pd.DataFrame(data, index=[&#39;一班&#39;,&#39;二班&#39;,&#39;二班&#39;])\n\n需要注意的是这个index的数据是可以重复的，并不需要唯一性\n通过index找出对应数据可以通过loc找出来的条件是设置了index，否则无法找到\nsear = df.loc[&#39;一班&#39;]\nprint(sear)\n\nname     韩信\nage      21\nscore    80\nName: 一班, dtype: object\n\n可以看出index与其对应数据也是一个dict数据类型\n即使设置了index，也可以通过默认的index来查找iloc\nsear = df.iloc[1]\n\n指定header默认header=0,会使用第0行（index为空）/excel中的第一行作为header，即columns\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, header=1)\n\n重新自定义header，能够自定义成功的前提是这个文件本身就没有header，否则原来的header会作为一个数据行成为index=0的那一行\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, header=None)\n# 取指定列\ndf = df[[1,3]]\n# 设置header\ndf.columns = [1,2]\n\n查看开头和结尾# 默认为5行\ndf.head()\ndf.tail()\n\n# 可以自己指定显示多少行\ndf.head(20)\ndf.tail(20)\n\n查看数据信息.info()提供了很重要的一些信息，包括行，列，数据是否为空，数据类型，内存占用等\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,22,24], &quot;score&quot;:[80,80,100]&#125;\ndf = pd.DataFrame(data)\ninfo = df.info()\nprint(info)\n\n&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;\nRangeIndex: 3 entries, 0 to 2\nData columns (total 3 columns):\n #   Column  Non-Null Count  Dtype \n---  ------  --------------  ----- \n 0   name    3 non-null      object\n 1   age     3 non-null      int64 \n 2   score   3 non-null      int64 \ndtypes: int64(2), object(1)\nmemory usage: 200.0+ bytes\nNone\n\n查看行列数.shape提供了一个简单快速查看总行数，列数的信息(rows,columns)\ninfo = df.shape\nprint(info)\n\n(3,3)\n\n添加与去重添加DataFrame\ndf.append()\npandas.concat([])\n\n.append()可以将已有的DataFrame追加。但是index不会自动变化，要是index自动变化，需要调用reset_index(drop=True)\nappend如果需要将Series追加到行后面，必须加一个参数ignore_index=True\nimport pandas as pd\nimport pymysql\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ntmp_df = df.append(df)\nprint(tmp_df)\n\n    name  age  score\n0   韩信   21     80\n1   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n0   韩信   21     80\n1   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ntmp_df = df.append(df).reset_index(drop=True)\nprint(tmp_df)\n\n    name  age  score\n0   韩信   21     80\n1   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n4   韩信   21     80\n5   韩信   21     80\n6   李白   22     80\n7   杜甫   24    100\n\n使用concat默认y轴添加，使用axis=1则x轴添加\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ntmp_df = pd.concat([df,df], axis=0).reset_index(drop=True)\nprint(tmp_df)\n\n添加Seriesimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\nadd = pd.Series(&#123;&#39;name&#39;:&#39;筱倩&#39;, &#39;age&#39;:30, &#39;score&#39;:88&#125;)\ndf = df.append(add, ignore_index=True)\nprint(df)\n\n    name  age  score\n0   韩信   21     80\n1   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n4   筱倩   30     88\n\n添加列df[&#39;column_name&#39;] = []\ntmp_df[&#39;add&#39;] = [i for i in range(max(tmp_df.index)+1)]\n\n找到重复数据df.dumpllicateed(subset=&#39;column_name&#39;)可以找出指定列的重复index，和True/False的Series。那么如何通过index来找到真正的重复数据？可以通过循环，其实更加简单的方式是使用df.iloc[index]定位\nimport pandas as pd\nimport pymysql\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ndum = df.duplicated(subset=&#39;name&#39;)\n# 查看是否存在重复数据\nprint(dum.any())\ndum = dum[dum == True] #可以简化为dum = dum[dum]\ninfo = df.iloc[dum.index]\nprint(info)\n\nTrue\n    name  age  score\n1   韩信   21     80\n\n去重.drop_duplicates()可以将追加的重复数据清除，需要加上inplace=True这个参数，否则不会生效。\n\n默认会对整个表的数据进行去重，如果需要对指定列，那么添加参数subset=&#39;column_name&#39;\n\ntmp_df.drop_duplicates(subset=&#39;score&#39;, inplace=True)\n\n    name  age  score\n0   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n\n.drop_duplicates()的keep参数：\n\nfirst，保留第一次出现的，默认\nlast，保留最后一次出现的\nFalse，去除所有重复数据\n\ntmp_df.drop_duplicates(inplace=True, keep=&#39;first&#39;)\n\n    name  age  score\n0   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n\ntmp_df.drop_duplicates(inplace=True, keep=&#39;last&#39;)\n\n    name  age  score\n1   韩信   21     80\n2   李白   22     80\n3   杜甫   24    100\n\ntmp_df.drop_duplicates(inplace=True, keep=False)\n\nEmpty DataFrame\nColumns: [name, age, score]\nIndex: []\n\n修改通过df[‘column_name’]/df.column_name可以获取Series，通过Series[index]可以获取到指定的值\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ndf.name[1] = &#39;筱倩&#39;\ndf.age[1] = 99\nprint(df)\n\n    name  age  score\n0   韩信   21     80\n1   筱倩   99     80\n2   李白   22     80\n3   杜甫   24    100\n\n替换使用到了df.iloc[index]定位，并用Series进行替换\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\nalert = pd.Series(&#123;&#39;name&#39;:&#39;筱倩&#39;, &#39;age&#39;:30, &#39;score&#39;:88&#125;)\ndf.iloc[1] = alert\nprint(df)\n\n插入行使用到了df[]切片以及追加操作。值得注意的是：在python中可以对list进行切片，但是在pandas中还可以对DataFrame这种二维数据进行切片\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ninsert = pd.Series(&#123;&#39;name&#39;:&#39;筱倩&#39;, &#39;age&#39;:30, &#39;score&#39;:88&#125;)\npart1 = df[:2]\npart2 = df[2:]\ndf = part1.append(insert, ignore_index=True).append(part2).reset_index(drop=True)\nprint(df)\n\n    name  age  score\n0   韩信   21     80\n1   韩信   21     80\n2   筱倩   30     88\n3   李白   22     80\n4   杜甫   24    100\n\n列# num为想插入到第几列前面\ndf.insert(num, column=&#39;column_name&#39;, value=[])\n\n删除行两种方法：\n\n使用到了df.drop(index=[], inplace=True)\n可以使用切片，将需要的数据切出来然后append组合\n\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;韩信&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\ninsert = pd.Series(&#123;&#39;name&#39;:&#39;筱倩&#39;, &#39;age&#39;:30, &#39;score&#39;:88&#125;)\npart1 = df[:1]\npart2 = df[2:]\n# index后面可以跟一个list集合，也可以是一个range()函数\ndf.drop(index=2, inplace=True)\n# 使用切片然后组合\n# df = part1.append(part2).reset_index(drop=True)\nprint(df)\n\n列df.drop(columns=[],inplace=True)\n\ncolumns.columns可获取所有列名，返回的是一个列表\nprint(df.columns)\n\nIndex([&#39;name&#39;, &#39;age&#39;, &#39;score&#39;], dtype=&#39;object&#39;)\n\n.rename()可修改列名\ndf.rename(columns=&#123;&#39;name&#39;:&#39;Name&#39;, &#39;age&#39;:&#39;AGE&#39;&#125;, inplace=True)\n\ncol.lower()搭配列表生成式可以转换小写\ndf.columns = [col.lower() for col in df.columns]\n\nNull数据行清除.isnull()找出null数据，null数据显示True，非空数据显示False\nprint(df.isnull())\n\n.sum()计算总的null数据\nprint(df.isnull().sum())\n\n.dropna()删除有null数据的行，只要有一个null数据就会清除\ndf.dropna(inplace=True)\n\n可以看到这种清除数据的缺点，无法对指定列的Null数据进行清除，所以需要使用到过滤\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,None,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,21,None,24], &quot;score&quot;:[80,80,80,100]&#125;\n# 为了能够找到手动输入的None数据列，对其进行了转换\ndf = pd.DataFrame(data).fillna(0)\n\nmiss = df.loc[df.name == 0 ].index\ndf.drop(index=miss, inplace=True)\nprint(df)\n\n    name   age  score\n0   韩信  21.0     80\n2   李白   0.0     80\n3   杜甫  24.0    100\n\nNull数据列的清除.dropna(axis=1)使用了一个参数axis\ndf.dropna(inplace=True, axis=1)\n\n为什么是1？在我们使用df.shape的时候返回一个tuple，(rows,columns)，可以看出columns的索引为1\n使用mean来填充null数据列.fillna(column_name, inplace=True)如果将有null的数据列都删除的话， 那么数据的缺失会比较大，可以用平均值来填充\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,None,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,None,22,24], &quot;score&quot;:[80,80,80,100]&#125;\ndf = pd.DataFrame(data)\n\n# 取出age列\nage = df[&#39;age&#39;]\n# 取平均值\nage_mean = age.mean()\n# 将age列中的null用平均值填充\nage.fillna(age_mean, inplace=True)\nprint(df)\n\n获取数据描述前面用.info()获取了对DataFrame的描述，但是.describe()可以获取关于数据的描述：包括最大值，最小值，平均值，列数，行数等。既可以是整个DataFrame，也可以是某一列。\n# 整个表\nprint(df.describe())\n# age列\nprint(df[&#39;age&#39;].describe())\n\n查看某列数据相同数据的个数.value_counts()指定列的数据出现个数\nprint(df[&#39;score&#39;].value_counts())\n\n重组DataFrametype(df[&#39;age&#39;])的类型是一个serise，而type(df[[&#39;age&#39;]])的类型是一个DataFrame，所以可以使用这种方式来重新选取需要的列构成新的DataFrame\nnew_df = df[[&#39;name&#39;, &#39;age&#39;]]\nprint(new_df)\n\n数据的过滤在Series的基础上过滤用条件判断来过滤数据：&gt; &lt; == !=等\ninfo = (df[&#39;score&#39;] == 80)\nprint(info)\n\n# 可以得到true of false的返回值\n0     True\n1     True\n2     True\n3    False\n\n如果想要直接得到过滤后的数据\ninfo = df[df[&#39;score&#39;] == 80]\nprint(info)\n\n   name   age  score\n0    韩信  21.0     80\n1   None   NaN     80\n2    李白  22.0     80\n\n还可以使用逻辑判断\ninfo = df[(df[&#39;score&#39;] &gt; 80) | (df[&#39;age&#39;] == 22)]\n\n使用isin()更加简洁\ninfo = df[df[&#39;age&#39;].isin([21,22])]\n\n上面的所有方法都很简洁，但是数据量比较大的时候，效率就比较低\n所以我们需要使用函数来进行过滤，使用.apply()将column传递给函数\ndef filter_score(x):\n    if x == 100:\n        return True\n    else:\n        return False\ninfo = df.loc[df[&#39;score&#39;].apply(filter_score)]\n# 简化\ninfo = df[df[&#39;score&#39;].apply(filter_score)]\n# 简化，其实我不理解为什么可以这么写\ninfo = df[df.score.apply(filter_score)]\n\n可以使用匿名函数简化\ninfo = df[df[&#39;score&#39;].apply(lambda x : x == 100)]\n# 再简化\ninfo = df[df.score.apply(lambda x : x == 100)]\n\n在DataFrame基础上过滤axis=1表示每一行（x轴），axis=0表示每一列（y轴）\ndef filter_score(x):\n    if x.score == 100:\n        return True\n    else:\n        return False\n\ninfo = df.apply(filter_score， axis=1)\nprint(info)\n\n从指定行或列开始读取可能表格并不是从第一行第一列开始写的，所以需要指定从哪里开始读取，否则会出现许多的unamed row和Nan值\nimport pandas as pd \n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;)\nprint(df)\n\n# 这里包含了一个空行，和一个index列，读取的时候会出现这些问题\nUnnamed: 0 Unnamed: 1 Unnamed: 2 Unnamed: 3\n0         NaN       name        age      score\n1         0.0         韩信         21         80\n2         1.0         韩信         22         80\n3         2.0         李白         22         80\n4         3.0         杜甫         24        100\n\n使用skiprows(num)和usecols=[]来选取需要的数据\nimport pandas as pd \n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3])\n# 或者使用列名指定\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[&#39;name&#39;,&#39;age&#39;,&#39;score&#39;])\nprint(df)\n\n# 这样就能读取需要的数据了\n    name  age  score\n0   韩信   21     80\n1   韩信   22     80\n2   李白   22     80\n3   杜甫   24    100\n\n自动填充功能用python来实现excel中拖拽自动填充的功能，生成序列数据进行填充，比较复杂的是日期的处理\n\n连续数据：list赋值\n交叉数据：三目运算\n日期数据：自定义函数\n\nimport pandas as pd\nfrom datetime import date,timedelta\n\ndata = &#123;&#39;name&#39;:[&#39;李白&#39;,&#39;杜甫&#39;,&#39;白居易&#39;,&#39;王维&#39;], &#39;age&#39;:[None,None,None,None], &#39;birthday&#39;:[None,None,None,None], &#39;drink&#39;:[None,None,None,None]&#125;\ndf = pd.DataFrame(data)\nprint(df)\n\n=======================================================================================\n    name   age birthday drink\n0   李白  None     None  None\n1   杜甫  None     None  None\n2  白居易  None     None  None\n3   王维  None     None  None\n=======================================================================================\n\n# 初始化日期\nstart = date(1600,1,31)\n# 定义日期处理函数，传一个开始日期以及添加的月份\ndef add_month(start_date, add_month):\n    tmonth = start_date.month + add_month\n    cyear = start_date.year + tmonth // 12 \n    cmonth = 12 if tmonth % 12  == 0 else tmonth % 12\n    cday = start_date.day\n    # 由于不同月份的天数不同，所以需要考虑\n    if cday &gt; 28:\n        if cmonth == 2:\n            cday = 29 if cyear % 4 == 0 and cyear % 100 != 0 or cyear % 400 == 0 else 28\n        elif cday == 31 and cmonth in [1,3,5,7,8,10,12]:\n            cday = 31\n        elif cday == 31 and cmonth in [2,4,6,9,11]:\n            cday = 30\n    return date(cyear,cmonth,cday)\n\n# 对age进行填充，使用到了list的赋值\ndf[&#39;age&#39;] = [i+20 for i in range(df.shape[1])]\n# 使用循环index，来对每一项进行赋值\nfor i in df.index:\n    # 用到了三目运算，实现交叉数据填充\n    df[&#39;drink&#39;][i] = &#39;like&#39; if i % 2 == 0 else &#39;hate&#39;\n    \n    # day递增的情况：day的相加有对应的函数\n    df[&#39;birthday&#39;][i] = start + timedelta(days=i)\n    # year递增的情况：year的相加可以在year上直接添加\n    df[&#39;birthday&#39;][i] = date(start.year+i, start.month, start.day)\n    # month递增的情况：比较复杂，涉及到year与month进位的问题，调用自定义函数实现\n    df[&#39;birthday&#39;][i] = add_month(start,i+10)\n\nprint(df)\n\n=======================================================================================\n    name  age    birthday drink\n0   李白   20  1600-11-30  like\n1   杜甫   21  1601-12-31  hate\n2  白居易   22  1601-01-31  like\n3   王维   23  1601-02-28  hate\n=======================================================================================\n\n计算功能x轴向乘法使用到了pandas特有的list相乘，以及list展开相乘（这在python语法中是没有的，乘也是list的复制）\nsr1 = pd.Series([21,18,22,24])\nsr2 = pd.Series([80,80,80,100])\ndf = pd.DataFrame(&#123;&#39;A&#39;:sr1, &#39;B&#39;:sr2&#125;)\nprint(df)\n\n# pandas的list乘\ndf[&#39;C&#39;] = df[&#39;A&#39;] * df[&#39;B&#39;]\ndf[&#39;D&#39;] = df[&#39;C&#39;] * 100\n# 可以使用apply()\ndf[&#39;E&#39;] = df[&#39;B&#39;].apply(lambda x:x+2)\n\nprint(df)\n\nA    B\n0  21   80\n1  18   80\n2  22   80\n3  24  100\n    A    B     C       D    E\n0  21   80  1680  168000   82\n1  18   80  1440  144000   82\n2  22   80  1760  176000   82\n3  24  100  2400  240000  102\n\nx轴向求和/平均前面都是使用的Series来进行计算的，如果需要的不止一列的数据呢？比如说需要每一行的和和平均值，当然也可以将所有列写出来计算，但是有点麻烦，其实可以指定轴。它会自动过滤掉文字列，只计算数字列。(索引不会计算)\naxis=1指定x轴，按行计算，从上到下\nimport pandas as pd\ndf1 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet1&#39;)\ndf2 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet2&#39;)\n\ntable = df1.join(df2, how=&#39;left&#39;).fillna(0)\ntable[&#39;qq&#39;] = table[&#39;qq&#39;].astype(int)\n\ntable[&#39;sum&#39;] = table.sum(axis=1)\ntable[&#39;mean&#39;] = table.mean(axis=1).astype(int)\nprint(table)\n\n    name  age  score student          qq         sum        mean\n0   韩信   21     80      韩信   124242423   124242524    62121262\n1   赵云   22     10      赵云    12342356    12342388     6171194\n2   李白   22     30      李白   574534563   574534615   287267307\n3   杜甫   24    100      杜甫     6785842     6785966     3392983\n4   曹操   18     75      曹操    34563342    34563435    17281717\n5   姜尚   45     75      姜尚    57845262    57845382    28922691\n6   阿狗   23     11      阿狗    45645834    45645868    22822934\n7   筱倩    3     99      筱倩    58364743    58364845    29182422\n8   夫子  123    107      夫子  4824854834  4824855064  2412427532\n9   葛聂   33     90       0           0         123          61\n\ny轴向求和/平均并添加到DataFrame\n必须设置ignore_index=True，否则无法添加\n\nimport pandas as pd\ndf1 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet1&#39;)\ndf2 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet2&#39;)\n\ntable = df1.join(df2, how=&#39;left&#39;).fillna(0)\ntable[&#39;qq&#39;] = table[&#39;qq&#39;].astype(int)\n\n# 这里省略了axis=0,因为这是默认值\ntotal = table.mean()\nsum = table.sum()\n# total为一个Series，可以设置name值\ntotal[&#39;name&#39;] = &#39;平均值&#39;\nsum[&#39;name&#39;] = &#39;总和&#39;\n# 将Nan转为空\ntable = table.append([total,sum], ignore_index=True).fillna(&#39;&#39;)\nprint(table)\n\nname    age  score student            qq\n0    韩信   21.0   80.0      韩信  1.242424e+08\n1    赵云   22.0   10.0      赵云  1.234236e+07\n2    李白   22.0   30.0      李白  5.745346e+08\n3    杜甫   24.0  100.0      杜甫  6.785842e+06\n4    曹操   18.0   75.0      曹操  3.456334e+07\n5    姜尚   45.0   75.0      姜尚  5.784526e+07\n6    阿狗   23.0   11.0      阿狗  4.564583e+07\n7    筱倩    3.0   99.0      筱倩  5.836474e+07\n8    夫子  123.0  107.0      夫子  4.824855e+09\n9    葛聂   33.0   90.0       0  0.000000e+00\n10  平均值   33.4   67.7          5.739179e+08\n11   总和  334.0  677.0          5.739179e+09\n\n排序.sort_values(by=[],inplace=True,ascending=[False])\n默认生成一个新的DataFrame，使用inplace=True在原DataFrame上修改\n默认使用升序排列，用ascending=False来降序排列\n\n对一列数据进行排序\n\nimport pandas as pd\n\nsr2 = pd.Series([21,18,22,22,24])\nsr3 = pd.Series([80,80,60,80,100])\ndf = pd.DataFrame(&#123;&#39;A&#39;:sr2, &#39;B&#39;:sr3&#125;)\ndf.set_index(&#39;A&#39;, inplace=True)\ndf.sort_values(by=&#39;A&#39;, inplace=True, ascending=False)\nprint(df)\n\n\n对多列数据进行排序，而且第一列倒序，第二列升序\n\nimport pandas as pd\n\nsr2 = pd.Series([21,18,22,22,24])\nsr3 = pd.Series([80,80,60,80,100])\ndf = pd.DataFrame(&#123;&#39;A&#39;:sr2, &#39;B&#39;:sr3&#125;)\ndf.set_index(&#39;A&#39;, inplace=True)\ndf.sort_values(by=[&#39;A&#39;,&#39;B&#39;], inplace=True, ascending=[False,True])\nprint(df)\n\n数据相关性之前在一篇文章中看到df.corr()时，没看懂它到底什么意思，有什么作用。今天看了老师讲的视频，才发现这个东西超级无敌厉害。它就是分析一个表中每两列数据之间的相关性的。\n\n1.0代表完全相关\n比例越大，相关性越大\n\nimport pandas as pd\n\nsr2 = pd.Series([21,18,22,22,24])\nsr3 = pd.Series([80,80,60,80,100])\ndf = pd.DataFrame(&#123;&#39;age&#39;:sr2, &#39;score&#39;:sr3&#125;)\ndf.corr()\n\n\n# 可以看出score与age之间的相关性比较小，仅有0.3\n            age    score\nage        1.000000    0.322749\nscore    0.322749    1.000000\n\n从不同sheet页读取import pandas as pd\ndf1 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet1&#39;)\ndf2 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet2&#39;)\n\nprint(df1)\nprint(df2)\n# table = df1.merge(df2, on=&#39;name&#39;)\n# print(table)\n    name  age  score\n0   韩信   21     80\n1   赵云   22     10\n2   李白   22     30\n3   杜甫   24    100\n4   曹操   18     75\n5   姜尚   45     75\n6   阿狗   23     11\n7   筱倩    3     99\n8   夫子  123    107\n9   葛聂   33     90\n  name          qq\n0   韩信   124242423\n1   赵云    12342356\n2   李白   574534563\n3   杜甫     6785842\n4   曹操    34563342\n5   姜尚    57845262\n6   阿狗    45645834\n7   筱倩    58364743\n8   夫子  4824854834\n\n多表联合查询用到了与数据库类似的操作，merge两个DataFrame，默认为inner join,可以设置left/right join\n\ndf.merge()需要指定关联的列，具有内连接，左/右连接\ndf.join()默认使用index作为关联的列，不具有内连接，左/右连接\npandas.concat([],axis=num)\n\nimport pandas as pd\ndf1 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet1&#39;)\ndf2 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet2&#39;)\n\ntable = df1.merge(df2, on=&#39;name&#39;)\nprint(table)\n\n    name  age  score          qq\n0   韩信   21     80   124242423\n1   赵云   22     10    12342356\n2   李白   22     30   574534563\n3   杜甫   24    100     6785842\n4   曹操   18     75    34563342\n5   姜尚   45     75    57845262\n6   阿狗   23     11    45645834\n7   筱倩    3     99    58364743\n8   夫子  123    107  4824854834\n\n可以发现默认是使用的inner join，要df1的数据全部显示出来，使用left join方式\ntable = df1.merge(df2, how=&#39;left&#39;, on=&#39;name&#39;)\n\n如果要关联的两张表的columns名字不同，那么不能使用on，而需要使用left_on=&#39;&#39;,right_on=&#39;&#39;来连接\n    name  age  score\n0   韩信   21     80\n1   赵云   22     10\n2   李白   22     30\n3   杜甫   24    100\n4   曹操   18     75\n5   姜尚   45     75\n6   阿狗   23     11\n7   筱倩    3     99\n8   夫子  123    107\n9   葛聂   33     90\n\n  student          qq\n0      韩信   124242423\n1      赵云    12342356\n2      李白   574534563\n3      杜甫     6785842\n4      曹操    34563342\n5      姜尚    57845262\n6      阿狗    45645834\n7      筱倩    58364743\n8      夫子  4824854834\n\n关联之后数据会出现Nan值，使用fillna()函数来填充null\n如果显示的是小数或者科学计数，可以使用astype()设置为数据类型\nimport pandas as pd\n\ndf1 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet1&#39;)\ndf2 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet2&#39;)\n\ntable = df1.merge(df2, how=&#39;left&#39;, left_on=&#39;name&#39;, right_on=&#39;student&#39;).fillna(0)\ntable[&#39;qq&#39;] = table[&#39;qq&#39;].astype(int)\nprint(table)\n\n    name  age  score student          qq\n0   韩信   21     80      韩信   124242423\n1   赵云   22     10      赵云    12342356\n2   李白   22     30      李白   574534563\n3   杜甫   24    100      杜甫     6785842\n4   曹操   18     75      曹操    34563342\n5   姜尚   45     75      姜尚    57845262\n6   阿狗   23     11      阿狗    45645834\n7   筱倩    3     99      筱倩    58364743\n8   夫子  123    107      夫子  4824854834\n9   葛聂   33     90       0           0\n\n使用join()函数\nimport pandas as pd\ndf1 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet1&#39;)\ndf2 = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, sheet_name=&#39;Sheet2&#39;)\n\ntable = df1.join(df2, how=&#39;left&#39;).fillna(0)\ntable[&#39;qq&#39;] = table[&#39;qq&#39;].astype(int)\nprint(table)\n\n    name  age  score student          qq\n0   韩信   21     80      韩信   124242423\n1   赵云   22     10      赵云    12342356\n2   李白   22     30      李白   574534563\n3   杜甫   24    100      杜甫     6785842\n4   曹操   18     75      曹操    34563342\n5   姜尚   45     75      姜尚    57845262\n6   阿狗   23     11      阿狗    45645834\n7   筱倩    3     99      筱倩    58364743\n8   夫子  123    107      夫子  4824854834\n9   葛聂   33     90       0           0\n\n数据列分割使用到了Series.str.split()方法，另外Series.str有很多方法可以用，可以对字符串进行各种操作。\nimport pandas as pd \n\ndata = &#123;&#39;A&#39;:[&quot;hello joyce&quot; for i in range(1,8)]&#125;\ndf = pd.DataFrame(data)\n# 不使用expand，那么数据会作为一个list\ninfo = df.A.str.split(expand=True)\ndf[&#39;first&#39;] = info[0]\ndf[&#39;last&#39;] = info[1]\nprint(df)\n\n行列转换df.transpose()即可，为了避免旋转后第一行为index，所以在读取的时候需要指定index\nimport pandas as pd\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, index_col=&#39;name&#39;)\ndf = df.transpose()\nprint(df)\n\n提取日期pandas.DatetimeIndex(df[&#39;column_name&#39;]).year\npandas.DatetimeIndex(df[&#39;column_name&#39;]).month\npandas.DatetimeIndex(df[&#39;column_name&#39;]).day\n\n分组，聚合模拟透视表功能\nimport pandas as pd\nimport numpy as np\n\ndf.pivot_table(index=&#39;column_name&#39;, columns=&#39;column_name&#39;, value=&#39;column_name&#39;, aggfunc=np.sum)\n\n分组\ngroups = df.groupby(&#39;column_name&#39;)\n\n聚合\nS = groups[&#39;column_name&#39;].sum()\n\n条件颜色import pandas as pd \n\ndef colorlize(x):\n    colors = &#39;orange&#39; if x &lt; 60 else &#39;lime&#39;\n    # 这里返回的格式必须要是这样\n    return f&#39;color:&#123;colors&#125;&#39;\n\ndef another(x):\n    # 这里需要返回一个list\n    return [&#39;color:red&#39; if v &gt; 90 else &#39;background-color:black&#39; for v in x] \n    \ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;)\n\n# 可直接添加在后面\n# df.style.apply(another, subset=[&#39;age&#39;,&#39;score&#39;])\ndf.style.applymap(colorlize, subset=[&#39;age&#39;,&#39;score&#39;]).apply(another, subset=[&#39;age&#39;,&#39;score&#39;])\n\n\n需要注意的：\n\ndf.style.applymap()获取到的是每一个值\ndf.style.apply()获取到的是一个Series，但是需要用for循环读取每一个值，这和之前用的df.apply()自动循环每一个值不同\n\n颜色条import pandas as pd \n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;)\ndf.style.bar(color=&#39;pink&#39;, subset=[&#39;age&#39;,&#39;score&#39;])\n\n\n渐变颜色需要下载seaborn模块\npip install seaborn\n\nimport pandas as pd \nimport seaborn as sn\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;)\ncolor_map = sn.light_palette(&#39;pink&#39;, as_cmap=True)\n\ndf.style.background_gradient(color_map, subset=[&#39;age&#39;, &#39;score&#39;])\n\n\n\nSeriesSeries序列用来生成一维数据。类似list数据类型\nimport pandas as pd\n\ndata = &#123;&quot;name&quot;:[&quot;韩信&quot;,&quot;貂蝉&quot;,&quot;李白&quot;,&quot;杜甫&quot;], &quot;age&quot;:[21,18,22,24], &quot;score&quot;:[80,80,80,100]&#125;\nsr = pd.Series(data)\nprint(sr)\n\nname      [韩信, 貂蝉, 李白, 杜甫]\nage       [21, 18, 22, 24]\nscore    [80, 80, 80, 100]\n\nSeries组装DataFrame\n使用dict组装。不指定index时，使用默认的index\n\nimport pandas as pd\n\nsr1 = pd.Series([&quot;韩信&quot;,&quot;貂蝉&quot;,&quot;李白&quot;,&quot;杜甫&quot;])\nsr2 = pd.Series([21,18,22,24])\nsr3 = pd.Series([80,80,80,100])\ndf = pd.DataFrame(&#123;&#39;name&#39;:sr1, &#39;age&#39;:sr2, &#39;score&#39;:sr3&#125;)\nprint(df)\n\n  name  age  score\n0   韩信   21     80\n1   貂蝉   18     80\n2   李白   22     80\n3   杜甫   24    100\n\n\n还可以手动指定index\n\nimport pandas as pd\n\nsr1 = pd.Series([&quot;韩信&quot;,&quot;貂蝉&quot;,&quot;李白&quot;,&quot;杜甫&quot;], index=(1,2,3,4), name=&#39;name&#39;)\nsr2 = pd.Series([21,18,22,24], index=(1,2,3,4), name=&#39;age&#39;)\nsr3 = pd.Series([80,80,80,100], index=(1,2,3,4))\ndf = pd.DataFrame(&#123;sr1.name:sr1, sr2.name:sr2, sr3.name:sr3&#125;)\nprint(df)\n\n  name  age  NaN\n1   韩信   21   80\n2   貂蝉   18   80\n3   李白   22   80\n4   杜甫   24  100\n\n\n使用list组装。如果不指定index和name，那么会用默认的index来填充columns和index\n\nimport pandas as pd\n\nsr1 = pd.Series([&quot;韩信&quot;,&quot;貂蝉&quot;,&quot;李白&quot;,&quot;杜甫&quot;],  index=(1,2,3,4), name=&#39;name&#39;)\nsr2 = pd.Series([21,18,22,24], index=(1,2,3,4), name=&#39;age&#39;)\nsr3 = pd.Series([80,80,80,100], index=(1,2,3,4), name=&#39;score&#39;)\ndf = pd.DataFrame([sr1, sr2, sr3])\nprint(df)\n\n        1   2   3    4\nname   韩信  貂蝉  李白   杜甫\nage    21  18  22   24\nscore  80  80  80  100\n\n可以发现，使用list来组装DataFrame时，会将Series以行的形式展示。如果用dict来组装，那么会将Series以列的形式组装。\nDataFrame取出Series两种方式：\n\n这种就是python自身的语法，DataFrame由字典组成，所以使用df[&#39;column_name&#39;]即可\n使用pandas DataFrame数据结构的语法，df.column_name也可以\n\n\n制图pandas是构建于matplotlib之上，所以需要先下载\n# matplotlib (3.2.1)                 - Python plotting package\npip install matplotlib\n\n使用到的数据：\n\n柱状图第一个例子：\nimport pandas as pd \nimport matplotlib.pyplot as plt\n\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3,4])\n# 先排score，再排age，从大到小\ndf.sort_values(by=[&#39;score&#39;,&#39;age&#39;], inplace=True, ascending=False)\n# pandas支持制图\ndf.plot.bar(x=&#39;name&#39;, y=[&#39;score&#39;,&#39;age&#39;], color=[&#39;lightblue&#39;,&#39;orange&#39;])\n# 紧凑显示\nplt.tight_layout()\n# 使用matplotlib来渲染\nplt.show()\n\n\n中文支持默认matplotlib无法显示中文，需要从matplotlib导入font_manager\nfrom matplotlib import font_manager\n\n查看有那些中文字体\nfc-list :lang=zh\n\n/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc: WenQuanYi Micro Hei,文泉驛微米黑,文泉驿微米黑:style=Regular\n/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc: WenQuanYi Micro Hei Mono,文泉驛等寬微米黑,文泉驿等宽微米黑:style=Regular\n\n设置font变量\nfont = font_manager.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\n在需要显示中文的地方加上fontproperties属性。需要注意只有matplotlib才能加这个属性，所以在需要加这个属性的时候，要用matplotlib来设置\nplt.xticks(rotation=40, fontproperties=font)\n\n使用matplotlib修饰matpllotlib比pandas自带的制图功能要多，可定制性更强。导入matplotlib的作用呢就是来补充pandas自身制图功能的一些不足，以及渲染图片。\n由于pandas基于matplotlib，所以这两个可完美的搭配使用。在pandas搞不定的地方就用matplotlib来补充\n分组柱状图import pandas as pd \nimport matplotlib.pyplot as plt\nfrom matplotlib import font_manager\n\nfont = font_manager.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\n# 读取\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3,4])\n# 排序\ndf.sort_values(by=[&#39;score&#39;,&#39;age&#39;], inplace=True, ascending=False)\n# 用pandas自身绘制分组柱状图\ndf.plot.bar(x=&#39;name&#39;, y=[&#39;score&#39;,&#39;age&#39;], color=[&#39;lightblue&#39;,&#39;orange&#39;])\n# pandas自身绘图的标签不支持中文，那么用matplotlib来让标签显示中文，以及设置一定旋转角度\n# plt.xticks(rotation=20, fontproperties=font, fontsize=14)\n# 上面这个无法设置旋转中心，所以使用下面的\n# gca获取x轴，ha=&#39;right&#39;设置右端对齐\npx = plt.gca()\npx.set_xticklabels(df[&#39;name&#39;], rotation=20, ha=&#39;right&#39;, fontproperties=font, fontsize=14)\n# gcf获取图形的布局\npf = plt.gcf()\npf.subplots_adjust(left=0.1)\n# 用matplotlib来设置x轴名称\nplt.xlabel(&#39;name&#39;, fontsize=20)\n# 用matplotlib来设置y轴名称\nplt.ylabel(&#39;score&#39;, fontsize=20)\n# 用matplotlib来设置title\nplt.title(&#39;学习情况统计表&#39;, fontproperties=font, fontsize=24, color=&#39;lightpink&#39;)\nplt.tight_layout()\nplt.show()\n\n\n叠加柱状图\n需要自己新计算一个新的列，这个列的值为需要叠加的数据之和\n使用这个新的列作为排序的标准\ny轴仍然为之前的列\n只不过在df.plot.bar显示的时候加了一个参数stacked=True，声明使用叠加的方式\n\nimport pandas as pd \nimport matplotlib.pyplot  as plt \nfrom matplotlib import font_manager\n\nfont = font_manager.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, usecols=[1,2,3,4,5], skiprows=1)\ndf[&#39;total&#39;] = df[&#39;age&#39;] + df[&#39;score&#39;]\ndf.sort_values(by=&#39;total&#39;, inplace=True, ascending=False)\ndf.plot.bar(x=&#39;name&#39;, y=[&#39;score&#39;, &#39;age&#39;], color=[&#39;brown&#39;,&#39;pink&#39;], stacked=True)\npx = plt.gca()\npx.set_xticklabels(df[&#39;name&#39;], rotation=10, ha=&#39;right&#39;, fontproperties=font)\nplt.xlabel(&#39;name&#39;)\nplt.ylabel(&#39;count&#39;)\nplt.title(&#39;学习情况统计&#39;, fontproperties=font, fontsize=22, fontweight=&#39;bold&#39;)\nplt.show()\n\n\n水平叠加柱状图其实只需要改一个参数就可以了，将df.plot.bar改为df.plot.barh就代表水平展示了。\n\n这个时候的排序可能需要调整一下\n如果自定义了x轴，y轴的话，需要交换一下\n\nimport pandas as pd \nimport matplotlib.pyplot  as plt \nfrom matplotlib import font_manager\n\nfont = font_manager.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, usecols=[1,2,3,4,5], skiprows=1)\ndf[&#39;total&#39;] = df[&#39;age&#39;] + df[&#39;score&#39;]\ndf.sort_values(by=&#39;total&#39;, inplace=True)\ndf.plot.barh(x=&#39;name&#39;, y=[&#39;score&#39;, &#39;age&#39;], color=[&#39;brown&#39;,&#39;pink&#39;], stacked=True)\npx = plt.gca()\npx.set_yticklabels(df[&#39;name&#39;], rotation=10, ha=&#39;right&#39;, fontproperties=font)\nplt.xlabel(&#39;count&#39;)\nplt.ylabel(&#39;name&#39;)\nplt.title(&#39;学习情况统计&#39;, fontproperties=font, fontsize=22, fontweight=&#39;bold&#39;)\nplt.show()\n\n\n饼图绘制饼图的优点是可以清晰的看出各部分所占的比例\n与柱状图不同，饼图需要的数据为一个Series，同时在读取数据的时候指定的index会成为饼图显示的信息\n\n饼图注意点还挺多的，最为重要的就是使用pandas来绘制，无法显示中文，所以采用了plt来绘制\n采用matplotlib时，也无法直接设置字体，需要用循环给具体的对象赋值\n对序列排序，并通过绘制时的顺时针来设置旋转方向\n通过startangle来设置最大值从12点方向开始\n\nimport pandas as pd \nfrom matplotlib import font_manager as fm \nfrom matplotlib import pyplot as plt \n\nfont = fm.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3,4])\n# 为了顺序显示，进行排序。这里没有从大到小排是因为后面绘制的时候可以使用counterclock来设置顺时针排序\ndf.sort_values(by=&#39;score&#39;, inplace=True)\n# 使用pandas自身的绘图，无法显示中文，所以不采用\n# df[&#39;score&#39;].plot.pie(labels=df[&#39;name&#39;])\n# 使用matplotlib来绘制图形，label为标签名\npaint = plt.pie(df[&#39;score&#39;], labels=df[&#39;name&#39;], counterclock=True, startangle=-270)\n# 即便是通过matplotlib来绘制，中文也不好显示，只能通过返回值来找到text所在位置，并循环设置中文字体\nfor i in df.index:\n    paint[1][i].set_fontproperties(font)\nplt.title(&#39;学习情况统计&#39;, fontproperties=font, fontsize=22, fontweight=&#39;bold&#39;)\n# ylabel来设置左边显示文字\nplt.ylabel(&#39;score&#39;, fontsize=16)\nplt.show()\n\n对数据进行排序之后会出现，比例较小的部分字重叠，这也是一个问题。\n\n所以不对其进行排序显示的效果可能会更好。\n\n折线图\n折线图在绘制的时候，只要直接使用.plot就可以了。需要指定y轴的数据\nx轴的数据可以通过指定index来设置\n\nimport pandas as pd \nfrom matplotlib import pyplot as plt \nfrom matplotlib import font_manager as fm \n\nfont = fm.FontProperties(fname=&#39;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&#39;)\ndata = &#123;&#39;score&#39;:[45,76,56,100,93], &#39;age&#39;:[16,18,24,29,35]&#125;\ndf = pd.DataFrame(data)\ndf.plot(y=[&#39;score&#39;,&#39;age&#39;])\n\nplt.title(&#39;年龄与分数走势图&#39;,fontproperties=font, fontsize=22)\nplt.xlabel(&#39;time&#39;)\nplt.xticks(df.index)\nplt.ylabel(&#39;count&#39;)\nplt.show()\n\n\n叠加区域图只需要在折线图的基础上将.plot改为.plot.area即可\ndf.plot.area(y=[&#39;score&#39;,&#39;age&#39;])\n\n\n散点图散点图就可以看出pandas的处理速度完胜excel，同时交换x，y轴数据，pandas可以轻松搞定，而excel在数据量多的时候无法操作。\n\n使用到了df.plot.scatter()来画散点图\n\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nfrom matplotlib import font_manager as fm \n\nfont = fm.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3,4])\ndf.plot.scatter(x=&#39;score&#39;, y=&#39;age&#39;, color=&#39;brown&#39;)\nplt.title(&#39;学习与年龄散点图&#39;, fontproperties=font, fontsize=22)\nplt.show()\n\n\n分布图可以清晰的看出指定数据的分布情况。分布图只需要Series就可以\n\n使用了Series.plot.hist(bins=num)\n参数bins设置划分区间，越多图越精细\nplt.xticks()设置x轴的分段，默认Series分段少，使用range()函数，来设置步长\n\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nfrom matplotlib import font_manager as fm \n\nfont = fm.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3,4])\ndf[&#39;score&#39;].plot.hist(bins=10)\nplt.xticks(range(0,max(df[&#39;score&#39;]),4), rotation=90)\nplt.xlabel(&#39;score&#39;)\nplt.title(&#39;分数分布图&#39;, fontproperties=font, fontsize=20)\nplt.show()\n\n\n密度图直接使用会报错，提示缺少一个scipy的科学库\n# scipy (1.4.1)                   - SciPy: Scientific Library for Python\npip install scipy\n\n密度图同样使用Series\n\n使用Series.plot.kde(),其它与分布图类似\n\nimport pandas as pd\nfrom matplotlib import pyplot as plt\nfrom matplotlib import font_manager as fm \n\nfont = fm.FontProperties(fname=&quot;/usr/share/fonts/wenquanyi/wqy-microhei/wqy-microhei.ttc&quot;)\n\ndf = pd.read_excel(&#39;~/Desktop/1.xlsx&#39;, skiprows=1, usecols=[1,2,3,4])\ndf[&#39;score&#39;].plot.kde()\nplt.xlabel(&#39;score&#39;)\nplt.title(&#39;密度分布图&#39;, fontproperties=font, fontsize=20)\nplt.show()\n\n\n\n终于一口气学完了这个模块，感觉功能确实很多，而且没学到的功能还有很多。但是就目前掌握的这些来说，写个自动化办公的脚本来说已经够了。数据的读取，增删查改，制图等等功能都很好用。虽然是一边看视频，一边敲代码，但是熟悉程度还不够，还的在日常的生活中多用才会熟练。学完一个东西觉得很开心，但是又觉得有点失落，因为我接下来要学什么呢？是个很大的问题。要不学学powershell吧！\n","categories":["learn"],"tags":["python"]},{"title":"podman","url":"/2022/04/23/podman/","content":"podman# create a container\npodman run -it -d --name ubuntu ubuntu\n\n# find container pid\ncontainer_pid=`podman inspect -f &#123;&#123;.State.Pid&#125;&#125; container_name`\n\n# execute host command in container(only used for network command)\n# useful for the container have no ip command\nsudo nsenter -t $container_pid -n command\n\n","categories":["learn"],"tags":["container"]},{"title":"rancher","url":"/2022/04/23/rancher/","content":"\nrancher + k8s\n\nubunturancherrancher是用来简化k8s集群管理的图形化web工具，它是运行在docker容器中的一个软件，所以安装rancher需要主机安装了docker，然后简单的通过一个命令将容器跑起来就可以了\n安装运行# 下面这种方式，即使添加了国内源下载速度依然很慢\ndocker pull rancher/server\n\n# 使用下面的命令下载很快\ndocker run -d -p 443:443 --name rancher --restart=unless-stopped \\\n    -e CATTLE_AGENT_IMAGE=&quot;registry.cn-hangzhou.aliyuncs.com/rancher/rancher-agent:v2.4.2&quot; \\\n    registry.cn-hangzhou.aliyuncs.com/rancher/rancher:v2.4.2\n\n运行上面的命令后会进行镜像下载及运行。然后查看容器的ip，即可进行rancher的网页访问\n# 查看ipaddress\ndocker inspect rancher\n\n访问rancher页面https://localhost:443或者https://172.17.0.2。首次运行需要设置admin用户密码，设置为admin\n\n主界面\n\n设置默认镜像源为registry.cn-hangzhou.aliyuncs.com\n\nk8sk8s是用来集群化管理docker容器的一个工具，它直接安装在物理机中，依赖docker运行，所以如果要安装k8s首先是安装并配置好docker（docker还需进行一些特殊化配置）\ndocker安装以ubuntu下的安装举例\n安装docker\napt install docker.io\n\n修改cgroups，同时添加国内源\n# k8s使用的是systemd来进行进程隔离的，但docker默认使用cgroups，所以需要修改docker的进程隔离为systemd\n\nvi /etc/docker/daemon.json\n&#123;\n  &quot;registry-mirrors&quot;: [\n    &quot;https://dockerhub.azk8s.cn&quot;,\n    &quot;https://reg-mirror.qiniu.com&quot;,\n    &quot;https://quay-mirror.qiniu.com&quot;\n  ],\n  &quot;exec-opts&quot;: [ &quot;native.cgroupdriver=systemd&quot; ]\n&#125;\n\n重启docker\nsystemctl daemon-reload\nsystemctl enable docker\nsystemctl start docker\n\n检查是否修改成功\ndocker info | grep -i cgroups\n\nk8s安装主要组件\nkubelet 后台服务\nkubeadm 集群部署操作\nkubectl 普通用户操作\n\n安装k8s不能使用swap分区，需要提前关闭\n# 手动关闭开启的swap分区\nswapoff -a\n\n# 注释/etc/fstab中swap分区的信息\n\n*ubuntu的相关配置\n# 使得 apt 支持 ssl 传输\napt-get update &amp;&amp; apt-get install -y apt-transport-https\n# 下载 gpg 密钥\ncurl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - \n# 添加 k8s 镜像源\ncat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\napt-get update\napt-get install -y kubelet kubeadm kubectl\n\n查看版本会报错，是因为还没有配置网络，可以忽略\nkubectl version\n\nThe connection to the server localhost:8080 was refused - did you specify the right host or port?\n\nk8s配置master节点安装：\n\n初始化master节点\n部署flannel网络\n配置kubectl工具\n\n初始化节点使用init进行初始化，其它参数如下：\napiserver-advertise-address为apiserver的ip，填写本机ip\nimage-repository指定docker的源，初始化时需要进行在线docker镜像源的下载，如果不配置则会下载失败\npod-network-cidr指定k8s的节点网络，k8s集群之间使用此网段进行通信，默认为10.244.0.0/16\nignore-preflight-errors如果出现报错时，可以进行忽略，例如虚拟机中的cpu个数为1时会报错\nkubeadm init \\\n--apiserver-advertise-address=192.168.1.10 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--pod-network-cidr=10.244.0.0/16 \\\n--ignore-preflight-errors=CpuNum\n\n运行成功后输出，最后的join语句为其它集群加入k8smaster节点需要运行的命令，如果丢失可在master节点使用kubeadm token create --print-join-command重新生成。如果过程中断可以使用kubeadm reset重置后再次初始化\n\n配置kubectl  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n然后查看是否可用kuberctl\n# 查看已加入的节点\nkubectl get nodes\n# 查看集群状态\nkubectl get cs\n\n配置flannel网络kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml\n\n使用这个命令运行之后会报错Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|0.0.0.0|:443... failed: Connection refused.。百度上说是因为域名污染，在/etc/hosts文件中添加对应的ip\n199.232.28.133  raw.githubusercontent.com\n\n之后再使用，依旧会报错，错误为199.232.28.133  raw.githubusercontent.com\n使用wget下载文件报ssl错误，不过在archlinux上可以使用wget下载一个yml文件，然后将此文件通过ssh传到ubuntu上\n wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n手动加载此配置文件\nkubectl apply -f kube-flannel.yml\n\n\n然后查看集群状态就ok了\nkubectl get nodes\n\n\n\ncentoscentos下的docker安装就比较麻烦，首先是docker安装需要三个软件:docker-ce,docker-ce-cli,containerd.io，同时在centos8上的docker-ce要求container版本大于1.4，然而仓库中的版本为1.3，所以需要手动在网上下载container1.4的版本并安装，然后使用yum命令在线安装docker-ce和docker-ce-cli\ndocker更新源系统的镜像源没有提供docker的安装包，需要自己添加。命令yum-config-manager命令来进行添加源，此命令需要先安装yum-utils，device-mapper-persistent-data ，lvm2\nyum install -y  yum-utils device-mapper-persistent-data lvm2\n\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n下载container在官网链接下载container1.4版本，并进行安装\nwget https://download.docker.com/linux/centos/8/x86_64/stable/Packages/containerd.io-1.4.3-3.1.el8.x86_64.rpm\n\nyum install -y ./containerd.io-1.4.3-3.1.el8.x86_64.rpm\n\n安装dockeryum install -y docker-ce docker-cli\n\n修改cgroupvi /etc/docker/daemon.json\n&#123;\n  &quot;exec-opts&quot;: [ &quot;native.cgroupdriver=systemd&quot; ]\n&#125;\n\n启动dockersystemctl enable docker\nsystemctl start docker\n\nrancher下载rancher的docker镜像并启动\ndocker run -d -p 443:443 --name rancher --restart=unless-stopped \\\n    -e CATTLE_AGENT_IMAGE=&quot;registry.cn-hangzhou.aliyuncs.com/rancher/rancher-agent:v2.4.2&quot; \\\n    registry.cn-hangzhou.aliyuncs.com/rancher/rancher:v2.4.2\n\nrancher使用443端口，经过端口映射，可在centos上使用centos的ip进行访问。同时由于centos虚拟机与宿主机archlinux在同一网段，所以可在archlinux上使用浏览器输入centos的ip:port直接访问rancherhttps://192.168.1.111:443\nk8s需要内存大于1.7G\n关闭swap分区\nswapoff -a\n\n# 同时需要在/etc/fstab里面对swap分区进行注释\n\n镜像配置\ncat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n禁止防火墙（docker中不需要）\n# docker中不需要\nsetenforce 0\n\nsystemctl disable firewalld\nsystemctl stop firewalld\n\n安装并启动kubenetes\nyum install -y kubelet kubeadm kubectl\n# docker中没有systemctl，直接使用命令kubelet启动即可\nsystemctl enable kubelet &amp;&amp; systemctl start kubelet\n\n初始化节点\nkubeadm init \\\n--apiserver-advertise-address=192.168.1.111 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--pod-network-cidr=10.244.0.0/16 \\\n--ignore-preflight-errors=CpuNum \\\n--apiserver-cert-extra-sans=192.168.1.111\n\nkubeadm init \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--pod-network-cidr=10.244.0.0/16 \\\n--ignore-preflight-errors=CpuNum \\\n--apiserver-cert-extra-sans=192.168.1.111\n\n报错：\n\ndocker版本太高，只支持到19.03\n需要修改docker的cgroup为systemd\nram需要大于1.7G\n需要enable kubelet\n\n# 下载对应版本docker\n wget https://download.docker.com/linux/centos/8/x86_64/edge/Packages/docker-ce-19.03.13-3.el8.x86_64.rpm\n \n wget https://download.docker.com/linux/centos/8/x86_64/edge/Packages/docker-ce-cli-19.03.13-3.el8.x86_64.rpm\n\n卸载之前的docker\nyum remove docker-ce\n\n安装下载的docker\nyum install -y ./docker-ce-19.03.13-3.el8.x86_64.rpm\nyum install -y ./docker-ce-cli-19.03.13-3.el8.x86_64.rpm\n\n修改cgroup\nvim /etc/docker/daemon.json\n&#123;\n  &quot;exec-opts&quot;: [ &quot;native.cgroupdriver=systemd&quot; ]\n&#125;\n\n重新启动docker\nsystemctl enable docker\nsystemctl start docker\n\n重启机器增加内存为3G\n重新初始化节点，需要5分钟左右下载，成功输出为：\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.1.111:6443 --token hzy655.b3l3x68qsyv0np8w \\\n    --discovery-token-ca-cert-hash sha256:89a0c3f88db476588e90109b56468f966b88be00139062f82359ef0b63f059ee \n\n根据输出进行配置\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\n此时查看节点状态为notready，配置网络后就ok了\n[root@localhost ~]# kubectl get nodes\nNAME                    STATUS     ROLES                  AGE     VERSION\nlocalhost.localdomain   NotReady   control-plane,master   2m50s   v1.20.1\n\n配置flannel网络\n# 下载配置文件\nwget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n# 用配置文件配置网络\nkubectl apply -f kube-flannel.yml\n\n输出为下面即为配置成功\npodsecuritypolicy.policy/psp.flannel.unprivileged created\nclusterrole.rbac.authorization.k8s.io/flannel configured\nclusterrolebinding.rbac.authorization.k8s.io/flannel configured\nserviceaccount/flannel unchanged\nconfigmap/kube-flannel-cfg configured\ndaemonset.apps/kube-flannel-ds created\n\n再次查看状态就为ready\n[root@localhost ~]# kubectl get nodes\nNAME                    STATUS   ROLES                  AGE     VERSION\nlocalhost.localdomain   Ready    control-plane,master   9m46s   v1.20.1\n\nk8s加入rancher\n\n\n在centos上运行上面的命令将k8s加入rancher，其中USER_ACCOUNT通过查看配置文件获取\n cat .kube/config\n\n\n","categories":["learn"],"tags":["k8s"]},{"title":"run_in_backend","url":"/2022/04/23/run-in-backend/","content":"run in backendokay, let’s check whether there is a program running in backend.\njobs\n\nif it shows like this then it has a program running in backend, if nothing, no program running in backend (always we can say like this).\n➜  ~  jobs\n[1]  + suspended  xterm\n\n[1] is job number, suspended is program status, xterm is program name. if we wanna to see program pid, just type jobs -l.\n5 ways running in backend\nwhen a terminal program runs, press ctrl+z, then program will stop and send to backend. after that type bg %jobs_number  will make background jobs running in backend.\nbg %job_number\n\n\nadd &amp; at the end of command running program.\ncommand &amp;\n\n\nadd nohup at the start of command and add &amp; at the end of command. it is much useful if we need logout of the system such as in a remote environment.\nnohup command &amp;\n\n\nuse setsid\nsetsid command_to_execute\n\n\nuse (&amp;)\n() will expand command in a subshell, put &amp; after command in () will run in backend\n(command &amp;)\n\n\n\n\nNote:\nmethods of 3,4,5 can resolve the problem when we logout the terminal but leaving the program execute continue.\nif we use methods 1,2. we can also make it execute continue as 3,4,5 with disown\n# change all jobs running in backend belongs to pid 1\ndisown -a\n\n# change a specified job belongs to pid 1\ndisown %job_number\n\n\nkill program in backendfirst find job number\njobs\nkill %job_number\n\nor find program pid\njobs -l\nkill $pid\n\nstart program in backendwith this command, we can make program in the backend with stop status running.\nbg %job_number\n\nanother way is using kill command\nkill -cont $pid\n\npause program in backendwith this command, we can pause program running in backend.\nkill -stop $pid\n\nput backend in frontwith this command, we can put backend program in front.\nfg %job_number\n\n","categories":["learn"],"tags":["linux"]},{"title":"rust","url":"/2022/04/23/rust/","content":"RUSTinstallby default rustup will be installed in ~/.rustup, cargo will be installed in ~/.cargo.if we want to customize install location, we need to export variables before installation.\n# export rustup and cargo location\nexport RUSTUP_HOME=~/.local/apps/rust/rustup                  \nexport CARGO_HOME=~/.local/apps/rust/cargo                    \ncurl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh\n\nafter installation finish, . /home/healer/.local/apps/rust/cargo/env command will be automaticly configured to some environment files(such as .bashrc). however it is not enough, we also need to add the variables we export before installation. without this step, there will be an error called error: no override and no default toolchain set.\nso, i write all of this to ~/.xinitrc\nexport RUSTUP_HOME=$HOME/.local/apps/rust/rustup\nexport CARGO_HOME=$HOME/.local/apps/rust/cargo\nsource $HOME/.local/apps/rust/cargo/env\n\nthen check compiler and package manager version\nrustc --version\ncargo --version\n\nvscode extensionsince i cannot download extension in vscode, so i need download rust vsix file in web site. then install it with command:\nvscodium --install-extension matklad.rust-analyzer-0.2.842.vsix\n\nthen we need to install rust language server(RSL) with command:\nrustup component add rls rust-analysis rust-src\n\nhowever i cannot download it since China cannot, so we need to config mirror with exporting this variables:\nRUSTUP_DIST_SERVER=http://mirrors.ustc.edu.cn/rust-static\nRUSTUP_UPDATE_ROOT=http://mirrors.ustc.edu.cn/rust-static/rustup\n\ncargo mirror\nthe same problem comes with cargo, so we need to config cargo mirror, add this to $CARGO_HOME/config:\n[source.crates-io]\nregistry = &quot;https://github.com/rust-lang/crates.io-index&quot;\nreplace-with = &#39;ustc&#39;\n[source.ustc]\nregistry = &quot;https://mirrors.ustc.edu.cn/crates.io-index&quot;\n\n","categories":["learn"],"tags":["rust"]},{"title":"tcp_3_handshake","url":"/2022/04/23/tcp-3-handshake/","content":"TCP 3 HandShakeas we know that TCP(transmission control protocol) is much more security than UDP(user datagram protocol). so why? and what makes it?\nthe problem of transmission\ndata sending will be split into several packets, how do i(server/client) know the sequence order of packets and how to rebuild them?\nhow can i(server/client) know that you(client/server) really received my request? no data lost or hacked?\n\nthe method to resolve problemin order to resolve the problem 1, packet use SYN synchronize sequence number to confirm data beginning number.\nin order to resolve the problem 2, server/client needs to confirm the SYC with ACK acknowledgement that it really received the SYN. (until receive ACK, server/client will resend SYN).\nthe way it worksSTEP1: client sends a syn x to server announce that client is likely start communication\nSTEP2: server received the request and then send a ack x + size of request packet(equal 1) to client confirms let’s begin with packet with number x+1. then send a syn y to client announce that the data server sends to client begins with number of y.\nSTEP3: client received the syn y of server and then announce that i will receive server’s data begins with number of y + size of request packet(equal 1).\n\n","categories":["learn"],"tags":["tcp"]},{"title":"python","url":"/2022/04/23/python/","content":"PYTHONpython is a dynamic language, very powerful, useful and simple to use.\npython interpreterbecause python is a dynamic language, a interpreter is needed for using. there are two ways to install python interpreter:\n\ninstall from  source code, this way need compiling,  and it is complex, download in official website, uncompress then compile\n./configure\nmake\nmake test\nsudo make install\n\n\nif we use linux distribution, it is easy to download with package manager.\n# such as in archlinux\npacman -S python\n\n\n\nafter installing, check it’s version\npython --version\n\npipwhat is pip? it is a package manager of python module. let’s install it.\ninstall\nnote that there are two pip package available,\n\npip2: this is used for python2\npip3:  this is used for python3\n\nso, which one should we choose depend on which python version we use.\npython --version\n\nin centos:\n# epel repo needed\nyum install epel-release\nyum install python2-pip\n\nin archlinux:\npacman -S python-pip\n\nrepo config\nin defalut, download speed is very slow. we need to modify mirror configuration\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n\nthe command will change mirror to tnua, and we can find the config in ~/.config/pip/pip.conf\nmodule location\ncommand to find the default position\npython -m site\n\nbe careful the USER_SITE value, it stores the package location pip installed\nnow let us to see where is the config file\npython -m site --help\n\nthe config file is /usr/lib/python3.8/site.py\nthen we can change the default value to any other site you want, such as\nUSER_SITE = &quot;/home/narcissus/Software/python_lib&quot;\n\nfrom now on, we use pip command install packages, they will be stored in customized position\nexample:\npip install pandas --user\n\n代码风格\npython代码的一个很明显的特点就是缩进。代码块是通过缩进来组织的，代码块使用冒号:来标识\n\n单行注释使用#\n# 单行注释\n\n\n多行注释使用&quot;&quot;&quot; &quot;&quot;&quot;\n&quot;&quot;&quot;\n多行\n注释\n&quot;&quot;&quot;\n\n\n一行代码拆分多行使用\\\nuser = &#123;&quot;name&quot;:&quot;snippet&quot;,\\\n      &quot;age&quot;:&quot;12&quot;,\\\n      &quot;gender&quot;:&quot;male&quot;\n      &#125;\nprint(user[&quot;age&quot;])\n\n\n命名规范\n\n类命名：使用大驼峰的规范，即每个单词都以大写字母开头\nclass UserInfo():\n  name = &quot;python&quot;\n\n\n变量命名：\n\n第一种：小驼峰，即第一个单词小写开头，其余字母大写开头baiduUrl = &quot;https://www.baidu.com&quot;\n\n\n第二种：所有字母全部小写，并用_连接，我比较喜欢这个baidu_url = &quot;https://www.baidu.com&quot;\n\n\n\n\n\n\n\n变量作用：\n变量是一个字符串，用来保存数据的内存地址，指向内存中数据Data的位置。\n变量所保存的内存地址可以被改变，所以变量可变\n如果在程序中多处都要使用到这个数据，那么使用变量则可以只修改一个地方就行\n\n赋值：\n由于python是解释型语言，所以在声明变量时，不需要指定变量的类型\nname = &quot;xiaotianquan&quot;\n\n\n还可以一次性赋值多个\nname,age,like = &quot;gou&quot;,2,&quot;food&quot;\nprint(name,age,like)\n\n\n\n引用直接写变量名即可\n数据类型标准数据类型：\n数字\n 直接写数字，不加引号，加了引号作为字符串\nage = 3\n\n\n字符串 str\n 用引号括起来的作为字符串，可以使用单引号和双引号 这两种没有区别，因为没有变量置换（shell和perl中）这种操作，它使用的是拼接\n\n布尔 True/False\n 在python中，布尔值也可以作为数字使用 True = 1, False = 0\nage = 3\nprint(age+True)\n\n\n列表 list\n 用[]表示，可以存储不同类型的数据\ndata = [1,2,3,4,5,6,7,&quot;a&quot;,&quot;b&quot;]\nprint(data)\n\n 切片操作\n\n使用:，取出指定范围的数据，可以使用函数id()查看取出数据的内存地址list[start_index:end_index:step]\n\n```pythondata1 = [1,2,3,4]\n\n作用为复制列表，使用频率高，有效的避免对原数组数据造成破坏 data2 = data1[:]\n内存地址不同 print(id(data1),id(data2))\n与data[:]作用相同，-1为最后一个元素的索引 data3 = data1[0:-1]\n指定位置,前闭后开[) data4 = data1[0:2]\n指定步幅 data4 = data1[::2]\n逆序 data8 = data1[-1::-1]\n负数索引 data5 = data1[-3:-1]\n\n其它\n```python\n# 删除指定元素\ndata6 = data1.remove(2)\n\n# 从后往前取出数据（删除）\ndata7 = data1.pop()\n\n# 乘\ndata9 = data1 * 2\n\n# 列表生成式\ndata10 = [ i for i in range(1,10) ]\n\n# 嵌套\ndata11 = [data,data10]\n\n# 循环取出嵌套数据\nfor i in data11:\n    for j in i:\n        print(j)\n    \n# 如果嵌套的两个list元素个数一致，可以使用一层嵌套即可取出所有值\nla = [1,2,3,4]\nlb = [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]\nlc = [la,lb]\nfor i,j,k,l in lc:\n    print(i,j,k,l)\n\n# 查看list元素个数\nlen(data)\n\n# 全部为数字时，可以取最大值，最小值\nmax(la)\nmin(la)\n\n# 查看某个元素存在多少个\nla.count(1)\n\n\n元组 tuple\n 使用()，为一个不可修改列表，大部分用法与list一致\ndata = (1,2,3,4,&quot;a&quot;,&quot;b&quot;)\n\n# 创建一个只有一个元素的tuple，后面需要一个逗号\ndata = (1,)\nprint(type(data))\n\n# 可以不加括号\ndata = 1,\nprint(type(data))\ndata = 1,2,3,4\nprint(type(data))\n\n# 创建空的tuple\ndata = tuple()\ndata = ()\n\n# 通过list创建tuple\nmylist = [i for i in range(1,9)]\ndata = tuple(mylist)\n\n# tuple的特殊用法，两个元素交换\na = 1\nb = 2\na,b = b,a\n\n\n集合 set\n\n数据有序，而且不可重复,具有取出重复的作用\n\n通过list和tuple来生成集合\na = [1,2,3,4,2,1,3]\nb = set(a)\nprint(type(b))\nprint(b)\n\n\n通过&#123;&#125;来定义集合\na = &#123;1,2,2,5,3,4&#125;\nprint(type(a))\n\n\n集合没有索引，只能for循环取出元素\na = &#123;i**2 for i in range(1,10)&#125;\nfor i in a:\n  print(i)\n\n\n集合运算\na = &#123;i for i in range(1,5)&#125;\nb = &#123;i for i in range(3,7)&#125;\n# 交集\nc = a.intersection(b)\n# 并集\nd = a.union(b)\n# 差集\ne = a.difference(b)\n\n\n让集合不可修改\na = &#123; i for i in range(1,5)&#125;\nb = frozenset(a)\n\n\n\n 其它 \n# 生成奇数、偶数集合\na = &#123;i for i in range(1,10) if i % 2 == 0&#125;\nb = &#123;i for i in range(1,10) if i % 2 != 0&#125;\n\n# 删除集合中的数，如果不存在则会报错\nsa = &#123;i for i in range(1,10)&#125;\nsa.remove(1)\n\n# 删除集合中的数，如果不存在不会报错\nsa.discard(11)\n\n# 集合中也有pop函数，但是是随机的\nsa.pop()\n\n\n字典 dict\n 输入字典数，以及字典数据，进行去重（相同key值相加），排序\nnum = int(input())\nlt = &#123;&#125;\n\nfor i in range(num):\n    # map可同时设置数据类型\n    a,b = map(int, input().split())\n    if a in lt.keys():\n        lt[a] += b\n    else:\n        lt[a] = b\n# sorted可对字典进行排序，key可以使用lambda来指定使用key或者value排序\nlt = sorted(lt.items(), key=lambda a: a)\nfor i in lt:\n    print(i[0], i[1])\n\n\n\n数据类型嵌套-对象在list，tuple，set，dict中均可以存储对象\nclass User():\n    name = &quot;ls&quot;\n    age = 21\nuser = User()\n\na = [user]\nb = (user,)\nc = &#123;user&#125;\nd = &#123;&quot;obj&quot;:user&#125;\n\nprint(type(a),type(b),type(c),type(d))\nprint(a[0].name,b[0].name,d[&quot;obj&quot;].name)\nfor i in c:\n    print(i.name,i.age)\n\n运算符\n算数运算符\n关系运算符\n赋值运算符\n逻辑运算符\n位运算\n成员运算符\n身份运算符\n\n算数运算符\npython没有自增自减运算符\n包括：\n加 +\n减 -\n乘 *\n除\n普通除法 /\n取余 %\n取整 //\n\n\n\n\n所有运算符都可以使用运算赋值的缩写：  +=，-=，*=,/=,%=,//=a = 1\na += 1\nprint(a)\n\n  已经有运算赋值这两个操作了，所以不能再赋值\n\n比较运算符比较运算的结果一定为一个布尔值：True/False\n\n等于 ==\n不等于 !=print(3!=4)\n\n\n其它\n&gt;\n&gt;=\n&lt;\n&lt;=\n\n\n\n赋值运算符使用等号来赋值=，将数据data赋值给变量\n逻辑运算符返回结果为True/False\n\nand\nor\nnot\n\na = 1\nif a == 3 or a == 2 :\n    print(&quot;true&quot;)\nelse:\n    print(&quot;false&quot;)\n\n成员运算符用来检测一个值或者变量是否在一个集合中,返回结果为True/False\n\nin\nnot ina = 1\nb = [i for i in range(1,5)]\nc = a in b\nd = a not in b\nprint(c,d)\n\n\n\n身份运算符用来判断两个变量是否一致,返回结果为True/False\n\nis\nis nota = 1\nb = 1\nc = 2\nprint(a is b)\nprint(a is c)\nprint(a is not c)\n\n\n\n程序结构\n顺序  程序从上到下依次执行\n循环  for  while\n分支  if\n\n分支结构这里的条件表达式只要是返回结果为True/False即可\nif 条件表达式:\n    语句1\nelif 条件表达式:\n    语句2\nelse:\n    语句3\n\n举例1：\nuser = input(&quot;type your name: &quot;)\nif user == &quot;root&quot;:\n    print(&quot;you are the admin&quot;)\nelif user == &quot;narcissus&quot;:\n    print(&quot;you are the normal user&quot;)\nelse:\n    print(&quot;you are the user not in group sudo&quot;)\n\n举例2：空字符串为假\nif &quot;&quot;:\n    print(&quot;true&quot;)\nelse:\n    print(&quot;false&quot;)\n\n循环结构for循环用来遍历序列中的所有元素\nfor 变量 in 序列:\n    语句\n\n举例：\nfor i in range(1,10):\n    print(i)\n\n\n循环中的条件跳转\nbreak 终止循环\ncontinue 跳过continue后的语句\npass 没有实际作用，用来占位\n\n\n\n举例：\nfor i in range(2,20):\n    if i % 2 == 0:\n        print(str(i) + &quot;能被2整除&quot;)\n        continue\n    elif i % 3 == 0:\n        print(str(i) + &quot;能被3整除&quot;)\n        pass\n    else:\n        break\n\nwhile循环当条件成立时，一直循环。这个条件必须要有终止，否则会形成死循环。\nwhile 条件表达式:\n    语句\n\n举例1：求a，b的最小公约数\na = 2\nb = 5\nc = 1\nwhile c % a != 0 or c % b != 0:\n    c += 1\n    print(a,b,c)\n\n举例2：\ni = 1\nwhile i &lt; 3:\n    i += 1\n    try:\n        num =  int(input(&quot;num&quot;))\n        a = 5 / num\n        print(a)\n    except Exception as e:\n        print(&quot;输入非零整数&quot;)\n\n函数\n命名一般采用:动词_名词的形式\n\n意义复用代码\n\n定义\ndef 函数名():\n  语句\n\n\n调用\n函数名()\n\n\n举例：\nimport time\ndef get_time():\n  now = time.strftime(&quot;%Y%m%d-%H:%M:%S&quot;)\n  print(now)\nget_time()\n\n\n\n参数\n分类方式1：\n\n形参：在写函数时，括号中的那个参数\ndef get_name(name):\n  print(name)\n\n\n实参：在函数调用时括号中传入的参数\nget_name(&quot;小舞&quot;)\n\n\n\n\n分类方式2：\n\n位置参数：在传参时必须一一对应\ndef normal(name,age,like):\n  print(&quot;&#123;&#125; is &#123;&#125; years old and like &#123;&#125;&quot;.format(name,age,like))\nnormal(&quot;小舞&quot;,20,&quot;star&quot;)\n\n\n关键字参数：在传参时不必一一对应，而是使用参数名来设置参数\ndef keyword(name,age,like):\n  print(&quot;&#123;&#125; is &#123;&#125; years old and like &#123;&#125;&quot;.format(name,age,like))\nkeyword(age=20, name=&quot;小舞&quot;, like=&quot;star&quot;)\n\n\n默认参数: 给参数设置默认值，如果不传则使用默认值，不过默认参数后面不能写位置参数\ndef default(a,b,c=1):\n  print((a + b) / c)\ndefault(1,2)\n\n\n收集参数：在不确定会传入参数个数的情况下使用\n\n如果后面还有位置参数，那么位置参数会作为关键字参数，而且位置不能变\n如果有两个星号，那么表示收集所有参数包括关键字参数def collection(*count):\nsum = 0\nfor i in count:\n sum += i\nreturn sum\ncollection(1,2,3,4)\n\n\n\n\n\n\n\ndef collection(*count,another=1):\nsum = 0\nfor i in count:\n    sum += i\nreturn sum + another\ncollection(1,2,3,4,another=5)\n```\n\n- 分解参数：\n    1. 将list和元组作为参数传给函数时\n    ```python\n    def expend(*args):\n        sum = 0 \n        for i in args:\n            sum += i\n        return sum\n    a = (i for i in range(1,10))\n    b = [i for i in range(1,10)]\n    print(expend(*a))\n    print(expend(*b))\n    ```\n\n    2. 将字典作为参数传给函数时\n    ```python\n    def expend(**args):\n        sum = 0\n        for i in args:\n            sum += args[i]\n        return sum\n    c = &#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;\n    expend(**c)\n    ```\n\n返回值\n函数可以有返回值，也可以没有返回值，使用return来返回执行结果\n但是在python中还是推荐有返回值，如果没有实际值返回可以返回一个None\n函数一旦执行return之后函数就会结束，return后面的语句不会执行\n\n举例：\ndef sum(a,b):\n    return a + b\na = sum(1,2)\nprint(a)\n\nc = 1\ndef plus():\n    global c\n    c += 1\n    return None\n# 函数没有返回值，每次调用函数c的值就自增1\nplus()\nprint(c)\n\n计算九九乘法表：我写的挺复杂\nfor y in range(1,10):\n    x = 1\n    while x &lt;= y:\n        print(str(x) + &quot;*&quot; + str(y) + &quot;=&quot; + str(x*y) \\\n        + &quot; &quot;,end=&#39;&#39;)\n        x += 1\n        if x &gt; y:\n            print(end=&quot;\\n&quot;)\n\n简单写法\nfor y in range(1,10):\n    for x in range(1,y+1):\n        print(&#39;&#123;&#125;*&#123;&#125;=&#123;&#125;\\t&#39;.format(x,y,x*y),end=&quot;&quot;)\n    print()\n\n三角形\nfor y in range(1,10):\n    for x in range(1,10-y):\n        print(&quot;   &quot;,end=&quot;&quot;)\n    for x in range(1,2*y):\n        print(&quot; 1 &quot;,end=&quot;&quot;)\n    print()\n\n递归函数函数直接或者间接调用自己，需要有结束条件\n优缺点：\n\n优点：书写理解简单\n缺点：执行速度慢\n\n写法：\n\n结束条件\ndef plus(num):\n  if num == 1:\n      return 1\n# 这个函数调用时，传入1，得到plus(1) = 1\n# 不能这么写，这么写是错误的\ndef plus(num):\n  plus(1) = 1\n\n\n返回自己\ndef plus(num):\n  if num == 1:\n      return 1\n  return num + plus(num-1)\nplus(100)\n\n\n举例：斐波拉契数列\n\n\n普通写法\n# 1, 1, 2, 3, 5, 8, 13.....\ndef fun(num):\n    a = b = i = 1\n    sum = 1 if num == 1 else 2\n    while i &lt; num-1:\n        a,b = b,a+b\n        i += 1\n        sum = sum + b \n    print(&quot;第&#123;&#125;个斐波拉契数为：&#123;&#125;，总数为：&#123;&#125;&quot;.format(num,b,sum)) \nfun(3)\n\n使用递归写法\n# 1, 1, 2, 3, 5, 8, 13.....\ndef fib(num):\n    if num == 1 or num == 2:\n        return 1\n    return fib(num-1) + fib(num-2)\n\ndef fib_list(num):\n    for i in range(1,num+1):\n        print(fib(i))\nfib_list(10)\n\n尾递归对比普通写法和递归的写法，递归函数在调用40次时已经停止调用了，而且在求同一个斐波拉契数的时候，普通写法速度秒杀递归写法。普通写法单线程求第十万个斐波拉契数不到一秒，第一百万个斐波拉契数约六秒。所以递归函数不适合复杂计算\n递归函数为什么慢？因为递归函数运行时，每一次调用都会返回一个表达式，不能返回一个确定的值，那么原函数的参数，逻辑结构等这些都不能修改，每次计算机在调用函数时会使用堆栈，每调用一个函数会增加一层栈帧，所以当递归过程多次调用函数的时候可能会导致大小有限的堆栈溢出。优化方式之一是尾递归\n为什么尾递归可以优化？尾递归与递归都需要调用自身，看起来没多大区别（我刚开始也没看懂），但是尾递归每次都不是返回的表达式，而是返回的一个函数，至于计算结果，那是通过变量的形式进行传递的，这么做的好处就是不用开新的栈，而是刷新原函数，将参数传递进去就好了。所以做到了优化，但是python中即使是使用了尾递归，次数仍然只能达到999次。并不是真正意义上的尾递归\n在很多时候我们都是在刷新变量的值，而并不是重新用一个别的变量\nsum = 0\nfor i in range(1,10):\n    sum += i\nprint(sum)\n\n尾递归的斐波拉契函数写法：\n# 1, 1, 2, 3, 5, 8, 13.....\ndef fib(num, first=1, second=1, sum=2):\n    if num == 2 or num == 1:\n        return second,sum\n    return fib(num-1, second, first+second, sum+first+second)\nfib(7)\n\n利用三目运算简写\ndef fib(num, first=1, second=1, sum=2):\n    return 1 if num == 1 else(sum  if num == 2 else fib(num-1, second, first+second, sum+first+second))\nfib(7)\n\n通过上面尾递归的写法，可以看出函数调用自身的作用类似于计数，真正计算的过程在参数中。其实类似于普通函数的写法\n函数的使用在python中一切皆是对象，所以函数也是对象，函数名指向的是代码段的内存地址\n\n作为元素使用：放在list，tuple，set，dict中\ndef user():\n  print(&quot;hello&quot;)\none = user()\na = [one]\n\n\n作为参数传递给函数\n\n可以被赋值\n\n作为函数的返回值\n\n\n字符串在linux相关的运维上，有很多都是处理字符串，所以字符串有点重要的\n路径问题在很多情况下，输入路径需要各种转义才行，为了避免这种麻烦，使用r\nlocation = r&#39;c:\\user\\kite\\desktop&#39;\nprint(location)\n\n变量替换（字符串拼接、格式化）\n%\nprint(&quot;i like %s and %s&quot;%(&quot;cat&quot;,&quot;dog&quot;))\n\n\nformat函数，使用&#123;&#125;\n\n直接使用\nprint(&quot;i like &#123;&#125; and &#123;&#125;&quot;.format(&quot;cat&quot;,&quot;dog&quot;))\n\n\n使用变量\na = &quot;i like &#123;&#125; and &#123;&#125;&quot;\nprint(a.format(&quot;cat&quot;,&quot;dog&quot;))\n\n\n指定位置\na = &quot;i like &#123;0&#125; and &#123;0&#125; and &#123;1&#125;&quot;\nprint(a.format(&quot;cat&quot;,&quot;dog&quot;))\n\n\n使用命名：\n\n我觉得这种还不错，虽然字多了一点，但是很清晰a = &quot;i like &#123;animal&#125; and &#123;animal&#125; and &#123;drink&#125;&quot;\nprint(a.format(animal=&quot;cat&quot;,drink=&quot;juice&quot;))\n\n\n在传入的参数比较多时，使用字典是最好的,需要使用到参数分解，这个是目前我觉得最好的a = &quot;i like &#123;animal&#125; and &#123;animal&#125; and &#123;drink&#125;&quot;\nb = &#123;&quot;animal&quot;:&quot;cat&quot;,&quot;drink&quot;:&quot;juice&quot;&#125;\nprint(a.format(**b))\n\n\n\n\n指定数字长度\na = &quot;pi is &#123;:.2f&#125;&quot;\nprint(a.format(1.1314))\n\n\n\n\n\n判断类函数函数以is开头，返回值为True/False\n内置函数字符串的关键字为str，通过str来查看帮助文档\nhelp(str)\n\n举例\nurl = r&quot;https://www.baidu.com&quot;\n# 查找，索引，未找到返回-1\nurl.find(&quot;http&quot;)\n# 从指定位置开始查找，优化查找速度\nurl.find(&quot;d&quot;,10)\n\n# 从右边查找，查找字符在结尾时优化查找速度\nurl.rfind(&quot;m&quot;)\n\n# 查找，索引，未找到报错\nurl.index(&quot;h&quot;)\n\n# 开头，结尾，返回True，False\nurl.startswith(&quot;https&quot;)\nurl.endswith(&quot;com&quot;)\n\n# 是否全大小写,返回True，False\nurl.isupper()\nurl.islower()\n\n# 大小写转换\nurl.upper()\nurl.lower()\n\n# 首字母大写\nurl.capitalize()\n\n# 不带参数代表空格，去除开头结尾空格\nerror = r&quot;   https://www.baidu.com   &quot;\na = error.strip()\n\n# 带参数去除开头结尾指定字符\nurl.strip(&quot;https&quot;)\n\n类与对象类通过class来定义，对象由类实例化而来。类的作用在于为对象提供一个模板，它包含了属性和函数。最重要的是类提供了继承，封装，多态这三大特性。\n# 定义类\nclass User():\n    pass\n\n# 实例化\nxiaolu = User()\n\n查看类的所有方法：__dict__\nstr.__dict__\n\n类属性和方法在类定义之后，就在内存中保存了类的属性和方法，可以直接调用\nclass User():\n    name = &quot;jounr&quot;\n    def get_name(self):\n        return self.name\nprint(User.name)\nprint(User.get_name(User))\n\n\n实例方法：使用最多的方法，需要将类实例化成为对象，通过对象调用方法\n\n静态方法：\n\n不需要实例化，通过类直接调用\n静态方法包装在staticmethod类的对象中，定义中没有self，可直接通过类来调用方法```pythonclass MyClass():def tellme():  print(“i am a static method,without self”)tellme = staticmethod(tellme)\n\n\n\nMyClass.tellme()\n\n- 类方法：\n    - 不需要实例化，通过类直接调用，如果调用需要传参的函数，则将类自己作为参数传递进去\n    - 类方法包装在classmethod类的对象中，参数为cls，虽然可以通过对象来调用，但是实际上cls还是会关联到类的方法\n```python\nclass MyClass():\n    def tellme(cls):\n        print(&quot;i am a class method,with args sls&quot;)\n    tellme = classmethod(tellme)\n\nMyClass.tellme()\n\n装饰器\n上面的类方法和静态方法，需要手动写，但是可以通过使用装饰器来自动包装\n用来替代手工包装，可用于包装任何可调用对象，还可用于方法和函数。装饰器可以有多个，指定多个时，应用的顺序与列出的顺序相反class MyClass():\n  @staticmethod\n  def tellme():\n      print(&quot;new decorator&quot;)\nMyClass.tellme()\n\n\n\nself\nself作为一个参数，常常用在类的函数中，但并不是所有类的函数都需要这个参数\nself并不是一个关键字，也可以用其它的替代\n如果这个函数需要访问类的属性，那么需要self这个参数，它用来指代实例自身\n如果这个函数不需要访问类的属性，那么不需要self这个参数\n在有self的时候，首先会看函数自己是否定义属性，如果没有，则访问类的属性class User():\n  age = 20\n  id = 1\n  qq = 102832343\n  def info():\n      print(&quot;hello&quot;)\n  def get_age(self):\n      return self.age\n  def get_qq(self):\n      self.qq = 2312323123\n      return self.qq,self.age\none = User()\none.info()\nprint(one.get_age())\nprint(one.get_qq())\n\n\n\n继承\n继承父类的属性，函数等。避免了代码的冗余，也可重写父类的方法\n将父类作为参数传递给子类\n子类可以继承自多个类```pythonclass User():  name = “one”  age = 20  def get_name(self):  return self.name\n\nclass Customer():  id = 1class Realone(User,Customer):  pass\n\na = Realone()a.get_name()print(a.id)\n\n- 子类扩充父类的方法：使用`super()`调用父类方法\n```python\nclass User():\n    name = &quot;journal&quot;\n    def get_name(self):\n        print(self.name)\nclass SomeOne(User):\n    def get_info(self):\n        super().get_name()\n        print(&quot;attend super&quot;)\n\na = SomeOne()\na.get_info())\n\n\n检测是否为子类print(issubclass(Realone,User))\n\n\n\n构造函数\n在类实例化的时候第一个自动调用的函数，作用是给对象初始化一些数据\n必须有参数self,函数名为__init__```pythonclass User():  def init(self):  self.name = &quot;lixingyun&quot;\n\n\n\na = User()print(a.name)\n\n- 通过继承，扩展父类的构造函数\n```python\nclass User():\n    def __init__(self,name):\n        self.name = name\n        print(name)\n\n# 直接写父类的init方法，只能写一个父类，不推荐使用\nclass One(User):\n    def __init__(self,name):\n        # 先调用父类的init函数\n        User.__init__(self,name)\n        print(&quot;initial finish&quot;)\n\n# 可以自动向上寻找父类的init方法，父类没有写死，推荐使用\nclass Two(User):\n    def __init__(self,name):\n        super(Two,self).__init__(name)\n        print(&quot;initial finish&quot;)\n\na = One(&quot;小小&quot;)\nb = Two(&quot;小小&quot;)\n\n\n构造函数默认被继承\n如果定义了自己的构造函数，那么父类的构造函数不再被继承。也叫重写父类函数\n\n封装封装即为对对象成员进行访问限制\n\n私有：最高级别的限制，只能在当前类或者对象中访问。通过在变量前加__实现\nclass User():\n  __name = &quot;喜洋洋&quot;\n  __age = 20\none = User()\n# 无法直接访问\nprint(one.name)\n\n其实私有也不是真的无法访问，还是可以访问的\nprint(one._User__age)\n\n\n受保护的：在外部不可访问，可以在内部和子类中访问。通过在变量前加_实现\n\n公有的：任何地方都可以使用\n\n\n多态\n同一个对象在不同情况下有不同的状态\n在python中是一种设计思想，并没有语法要求，其实我也搞不懂\n\n类的函数转属性类中的get，set，del函数可以转换为属性\nclass User():\n    def __init__(self,name):\n        self.name = name\n    def get_name(self):\n        return self.name\n    def set_name(self,name):\n        self.name = name\n\none = User(&quot;小小&quot;)\none.get_name()\none.set_name(&quot;小青&quot;)\none.get_name()\n\n可以使用property(get,set,del)函数对get，set，del封装。将函数转换为一个属性值\nclass User():\n    def __init__(self,name):\n        self.name = name\n    def get_name(self):\n        return self.name\n    def set_name(self,name):\n        self.name = name\n    sname = property(get_name, set_name)\n\ntwo = User(&quot;小二&quot;)\ntwo.sname\ntwo.sname = &quot;可可&quot;\ntwo.sname\n\n类的内置属性\n__dict__： 显示类的属性和方法\n__doc__： 类的说明文档\n__name__： 类的名称\n__bases__： 类的所有父类\n\n类的魔法函数不需要手动调用，达到触发条件，自动调用\n\n__init__： 初始化类的属性\n\n__call__： 当对象被当做函数使用的时候，调用此函数\nclass User():\n  def __call__(self):\n      print(&quot;此时对象被当做函数调用了&quot;)\none = User()\none()\n\n\n__str__： 当对象被当做字符串使用的时候，调用此函数\nclass User():\n  def __str__(self):\n      return &quot;此时对象被当做字符串使用了&quot;\none = User()\nprint(one)\n\n\n__getattr__： 当访问一个不存在的属性时，调用此函数```pythonclass User():  def getattr(self,method):\n  return &quot;此函数不存在&quot;\n\n\n\none = User()print(one.age)\n\n## 抽象\n- 抽象方法\n\n定义了方法，但没有实现\n```python\nclass User():\n    def get_name(self):\n        pass\n\n\n抽象类\n\n必须导入模块abc\n抽象类不可以实例化，必须继承后实例化，继承的子类需要实现所有的继承来的抽象方法\n作用为设定类的标准\n\n\n\nimport abc\n\nclass User(metaclass=abc.ABCMeta):\n\n    # 定义抽象方法\n    @abc.abstractmethod\n    def get_name(self):\n        pass\n\n    # 定义类抽象方法\n    @abc.abstractclassmethod\n    def get_age(self):\n        pass\n\n    # 定义静态抽象方法\n    @abc.abstractstaticmethod\n    def get_id(self):\n        pass\n\n    # 定义普通方法\n    def set_qq(self,qq):\n        self.qq = qq\n\n组装类函数名可以作为变量使用\nclass User():\n    pass\ndef he(self):\n    print(&quot;hello&quot;)\n\nUser.he = he\none = User()\none.he()\n\nPackagepackage is a collection of modules, which must be included with a file called __init__.py\n\nhow to import a package\n\nimport all include __init__.py```pythonimport package_name\n\n  package_name.function_name()  package_name.class_name.function_name()\n\n- only import specify module,except `__init__.py`\n```python\nimport package_name.module_name as md1\n\nmd1.function_name()\nmd1.class_name()\n\n\nanother way import should be mentiondfrom package_name import *\n\nthe way import only import function and class which in __init__.py\n\n\n\nmodulea module is a file contains python code.it’s suffix with .py\n\nwhy we need module?\n\nshrink program,make it easy to maintain\nmodule can be reused\nused as a namespace,reduce name conflict\n\n\nhow to use module?\n\nimport directily```pythonimport module_name\n\n  module_name.function_name()  module_name.class_name()\n\n- if the module name prefix with num such as 2.py\n```python\nimport importlib\n\nvariable = importlib.import_module(&quot;02&quot;)\n\nvariable.function_name()\nvariable.class_name()\n\n\nuse as rename module when the name of module is long\nimport module_name as somename\n\n\nimport module’s class or function,not whole module```pythonfrom module_name import someclass,somefunction\n\n\n  variable1 = someclass()  variable2 = somefunction()\n\n- import all class and function\n\nthe benifit of it is writing class or function directily without module name prefix\n```python\nfrom module_name import *\n\nvariable = someclass()\n\n\nwhere modules store?\n\ndefault location```pythonimport sys\n\n  for i in sys.path:\n  print(i)\n\n\n- add own module location\n```python\nimport sys\n\nsys.path.append(directory)\n\n\n\nthe entrance of code\nin genreal,all entrance of code should be started with this\nit can control whether to execute some code,if used as a code which will be execute,if used as a module which will not be execute\n\nif __name__ == &quot;__main__&quot;:\n    print(&quot;first execute code&quot;)\n\nError catchsome days ago,i really don’t know why we need to catch error.in my mind,i think we should not write code with error.until one day,i get a problem,i need to create a temporary table first and then delete it every time the script run.and the error appeard.some times the table isn’t exist,when execute the delete code,the program broken.at last i use error catch to avoid the error\neg:get user type in\ntry:\n    num = int(input(&quot;num:&quot;))\n    result = 100 / num\n    print(result)\nexcept:\n    print(&quot;not a none zero number&quot;)\n\n\nsyntaxtry:\n  ...\n  # can raise error by hand\n  raise some_error_type\n# if it is the error below(tuple),execute this code\nexcept (error_type1,error_type2...):\n  ...\n  # exit() can exit the program\n  exit()\n# we can print error infomation\nexcept ZeroDivisionError as e:\n  print(e)\n# Exception is the supper of all except type\nexcept Exception as e:\n  ...\n# if not in the error above execute this code\nelse:\n  ...\n# what ever error happend,will execute this code\nfinally:\n  ...\n\n\n\nTime muduleimport time\n\n# get time now with format\nnow = time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)\n\n# another way to get the format time\nhour = time.localtime().tm_hour\n\n# get the timestamp\nunique = time.time()\n\n# sleep\ntime.sleep(second_number)\n\nimport timeit\n\n# calcute program execute time with number times repeat\nt1 = timeit.timeit(stmt=&quot;[i for i in range(10)]&quot;,number=100)\n\ndef number():\n    lt = []\n    for i in range(10):\n        lt.append(i)\n\nt2 = timeit.timeit(stmt=number,number=100)\n\nimport datetime\n\n# convert string to date\na = datetime.date(2020,10,10)\nprint(a)\nb= datetime.time(10,10,10)\nprint(b)\nc = datetime.datetime(2020,10,10,10,10,10)\nprint(c)\n\n# get the current datetime\nd = datetime.date.today()\nprint(d)\n\nOS moduleassociated with operate system\nthree important modules:\n\nos\nos.path, used for path\nshutil, used for directory,file\n\nimport os\n\ndir = os.getcwd()\n\nos.chdir(&quot;../&quot;)\n\n# get file and dir of current directory with out hidden file\nlt = [i for i in os.listdir() if not i.startswith(&quot;.&quot;)]\n\n# execute shell command\nos.system(&quot;htop&quot;)\n\n# get system environment variables\nos.getenv(&quot;SHELL&quot;)\n\nimport os.path as op\n\nabsc = op.abspath(&quot;.&quot;)\n\n# used for different operate system\nd1 = &quot;/home/narcissus&quot;\nd2 = &quot;1.txt&quot;\nos.join(d1,d2)\n\n# os.path.split return a tuple,so can be used like this\nd1,d2 = op.split(&quot;/home/narcissus/1.txt&quot;)\n\n# whether a path exists\nop.exists(&quot;/home/narcissus/1.txt&quot;)\n\nimport shutil\n\nshutil.copy(&quot;1.txt&quot;,&quot;2.txt&quot;)\n\nshutil.move(&quot;1.txt&quot;,&quot;2.txt&quot;)\n\n# archive all file of Desktop into test.tar\nshutil.make_archive(&quot;/home/narcissus/Desktop/test&quot;,&quot;tar&quot;,&quot;/home/narcissus/Desktop/&quot;)\n\n# unarchive file\nshutil.unpack_archive(&quot;/home/narcissus/Desktop/test.tar&quot;,&quot;.&quot;,&quot;tar&quot;)\n\nRandom moduleimport random\n\n# return a number in the interval [0,1)\nr1 = random.random()\n\n# return a number in the interval [0,100)\nr2 = int(random.random()*100)\n\n# random choice in the interval [1,100)\nl1 = [i for i in range(0,100)]\nrandom.choice(l1)\n\n# shuffle list\nl1 = [i for i in range(1,10)]\nprint(l1)\nrandom.shuffle(l1)\nprint(l1)\n\n# random integer\nrandom.randint(1,100)\n\nFunctional programmingfeatures:\n\nfunction can be used as a parameter \nfunction can be used as return value\n\nlambdalambda exprssion\n\nbegin with lambda\nhave zero or more parameter\nuse : split lambda with expression\nno return keyword\n\nla = lambda x: x * 100\nla(10)\n\nlb = lambda x,y,z: x + y*10 + z/2\nlb(2,4,8)\n\nhigh-level functiondef get_name():\n    print(&quot;小小&quot;)\n\n# function is a variable\nvariable = get_name\nvariable()\n\n# normal function\ndef plus(num):\n    return num * 100\ndef add(num):\n    return plus(num) + 100\nadd(3)\n\n# high_level function\ndef plus(num):\n    return num * 100\ndef high_level(fun,num):\n    return fun(num) + 100\nhigh_level(plus,2)\n\nmapmap(func,*iterables)\nl1 = [i for i in range(10)]\nprint(l1)\n\n# use lambda expression ,ten times a num\nmult = lambda num: num * 10\n\n# use map to generate a class map\nl2 = map(mult,l1)\nprint(l2)\n\n# class object can be iterabled\nl3 = [i for i in l2]\nprint(l3)\n\nreducenotice:\n\nneed import module\nfunction need two parameters\nfunction need return value\n\nprinciple:reduce(1,2,3) = f(f(1,2),3)\nfrom functools import reduce\n\nl1 = [i for i in range(10)]\n\nplus = lambda x,y: x + y\n\nl2 = reduce(plus,l1)\nprint(l2)\n\nfilternotice:\n\nfunction need return a boolean\nfilter return a class object which can be iterabled\n\nfilter(function,*iterables)\nl1 = [i for i in range(10)]\n\nfit = lambda x: x % 2 == 0\n\nl2 = filter(fit,l1)\n\nl3 = [i for i in l2]\nprint(l3)\n\nsortednumber sorted\nimport random\n\nl1 = [i for i in range(10)]\nrandom.shuffle(l1)\nprint(l1)\n\nl2 = sorted(l1)\nprint(l2)\n\nl3 = sorted(l1,reverse=True)\nprint(l3)\n\ncharactor sorted\nl1 = [&quot;sda&quot;,&quot;dev&quot;,&quot;HOME&quot;,&quot;Alian&quot;,&quot;alias&quot;]\n\nl2 = sorted(l1)\nprint(l2)\n\nl3 = sorted(l1, key=str.lower)\nprint(l3)\n\nl4 = sorted(l1, key=str.lower, reverse=True)\nprint(l4)\n\nClosure packageB function defined inside A function,and B function as a return vlaue,all parameters of A can be used by B,it is called closure\ndef A(*args):\n    def B():\n        sum = 0\n        for i in args:\n            sum += i\n        return sum\n    return B\n\nl1 = [i for i in range(20)]\none = A(*l1)\none()\n\nDecoratorDecorator is a high-level function,i can return a function.\nfeature:\n\nextend origion function without change its code\nuse @ to called a decorator\n\nimport time\n\ndef now(func):\n    def pf(*args,**kwargs):\n        print(&quot;Time:&quot;,time.ctime())\n        return func(*args,**kwargs)\n    return pf\n\ndef line(func):\n    def pf(*args,**kwargs):\n        print(&quot;=&quot;*50)\n        return func(*args,**kwargs)\n    return pf\n\n# use system decorator @\n@now\n@line\ndef he(name):\n    print(&quot;hello&quot;,name)\n\nhe(&quot;小小&quot;)\n\n\n# by hand execute without system decorator @\nreturn_fun = now(he)\nreturn_fun(&quot;小小&quot;)\n\nPartial functionreturn a new function with some of its parameters fixed\nimport functools\n\n# convert 16 to 10\nint16 = functools.partial(int,base=16)\nint16(&quot;f&quot;)\n\n\n# we can realize this by hand\ndef int16(num,base=16):\n    return int(num,base)\nint16(&quot;f&quot;)\n\nzipcombine two iterable object into several tuples\nl1 = [i for i in range(1,10)]\nl2 = [i for i in range(100,110)]\nl3 = [i for i in zip(l1,l2)]\nprint(l3)\n\nenumerategive each iterable object a index and return several tuples,notice that the index can be customized\nl1 = [i for i in range(1,10)]\n\nl2 = [i for i in enumerate(l1,start=1)]\n\nprint(l2)\n\ncollections module\nnamedtuple: it can limit the number of tuple\ndeque: it is much faster than list\ndefaultdict: no error report when query none exist key\nCounter: regard string as a iterable dict\n\nimport collections\n\ncircle = collections.namedtuple(&quot;circle&quot;,[&quot;x&quot;,&quot;y&quot;,&quot;r&quot;])\np = circle(3,4,5)\nif p.x**2 + p.y**2 == p.r**2:\n    print(&quot;it is a circle&quot;)\n\nimport collections\n\nql = collections.deque()\nql.append(1)\nprint(ql)\n\nimport collections\n\nfunc = lambda : &quot;no key exist&quot;\ndd = collections.defaultdict(func)\ndd[&quot;one&quot;] = &quot;first&quot;\ndd[&quot;one&quot;]\ndd[&quot;four&quot;]\n\nimport collections\n\ncr = &quot;ksjflajowielzxkjowieof1242lkjlk&quot;\ncd = collections.Counter(cr)\nprint(cd)\nprint(cd[&quot;j&quot;])\n\nFile operateopen\nmode\nr: read only\nw: new write,will erase origional file\nx: open exist file,if not error reportd\na: append mode\nb: binary write\nt: file mode open\n+: read and write\n\n\n\nin this way, we need to close file handle by hand\ndir = r&quot;/home/narcissus/Desktop/遍历游标的三种方式.md&quot;\nf = open(dir,&quot;r&quot;)\nfor i in f:\n    print(i)\nf.close()\n\nin this way, file handle will be closed automatically\ndir = r&quot;/home/narcissus/Desktop/遍历游标的三种方式.md&quot;\nwith open(dir,&quot;r&quot;) as f:\n    for i in f:\n        print(i)\n\nread only one line,so should be carefully\ndir = r&quot;/home/narcissus/Desktop/遍历游标的三种方式.md&quot;\nwith open(dir,&quot;r&quot;) as f:\n    i = f.readline()\n    while i:\n        print(i)\n        i = f.readline()\n\nread all lines\ndir = r&quot;/home/narcissus/Desktop/遍历游标的三种方式.md&quot;\nwith open(dir,&quot;r&quot;) as f:\n    i = f.readlines()\n    for j in i:\n        print(j)\n\n# or use this\nwith open(dir,&quot;r&quot;) as f:\n    i = list(f)\n    for j in i:\n        print(j)\n\nread each word\ndir = r&quot;/home/narcissus/Desktop/遍历游标的三种方式.md&quot;\nwith open(dir,&quot;r&quot;) as f:\n    word = f.read(1)\n    while word:\n        print(word,end=&quot;&quot;)\n        word = f.read(1)\n\nwrite\nwrite: only support string\nwriteline: can write list directily\n\nimport os\n\ndir = r&quot;/home/narcissus/Desktop/1.txt&quot;\ntxt = os.listdir(&quot;/home/narcissus&quot;)\nneeded = [i for i in txt if not i.startswith(&quot;.&quot;)]\nwith open(dir, &quot;w&quot;) as f:\n    # write whole list once without space\n    f.writelines(needed)\n\n    # can not write list directily,but can use loop to write new line per element\n    # for i in needed:\n    #     f.write(i)\n    #     f.write(&quot;\\n&quot;)\nwith open(dir,&quot;r&quot;) as f:\n    info = f.readlines()\n    print(info)\n\npickle moduleit is used for persistence file, can save program’s information to disk while the program runing\nfeature:\n\nit can store infomation immediately\nit can store infomation with format unchanged\n\nfunction:\n\npickle.dump: write\npickle.load: read\n\nnotice:use binary mode to write or read file\nimport pickle,os\n\ndir = r&quot;/home/narcissus/Desktop/1.txt&quot;\ntxt = os.listdir(&quot;/home/narcissus&quot;)\ninfo = [i for i in txt if not i.startswith(&quot;.&quot;)]\nwith open(dir,&quot;wb&quot;) as f:\n    pickle.dump(info,f)\nwith open(dir,&quot;rb&quot;) as f:\n    get = pickle.load(f)\n    print(get)\n\nLogwhy we need log?recording some information at important points, suitable log information can let us to know program running statiusbut that isn’t to say log is much more much better,because io operation will slow down program.\nthere are several log level:\n\ndebug\ninfo\nnotice\nwarning\nerror\ncritical\nalert\nemergency\n\nlog include:[time location level content]\ngood log module:\n\nlog4j -&gt; java\nlog4php -&gt; php\nlogging -&gt; python\n\npython logging modulelevel:\n\ndebug\ninfo\nwarning\nerror\ncritical\n\ndefault log level:\n\nspecify a log level in program\nonly log level which equal or high above than specified level will be write in log\n\nusage:specify default log levelonly logging once at first time executes\nfeature:\n\nspecify the default log level\noutput: sys.stderr\ndefault level: warning\nformat: level:log_name:content\n\nlogging.basicConfig(**kwargs)\n\neg:\nimport logging\n\ndir = r&quot;/home/narcissus/Desktop/info.log&quot;\nlog_format = &quot;%(asctime)s   %(levelname)s   %(message)s&quot;\nlogging.basicConfig(filename=dir, level=logging.DEBUG, format=log_format)\n\nuse level functionlogging.debug(msg, *args, **kwargs)\nlogging.info(msg, *args, **kwargs)\nlogging.warning(msg, *args, **kwargs)\nlogging.error(msg, *args, **kwargs)\nlogging.critical(msg, *args, **kwargs)\n\neg:\nimport logging\n\nlogging.debug(&quot;this is a debug log&quot;)\nlogging.info(&quot;this is a info log)\n\nuse log functionlogging.log(level, *args, **kwargs)\n\neg:\nimport logging\n\nlogging.log(logging.DEBUG,&quot;this is a debug log&quot;)\nlogging.log(logging.INFO,&quot;this is a info log&quot;)\n\ncomplete example\nimport logging\n\ndir = r&quot;/home/narcissus/Desktop/info.log&quot;\nlog_format = &quot;%(asctime)s\\t%(levelname)s\\t%(lineno)d %(message)s&quot;\nlogging.basicConfig(filename=dir, level=logging.DEBUG, format=log_format)\n\n\nlogging.debug(&quot;this is a debug log&quot;)\nlogging.info(&quot;this is a info log&quot;)\n\nlogging.log(logging.DEBUG,&quot;this is a debug log&quot;)\nlogging.log(logging.INFO,&quot;this is a info log&quot;)\n\nby hand usage\nlogger: a interface of log produces log\nhandler: decide where log stores\nfilter: what should be displayed\nformatter: format\n\nlogger:\nLogger.setLevel()\nLogger.addHandler()/Logge.removeHandler()\nLogger.addFilter()/Logger.removeFilter()\nLogger.debug()/info/error\nLogger.exception()\nLogger.log()\n\n\nlogging.getLogger()\n\nand so on …..\nJsonconvert:\n\njson.dumps(): python -&gt; json\njson.loads(): json -&gt; json\n\nread and write with file:\n\njson.dump(): write to file\njson.load(): read from file\n\nimport json,os\n\ndata = &#123;\n    &quot;user&quot;: &quot;小小&quot;,\n    &quot;age&quot;: 20,\n    &quot;like&quot;: [&quot;juice&quot;,&quot;apple&quot;,&quot;cherry&quot;],\n    &quot;score&quot;: &#123;\n        &quot;chinese&quot;: 80,\n        &quot;math&quot;: 90,\n        &quot;english&quot;: 100\n    &#125;\n&#125;\n\njd = json.dumps(data)\nprint(type(jd),jd)\nnd = json.loads(jd)\nprint(type(nd),nd)\n\ndir = r&quot;/home/narcissus/Desktop&quot;\nos.chdir(dir)\nwith open(&quot;test.js&quot;,&quot;w&quot;) as f:\n    json.dump(data,f)\n\nwith open(&quot;test.js&quot;,&quot;r&quot;) as f:\n    file = json.load(f)\n    print(file[&quot;score&quot;][&quot;chinese&quot;])\n\nMulti threadsprocess vs thread:process totally different,but thread will share something.process builds with threads\nbasic usagesyntax:\nimport threading\n# args is tuple\ntd = threading.thread(target=function_name,args=())\n# set thread name,it is optional\ntd.setName(&quot;thread1&quot;)\n# start thread\ntd.start()\n# waiting for thread finish\ntd.join()   \n\nnotice:the type of args is tuple\ndaemon threadwhen process stops the daemon thread will stop immediately\nsyntax:\nimport threading\n# args is tuple\ntd = threading.thread(target=function_name,args=())\ntd.daemon = True # or td.setDaemon(True)\ntd.start()\n# waiting for thread finish\ntd.join()   \n\nshared variablesit is appeard when several threads access one variable at the same time, it will lead wrong result. In order to resolve this problem, we can lock the use of variable\nsyntax:\nlock = threading.Lock()\nlock.acquire()\nlockd_variable\nlock.release()\n\nwithout lock\nimport threading\n\nsum = 0\nnum = 1000000\n\ndef add(num):\n    global sum\n    for i in range(num):\n        sum += 1\n    return sum\n\ndef miu(num):\n    global sum\n    for i in range(num):\n        sum -= 1\n    return sum\n# normal usage will return sum = 0\n# miu(num)\n# add(num)\n# print(sum)\n\n\n# use thread access one variable at the same time will lead wrong result\ndef calcu():\n    td1 = threading.Thread(target=add,args=(num,))\n    td2 = threading.Thread(target=miu,args=(num,))\n\n    td1.start()\n    td2.start()\n    td1.join()\n    td2.join()\n\nif __name__ == &quot;__main__&quot;:\n    calcu()\n    print(sum)\n\nuse lock\nimport threading\n\nsum = 0\nnum = 1000000\nlock = threading.Lock()\n\n# lock variable to be accessd by one at the same time\ndef add(num):\n    global sum\n    for i in range(num):\n        lock.acquire()\n        sum += 1\n        lock.release()\n    return sum\n\ndef miu(num):\n    global sum\n    for i in range(num):\n        lock.acquire()\n        sum -= 1\n        lock.release()\n    return sum\n\n\ndef lock_calcu():\n    ld1 = threading.Thread(target=add,args=(num,))\n    ld2 = threading.Thread(target=miu,args=(num,))\n\n    ld1.start()\n    ld2.start()\n\n    ld1.join()\n    ld2.join()\n\nif __name__ == &quot;__main__&quot;:\n    lock_calcu()\n    print(sum)\n\nthread safeif one variable to be used by multi threads at the same time without lock variable but no problem happend, it is called thread safe.\nnot thread safe: list, set, dict\nthread safe: queue\ndeadlocktwo lock both not release, lead to both waitting, deadlock appeard, leading program dead\nmuiti processeswe know multi threads will cause problem usually, but there are several method more useful than multi threads:\n\nsubprocess\nmultiprocessing\nconcurrent.futures\n\niterable/iteratordifference:iterable -&gt; directly used by for loopiterator -&gt; not only used by for loop but also can be used by next function\nhow to distinct each other:\nfrom collections import Iterable,Iterator\n\nlt = [i for i in range(10)]\n\nprint(isinstance(lt,Iterable))\nprint(isinstance(lt,Iterator))\n\nconvert iterable to iterator:\nfrom collections import Iterable,Iterator\n\nlt = [i for i in range(10)]\n\nprint(isinstance(lt,Iterable))\nprint(isinstance(lt,Iterator))\n\nclt = iter(lt)\nprint(isinstance(clt,Iterable))\nprint(isinstance(clt,Iterator))\n\ngeneratorfeature:\n\nproduct data which used by for loop\nat the end of generator raise StopIterationError\ncan be used by next() function\n\nwhy we need generator?all data are calculated step by step when in need, don’t store in memory, use cpu instead of memory. range() is a generator,so we need use it often, it is more useful than list.\nhow to make a generator\n\n()\nyield: yield can stop loop until next iterate\n\nuse ()\nlt = [i for i in range(10)]\nlg = (i for i in range(10))\n\nprint(type(lt))\n# lg is a generator\nprint(type(lg))\n\nuse yield\n# normal usage\n# 1,1,2,3,5,8,13\n# def fib(num):\n#     a,b,n = 0,1,0\n#     while n &lt; num:\n#         a,b = b,a+b\n#         n += 1\n#     return a\n# fib(6)\n\n\n# use yield\ndef fib(num):\n    a,b,n = 0,1,0\n    while n &lt; num:\n        # yield can stop loop until next iterate\n        yield b\n        a,b = b,a+b\n        n += 1\n\n# generator is iterable\nfor i in fib(7):\n    print(i)\n\ncoroutinescoroutines is much more useful than multi threads, it’s need less resource, we can regard it as a generator or a function which can be stopd\nhow to realize it?\n\nyield: return result\nsend: send args to generator\nyield from: as a middle hand transfer message\n\nyield x: return xx = yield: get x value from send() function\ndef test_coroutine():\n    print(&quot;start&quot;)\n    x = yield\n    print(&quot;get&quot;,x)\n    yield x\n\n\nco = test_coroutine()\nnext(co)\nco.send(20)\n\nyield from\ndef test_coroutine(st):\n    for i in range(st):\n        yield i\n\ndef get_num():\n    yield from &quot;1234567&quot;\n\nprint(list(get_num()))\n\nasync/waitimport asyncio\n\nasync def get_num(num):\n    for i in range(num):\n        print(i)\n        await asyncio.sleep(1)\n\nloop = asyncio.get_event_loop()\nlt = [get_num(10),get_num(20)]\nloop.run_until_complete(asyncio.wait(lt))\nloop.close()\n\nconcurrent.futures\nuse subprocess, run several python interpreter. each subprocess can use a core of cpu, all core of cpu can be used 100%\nuse multithreads, as we know python can only use one thread at one time, so it uses the same time as one process, and each of thread can not pull use cpu\n\nThreadPoolExecutoralthough my cpu only have 4 core 8 thread, but each cpu didn’t be full used, it is because python can only run one thread at one time, threadpool is also thread.\nfrom concurrent.futures import ThreadPoolExecutor\n\ndef ts(num):\n    sum = 0\n    print(threading.current_thread())\n    for i in range(num):\n        sum += 1\n    return sum\n\npool = ThreadPoolExecutor(max_workers=8)\n\nt1 = pool.submit(ts, 100000000)\nt2 = pool.submit(ts, 100000000)\nt3 = pool.submit(ts, 100000000)\nt4 = pool.submit(ts, 100000000)\nt5 = pool.submit(ts, 100000000)\nt6 = pool.submit(ts, 100000000)\nt7 = pool.submit(ts, 100000000)\nt8 = pool.submit(ts, 100000000)\n\nprint(t1.result())\nprint(t2.result())\nprint(t3.result())\nprint(t4.result())\nprint(t5.result())\nprint(t6.result())\nprint(t7.result())\nprint(t8.result())\n\nuse map\nfrom concurrent.futures import ThreadPoolExecutor\n\ndef ts(num):\n    sum = 0\n    print(threading.current_thread())\n    for i in range(num):\n        sum += 1\n    return sum\n\npool = ThreadPoolExecutor(max_workers=8)\n\n\nlt = [100000000] * 8\nfor i in pool.map(ts,lt):\n    print(i)\n\nProcessPoolExecutorall core of cpu can be used 100%\nfrom concurrent.futures import ProcessPoolExecutor\n\ndef ts(num):\n    sum = 0\n    print(threading.current_thread())\n    for i in range(num):\n        sum += 1\n    return sum\n\npool = ProcessPoolExecutor(max_workers=8)\n\n\nlt = [100000000] * 8\nfor i in pool.map(ts,lt):\n    print(i)\n\nregular expression\nthere are two methods\n\ncompile re to a object```pythonimport re\n\n  s = “Hello, Join. where did you go? 123,hk123,H89Hk”  p = re.compile(“[0-9]{1,}”)  m = p.findall(s)  print(m)\n\n2. use re directory\n```python\nimport re\n\ns = &quot;Hello, Join. where did you go? 123,hk123,H89Hk&quot;\nm = re.findall(&quot;[0-9]&#123;1,&#125;&quot;,s)\nprint(m)\n\n\nignore case\n\n\nimport re\n\ns = &quot;Hello, Join. where did you go? 123,hkj123,H89Hjk&quot;\np = re.compile(&quot;h&quot;,re.I)\nm = p.findall(s)\nprint(m)\n\n\nsubstitute\n\nimport re\n\ns = &quot;Hello, Join. where did you go? 123,hkj123,H89Hjk&quot;\np = re.compile(&quot;\\d+&quot;)\nt = p.sub(&quot;000&quot;,s)\nprint(s)\nprint(t)\n\n\ncatch chinese\n\nimport re\n\ns = &quot;Hello, 世界. 喜欢你where did you go? 123,hkj123,H89Hjk&quot;\np = re.compile(&quot;[\\u4c00-\\u9fa5]+&quot;)\nt = p.findall(s)\n\nprint(t)\n\n\ncatch no chinese\n\nimport re\n\ns = &quot;Hello, 世界. 喜欢你where did you go? 123,hkj123,H89Hjk&quot;\np = re.compile(&quot;[^\\u4c00-\\u9fa5]+&quot;)\nt = p.findall(s)\n\nprint(t)\n\nXpathit is used to find xml file\nsyntax:\n\n/: root node\n//: two node\n.: current node\n..: father node\n@: property\n\nnet programnetwork model:\n\n7 layers model\nLayer 7 - Application\nLayer 6 - Presentation\nLayer 5 - Session\nLayer 4 - Transport\nLayer 3 - Network\nLayer 2 - Data Link\nLayer 1 - Physical\n\n\n4 layers model\nLayer 4 - Application\nLayer 3 - Transport\nLayer 2 - Network\nLayer 1 - Link\n\n\n\nftp\nleaning website: link\n\nPython ftplibpython ftplib is a module that implements the client side of the FTP protocol. It contains an FTP client class and some helper functions. \n\nPython FTP clasThe ftplib.FTP() creates a new instance of the FTP class. When host is given, a connection to the host is made with the connect() method. \n\n\nexample:\nin my archlinux, i start vsftpd.service first\nsudo systemctl start vsftpd\n\nand then change the default config /etc/vsftpd.config to enable local user login\nat last i write a ftp python file\nimport ftplib\n\n# a anonymous function print lines\nline = lambda x: print(x * 80)\n\n# get ftp login user and passwd\nuser = input(&quot;ftp login user name: &quot;)\npwd = input(&quot;password: &quot;)\n\nwith ftplib.FTP(&quot;localhost&quot;) as ftp:\n    try:\n        # get connection\n        ftp.login(user=user, passwd=pwd)\n\n        # print welcome information\n        info = ftp.getwelcome()\n        print(&quot;welcome: &quot;,info)\n        line(&quot;-&quot;)\n        \n        # change current directory\n        ftp.cwd(dirname=&quot;Desktop&quot;)\n\n        # get current directory\n        current_dir = ftp.pwd()\n        print(&quot;current_dir: &quot;,current_dir)\n        line(&quot;*&quot;)\n\n        # get context list\n        files = []\n        ftp.dir(files.append)\n        for i in files:\n            print(i)\n        line(&quot;=&quot;)\n\n        # download file, by default the file will be stored at /tmp/\n        file_copy = &quot;test.txt&quot;\n        with open(file_copy, &quot;w&quot;) as f:\n            res = ftp.retrlines(&quot;RETR &quot;+&quot;1.py&quot;, f.write)\n            \n            if not res.startswith(&#39;226 Transfer complete&#39;):\n                print(&#39;Download failed&#39;)\n                if os.path.isfile(file_copy):\n                    os.remove(file_copy)  \n            else:\n                print(&quot;down&quot;)\n        \n    except ftplib.all_errors as e:\n        print(e)\n\nmailhow it works?process: user mail —-&gt; mail proxy —–&gt; mail server —–&gt; useragent: ————&gt;mua————–&gt;mta—————&gt;mdaprotocal: —————–&gt;SMTP————-&gt;POP3/IMAP\nMUA: MailUserAgent, user send mail to proxyMTA: MailTransferAgent, catch mail from proxy to mail serverMDA: MailDeliveryAgent, deliver mail from server to user\nhow to use it:there are two modules\n\nemail: used to modify mail\nsmtplib: used to send mail\n\nthe following is a simple text mail example.\nimport smtplib\nfrom email.mime.text import MIMEText\n\n\n# define some variables\nfrom_addr = &quot;1025096440@qq.com&quot;\n# this is a code from web mail\nfrom_pwd = &quot;nrbnnibhjrgrbcdd&quot;\nto_addr = &quot;1025096440@qq.com&quot;\nsmtp_srv = &quot;smtp.qq.com&quot;\n\n# write message\ntext_msg = MIMEText(&quot;第一封邮件&quot;, &quot;plain&quot;, &quot;utf-8&quot;)\n\n# add header\ntext_msg[&#39;From&#39;] = from_addr\ntext_msg[&#39;To&#39;] = to_addr\ntext_msg[&#39;Subject&#39;] = &quot;测试&quot;\n\n\ntry:\n    # server address need encode to byte,so we need encode it\n    # port 465 is a security port which server accept\n    srv = smtplib.SMTP_SSL(smtp_srv.encode(), 465)\n\n    # login\n    srv.login(from_addr,from_pwd)\n\n    # send text mail\n    srv.sendmail(from_addr, [to_addr], text_msg.as_string())\n    srv.quit()\nexcept Exception as e:\n    print(e)\nelse:\n    print(&quot;done&quot;)\n\nthe following is a text format mail with additional file \nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEBase,MIMEMultipart\n\n\n\n# some variables\nfrom_addr = &quot;1025096440@qq.com&quot;\n# this is a code from web mail\nfrom_pwd = &quot;nrbnnibhjrgrbcdd&quot;\nto_addr = &quot;1025096440@qq.com&quot;\nsmtp_srv = &quot;smtp.qq.com&quot;\nfiles = r&quot;/home/narcissus/Desktop/1.py&quot;\n\n# initial multipart object\nmail_mul = MIMEMultipart()\n# add header\nmail_mul[&#39;From&#39;] = from_addr\nmail_mul[&#39;To&#39;] = to_addr\nmail_mul[&#39;Subject&#39;] = &quot;use python email and smtplib module send mail&quot;\n\n# write message\ntext_msg = MIMEText(&quot;the email include text message and file&quot;, &quot;plain&quot;, &quot;utf-8&quot;)\n\n# add text to multipart object\nmail_mul.attach(text_msg)\n\n# add file\nwith open(files, &quot;rb&quot;) as f:\n    line = f.read()\n    content = MIMEText(line, &quot;base64&quot;, &quot;utf-8&quot;)\n    content[&quot;Content-type&quot;] = &quot;application/octet-stream&quot;\n    content[&quot;Content-Disposition&quot;] = &quot;attachment; filename=files&quot;\n    mail_mul.attach(content)\n\n# send mail\ntry:\n    # server address need encode to byte,so we need encode it\n    # port 465 is a security port which server accept\n    srv = smtplib.SMTP_SSL(smtp_srv.encode(), 465)\n\n    # login\n    srv.login(from_addr,from_pwd)\n\n    # send text mail\n    srv.sendmail(from_addr, [to_addr], mail_mul.as_string())\n    srv.quit()\nexcept Exception as e:\n    print(e)\nelse:\n    print(&quot;done&quot;)\n\nthe following is a html format mail example.\nimport smtplib\nfrom email.mime.text import MIMEText\n\n# write message\nhtml_msg = &quot;&quot;&quot;\n    &lt;!DOCTYPE html&gt;\n    &lt;html lang=&quot;en&quot;&gt;\n    &lt;head&gt;\n        &lt;meta charset=&quot;UTF-8&quot;&gt;\n        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;\n        &lt;title&gt;Document&lt;/title&gt;\n        &lt;script src=&quot;./vue.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1 style=&quot;background: #7fedbb&quot;&gt;有情人难成属眷&lt;/h1&gt;\n    &lt;/body&gt;\n    &lt;/html&gt;\n    &quot;&quot;&quot;\nhtml_msg = MIMEText(html_msg, &quot;html&quot;, &quot;utf-8&quot;)\n# some variables\nfrom_addr = &quot;1025096440@qq.com&quot;\n# this is a code from web mail\nfrom_pwd = &quot;nrbnnibhjrgrbcdd&quot;\nto_addr = &quot;1025096440@qq.com&quot;\nsmtp_srv = &quot;smtp.qq.com&quot;\n\ntry:\n    # server address need encode to byte,so we need encode it\n    # port 465 is a security port which server accept\n    srv = smtplib.SMTP_SSL(smtp_srv.encode(), 465)\n\n    # login\n    srv.login(from_addr,from_pwd)\n\n    # send html mail\n    srv.sendmail(from_addr, [to_addr], html_msg.as_string())\n    srv.quit()\nexcept Exception as e:\n    print(e)\nelse:\n    print(&quot;done&quot;)\n\nalternative choose html format or text format, because some fo device can not display html format\nimport smtplib\nfrom email.mime.text import MIMEText\nfrom email.mime.multipart import MIMEMultipart\n\n\n\n# some variables\nfrom_addr = &quot;1025096440@qq.com&quot;\n# this is a code from web mail\nfrom_pwd = &quot;nrbnnibhjrgrbcdd&quot;\nto_addr = &quot;1025096440@qq.com&quot;\nsmtp_srv = &quot;smtp.qq.com&quot;\n\n# initial multipart object\nmail_mul = MIMEMultipart(&quot;alternative&quot;)\n# add header\nmail_mul[&#39;From&#39;] = from_addr\nmail_mul[&#39;To&#39;] = to_addr\nmail_mul[&#39;Subject&#39;] = &quot;use python email and smtplib module send mail&quot;\n\n# write message\ntext_msg = MIMEText(&quot;alternative choose text or html style&quot;, &quot;plain&quot;, &quot;utf-8&quot;)\n\n# add text to multipart object\nmail_mul.attach(text_msg)\n\n# write html\nhtml_msg = &quot;&quot;&quot;\n    &lt;!DOCTYPE html&gt;\n    &lt;html lang=&quot;en&quot;&gt;\n    &lt;head&gt;\n        &lt;meta charset=&quot;UTF-8&quot;&gt;\n        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;\n        &lt;title&gt;Document&lt;/title&gt;\n        &lt;script src=&quot;./vue.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1 style=&quot;background: #7fedbb&quot;&gt;有情人难成属眷&lt;/h1&gt;\n    &lt;/body&gt;\n    &lt;/html&gt;\n    &quot;&quot;&quot;\nhtml_msg = MIMEText(html_msg, &quot;html&quot;, &quot;utf-8&quot;)\nmail_mul.attach(html_msg)\n\n# send mail\ntry:\n    # server address need encode to byte,so we need encode it\n    # port 465 is a security port which server accept\n    srv = smtplib.SMTP_SSL(smtp_srv.encode(), 465)\n\n    # login\n    srv.login(from_addr,from_pwd)\n\n    # send text mail\n    srv.sendmail(from_addr, [to_addr], mail_mul.as_string())\n    srv.quit()\nexcept Exception as e:\n    print(e)\nelse:\n    print(&quot;done&quot;)\n\n\nthe end! I am really happy that i learn all of them. It is really awesome,nice.\n","categories":["learn"],"tags":["python"]},{"title":"terminal","url":"/2022/04/23/terminal/","content":"TERMINALterminal is a topic include many many things, and i will complete it.\nSHORTCUTclean and movement\nctrl + l # clearn screen\n\nctrl + a # move cursor to the begin\n\nctrl + e # move cursor to the end\n\nalt + b # move cursor one word before\n\nalt + f # move cursor one word after\n\nctrl + u # clear to the begin and yank to clipboard\n\nctrl + k # clear to the end and yank to clipboard\n\nalt + backspace || ctrl + w # clear one word before\n\nctrl + y # paste last command&#39;s last argument\n\n\nNote: in zsh, some of the key binding is not working by default. so we need add key binding by hand.\n\n# find all registered zle commands\nzle -al\n\n# bind personal key for zsh, add to .zshrc\nbindkey ^K kill-line   \nbindkey ^B backward-word \nbindkey ^F forward-word \nbindkey ^Y insert-last-word\n\n# show all binded keys\nbindkey\n\ndisplay and process\nctrl + c # end process\n\nctrl + z # stop current process and send to backend\n\nctrl + d # end typing\n\nctrl + s # hide character typed and output\n\nctrl + q # get out of hide mode and display\n\nGREAT WORKFLOWif you forget to type sudo at the beginning, there are two convenient ways. and i prefer the second one\n# first\nctrl + a\nsudo\n\n# second \nctrl + u \nsudo\nctrl + y\n\nCOMMANDwrap terminal long lineview all message with this page\nsometimes the terminal output is too long, in default the long line will wrap in several lines, and we cannot see each line’s begin.\nthere are several methods to solve this problem:\n\nedit terminal setting\n# such as in xterm disable line wrap\nsetterm --linewrap off\n\n\nuse -S of less\n# such as \nps -ef |grep code |less -S\n\n\n\n\nlast commandthere i will show how to modify the last command since it is really very useful in our daily typing.\n# repeat last command\n!!\n\n# repeat second last command\n!-2\n\n# get last command first argument\n!^\n\n# get last command last argument\n!$\n\n# get last command Nth argument, n is numeric, such as 1,2...11...\n!:n\n\n# modify last command and execute\n!:s/xxx/yyy\n\nmktemp在脚本中经常遇到需要创建临时文件或目录的情况，直接使用命令在/tmp目录下创建存在安全问题，所以更好的是使用mktemp命令\n# file\nTEMPFILE=$(mktemp) || exit 1\n\n# dir\nTEMPFILE=$(mktemp -d) || exit 1\n\ntrap临时文件或目录使用完后需要清理，可以搭配trap命令。trap命令放在文件最开头，这样可以包含所有后面的信号\ntrap [command] [signal]\n\n#!/bin/bash\n\ntrap &quot;rm -rf $TEMPFILE&quot; EXIT\nTEMPFILE=$(mktemp) || exit 1\n\n# 信号\nHUP：编号1，脚本与所在的终端脱离联系。\nINT：编号2，用户按下 Ctrl + C，意图让脚本中止运行。\nQUIT：编号3，用户按下 Ctrl + 斜杠，意图退出脚本。\nKILL：编号9，该信号用于杀死进程。\nTERM：编号15，这是kill命令发出的默认信号。\nEXIT：编号0，这不是系统信号，而是 Bash 脚本特有的信号，不管什么情况，只要退出脚本就会产生。\n\nsshfssshfs和nfs作用相同，都是挂载远程目录，但是sshfs更加简单，只需要在本地安装sshfs即可，因为连接使用的是ssh\n# install\napt install sshfs\n\n# mount\nsshfs root@192.168.31.121:/opt /opt\n\n# umount\nfusermount -u /opt\n\nstty修改终端的设置\n# show all setting\nstty -a\n\n# disable input echo\nstty -echo\n\n# enable input echo\nstty echo\n\n在有些程序中（例如ftp），按下回车键不能删除字符，而是显示^H，为了解决这个问题，可以在使用ftp之前进行设置\nstty erase ^H\n\n设置之后回车即可删除，但是在shell下回车会变成^?，所以有必要改回来\nstty erase ^?\n\n同时stty还可以查看/设置屏幕高度和宽度\nstty size\nstty rows 100 cols 100\n\nqmvqmv/qcp/qcmd属于renameutils软件包，可以用编辑器快速对文件重命名，默认使用nano打开文件，可以指定vim打开进行更加高效的操作\nexport EDITOR=vim\n\n# rename all jpg\nqmv *.jpg\n\n# only show target column\nqmv *.jpg -f do\n\n\npidof查看进程的pid，效果等同于pgrep\npgrep xxx\npidof xxx\n\n$!check last backend jobs’s pid\n# if we have a backend jobs\nsleep 100 &amp;\n\n# then we can access its pid with\necho $!\n\nrgrg(ripgrep), ag(the silver search) is the newest grep tool, much more faster than grep\n# almost the same useage of grep\nrg xxx\n\nfdfd-find is the newest find tool, much more faster then find\n# different with find, but more simple\nfdfind md$ #\n\nexaexa is the colorful tool of ls\n# include tree display\nexa -T\n\ncrontabcrontab can not only used to execute regular task, but also at a specified time, such as reboot\n# execute at reboot\n@reboot /location/to/script\n\n# reboot and wait for a while\n@reboot sleep 60 /location/to/script\n\nnot stores in historyif we put a space before command, then it will not store in history\n echo &quot;cannot find this command in history&quot;\n\ndisownexit terminal but leave all processes running\ndisown -a &amp;&amp; exit\n\ntmpfscreate a super fast ram disk\nmkdir /mnt/ram\nmount -t tmpfs tmpfs /mnt/ram -o size=8G\n\n# change mount size without reboot\nmount -o remount,size=4G /mnt/ram\n\nlong commnaduse shortcut opening a editor to write long command or multi commands instead of the terminal\nctrl+x+e\n\nfcopen a editor to edit the last command you run and then execute it automatically\nvim /etc/sysconig/network-scripts/ifcfe-en980\nfc\n\ncatch log fileif  the log file is not big enough, we can use less +F instead of tail -f, because with it we can do more control of output. such as we can see old message with ctrl + c and scroll , and than shift + f to the end with tailing\nless +F file_name\n\n# or press shift + f after opening a file when we only use less command\nless file_name\nshift + f\n\n# q to quit\nq\n\nalso we can combine this option with -S to wrap long lines, pretty much useful\nless -S +F file_name\n\nresetthere is no need to close and reopen you terminal to reset all the things such as variable setting. just typing reset , all will be done\nreset\n\ndoasI will use doas instead of sudo, because i get confused when i find /etc/sudoers file includes root settings. I wonder why it includes root settings, root has the highest privileges by default. At last i know the reason that with the settings root can use sudo command.\n# in archlinux, install opendoas\npacman -S opendoas\n\n in order to make it effects, we need create a configure file and write our configuration to it\n# allow all users belong to wheel group execute super user command without password\necho &quot;permit nopass :wheel&quot; &gt; /etc/doas.conf\n\n\nNote:\n\nnopass allow us to run command without password\nuse : before wheel means wheel is a group\n\n\nserveral days after, i find that i need reinstall sudo package, because some program need sudo, such as psd, build package with aur, without sudo there will be an error occurs.\nrsyncrsync must be installed in two machines if the two machine need to sync files\nI have ever used linux nearlly 5 years, however i know the awesome command this days. the main features:\n\nIt can implement cp scp, but more powerful\nIt can specified some file to skip\nIt can delete different files in destination\n\n\nfunny:\nI have ever wrote a shell script to backup my linux configure file. There is a satulation that the configure file in linux i have deleted but the backup directory still has the file, it is hard to check which file should be delete, so i delete whole directory and then copy directory to destination. Now, with rsync it seems that much easier.\n\n# --delete will delete destination file which not exists in source directory\nrsync --include &#39;*.txt&#39; --exclude &#39;*.sh&#39; --delete -av remoteUser@ip:/remote/directory /local/directory\nrsync --include &#39;*.txt&#39; --exclude &#39;*.sh&#39; --delete -av /local/directory remoteUser@ip:/remote/directory \n\nbata colorful repalcement of cat\n# show text with line number and scroll like less\nbat -pn\n\n# show all text with line number at once\nbat -ppn\n\ncpufetchshow detail informatioin of cpu\nxdotoolxdotool can do lots of things, such as simulate mouse action, key press, get window properity and so on.\n# key press\nxdotool key &quot;l&quot; &quot;s&quot; return return\n\n# get current window class name\nxdotool getwindownfocus getwindowclassname\n\n# get mouse location\nxdotool getmouselocation\n\nyadyad is gui dialog tool which can be used to launch a dialog for shell input. though i have ever not used xdialog, i think it is much better than xdialog.\n# setting with timeout,position,length,window title,label text,default placeholder,button position.\nyad --entry --timeout=5 --center --fixed --title=&#39;change app transparence&#39; --entry-label=&quot;App name:&quot; --entry-text=&quot;$currentApp&quot; --buttons-layout=edge\n\n# also can use text to specified window text\nyad --entry --timeout=5 --center --fixed --title=&#39;change app transparence&#39; --entry-label=&quot;App name:&quot; --entry-text=&quot;$currentApp&quot; --buttons-layout=edge --text=&quot;CHANGE APP TRANSPARENCE&quot;\n\nmount bindit is a very useful tool much better than ln -sf, ln is a tool to create a link(file) redirect to other position, and mount --bind will mount some folder/file to a specified location at boot time in kernel. so mount --bind‘s operation makes effect to origin location.\n# temporary\nmount --bind /mount/folder /to/mount/point\n\n# permanent\nvim /etc/fstab\n/mount/folder /to/mount/point    none    rw,bind 0 0\n\nnsenterenter new namespace with nsenter command. it is a really useful tool with container if the container don’t have  ip command.  we can use this to  easily get container ip address and route table.\n# get container&#39;s  pid\npid=`podman inspect -f &#123;&#123;.State.Pid&#125;&#125; container_name`\n\n# or use ps command\nps -ef |rg $(ps -ef |rg container_name |awk &#39;&#123;print $2&#125;&#39; |head -1) |tail -1 |awk &#39;&#123;print $2&#125;&#39;\n\n# get container ip address\nnsenter -t $pid -n ip -c a\n\n# get container ip route table\nnsenter -t $pid -n ip -c r\n\ncczewith ccze the output in terminal will be colorized.\n# usage\nps -ef |rg firefox |ccze -A\n\npodman images |ccze -A\n\nSHELLsome userful, unusual, amazing usage or tips\nfind test shortcut meaningmost of time i will forget what the shortcut in shell condition meaning, but now i find a way to find all the shortcut meaning.\nman test\n\ngrant privilege to normal user with the owner’s permissionyeah, i remember to learn setuid and setgid. but still today, i really know the right usage of them, and i have to say they are very powerful for our daily use.\nas we know some command need root privilege to execute, when i meet this requirement before, i often put this command to sudoers file to make it execute without password, in a fact this method is too stupid. it is simple to resolve with setuid or setgid.\nsetuid and setgid or a command to be executed, it is a property of the command.\n# grant user privilege\nchmod u+s /some/command\n\n# grant group privilege\nchmod g+s /some/command\n\nremote X11 forward with sshwe can open remote machine’s GUI program in local  with ssh even though remote machine without a full X11 system installed. but local machine must has a full X11 system environment.\nremote machine:\n\ninstall xauth and xhost(optional)\n/etc/ssh/sshd_config allow X11Forwarding, AllowTcpForwarding, X11UseLocalhost to yes and X11DisplayOffset=10 \nrestart ssh\n\nlocal machine:\n\ninstall xauth\n\n# specify X11 forwarding\nssh -X remote_user@remote_ip\n# then open remote gui program such as xterm\nxterm\n\nuse Xvfb open application without GUIas we know there are so many programs load in background and they are be called daemons, however not all of the programs be designed like that, may be we have the need of opening some GUI applications in background and we don’t want to see the GUI each time the system starts.\nwith Xvfb we can do that, it opens GUI application in virtual memory without showing any screen output. in archinux, we can install it with\npacman -S xorg-server-xvfb\n\naccording to this webpage, if we want to run some GUI application in background, we can write like this\n# open a virtual frame buffer called :1\nXvfb :1 &amp;\n# specify the application to start in virtual frame buffer :1\nDISPLAY=:1 /location/to/gui/application &amp;\n\nmay be we can use it in browser testing, and starting pentablet app\nthe problem of numthe way to get the hour of system will lead some problem while comparing with this nums, because all num begin with 0 is recognized as octonary\nhour=`date +%H`\n\n[[ hour -eq 8 ]] || EXIT\n#[[: 08: value too great for base (error token is &quot;08&quot;)\n\nthe way to fix the problem is adding 10# at the begining\nhour=10#`date +%H`\n[[ $hour -eq 8 ]] || EXIT\n\nthe problem of column alignmentcolumn can deal most of column’s alignment, however sometimes i don’t know why it fails, at last i find command  expand can work with column to fix the problem.\n\nfor loop in shellfor ((i=0; i&lt;5; i++))\ndo\n    echo $i\ndone\n\nvariable expansion# set default value\n$&#123;var:-default&#125;\n$&#123;var:=default&#125;\n$&#123;var=default&#125;\n\n# if variable not defined before then give a message\n$&#123;var?message&#125;\n\n# cut variable with index and length\n$&#123;var:index:length&#125;\n\n# cut variable with pattern\n$&#123;var#*pattern&#125; #cut left to the first match\n$&#123;var##*pattern&#125; #cut left to the last match\n$&#123;var%pattern*&#125; #cut right to the first match\n$&#123;var%%pattern*&#125; #cut right to the last match\n\n# get variable length\n$&#123;#var&#125;\n\n# show all variables matched with begining of \"pre\"\n$&#123;!pre*&#125;\n\n# variable replace\n$&#123;var/match/replace&#125; #replace the first one matched\n$&#123;var//match/replace&#125; #replace all matched\n$&#123;var/#match/replace&#125; #only replace the first one matched\n$&#123;var/%match/replace&#125; #only replace the last one matched\n```\n\n### privilege of script\n\nsometimes we may meet the problem of privilege in our script as a normal user, because some commands need to be executed with root privilege.\n\n```shell\n# one method is send root password to sudo\necho \"password\" |sudo -S command\n\n# another way is giving the script privilege of without password\necho  ALL=(ALL) NOPASSWD: \n# then execute script with sudo\nsudo \n```\n\n### alias act as function\n\nthere is a concept in perl called one liner, with zsh, we can use function to write one liner, but bash cannot. however we can use alias, is it amazing? just think of it a little more deeper, both of them are block code.\n\n```shell\n# with zsh, function can write in one line\nfunction autoline()&#123;for ((i=0;i` to truncate a file, `>>` append to a file. and there has a method to disable truncate file in global in order to less mistake happend\n\n```shell\n# disable truncate file, now only append to file allowed\nset -C\n\n# enable truncate file\nset +C\n```\n\n> Note:\n> \n> unset has totally different usage, it is used for clear variable define: `var=5; unset var`\n\n### array in shell\n\ndifferent shell has different usage\n\n```shell\n# in bash, it is complex with index\narray=(1 2 3 4 5)\nlen=$&#123;#array[@]&#125;\nfor ((i=0; i","categories":["learn"],"tags":["linux"]},{"title":"the-reality","url":"/2022/07/04/the-reality/","content":"Reality现在是凌晨3:45，而我刚从公交车站回来，yeah，似乎现实与虚幻交织。昨天我拿主板的时候居然把食指划了一条口，当时我都有些不可置信主板也能把手划伤。而昨天的划伤似乎是今天发生的事情的预兆，yeah，我第一次打110报警。\n刚开始我却是有些激动，这都是些什么狗屁国家规定，因为出去做了一个核酸，然后不让我回家了，说72小时不能进去。我当时就火了，以前明明只要做了核酸就可以进去，如今非要24小时证明。换言之，你永远别想进去睡觉除非有那个该死的24小时证明。\n我试图闯进去，我很清楚这种做法没有任何作用，但是我还是想这么做，不仅仅是为了我自己，也是给那些乖乖的绵羊们看看如何才叫做一个有血性的人。我们不能被这种邪恶的政府随意制定的规则摆弄，我们是人，本来是你租的房子，但是你没有权利住，即便外面下着雨，他们还是不管不顾。他们唯一拥有的就是这是国家规定的这句话。他们不care你是淋雨还是躲在那个角落，我感觉一瞬间就成了一个无家可归的人，no body care where you can live, no body care whether you good, no body care whatever, it seems that i am a dog, no rights to choose, no rights to fight, the only one thing i can do is do as what they want.\n结果那个人推了我几下，我才发现嘴角已经淤青了一小块，之前还以为没什么。不过我报警了，哈哈，不得不承认这是我做的最坏的一个决定。我以为他们会讲理，以为他们会给对我动手的人一些惩罚，然而，他们是同样的思考模式，why you don’t have 72 hours proof? what a fucking word, i really hate this one. the only thing they can thought is that why you aren’t a pretty pet? but i need is where i live tonight, can you sir help me? if i know they forbid people come in without 24 hours proof, i will never ever go out. but the only thing they have is blame，it is all because your fault. you deserve it.\n到了警察局后没有座位，很多人，我们都是在门外面站着，因为不允许进去。找警察局的人真的特别多，都得排队等。其中有一个人，看着非常生气，身高1.8左右也很壮，从说话动作可以看出它是一个混混，他指着另外一个拿着文件袋的穿着制服的人大骂，说要出去之后杀了他。那个人看着好弱小，40多岁，皱巴的制服衣裳，对着另外一直狂叫的狗一样的东西有些不敢直视它的眼睛。我知道仅仅从这些外表现象就判断那个人好，那个人坏是非常不正确的，更何况我知道人是多面的。然而在他大骂的时候我却想到了我，我当时会不会也像这个狗一样的家伙那样野蛮不讲理？虽然我知道我没有骂人，也没有想害人，但是我的愤怒和他一样。而这让我感到害怕，我似乎在被邪恶吞噬，他们似乎已经存在我的灵魂。\n那一刻我突然觉得释怀了，因为我决定我一定不要成为这样的人。但是我也突然茫然了，我所坚持和争取的是对的吗？我们真的要遵守这些不讲道理的规定吗？会不会是我不遵守规则导致的呢？这会不会就仅仅是我的问题，我应该像大家一样严格遵守所谓的国家规定这才是遵纪守法吗？现实中我没有找到答案，但是我在韩剧中找到了答案。\n这一幕幕所呈现出来的不就是韩剧中那些大奸大恶之人的所作所为吗？失去良心的官员门，制定一项一项严苛的命令，每一项命令的结果从来都是以牺牲百姓为代价。是的，我突然觉得这就是电视剧啊，他们不管那么多，他们只管遵守上级的命令，至于你是死是活，是苦是乐与他们有和关系呢？然而现实如戏剧，我就生活在这样一个丑陋的社会之下，并不是我想遵守这些规矩，而是不遵守会给我带来无穷无尽的痛苦，而遵守却有可能堕落为恶魔，因为如果不时刻谨记，何为善何为恶，我就会像之前一样无法分辨是我的错还是规则的错。\n还有一个特别讽刺的事情，我们每个在局外的人都没有座位，要么站着要么做台阶上，就仅仅是这一点我就觉得我们和朝鲜没什么两样，而和那些民主国家的差距是银河之遥。但还不够，一个看门的人员给一个警察拿了一把椅子在最高的台阶坐下，过了一会有一个办完事的人连着给警察说了几声谢谢，讽刺的是，这个警察居然从嘴里蹦出了几个完全不合语境的话：为人们服务嘛，为你们服务嘛，没什么。我真的只想拍手叫绝，你这真的是在为人们服务啊，自己坐着似乎是这个世界上唯一的一把椅子，对着所有趴在地上的人说，唉，这都是为你们服务嘛！\n在局外做了4，5个小时，见识了各种纠纷的事件。让我感叹的是，这里的人为何戾气那么重，当然也包括我，还是说这就是整个社会的一个缩影呢？为什么人们都不能大度一点，从容一点，懂得互相尊重呢？\n当我觉得这个社会已经无可救药的时候，却看见了善意，我走了10，20分钟到处找公共厕所，都没找到，最后看见了一个地铁站，我想这里可能有吧。但是已经过了12点了，结束运营了，但是我还是想试一试，我问一个快50岁的人，可以去上个厕所吗？他犹豫了一会说你要快点，因为马上就要关了。我不明白他说的关是地铁口关还是什么其它的，但是因为他犹豫了，所以让我看见了善良。我知道因为犹豫就代表着有些难办，或许会给他带来什么不便，但他还是答应了。好像冬日里的一束阳光，温暖了整个山脊。\n我在局外等了4，5个小时，最后觉得待哪里没有任何意义，所以跑到公交车站等了3个半小时，等到凌晨3:30，24小时证明出来了我才回家。这一次的经历我是非常珍惜的，虽然不美好，但它又丰富了我风平浪静的人生。怎么说呢，我已经没有了那股愤怒的情绪，只是有无尽的悲凉。\n","categories":["think"],"tags":["reality is aweful"]},{"title":"vboxdiskResize","url":"/2022/04/23/vboxdiskResize/","content":"Virtualbox Disk Resizecheck virtualbox disk size\n\nnow to resize disk size, unit is Mib. --resize is the size after extend whole disk size\n\nnow to check whether make effect\n\nit seems that the partation has not added to C: drive\n\n\nwe need to manually add the partion to C: drive with Diskgenius application\n\n\nnow, it is done!\n\n\n","categories":["learn"],"tags":["vbox"]},{"title":"to-be-gentle","url":"/2022/06/19/to-be-gentle/","content":"To Be Gentle昨晚把看似几乎没办法写出的xmond的功能，通过自己的学习和实践成功配置好了。今天早上自然醒是九点多，爬起来用昨天刚擦干净的笔记本播放音乐，几乎所有的歌曲都是温柔的。因为几个星期连着下雨，笔记本都长霉了，昨天擦干净充电，还好功能都没问题。躺在床上，听着歌，感觉好舒服，很久很久没有这种感觉了，时间就像没有流逝，所有美好都不期而遇。\n前两天是周五，很久没有那么早下班了，刚走出门就感觉到了清爽的风，抬起头天空好明亮，前面的树木全被风吹的翻起了白肚子。那一刻感觉生活在漫画的世界。\n这是一种温柔的感觉，gentle。昨天看DT的视频，他说现代的多媒体社交平台在摧毁着我们，让我们接受到太多的negative信息，浪费我们太多的时间，也在消耗这我们的能量。我觉得很对，我感觉自己就变得很negative，在网上看了太多负面的消息，当然这些都是事实，现实中也确实因为这些事实而烦恼。对这个社会了解的越多，就越让人无法开心起来，也让我变得越来越negative。\n有一个特别适合的比喻，如果把国家比作两个邻居，那么美国就是那个大大咧咧多管闲事的家伙，我们国家就是那个野心勃勃，在背地里耍小聪明且偏执的家伙。然而我不得不说我更喜欢直爽的人。而后者的这种性格，对生活实实在在的造成了很多困扰，毫无意义的核酸检测，有公路车没有道路骑，有机车卖不允许骑，然而他们自己却大摇大摆的骑着机车在道路上穿梭。太多不公平，不合理，不为百姓着想的事情了。只能说生活在这个时代这个空间的人是不幸的。因为生活几乎找不到乐趣了，all of them都被禁止，看到大街上的人群，看到我自己，有一种无法诉说的悲凉。\n没错，这些都是事实，昨天又突然把小区封闭了。虽然说着“请”大家配合，但是紧接着就说如果不配合那么解封之后可能无法出去，后果自负。一边为这奇葩的脑回路说话感到无语，一边还要为明天能否可以出去上班而担忧。我想朝鲜也就是这个鬼样子吧。如果是以前那种特别负面的心态，不知道我会不会配合做核酸。但是我的想法却变了，有人上门来做核酸多好啊，这种待遇谁享受过啊，还免得我跑几公里外去做核酸了。\n是啊，为什么我要担心考虑那么多，过好自己的生活就够了，没必要为一些不相关的事情而担忧。历史依旧会这么走，从来不会因为我的想法而改变，宇宙这么大，怎么会因为我这个尘埃的想法而改变。我真的没必要关心，而是过好自己的生活，不要让negative信息左右着我。李白，苏轼，陆游，他们都没有公路车，机车，可是他们的生活是那么丰富。作为现代人的我拥有的更多。\n真正能让一个人positive的不是外在的环境，而是自己的内心。王阳明也说心即理，内心纯粹便是天理。时光流逝的如此迅速，更应该留住美好，不去触及那些让人不开心的。成为一个温柔的人，gentle。\n","categories":["think"],"tags":["positive"]},{"title":"vscode","url":"/2022/04/23/vscode/","content":"VSCODEvscode is a code editor with lots of extension. now i will show u how to install and configure it.\nsoftware install# pacman -S visual-studio-code-bin\n\n\nNote: now it is not recommended to install this package. because it cannot download any extensions,  for some reasons that vscode the open project cannot use any extensions from microsoft’s virsul studio market. So, there comes vscodium-bin which can use the open market  the Open VSX registry while vscodium-bin-marketplace installed instead of microsoft one. However in our country we cannot visit github and some other websites, so we cannot download the open VSX market’s extension in code editor. The resolution is downloading extension from [market website](Extensions for Visual Studio family of products | Visual Studio Marketplace) manually and then run vscodium --install-extension the-name-of-extension.vsix to install it\n\nparu -S vscodium-bin\nparu -S vscodium-bin-marketplace\n\n# install some downloaded extension\nvscodium --install-extension xxx.vsix\n\n# if there comes an error while installing extensions, we need to check whether we are in the correct markplace in website(visual studio code instead of visual studio)\n\n\n\nNote: the good news is that old vscode extensions can be used again once we copy it to new vscodium’s extension location.\n\ncp ~/.vscode/extensions ~/.vscode-oss/extensions\n\nsync with accounti use microsoft account to sync my settings for vscode is developed by microsoft.\n\nthe benefit of login with account is that when we install a new vscode, the only thing that we need to do is login our account, then all extension and user specified setting will download and correctly configure.\nextension\nBracket Pair Colorizer 2: colorize parentheses\nCode Runner: run code with shortcut\nPython: python syntax highlight and autocomplete\ngo: golang syntax highlight and autocomplete\n\ncommon settingsfont size\neditor font size\n\n\ndebug fontsize\n\n\nintegrated fontsize\n\n\n\nsmooth scroll\nrun in terminalconfigured only when code runner installed before\n\nrun before clearconfigured only when code runner installed before\n\nsave file before runconfigured only when code runner installed before\n\nshortcutconfigured only when code runner installed before. use ctrl+enter to run code\n\ndisable auto check update\n\npretty font settingwe know that we can use setting’s UI page to set this configuration. but edit file can reduce the time we search correct setting position.\npress ctrl+p then type settings.json open the file to edit.\nnote that the font name can be find with fc-list in linux. only copy the font name, remember no any style or it makes no sense.\nfont weight is also important, without it, the font may look thin.\nthe font is introduced by this video on Youtube, follow this web page, we can find Fira Code font, it looks really beautiful while rendering math symbol.\nin archlinux, we can download it use pacman\npacman -S nerd-fonts-fira-code\n\n\ncondai wanna to configure vscode debug with conda environment.\npress ctrl+p and type setting.json then enter\n\nand add &quot;python.pythonPath&quot;: &quot;/home/blueocean/.local/apps/minicanda/envs/new/bin/python&quot; the path of my conda python\n\nat last, activate conda env by hand in integrate terminal\n\namazing Zen modeThat’s the feature i love vscode most,  pure clean.  press ctrl+k then release, after that press z to  switch Zen mode.\ntroubleshootwhen i use microsoft account to login vscode to sync settings, i get the error below. and find a solution in this website\n\n# with archlinux, install the two packages\nyay -S qtkeychain gnome-keyring\n\n","categories":["learn"],"tags":["vscode"]},{"title":"xmonad","url":"/2022/06/19/xmonad-0.17/","content":"XMONAD上大学的时候就开始用xmonad了，过段时间可能就要重新配置一下xmonad，这也成为了一种乐趣。曾经尝试过很多的WE，DE，最终还是最喜欢xmonad。xmonad的版本也从0.15变成了现在的0.17，logo也换了，everything is changed。有一种沧桑的感觉\n最近又在配置xmonad，想要实现用快捷键切换窗口的布局。然后发现了一些其它比较好的功能，但是我的archlinux上的版本不支持，所以考虑下载最新的版本使用。\n跟着教程一步一步配置，这种方式就不是用pacman上的安装包，而是从github克隆源码下来，用stack来编译安装。\n而且使用这种方式安装有一个附加的好处是系统升级不需要重新编译它，因为它不是用pacman来安装的，非常好。以前更新之后必须要编译不然重启后就会报错。\n以前一直以为配置文件只能放家目录下，现在发现可以放~/.config/xmonad下了，又是一个惊喜。\ninstall new 0.17\n进入配置目录\n\nmkdir ~/.config/xmonad\ncd ~/.config/xmonad\n\n\n复制之前的配置文件\n\ncp ~/.xmonad/xmonad.hs ~/.config/xmonad/\n\n\n克隆源码\n\ngit clone https://github.com/xmonad/xmonad\ngit clone https://github.com/xmonad/xmonad-contrib\n\n\n下载编译工具\n\npacman -S stack\n\n\n创建stack project\n\nstack init\n\n从这一步开始就报错了，还是老问题，国内访问不到，只能开vpn下载了\n\n安装编译\n\nstack install\n\n这一步会下载ghc，并且自动编译stack build，然后自动把xmonad命令移动到~/.local/bin下。\n现在准备工作已经完毕，只需要编译配置文件就行。因为用pacman安装的有xmonad，所以现在运行xmonad --recompile还是用的之前的版本，所以我们必须指定路径来编译配置。\n~/.local/bin/xmonad --recompile\n\n\nNote: 为什么不先卸载系统的xmonad呢？因为我们不能确定编译没有问题，所以需要先保证编译没问题后再卸载。\n\n编译过程自然是会报错，问题就是0.15版本的一些语法在0.17不兼容了。包括两个地方：\n1. \nXMonad.Hooks.StatusBar.PP 取代 XMonad.Hooks.DynamicLog\n2. \nXMonad.Actions.CycleWS 用emptyWS取代EmptyWS\n\n\n编译没问题之后卸载系统xmonad\n\npacman -Rns xmonad xmonad-contrib\n\nnew featurekeybinding to toggle layout这个功能在0.15版本就是可以实现的，只不过之前不知道怎么配置，因为自带的配置没有对应的layout调用，需要自己写数据结构\n -- self define toggle layout transformer\n data ACCORDION = ACCORDION deriving (Read, Show, Eq)\n instance Transformer ACCORDION Window where\n     transform _ x k = k Accordion (const x)\n data CROSS = CROSS deriving (Read, Show, Eq)\n instance Transformer CROSS Window where\n     transform _ x k = k simpleCross (const x)\n data PST = PST deriving (Read, Show, Eq)\n instance Transformer PST Window where\n     transform _ x k = k positionStoreFloat (const x)\n data THREE = THREE deriving (Read, Show, Eq)\n instance Transformer THREE Window where\n     transform _ x k = k (ThreeColMid 1 (3/100) (1/2)) (const x)\n\n然后调用\n$  mkToggle (single MIRROR)\n$  mkToggle (single ACCORDION)\n$  mkToggle (single CROSS)\n$  mkToggle (single PST)\n$  mkToggle (single THREE)\n\n设置快捷键\n, ((_M , xK_apostrophe), submap . M.fromList $\n   [ ((0 , xK_m), sendMessage $ Toggle MIRROR)\n   , ((0 , xK_a), sendMessage $ Toggle ACCORDION)\n   , ((0 , xK_c), sendMessage $ Toggle CROSS)\n   , ((0 , xK_p), sendMessage $ Toggle PST)\n   , ((0 , xK_t), sendMessage $ Toggle THREE)\n   ])\n\nswallow parent while child GUI open这个功能只有0.17才支持，非常适合在terminal中打开图形程序。设置之后，如果在terminal中打开GUI程序，那么terminal会被隐藏直到GUI被关闭。例如用feh打开图片后就不会开一个新的窗口，而是隐藏终端，非常nice\n导入模块\nimport XMonad.Hooks.WindowSwallowing\n\n配置\n, handleEventHook       = swallowEventHook (className =? &quot;XTerm&quot;) (return True) \n\n","categories":["linux"],"tags":["xmonad"]},{"title":"xmonad","url":"/2022/06/19/xmonad/","content":"XMONADWhat is xmonad? It is a window manager which i used for years and it is also my favorite one among tens of WM. Although i have used it so many years, i can not really understand it’s configure language haskell, so do some of features that i like. Recently, when i see a installation guide in official web site, i find something new i have never know and also a solution for every time upgrade system will broken xmonad in archlinux.\nMain point:\n\nwe can put xmonad configure file under ~/.config/xmonad instead of ~/.xmonad.\nwe should not install xmonad and xmonad-contrib via system package manager(pacman).\nwe need download origion file of xmonad and xmonad-contrib from github.\nwe need a tool called stack to manage our xmonad.\n\n\nNote: \n\nwhen we use our system package manager pacman to download xmonad, it will also download many dependences, once some of them upgrade, our xmonad should be recompiled, if not it will broken once restart computer since it builds xmonad with dependences though system dynamic link.\n\nwhen compile xmonad, it needs a tool called ghc. once we use stack, we need create a project, and then it can automatically download ghc, auto download project dependences, auto compile. very useful.\n\n\n\nInstall StackOpen up official website, we can find the full introduction. what i recommend is to download the binary file of stack(manual style).\nuncompress to local path\ntar -xzf stack-2.7.5-linux-x86_64.tar.gz -C ~/.local/share/bin\n\nmake sure the path already added to system path\nChina-based users\nbecause we live in China, we cannot download need file with stack until we do some configuration.\nappend this in ~/.stack/config.yaml\n###ADD THIS IF YOU LIVE IN CHINA\nsetup-info-locations: \n- &quot;http://mirrors.tuna.tsinghua.edu.cn/stackage/stack-setup.yaml&quot;\nurls:\n  latest-snapshot: http://mirrors.tuna.tsinghua.edu.cn/stackage/snapshots.json\n\npackage-indices:\n  - download-prefix: http://mirrors.tuna.tsinghua.edu.cn/hackage/\n    hackage-security:\n        keyids:\n        - 0a5c7ea47cd1b15f01f5f51a33adda7e655bc0f0b0615baa8e271f4c3351e21d\n        - 1ea9ba32c526d1cc91ab5e5bd364ec5e9e8cb67179a471872f6e26f0ae773d42\n        - 280b10153a522681163658cb49f632cde3f38d768b736ddbc901d99a1a772833\n        - 2a96b1889dc221c17296fcc2bb34b908ca9734376f0f361660200935916ef201\n        - 2c6c3627bd6c982990239487f1abd02e08a02e6cf16edb105a8012d444d870c3\n        - 51f0161b906011b52c6613376b1ae937670da69322113a246a09f807c62f6921\n        - 772e9f4c7db33d251d5c6e357199c819e569d130857dc225549b40845ff0890d\n        - aa315286e6ad281ad61182235533c41e806e5a787e0b6d1e7eef3f09d137d2e9\n        - fe331502606802feac15e514d9b9ea83fee8b6ffef71335479a2e68d84adc6b0\n        key-threshold: 3\n        ignore-expiry: no\n\nand that is all we need do for installation\nInstall Needed Dependencesin archlinux, we need download below dependences:\nsudo pacman -S \\\n&gt; git \\\n&gt; xorg-server xorg-apps xorg-xinit xorg-xmessage \\\n&gt; libx11 libxft libxinerama libxrandr libxss \\\n&gt; pkgconf\n\nInstall Xmonad\ncreate xmonad configure directory and change to it.\n\nmkdir ~/.config/xmonad\ncd ~/.config/xmonad\n\n\ncopy our configure file to new directory\n\ncp ~/.xmonad/xmonad.hs ~/.config/xmonad\n\n\nfollow this page, download xmonad via git\n\ngit clone https://github.com/xmonad/xmonad\ngit clone https://github.com/xmonad/xmonad-contrib\n\n\ncreate stack project\n\nstack init\n\nwith this command, stack will create a yaml file to record our xmonad project\n\ninstall everything\n\nstack install\n\nit will auto download ghc, build all required package, copy xmonad executable file to ~/.local/bin\n\nconfigure xmonad to be our window manager\n\n# add this to the end of ~/.xinitrc\nexec xmonad\n\nStack simple usageghci command\nstack ghci --no-build --no-load\n\nrunhaskell command which used in vscodium\nstack runhaskell\n\nwe can add the two with alias\nnvim ~/.config/zsh/.zshrc\n\nalias ghci=&quot;stack ghci --no-build --no-load&quot;\nalias runhaskell=&quot;stack runhaskell&quot;\n\nUninstall system xmonadif we use xmonad by pacman in the past, now we can uninstall it.\nuninstall xmonad which is installed by system package manger pacman\nsudo pacman -Rns xmonad xmonad-contrib\n\nuninstall all other haskell package which is installed by system package manager pacman\npacman -Qq |rg haskell |xargs -I &#123;&#125; sudo pacman -Rnsc --noconfirm &#123;&#125;\n\nAt lastand now we have an inpendent, clean xmonad.\n","categories":["linux"],"tags":["xmonad"]},{"title":"xp-pentablet","url":"/2022/06/24/xp-pentablet/","content":"XP-PentabletI brought a xp-pentablet almost one year, and i like it very much for daily use instead of mouse. I remember the first time i install it’s driver, i got a problem every time i restart the computer, all of my configuration was gone. I request for Sells client, but they also don’t know how, at last i know it’s just because the default xp-driver not starts in background which they should be in DE, but in my WM, it’s just not working.\nBut if i run the driver program it will turn up a gui app every time i restart computer, i finally find a solution with xvfb by sending it to virtual display. And it goes so far so good.\nHowever today when i try to search how to use pen pressure in normal usage, i find an open source driver which suits for tens of pentablets, and i wanna to have a try.\nopentabletdriverthe main reason i wanna to use this is because it has a system service run in backend, so there is no need for me to send a gui app to virtual display. That sounds better.\nfollow this guide i can install it from AUR.\n# install\nparu -S opentabletdriver-git\n\n# Reload the systemd user unit daemon\nsystemctl --user daemon-reload\n\n# Enable and start the user service\nsystemctl --user enable opentabletdriver --now\n\n\nNote: it is a user service\n\nthen in rofi typing opentabletdriver to open it’s gui configure some key bindings\nat last stop using old xp-pentable\n# comment this in xmonad.hs\n--spawnOnce &quot;startPentablet&quot;\n\n\nPS: opentabletdriver has lots of drivers, but i find it cannot installed successfully, which makes me a little disappointed.\n\n","categories":["linux"],"tags":["pentablet"]},{"title":"zabbix","url":"/2022/04/23/zabbix/","content":"♥ ZABBIXarchitecture\n server: central component\n database storage: data gathered and configuration stores\n web interface: web UI support\n proxy: optional, load balance support\n agent: install on target machine to gather needed information\n\n\ninstallzabbix can only be installed on specified OS, and the way to install is :\n\nusing commands which can be find in online official website\n\nusing ovf template directly without step to step to configure\n\n\nthe version of 5.4 with centos7 has no server, so we cannot use it. then i choose centos7-5.0LTS-mysql-nginx \ndetail steps:\nNote: \nit is very important to disable selinux and firewalld, or it may meet this error message: “PID file /run/zabbix/zabbix_server.pid not readable (yet?) after start”. and zabbix-server cannot start successfully\n\n\nsecurity setting\n## selinux\n# temporary\nsetenforce 0\n\n# forever\nvi /etc/selinux/config \n\nSELINUX=disabled\n\n\n## firewalld\n# disable\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n# or open some port\nsudo firewall-cmd --add-port=&#123;10051/tcp,10050/tcp,80/tcp&#125; --permanent\nsudo firewall-cmd --reload\n\n\ninstall repository\nrpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm\nyum clean all \n\n\ninstall zabbix server and agent\nyum install zabbix-server-mysql zabbix-agent  -y\n\n\ninstall zabbix frontend\nyum install centos-release-scl -y\n\nedit /etc/yum.repos.d/zabbix.repo file, change enabled from 0 to 1\nvi /etc/yum.repos.d/zabbix.repo\n\n[zabbix-frontend]\nenabled=1\n\nyum install zabbix-web-mysql-scl zabbix-nginx-conf-scl -y\n\n\ninstall mariadb\nyum install mariadb-server -y\n\nsystemctl enable mariadb\nsystemctl start mariadb\n\n\nconfigure mariadb\n-- default no password\nmysql -uroot -p \ncreate database zabbix character set utf8 collate utf8_bin;\n\n-- specified your own passwd\ncreate user zabbix@localhost identified by &#39;123456&#39;; \ngrant all privileges on zabbix.* to zabbix@localhost;\nquit;\n\nif we wanna to change zabbix user’s password, follow this steps:\nset password for zabbix@localhost = password(&#39;123456&#39;)\n\nimport data to zabbix database， enter the password of zabbix created before\nzcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix \n\n\nconfigure zabbix with the ability of accessing DataBase\nvi /etc/zabbix/zabbix_server.conf\n\nDBPassWord=123456\n\n\nconfigure PHP for zabbix frontend\nvi     /etc/opt/rh/rh-nginx116/nginx/conf.d/zabbix.conf\nlisten 80;\nserver_name 192.168.31.114\n\n\nvi /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf\nlisten.acl_users = apache,nginx\nphp_value[date.timezone] = Asia/Shanghai \n\n\nstart zabbix server and agent process\nsystemctl enable zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm \nsystemctl restart zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm\n\n\naccess webpage with database password\nhttp://192.168.31.114\n\n# default user name and password\nAdmin/zabbix\n\n\n\n\n\n","categories":["learn"],"tags":["zabbix"]},{"title":"zookeeper","url":"/2022/04/23/zookeeper/","content":"\nzk单机以及集群搭建（基于docker）\n\n单机创建并进入docker创建docker，并将有安装包的主机挂载到docker中\nsystemctl start docker\n\ndocker run -d -it --name zk -v /home/qiyue/Downloads:/home centos\ndocker exec -it zk /bin/bash\n\n配置并启动zk在容器中将安装包复制到/opt目录下\ncp /home/jdk-15.0.1 /opt -r\ncp /home/apache-zookeeper-3.6.2-bin /opt -r\n\n在/etc/profile中添加环境变量\nexport JAVA_HOME=/opt/jdk-15.0.1\nexport ZK_HOME=/opt/apache-zookeeper-3.6.2-bin\nexport CLASSPATH=.:$JAVA_HOME/lib\nexport PATH=$PATH:$JAVA_HOME/bin:$ZK_HOME/bin\n\n使环境变量生效\nsource /etc/profile\n\n创建data和logs文件夹\ncd /opt/apache-zookeeper-3.6.2-bin\ntouch data logs\n\n修改配置文件conf/zoo.cfg\n# 新建zoo.cfg\ncd conf\ncp zoo_sample.cfg zoo.cfg\n\n# 添加\ndataDir=/opt/apache-zookeeper-3.6.2-bin/data\ndataLog=/opt/apache-zookeeper-3.6.2-bin/logs\n\nserver.1=172.17.0.2:2888:3888\nserver.2=172.17.0.3:2888:3888\nserver.3=172.17.0.4:2888:3888\n\n# 添加\ndataDir=/opt/apache-zookeeper-3.6.2-bin/data\n\n启动/查看/停止运行状态\nzkServer.sh start\nzkServer.sh status\nzkServer.sh stop\n\n集群创建并进入docker创建docker，并将有安装包的主机挂载到docker中\nsystemctl start docker\n\ndocker run -d -it --name zk1 -v /home/qiyue/Downloads:/home centos\ndocker run -d -it --name zk2 -v /home/qiyue/Downloads:/home centos\ndocker run -d -it --name zk3 -v /home/qiyue/Downloads:/home centos\ndocker exec -it zk1 /bin/bash\ndocker exec -it zk1 /bin/bash\ndocker exec -it zk1 /bin/bash\n\n配置并启动zk在容器中将安装包复制到/opt目录下\ncp /home/jdk-15.0.1 /opt -r\ncp /home/apache-zookeeper-3.6.2-bin /opt -r\n\n在/etc/profile中添加环境变量\nexport JAVA_HOME=/opt/jdk-15.0.1\nexport ZK_HOME=/opt/apache-zookeeper-3.6.2-bin\nexport CLASSPATH=.:$JAVA_HOME/lib\nexport PATH=$PATH:$JAVA_HOME/bin:$ZK_HOME/bin\n\n使环境变量生效\nsource /etc/profile\n\n创建data和logs文件夹\ncd /opt/apache-zookeeper-3.6.2-bin\ntouch data logs\n\n创建myid文件(不同的容器中写入对应的id)\n# 第一个容器\necho 1 &gt; data/myid\n# 第二个容器\necho 2 &gt; data/myid\n# 第三个容器\necho 3 &gt; data/myid\n\n修改配置文件conf/zoo.cfg\n# 新建zoo.cfg\ncd conf\ncp zoo_sample.cfg zoo.cfg\n\n# 添加\ndataDir=/opt/apache-zookeeper-3.6.2-bin/data\ndataLog=/opt/apache-zookeeper-3.6.2-bin/logs\n\nserver.1=172.17.0.2:2888:3888\nserver.2=172.17.0.3:2888:3888\nserver.3=172.17.0.4:2888:3888\n\n启动/查看/停止运行状态\nzkServer.sh start\nzkServer.sh status\nzkServer.sh stop\n\n选举机制与myid的大小和投票数有关：\n\n第一次都只会给自己投票，无法选出leader\n第二次投票myid大的获胜，选出leader\n第三次票数多的获胜，leader依然为leader，后启动的都是follower\n\n错误\nClient port found: 2181. Client address: localhost. Client SSL: false.\n因为myid中写了id和ip，正确的应该只写id\n\n\n使用节点查看节点目录\nls path\neg:\n    ls /\n# 递归\nls -R /\n\n新增节点和数据\n# 新增节点并进行数据关联\ncreate /node1 &quot;the fist node&quot;\n\n查看节点数据\nget /node1\n\n修改节点数据\nset /node1 &quot;the master node&quot;\n\n删除节点和数据\ndelete /node1\n# 如果当前节点下还有子节点\ndeleteall /node1\n\n","categories":["learn"],"tags":["zk"]},{"title":"zsh","url":"/2022/04/23/zsh/","content":"ZSHchange default location.zshrc and .zcompdump location in $HOME directory.  and we can change it to another folder\n# add this to ~/.zprofile\nexport ZDOTDIR=$HOME/.config/zsh\n\n\nNote:\n.zcompdump file used to speed up the zsh completion\n\nchange oh-my-zsh default locationexport ZSH=$HOME/.config/zsh/.oh-my-zsh\n\nauto correctIn archlinux installer, i have ever saw auto correct effect while error typing and it is very helpful, however i cannot find the plugin which has the same effect. Today, i searched and found it finally, you know what? It is even not a plugin but a configuration in .zshrc.\n# uncomment to enable it\nENABLE_CORRECTION=&quot;true&quot;\n\n\n\nn which means no, don’t correct my command and execute it as it is\ny which means yes, correct my command\na which means abort, don’t execute the command and give me an empty prompt\ne which means edit, don’t execute the command and let me edit it again\n\nauto suggestionoh-my-zsh includes this function. Add zsh-autosuggestions to plugin&#123;&#125; will okay. However, it is much more customizable, we can even define its color.\nplugins=(git\n    zsh-autosuggestions\n    )\nZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=&quot;fg=#7e749d,bg=#42414d,bold,underline&quot;\n\n\n","categories":["learn"],"tags":["zsh"]},{"title":"为什么我们都患上了愤怒调节障碍","url":"/2022/05/15/%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E9%83%BD%E6%82%A3%E4%B8%8A%E4%BA%86%E6%84%A4%E6%80%92%E8%B0%83%E8%8A%82%E9%9A%9C%E7%A2%8D/","content":"刚毕业那年，武汉发生封城，我当然就是被封的那个，小区设置了门禁，需要检查核酸。被关了半年，头发都可以扎起来了，深刻的感受到了孤独和被抛弃的感觉，然而对待每次的检查，我都是没有任何怨言的，我觉得应该如此，没有太多的想法。\n然而今年的核酸检查，每次都让我感到愤怒、可笑、可悲。\n有一次去小区做核酸，哪里人太多，就打算回家玩会再去，可结果是看大门的一个人拦住了我，不让我过去，然后就是直接暴力的把我往那边推，我说明了原因，但是他说他说了算，他说不让我过我就别想过。顿时我就怒了，因为这种做法直接挑战了我对现在是文明社会的认知，也挑战了我对自由的看法。我真的很想跟他打一架，但是没打起来。哈哈，我记得当时腿就不由自主的抖，我知道那不是害怕，但是我就是控制不住。后来发现仅仅是因为紧张，因为在公开场合我几乎话都没说过，就好像大一参加社团时在台上发言一样，我几乎说不出一句完整的话。尽管我已经告诉自己大丈夫屹立于天地直接，有何可俱。\n还有一次是因为我出去骑公路车回来，也是小区的一个看门的，拦住不让我进去。非要我给什么网格员打电话，我不知道这是什么外星术语，让他给我号码或者什么联系方式，但是他也不给。反正就是不让你过，道理什么的嘛他也不懂。这次真的真的对我影响很大，因为他让我放弃了骑行的梦想和乐趣，前几天把车也卖了。除了愤怒之外，我也深深的感到悲哀，就这样一个素质的社会，还想企及环法，环意自行车赛的边？一个把人最后梦想都扼杀的社会？痴人说梦，即便是道路状况极差，只能在颠簸的人行道上骑，我们仍在继续，仅仅是因为那一份热情。而这也被无情的抹杀，你说现在的年轻人都躺平是为什么呢？因为我们的热情，追求都被抹去，只剩下孤独的灵魂。\n然后就是这怪诞的核酸检测了，之前是一天一次，现在改成三天一次了。我发现渐渐的人们都已经忘记为什么要做核酸检测了，只知道不做你就上不了班，坐不了车，没有行动的自由。如果说这是一个文明社会、尊重科学的社会，会发生这种事情吗？我们都已经麻木不仁了，检测已经成为了呼吸的一部分，尽管我们知道这都是毫无意义的，这不是保护人该做的事，这已经成为一门生意，堂而皇之以一个国家的背书，靠着武力野蛮来施加无可抗拒的压力。这让我可笑，因为国家把科学常常挂在嘴边，而做出的事，毫无科学。\n对于这所有种种事情，我不想全部怪罪于一个国家。因为细数历史，你会发现每个朝代都是这样，由兴盛转向衰亡。个人同样是无法抗拒的，每一个人都属于时代的微不足道的一部分。然而我想说的是，正是王阳明先生提到的，从尧舜到当今，社会是每况愈下。千年前有孔孟，500年前有阳明，而当今谁也没有了。那些被先贤们珍视的文明礼仪、社会良知几乎散尽，作为人被判定为一个人该有的依据已模糊，斯人逐渐沦为禽兽而不自省。即便朝代再次更迭，我想情况并不会改善，因为人心已不在。而决定一个社会前进最为重要的是什么呢？是良知。没有了良知，俄罗斯这样拥有先进核武的国家，也只会沦为屠杀人类的机器。没有了良知，那些管理人员才会显得那么野蛮。\n经常看科幻片的我认为如果人类真的发明了星际穿越的方法，我也觉得目前的人类配不上，因为他们自私没有良知，所过之处只是无尽的灾难罢了。阳明说人心就是良知，需要内心纯粹无一毫私欲。试问有几人做得到呢？如今这可悲的时代。\n除了从本质来解读之外，还想从另一个现实解释这种现象出现的原因：1. 人们之间几乎无交集，属于陌生人范畴。2. 因为戴了口罩，遮住了它的社交信息，真实显露出它的邪恶。想象一下，如果是发生在一个乡村里面，你做出这等散尽天良的事，只怕会被所有人孤立，甚至是报复。\n唉，除了一声长叹，也只剩一句唏嘘。虽然整体社会的良知散失，但是并不代表我也没有，我有王阳明作为导师，足以澄其心。再者说了，不管邪恶做出什么，那是他们做的事，对于我们来说如何回应邪恶才是关键。如果用暴力来还击，那证明我们也只是他们的一部分罢了。\n","categories":["think"],"tags":["良知"]},{"title":"人生几多愁","url":"/2022/05/26/%E4%BA%BA%E7%94%9F%E5%87%A0%E5%A4%9A%E6%84%81/","content":"虽然标题看起来很宏伟，但是人生是我无法看破的存在。所以本文就是泛泛而谈，想到什么写什么。\n前一段时间，或者说今年，我都没怎么学习linux相关的东西，最心爱的arch也成为了看电影的工具。我想很大部分原因是这个工作不涉及这些导致的吧。很长一段时间，我都无法开心，因为核酸隔离限制了我的行动自由，我想这是我上学时候绝对想象不到的。那个时候就希望早点毕业，渴求自由，希望没人约束，但是到了社会才发现这是另外一个囚笼，几乎没人可以逃脱，所以我感觉人生被束缚住了，无论多么用力挣扎，和一个国家比起来，微不足道。我也深深体会到了先辈们在历史中的那份迫不得已，谁人不想像李白一样仰天大笑出门去呢？然而如果皇权下令不许，那么这就是一个梦。\n因为这一切，有那么一段时间我特别厌恶这个专制体系，希望可以逃离它。然而许久过去，我发现已经渐渐的少了些许怨愤，添了一份平和。当然这一切只是我的心境变化，环境嘛可以说更糟吧。\n为什么会有这些变化？我想很大一个原因是我一直记得shield中的那句话：真正重要的不是邪恶对我们做了什么，而是我们面对这些事的反馈。人或者社会无论多么邪恶，那是他们的态度，而真正决定我们的是什么呢？如果因为他们的邪恶，我们也同样没有原则的用同样的手段对付他们，那么我们与他们有和差别呢？\n所以我想这就是一段时间心境的一个缩影吧。小时候无忧无虑，十几岁为成绩发愁，大学追求一个女生，进入社会面对另外的困境。每个阶段都有应该要完成的事，并不是每一段时光都那么美好，都值得留恋，然而正是这些经历塑造了不同的我们。所以如果现在的环境特别差，我想说这是一个去磨练我们的机会。当然并不是说我们一定要做出什么对的选择，当然可以选择错误的做法，可以成就一段后悔的记忆。然而我们不要否定它，不要掩盖它，正是它成就了我们。\n今天打算买一本书《月亮与六便士》，看了百科的介绍，突然就特别想买了看，因为它讲述了一个古老的故事，让我有一种看了就会很治愈的感觉。我想生活真的需要这些讲故事的人，体验他们所描绘的人生。如果一个人的生活仅仅是可见的世界，我想那一定很无聊吧，所以为了不无聊，我想看一看。\n当然也是因为买这本书看到了京东上的第一个评论，他说他很爱看书，也拍照显示了他买了很多书，看过很多书。哈哈，我就看了他写的一段评论：”人需要多看书，书中自有黄金屋，书中自有颜如玉……“。然后我就突然了解到了这是一个怎样的人，我很想说他的书真的是白看了。就随随便便的几句话就可以看出一个人的庸俗，如果看书是为了这些的话，我觉得还是别看了，简直是浪费钱。读历史是读人心，读小说是体验人生。他们从来都不是为了给你带来可以炫耀的知识和可以变现的财富。深深体会到王阳明先生所主张的心既是天理，内心纯粹没有一毫私欲才是我们该有的态度。多谢王阳明先生的书，让我可以很轻易的分辨一个人的内心。\n我想起去年的一个老板，他说自己一年要读接近100本书。当时的我从来没有看书的兴趣，觉得太不可思议了。但是如今我却觉得真的没必要读那么多书，读的多有什么用呢，能真正体会到的其实是很少的。就像王阳明的四本书，潦草读一遍能算了解阳明吗？那可是他一生的结晶，我觉得每一个故事，每一段对话都值得好好领悟。同样的爱因斯坦的相对论，薄薄的一本书，但是就是它开启了新的物理时代，多么伟大，潦草读一遍能收获什么呢？我想书中随便一个公式都推导不出来吧。\n人生啊，喜怒哀乐皆具本是正常不过，不必苛责。然而我们时常会走偏，时而会无故低沉，那么这个时候就需要主动给自己添加一些目标指引。\n生活的绚烂不在于多么惊天动地，而在于欣赏和享受每一刻小确信。这顿饭有肉，柴米有盐，下雨有伞，烈日有云，早春有花，盛夏有风，生活有乐，有恼，有悟。都值得被珍视和留恋\n","categories":["think"],"tags":["思绪"]},{"title":"从容","url":"/2022/06/25/%E4%BB%8E%E5%AE%B9/","content":"从容if you wanna smile, just smile. if you wanna cry, just cry. if you wanna run, just run, if you wanna take a break, just break. if we feel bad, just let it go.\n在youtube上看到一个视频，一个约40岁的男人，潦草的头发，一张塑料凳子，一把吉他，坐在泥土地面的道路旁进行弹唱。时而有健身跑步的美女，时而有路过的行人，时而有驶过的马车拖着的自来水瓶。没有人停留，时间在流逝，歌声在蔓延。而这真的让我感到特别舒适，这就是真正的生活。\n今天看另外一个chipmunk视频，是我熟悉的chuncky。女士打开在门外等待的chipmunk，它熟悉的跑到装满食物的bowl，享用这为它准备的美食。这个little girl是有多么开心，作为一个谨慎的动物，它可以拥有这么善良的善待它的人类。我在想，为什么我无法开心，我在追求什么呢？人真的必须要有追求吗？我们真正能追求到的又是什么呢？\n翻看历史，有无数无数被记录的人物，他们能够追求的最多也只是那个时代所能享受到的，无论有多少权利金钱，也无法获得现代的任何高科技产品。所追求权利和金钱，拥有了他们可以享受更多的物质，但也仅此而已。我们和所有其它的生物享受一样的空气，阳光，大地。\n一个chipmunk来到这个世界，它要实现什么人生目标吗？那么人为什么就必须要有呢？我们如此渺小，无法穿越时空，无法进入高维世界，我们和chipmunk一样。所以为什么要让自己的生活存在那么多的不开心呢？\n如果问一个进入社会的人，你追求什么，大多数人会说钱吧。如果你问一个小孩子，那么很难和钱有关。为什么我们的生活单调到只有钱这么一个目标？过去的三年里，我学了无数计算机的东西，可是如今我如果有一丝念头在想学学rust吧，居然有点搞笑，心里会想，what the hell, are you crazy? \nyes，我的生活也很枯燥，上班下班睡觉吃饭+最近热爱的健身。偶尔还会有念头不想锻炼，感觉就是一团糟。为什么无法悠闲的躺着看一下午的天空，为什么没有想法在街头溜达溜达感受这番水土的气息，为什么无法静静的看一会书。为什么总感觉很忙，但是其实发现啥也没做，反而无法从容淡定。\n听着视频的歌声，我想生活本来就没有欢声，没有听众，而是需要我们自己给它谱曲，让它婉转绚烂。而这需要我们的耐心，坚持，从容。\nso，just get a little plan, and try to make our life more regular. let’s dive in.\n","categories":["thinking"],"tags":["life"]},{"title":"我愿成魔","url":"/2022/05/14/%E6%88%91%E6%84%BF%E6%88%90%E9%AD%94/","content":"今天听了《美丽的神话》这首歌，又回想起来大学看过的《神话》这个电视剧。时光匆匆，这么多年又过去了，然而看电视剧的感受还是那么 清晰。全剧最让我感动的就是赵高说他要一步一步往上爬，成为一人之下万人之上的存在。这里也是他和主角正式分道扬镳的地方，如果让我选择一个支持的人，我可能并不会那么高尚的选择主角。\n赵高原本是一个现代的厨师，有一些小偷小摸的习惯，但却是为了是给妹妹更好的生活。他从小把妹妹带大，相依为命，可以说妹妹就是他唯一生活的阳光。因为小川，他被无缘无故的被带入到了古代，与妹妹时空相隔，同时迎接他的命运也是极端的残酷，被拉去修长城，进宫成为了太监，这一系列的遭遇，如果唤作是我，恐怕活着的勇气都没了。然而他还是坚持了下来，因为他始终相信他还可以回去，回到现代。\n而小川的命运完全不一样，一帆风顺的不可想象，结识了刘邦项羽，有吕素为救自己而牺牲，后来还遇到了他的所爱，像天使一样美丽的少数名族的公主玉树，并且相恋。所以小川坚持他的人间值得，正道光明没有什么错。但是我认为他却不能将这样的要求强加给赵高。\n后来小川将虞姬引荐给赵高，我还记得赵高第一次遇见虞姬的那种开心，那种话都说不明白的心情，因为虞姬和他妹妹长的一模一样，他以为他又见到了自己的妹妹。那一瞬间仿佛穿越了时空，仿佛停止了时间，感动的让人落泪。我想这是那苦难的社会能唯一给他带来快乐的事情了吧。\n所以他说他要一步一步往上爬，即便是成为历史书中那个奸臣赵高也无妨。我可以体会到那种心情，也足够同情他，他每爬一步背后所承受的那种心酸，悲伤，无助，失望谁又能懂呢？他不是不知道他会堕落成魔，但是社会已经无可救药，为了可以见到亲妹妹，为了保护这个世界的虞姬，他必须这么做。没有多么高尚的目标，没有社会责任，没有英雄主义，却让我敬佩。这才是真正的人生，这才是勇敢的人。\n设想一下一个社会的小小角色，无权捍卫自己的人生安全，无法受到公平对待，没有任何自由的权利，那么我为什么还要遵守这癫狂的社会规则，遵守那些贪官污吏、昏庸无能的君主所定下的规则呢？如果成魔可以保护自己所爱的人，那么就让我成魔吧。\n我并不认为历史和当下有多遥远的距离，因为此刻也即是历史，那些曾经做过的错的对的事也会随风流逝，重要的是我们为自己所做的决定后悔吗？赵高不会为自己所做的事后悔，他就是一个小老百姓，不必肩负历史的命运，而能够尽自己所能保护所爱的人已足矣，心安。\n对与错是很难分辨的，也不应该用一个固定标准去衡量它，因为在不同的人眼中是不同的，不同的地域，不同的时空都是不同的。一千个读者就有一千个哈姆雷特；在美国拥有枪支是合法的，而在中国却是非法的；杜甫那个时代指责政府的诗可以流传千古，而八股文，文字狱却是一言足以入狱。\n那么如何去分辨是非曲直呢？我只能说我也不清楚，因为我自己都无法正确判断，我也在学习的路上。而行之有效的一个方式就是走进历史，走进历史所在的那个环境，用心去体会，用理智去判断。这个判断的依据从来都不是政府，因为皇权百年更迭，而人心亘古不变，人心也即是普世价值。\n","categories":["读历史"],"tags":["神话"]}]