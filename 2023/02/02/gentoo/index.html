<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="shutterbug">
    
    <title>
        
            gentoo |
        
        Screw it!
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"raw.githubusercontent.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/4.jpg","description":"the world you see is not about how they act but how we respond."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Screw it!
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">gentoo</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">shutterbug</span>
                        
                            <span class="author-label">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2023-02-02 22:27:42</span>
        <span class="mobile">2023-02-02 22:27</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/linux/">linux</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/gentoo/">gentoo</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="MY-GENTOO-HANDBOOK"><a href="#MY-GENTOO-HANDBOOK" class="headerlink" title="MY GENTOO HANDBOOK"></a>MY GENTOO HANDBOOK</h1><p>After 6 years of archlinux usage, i finally move to gentoo and give it a try. After several weeks, i still miss archlinux, since installing something is really cheap in arch, but often take minutes in gentoo. However, i learned more in gentoo and get used to compiling kernel. So, it is really worth to try gentoo.</p>
<h2 id="INSTALL"><a href="#INSTALL" class="headerlink" title="INSTALL"></a>INSTALL</h2><h3 id="KERNEL"><a href="#KERNEL" class="headerlink" title="KERNEL"></a>KERNEL</h3><h4 id="configure-sound-card"><a href="#configure-sound-card" class="headerlink" title="configure sound card"></a>configure sound card</h4><p>If we don’t configure sound card, then with the default configuration we never gonna have sound. So we need to follow the <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/ALSA" >alsa page<i class="fas fa-external-link-alt"></i></a> and choose some of the card driver.</p>
<p>In fact i also don’t know which one should i choose, i just picked <code>Realtic</code> and then compiled and reboot, and i get the sound.</p>
<h4 id="configure-frame-buffer"><a href="#configure-frame-buffer" class="headerlink" title="configure frame buffer"></a>configure frame buffer</h4><p>There are several times when i compiled a kernel, and reboot to a black screen, it only shows “loading kernel…”, and this is something that configured in grub. So in a word, system cannot boot the kernel. And i am glad to say, i finally know the reason, that is caused by error configuration of frame buffer.</p>
<p>I miss one step in <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Xorg/Guidehttps://wiki.gentoo.org/wiki/Xorg/Guide" >kernel configuration<i class="fas fa-external-link-alt"></i></a> with <code>Xorg</code> ability. I didn’t specify the firmware file(under <code>/lib/firmware</code>) which frame buffer depends on(compile gpu drive to kernel directly). </p>
<p>We should follow the <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Linux_firmware#Kernels_prior_to_v4.18" >firmware page<i class="fas fa-external-link-alt"></i></a> to configure.</p>
<p><img src="../.images/framebf.1.png" alt="flamebuffer location"></p>
<p>We can write like this: <code>amdgpu/xxx.bin amdgpu/xxx.bin</code>, separated by space. However which one should i write? We need boot to a normal system, and run this command to find.<br>Or we can find in the <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Fonts#Console_font" >page<i class="fas fa-external-link-alt"></i></a>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--- › » dmesg -t | grep amdgpu | grep firmware</span><br><span class="line">Loading firmware: amdgpu/beige_goby_sos.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_ta.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_smc.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_pfp.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_me.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_ce.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_rlc.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_mec.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_mec2.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_sdma.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_dmcub.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_vcn.bin</span><br><span class="line">amdgpu 0000:03:00.0: amdgpu: Will use PSP to load VCN firmware</span><br></pre></td></tr></table></figure>

<p><img src="../.images/framebf.2.png" alt="location to write"><br><img src="../.images/framebf.3.png" alt="location to write"></p>
<h3 id="configure-default-gpu-driver"><a href="#configure-default-gpu-driver" class="headerlink" title="configure default gpu driver"></a>configure default gpu driver</h3><p>Usually we can successfully login window manager without problem, but once we check the xorg log file <code>~/.local/share/xorg/Xorg.0.log</code>, we will find some error messages show cannot load ati/mesa gpu driver, although it is harmless(it will finally load the gpu we have), but this comes because we have not configured it yet.</p>
<p>We should specify the correct gpu driver we use in <code>/etc/X11/xorg.conf</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Section &quot;Device&quot;</span><br><span class="line">   Identifier   &quot;My Graphics Card&quot;</span><br><span class="line">   Driver       &quot;amdgpu&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure>


<h3 id="configure-console-front"><a href="#configure-console-front" class="headerlink" title="configure console front"></a>configure console front</h3><p>While using framebuffer, the console font size becomes too small, so there is a need to change the font size. I find <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Fonts#Console_font" >the way<i class="fas fa-external-link-alt"></i></a>.</p>
<ol>
<li><p>Find console font name in <code>/usr/share/consolefonts</code>.</p>
</li>
<li><p>Configure font in <code>/etc/conf.d/consolefont</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consolefont=&quot;sun12x22&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: remove <code>.psfu.gz</code> of the font name.</p>
</blockquote>
</li>
<li><p>Add consolefont service to boot level.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rc-update add consolefont boot</span><br></pre></td></tr></table></figure></li>
<li><p>After reboot, the font size will be the right one.</p>
</li>
</ol>
<h2 id="SKILL"><a href="#SKILL" class="headerlink" title="SKILL"></a>SKILL</h2><h3 id="compile-kernel-with-correct-file"><a href="#compile-kernel-with-correct-file" class="headerlink" title="compile kernel with correct file"></a>compile kernel with correct file</h3><p>Since i decide to use gentoo, how to configure a minimalist kernel is always a challenge for me. Last failed time i compile kernel, i got confused a lot, because the first time compiled failed, i want to recompile the kernel, but when i run <code>make menuconfig</code>, i got the configuration the same as i changed before, even when i removed <code>.config</code> file. What i really want is a clean origin setting. And i finally find there are ways to <a class="link"   target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/224887/how-to-script-make-menuconfig-to-automate-linux-kernel-build-configuration" >realized that<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Configuration targets:                  </span><br><span class="line">  config              - Update current config utilising a line-oriented program</span><br><span class="line">  nconfig             - Update current config utilising a ncurses menu based program       </span><br><span class="line">  menuconfig          - Update current config utilising a menu based program               </span><br><span class="line">  xconfig             - Update current config utilising a QT based front-end</span><br><span class="line">  gconfig             - Update current config utilising a GTK based front-end</span><br><span class="line">  oldconfig           - Update current config utilising a provided .config as base         </span><br><span class="line">  localmodconfig      - Update current config disabling modules not loaded                 </span><br><span class="line">  localyesconfig      - Update current config converting local mods to core                </span><br><span class="line">  silentoldconfig     - Same as oldconfig, but quietly, additionally update deps           </span><br><span class="line">  defconfig           - New config with default from ARCH supplied defconfig               </span><br><span class="line">  savedefconfig       - Save current config as ./defconfig (minimal config)                </span><br><span class="line">  allnoconfig         - New config where all options are answered with no                  </span><br><span class="line">  allyesconfig        - New config where all options are accepted with yes                 </span><br><span class="line">  allmodconfig        - New config selecting modules when possible                         </span><br><span class="line">  alldefconfig        - New config with all symbols set to default                         </span><br><span class="line">  randconfig          - New config with random answer to all options                       </span><br><span class="line">  listnewconfig       - List new options                                                   </span><br><span class="line">  olddefconfig        - Same as silentoldconfig but sets new symbols to their default value</span><br><span class="line">  kvmconfig           - Enable additional options for guest kernel support                 </span><br><span class="line">  tinyconfig          - Configure the tiniest possible kernel                              </span><br></pre></td></tr></table></figure>

<p>I finally know that there are so many options for make to choose, and the one i need is <code>make defconfig</code>. It will produce an origin <code>.config</code> file. After that run <code>make menuconfig</code> to use gui interface to choose the items.</p>
<h3 id="unmask-a-package-get-the-latest-version"><a href="#unmask-a-package-get-the-latest-version" class="headerlink" title="unmask a package || get the latest version"></a>unmask a package || get the latest version</h3><p>Sometimes, when we prepare to install a package with emerge, and we find we cannot install it, because it shows the package is masked. We can allow that by editing a configuration file <code>/etc/portage/package.accept_keywords</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> example unmask ddcutil package</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">put the line <span class="keyword">in</span> package.accept_keywords</span></span><br><span class="line"></span><br><span class="line">app-misc/ddcutil ~amd64</span><br></pre></td></tr></table></figure>

<p>Then we will be allowed to install. If we want to install the latest version of package, we can configure it the same way.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> example without any configure, allowed firefox version is 102.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">with configuration, we can install the newest verion 108</span></span><br><span class="line"></span><br><span class="line">www-client/firefox ~amd64</span><br></pre></td></tr></table></figure>


<h2 id="ISSUE"><a href="#ISSUE" class="headerlink" title="ISSUE"></a>ISSUE</h2><h3 id="Startx-cannot-open-dev-tty0"><a href="#Startx-cannot-open-dev-tty0" class="headerlink" title="Startx cannot open /dev/tty0"></a>Startx cannot open /dev/tty0</h3><p>In gentoo, after we installed, and we try to login window manager with <code>startx</code> command as a none root user, we will got this error message:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">startx</span></span><br><span class="line"></span><br><span class="line">parse_vt_settings: Cannot open /dev/tty0 (permission denied)</span><br></pre></td></tr></table></figure>

<p>The solution is <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Non_root_Xorg" >enabling elogind service<i class="fas fa-external-link-alt"></i></a> at boot time.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas rc-update add elogind boot</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">/etc/init.d/elogind start</span></span><br></pre></td></tr></table></figure>

<h3 id="etc-profile-doesn’t-take-effect"><a href="#etc-profile-doesn’t-take-effect" class="headerlink" title="/etc/profile doesn’t take effect"></a><code>/etc/profile</code> doesn’t take effect</h3><p><em>Cannot auto source <code>/etc/profile</code> when changing default shell from bash to zsh.</em></p>
<p>In archlinux, once i change default shell to zsh, everything works fine. But in gentoo, i got some problems, i find everything in <code>/etc/profile</code> doesn’t take effect.</p>
<p>After searching, i finally find <a class="link"   target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/537637/sshing-into-system-with-zsh-as-default-shell-doesnt-run-etc-profile" >the reason<i class="fas fa-external-link-alt"></i></a>, zsh shell doesn’t read <code>/etc/profile</code> but <code>/etc/zsh/zprofile</code>.</p>
<p>So the solution is writing everything we need to <code>/etc/zsh/zprofile</code> for system wide, or <code>~/.config/zsh/zprofile</code> for user wide.</p>
<h3 id="no-sound-by-default"><a href="#no-sound-by-default" class="headerlink" title="no sound by default"></a>no sound by default</h3><p>Alsa stands for advanced linux sound architecture which obtains the sound ability of kernel. In fact, we don’t need other tools to gain the sound, but the sound system is muted by default, so we need install <code>media-sound/alsa-utils</code> which contains <a class="link"   target="_blank" rel="noopener" href="https://github.com/alsa-project/alsa-utils" >some useful tools<i class="fas fa-external-link-alt"></i></a> help us to unmute sound and adjust it.</p>
<ul>
<li><p>Unmute sound system</p>
<p>We can use command <code>alsamixer</code> a ncurse tool to unmute sound first. But the system will still have no sound until we configured.</p>
</li>
<li><p><a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/ALSA#Configuration_2" >Find sound device<i class="fas fa-external-link-alt"></i></a></p>
<p>Find the sound devices</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">aplay -L</span> </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">front:CARD=Generic_1,DEV=0</span><br><span class="line">HD-Audio Generic, ALCS1200A Analog</span><br><span class="line">Front output / input</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Find the part of front, that is the information we need.</p>
</li>
<li><p>Configure sound</p>
<p>There are there places we can put our configuration:</p>
<ul>
<li><code>/etc/asound.conf</code></li>
<li><code>~/.asoundrc</code></li>
<li><code>~/.config/alsa/asoundrc</code></li>
</ul>
<p>As my case, i need this configuration to be put.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaults.pcm.!card Generic_1</span><br><span class="line">defaults.pcm.!device 0</span><br><span class="line">defaults.ctl.!card Generic_1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="cannot-find-libnss-so"><a href="#cannot-find-libnss-so" class="headerlink" title="cannot find libnss.so"></a>cannot find libnss.so</h3><p>When i start clash with <code>./cfw</code>, it shows some error messages: “libnss.so library missing”. If use emerge to search libnss, we cannot find the correct one. In a fact, the correct one is called <code>nss</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask dev-libs/nss</span><br></pre></td></tr></table></figure>

<p>After installing, i can successfully launch the clash application.</p>
<h2 id="COMPILED-FROM-SOURCE"><a href="#COMPILED-FROM-SOURCE" class="headerlink" title="COMPILED FROM SOURCE"></a>COMPILED FROM SOURCE</h2><h3 id="ddcutil"><a href="#ddcutil" class="headerlink" title="ddcutil"></a>ddcutil</h3><p>If we get a external monitor, we cannot adjust brightness with <code>xbrightness</code> command, so we need a tool called <code>ddcutil</code>, however in gentoo it is masked, so the best way is downloading the source code and compile it manually.</p>
<ul>
<li><p>Download <a class="link"   target="_blank" rel="noopener" href="https://github.com/rockowitz/ddcutil" >ddcuitl source file<i class="fas fa-external-link-alt"></i></a> from github</p>
</li>
<li><p>Follow <a class="link"   target="_blank" rel="noopener" href="https://www.ddcutil.com/building/" >this page<i class="fas fa-external-link-alt"></i></a> to compile ddcutil</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">cd</span> to unpacking directory</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">./autogen.sh</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">./configure</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">make</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas make install</span></span><br></pre></td></tr></table></figure>

<p>Then ddcutil will be installed in <code>/usr/local/bin/ddcutil</code>.</p>
</li>
<li><p>Load <code>i2c-dev</code> module</p>
<p>By default, we cannot run ddcutil command, cause <code>i2c-dev</code> device missing.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil detect                                       1 ↵</span></span><br><span class="line">No /dev/i2c devices exist.</span><br><span class="line">ddcutil requires module i2c-dev.</span><br></pre></td></tr></table></figure>

<p>Load missing module</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas modprobe i2c-dev</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">check whether loaded</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">lsmod |rg -i i2c</span></span><br><span class="line">i2c_dev                28672  0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: we need to make sure i2c-dev already compiled in kernel.</p>
</blockquote>
</li>
<li><p>Detect display device</p>
<p>Most of the time it show device 10</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil getvcp ALL |rg -i brightness</span></span><br><span class="line">VCP code 0x10 (Brightness                    ): current value =    25, max value =   100</span><br></pre></td></tr></table></figure></li>
<li><p>Set/get brightness with ddcutil</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil setvcp 10 + 5</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil getvcp 10</span></span><br><span class="line">VCP code 0x10 (Brightness                    ): current value =    25, max value =   100</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="picom"><a href="#picom" class="headerlink" title="picom"></a>picom</h3><p>Yeah, i love picom, but in gentoo repo i cannot find [pijulius/picom] but the original one, so i need to compile it from source.</p>
<ul>
<li><p>Download <a class="link"   target="_blank" rel="noopener" href="https://github.com/pijulius/picom" >source code<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li><p>Download needed dependcies</p>
<p>One trick is that we don’t need to install all the dependcies from what github page says. We can only install the dependcies from what gentoo repo’s picom needs.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">find the needed dependcies</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">emerge --ask --pretend x11-misc/picom</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">install the need dependcies</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas emerge --ask uthash libev libconfig</span></span><br></pre></td></tr></table></figure></li>
<li><p>Compile source file</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">cd</span> picom-implement-window-animations</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">git submodule update --init --recursive</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">meson --buildtype=release . build</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">ninja -C build</span></span><br></pre></td></tr></table></figure>

<p>Then the binary file will be installed in <code>~/.local/bin/picom</code>.</p>
</li>
<li><p>Run picom</p>
<p>Make sure the configuration file is placed in proper location.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">picom --experimental-backends --config ~/.config/picom/picom.conf -b</span></span><br></pre></td></tr></table></figure></li>
</ul>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/gentoo/">#gentoo</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/11/30/use-entr-to-sync-task/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">use-entr-to-sync-task</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">shutterbug</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MY-GENTOO-HANDBOOK"><span class="nav-number">1.</span> <span class="nav-text">MY GENTOO HANDBOOK</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#INSTALL"><span class="nav-number">1.1.</span> <span class="nav-text">INSTALL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#KERNEL"><span class="nav-number">1.1.1.</span> <span class="nav-text">KERNEL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#configure-sound-card"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">configure sound card</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#configure-frame-buffer"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">configure frame buffer</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-default-gpu-driver"><span class="nav-number">1.1.2.</span> <span class="nav-text">configure default gpu driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-console-front"><span class="nav-number">1.1.3.</span> <span class="nav-text">configure console front</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SKILL"><span class="nav-number">1.2.</span> <span class="nav-text">SKILL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#compile-kernel-with-correct-file"><span class="nav-number">1.2.1.</span> <span class="nav-text">compile kernel with correct file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unmask-a-package-get-the-latest-version"><span class="nav-number">1.2.2.</span> <span class="nav-text">unmask a package || get the latest version</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISSUE"><span class="nav-number">1.3.</span> <span class="nav-text">ISSUE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Startx-cannot-open-dev-tty0"><span class="nav-number">1.3.1.</span> <span class="nav-text">Startx cannot open &#x2F;dev&#x2F;tty0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#etc-profile-doesn%E2%80%99t-take-effect"><span class="nav-number">1.3.2.</span> <span class="nav-text">&#x2F;etc&#x2F;profile doesn’t take effect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#no-sound-by-default"><span class="nav-number">1.3.3.</span> <span class="nav-text">no sound by default</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cannot-find-libnss-so"><span class="nav-number">1.3.4.</span> <span class="nav-text">cannot find libnss.so</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COMPILED-FROM-SOURCE"><span class="nav-number">1.4.</span> <span class="nav-text">COMPILED FROM SOURCE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ddcutil"><span class="nav-number">1.4.1.</span> <span class="nav-text">ddcutil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#picom"><span class="nav-number">1.4.2.</span> <span class="nav-text">picom</span></a></li></ol></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>






<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
