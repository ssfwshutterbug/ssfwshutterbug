<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="shutterbug">
    
    <title>
        
            gentoo |
        
        Stay Hard!
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"raw.githubusercontent.com","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/logo.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/4.jpg","description":"the world you see is not about how they act but how we respond."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                Stay Hard!
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">gentoo</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">shutterbug</span>
                        
                            <span class="author-label">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2023-02-02 22:27:42</span>
        <span class="mobile">2023-02-02 22:27</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/linux/">linux</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/gentoo/">gentoo</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="MY-GENTOO-HANDBOOK"><a href="#MY-GENTOO-HANDBOOK" class="headerlink" title="MY GENTOO HANDBOOK"></a>MY GENTOO HANDBOOK</h1><p>After 6 years of archlinux usage, i finally move to gentoo and give it a try. After several weeks, i still miss archlinux, since installing something is really cheap in arch, but often take minutes in gentoo. However, i learned more in gentoo and get used to compiling kernel. So, it is really worth to try gentoo.</p>
<p>Okay, another several weeks later, i got to say i love gentoo really, aka. It takes time to get used to gentoo, but once you make it, you will find that gentoo’s way is elegant. </p>
<h2 id="KERNEL"><a href="#KERNEL" class="headerlink" title="KERNEL"></a>KERNEL</h2><h3 id="configure-sound-card"><a href="#configure-sound-card" class="headerlink" title="configure sound card"></a>configure sound card</h3><p>If we don’t configure sound card, then with the default configuration we never gonna have sound. So we need to follow the <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/ALSA" >alsa page<i class="fas fa-external-link-alt"></i></a> and choose some of the card driver.</p>
<p>In fact i also don’t know which one should i choose, i just picked <code>Realtic</code> and then compiled and reboot, and i get the sound.</p>
<h3 id="configure-frame-buffer"><a href="#configure-frame-buffer" class="headerlink" title="configure frame buffer"></a>configure frame buffer</h3><p>There are several times when i compiled a kernel, and reboot to a black screen, it only shows “loading kernel…”, and this is something that configured in grub. So in a word, system cannot boot the kernel. And i am glad to say, i finally know the reason, that is caused by error configuration of frame buffer.</p>
<p>I miss one step in <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Xorg/Guidehttps://wiki.gentoo.org/wiki/Xorg/Guide" >kernel configuration<i class="fas fa-external-link-alt"></i></a> with <code>Xorg</code> ability. I didn’t specify the firmware file(under <code>/lib/firmware</code>) which frame buffer depends on(compile gpu drive to kernel directly). </p>
<p>We should follow the <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Linux_firmware#Kernels_prior_to_v4.18" >firmware page<i class="fas fa-external-link-alt"></i></a> to configure.</p>
<p><img src="../.images/framebf.1.png" alt="flamebuffer location"></p>
<p>We can write like this: <code>amdgpu/xxx.bin amdgpu/xxx.bin</code>, separated by space. However which one should i write? We need boot to a normal system, and run this command to find.<br>Or we can find in the <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Fonts#Console_font" >page<i class="fas fa-external-link-alt"></i></a>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--- › » dmesg -t | grep amdgpu | grep firmware</span><br><span class="line">Loading firmware: amdgpu/beige_goby_sos.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_ta.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_smc.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_pfp.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_me.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_ce.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_rlc.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_mec.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_mec2.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_sdma.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_dmcub.bin</span><br><span class="line">Loading firmware: amdgpu/beige_goby_vcn.bin</span><br><span class="line">amdgpu 0000:03:00.0: amdgpu: Will use PSP to load VCN firmware</span><br></pre></td></tr></table></figure>

<p><img src="../.images/framebf.2.png" alt="location to write"><br><img src="../.images/framebf.3.png" alt="location to write"></p>
<h3 id="compile-fuse-as-module"><a href="#compile-fuse-as-module" class="headerlink" title="compile fuse as module"></a>compile fuse as module</h3><p>When i run appimage, it occurs an error shows need fuse(file system in userspace) device, and i have not compiled it to kernel, so if we want to use appimage, we need to compile it to kernel. And i choose to compile it as module.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- ~/dl » ./Franz-5.9.2.AppImage </span><br><span class="line">fuse: device not found, try &#x27;modprobe fuse&#x27; first</span><br><span class="line"></span><br><span class="line">Cannot mount AppImage, please check your FUSE setup.</span><br><span class="line">You might still be able to extract the contents of this AppImage </span><br><span class="line">if you run it with the --appimage-extract option. </span><br><span class="line">See https://github.com/AppImage/AppImageKit/wiki/FUSE </span><br><span class="line">for more information</span><br><span class="line">open dir error: No such file or directory</span><br></pre></td></tr></table></figure>


<h3 id="configure-default-gpu-driver"><a href="#configure-default-gpu-driver" class="headerlink" title="configure default gpu driver"></a>configure default gpu driver</h3><p>Usually we can successfully login window manager without problem, but once we check the xorg log file <code>~/.local/share/xorg/Xorg.0.log</code>, we will find some error messages show cannot load ati/mesa gpu driver, although it is harmless(it will finally load the gpu we have), but this comes because we have not configured it yet.</p>
<p>We should specify the correct gpu driver we use in <code>/etc/X11/xorg.conf</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Section &quot;Device&quot;</span><br><span class="line">   Identifier   &quot;My Graphics Card&quot;</span><br><span class="line">   Driver       &quot;amdgpu&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure>


<h3 id="configure-console-front"><a href="#configure-console-front" class="headerlink" title="configure console front"></a>configure console front</h3><p>While using framebuffer, the console font size becomes too small, so there is a need to change the font size. I find <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Fonts#Console_font" >the way<i class="fas fa-external-link-alt"></i></a>.</p>
<ol>
<li><p>Find console font name in <code>/usr/share/consolefonts</code>.</p>
</li>
<li><p>Configure font in <code>/etc/conf.d/consolefont</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consolefont=&quot;sun12x22&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: remove <code>.psfu.gz</code> of the font name.</p>
</blockquote>
</li>
<li><p>Add consolefont service to boot level.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rc-update add consolefont boot</span><br></pre></td></tr></table></figure></li>
<li><p>After reboot, the font size will be the right one.</p>
</li>
</ol>
<h2 id="USAGE"><a href="#USAGE" class="headerlink" title="USAGE"></a>USAGE</h2><h3 id="Turn-Compile-Dir-To-Tmpfs"><a href="#Turn-Compile-Dir-To-Tmpfs" class="headerlink" title="Turn Compile Dir To Tmpfs"></a>Turn Compile Dir To Tmpfs</h3><p>When emerge builds package, it will use <code>/var/tmp/portage/</code> to store all compile files which will never be used again, so it is a waste of disk space, and we can <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Portage_TMPDIR_on_tmpfs" >change this directory<i class="fas fa-external-link-alt"></i></a> to tmpfs.</p>
<p>We can add this lines to <code>/etc/fstab</code>. In a fact <code>/var/tmp</code> directory can also change to tmpfs.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmpfs /var/tmp         tmpfs rw,nosuid,noatime,nodev,size=4G,mode=1777 0 0</span><br><span class="line">tmpfs /var/tmp/portage tmpfs rw,nosuid,noatime,nodev,size=4G,mode=775,uid=portage,gid=portage,x-mount.mkdir=775 0 0</span><br></pre></td></tr></table></figure>


<h3 id="Change-Keyboard-Map"><a href="#Change-Keyboard-Map" class="headerlink" title="Change Keyboard Map"></a>Change Keyboard Map</h3><p>Change console keyboard map</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">edit /etc/conf.d/keymaps</span></span><br><span class="line"></span><br><span class="line">extended_keymaps=&quot;dvorak&quot;</span><br></pre></td></tr></table></figure>
<p>Change X11 keyboard map</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">edit /etc/X11/xorg.conf</span></span><br><span class="line"></span><br><span class="line">Section &quot;InputClass&quot;</span><br><span class="line">	Identifier &quot;Keyboard&quot;</span><br><span class="line">	MatchIsKeyboard &quot;on&quot;</span><br><span class="line">	MatchDevicePath &quot;/dev/input/event*&quot;</span><br><span class="line">	Driver &quot;evdev&quot;</span><br><span class="line">	Option &quot;XkbLayout&quot; &quot;us&quot;</span><br><span class="line">	Option &quot;XkbVariant&quot; &quot;dvorak&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure>

<h3 id="correctly-configure-gpu-driver"><a href="#correctly-configure-gpu-driver" class="headerlink" title="correctly configure gpu driver"></a>correctly configure gpu driver</h3><p>If we only follow gentoo handbook to install and configure system with amdgpu, then we can get system work. If we run <code>neofetch</code>, we can see GPU is the correct one, but it just seems that the real amdgpu is not working, because its display a little slow and cannot set Xorg with <em>tearfree</em> and <em>accerate</em>.</p>
<p>If we run command <code>glxinfo -B</code>, we can see the truth, and it shows we are not using amdgpu but <code>llvmpipe</code>. The seem, if we run <code>glxgears</code>, only cpu usage increased.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OpenGL vendor string: Mesa/X.org</span><br><span class="line">OpenGL renderer string: llvmpipe (LLVM 12.0.0, 256 bits)</span><br></pre></td></tr></table></figure>

<p>The reason is that we missed one software, we need to follow <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/AMDGPU" >gentoo amdgpu chapter<i class="fas fa-external-link-alt"></i></a> to correctly set <code>VIDEO_CARDS</code> in <code>make.conf</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VIDEO_CARDS=&quot;amdgpu radeonsi&quot;</span><br></pre></td></tr></table></figure>

<p>And then update world use flag.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask --deep --changed-use @world</span><br></pre></td></tr></table></figure>

<p>After reboot, we run <code>glxinfo -B</code> and find that everything is find.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">name of display: :0</span><br><span class="line">display: :0  screen: 0</span><br><span class="line">direct rendering: Yes</span><br><span class="line">Extended renderer info (GLX_MESA_query_renderer):</span><br><span class="line">    Vendor: AMD (0x1002)</span><br><span class="line">    Device: AMD Radeon RX 6500 XT (navi24, LLVM 15.0.7, DRM 3.42, 5.15.88-gentoo) (0x743f)</span><br><span class="line">    Version: 22.2.5</span><br><span class="line">    Accelerated: yes</span><br><span class="line">    Video memory: 4096MB</span><br><span class="line">    Unified memory: no</span><br><span class="line">    Preferred profile: core (0x1)</span><br><span class="line">    Max core profile version: 4.6</span><br><span class="line">    Max compat profile version: 4.6</span><br><span class="line">    Max GLES1 profile version: 1.1</span><br><span class="line">    Max GLES[23] profile version: 3.2</span><br></pre></td></tr></table></figure>


<h3 id="add-guru-repository"><a href="#add-guru-repository" class="headerlink" title="add guru repository"></a>add guru repository</h3><p>There are so many <a class="link"   target="_blank" rel="noopener" href="https://qa-reports.gentoo.org/output/repos/" >third part repository<i class="fas fa-external-link-alt"></i></a> with gentoo. And i will try guru this time.</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Project:GURU/Information_for_End_Users" >Guru<i class="fas fa-external-link-alt"></i></a> is a gentoo repository just like arch’s aur. I tried to install with eselect-repository but failed, so i will configure it manually.</p>
<ol>
<li><p>Create a repo file</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/portage/repos.conf/guru.conf </span><br><span class="line"></span><br><span class="line">[guru]</span><br><span class="line">location = /var/db/repos/guru</span><br><span class="line">sync-type = git</span><br><span class="line">sync-uri = https://github.com/gentoo-mirror/guru.git</span><br></pre></td></tr></table></figure></li>
<li><p>syncing</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --sync guru</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p>Note: now we cannot find any difference with <code>emerge search</code> which not like arch’s aur. But we can find the difference in installation</p>
</blockquote>
<h3 id="compile-kernel-with-correct-file"><a href="#compile-kernel-with-correct-file" class="headerlink" title="compile kernel with correct file"></a>compile kernel with correct file</h3><p>Since i decide to use gentoo, how to configure a minimalist kernel is always a challenge for me. Last failed time i compile kernel, i got confused a lot, because the first time compiled failed, i want to recompile the kernel, but when i run <code>make menuconfig</code>, i got the configuration the same as i changed before, even when i removed <code>.config</code> file. What i really want is a clean origin setting. And i finally find there are ways to <a class="link"   target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/224887/how-to-script-make-menuconfig-to-automate-linux-kernel-build-configuration" >realized that<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Configuration targets:                  </span><br><span class="line">  config              - Update current config utilising a line-oriented program</span><br><span class="line">  nconfig             - Update current config utilising a ncurses menu based program       </span><br><span class="line">  menuconfig          - Update current config utilising a menu based program               </span><br><span class="line">  xconfig             - Update current config utilising a QT based front-end</span><br><span class="line">  gconfig             - Update current config utilising a GTK based front-end</span><br><span class="line">  oldconfig           - Update current config utilising a provided .config as base         </span><br><span class="line">  localmodconfig      - Update current config disabling modules not loaded                 </span><br><span class="line">  localyesconfig      - Update current config converting local mods to core                </span><br><span class="line">  silentoldconfig     - Same as oldconfig, but quietly, additionally update deps           </span><br><span class="line">  defconfig           - New config with default from ARCH supplied defconfig               </span><br><span class="line">  savedefconfig       - Save current config as ./defconfig (minimal config)                </span><br><span class="line">  allnoconfig         - New config where all options are answered with no                  </span><br><span class="line">  allyesconfig        - New config where all options are accepted with yes                 </span><br><span class="line">  allmodconfig        - New config selecting modules when possible                         </span><br><span class="line">  alldefconfig        - New config with all symbols set to default                         </span><br><span class="line">  randconfig          - New config with random answer to all options                       </span><br><span class="line">  listnewconfig       - List new options                                                   </span><br><span class="line">  olddefconfig        - Same as silentoldconfig but sets new symbols to their default value</span><br><span class="line">  kvmconfig           - Enable additional options for guest kernel support                 </span><br><span class="line">  tinyconfig          - Configure the tiniest possible kernel                              </span><br></pre></td></tr></table></figure>

<p>I finally know that there are so many options for make to choose, and the one i need is <code>make defconfig</code>. It will produce an origin <code>.config</code> file. After that run <code>make menuconfig</code> to use gui interface to choose the items.</p>
<h3 id="remove-sys-kernel-gentoo-kernel-bin"><a href="#remove-sys-kernel-gentoo-kernel-bin" class="headerlink" title="remove sys-kernel/gentoo-kernel-bin"></a>remove sys-kernel/gentoo-kernel-bin</h3><p>Because the first time i installed gentoo with this pre-compiled kernel, and change to gentoo-source after successfully boot, so there is no need to keep this binary kernel installed anymore, since every time upgrading system, it will upgrade too.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas emerge --depclean virtual/dist-kernel sys-kernel/gentoo-kernel-bin</span></span><br></pre></td></tr></table></figure>


<h3 id="unmask-a-package-or-get-the-latest-version"><a href="#unmask-a-package-or-get-the-latest-version" class="headerlink" title="unmask a package or get the latest version"></a>unmask a package or get the latest version</h3><p>Sometimes, when we prepare to install a package with emerge, and we find we cannot install it, because it shows the package is masked. We can allow that by editing a configuration file <code>/etc/portage/package.accept_keywords</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">for</span> example unmask ddcutil package</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">put the line <span class="keyword">in</span> package.accept_keywords</span></span><br><span class="line"></span><br><span class="line">app-misc/ddcutil ~amd64</span><br></pre></td></tr></table></figure>

<p>Then we will be allowed to install. If we want to install the latest version of package, we can configure it the same way.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="keyword">for</span> example without any configure, allowed firefox version is 102.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">with configuration, we can install the newest verion 108</span></span><br><span class="line"></span><br><span class="line">www-client/firefox ~amd64</span><br></pre></td></tr></table></figure>

<h3 id="update-configuration-file"><a href="#update-configuration-file" class="headerlink" title="update configuration file"></a>update configuration file</h3><p>When we update or install or uninstall software, there is a chance we will face this information.</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">*</span> IMPORTANT: 7 config files in &#x27;/etc&#x27; need updating.</span><br><span class="line"><span class="bullet">*</span> See the CONFIGURATION FILES and CONFIGURATION FILES UPDATE TOOLS</span><br><span class="line"><span class="bullet">*</span> sections of the emerge man page to learn how to update config files.</span><br></pre></td></tr></table></figure>

<p>What this information it is telling us there is a need to merge new configuration to the old one, why would that happen? I am grade to say that’s the graceful of gentoo, it will never gonna to change our configuration(default all config under <code>/etc</code>) unless our permit(adding to the path of <code>$CONFIG_PROTECT_MASK</code>). So we need to merge those changes, and there are <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Dispatch-conf" >some tools<i class="fas fa-external-link-alt"></i></a> will help us.</p>
<ul>
<li>dispatch-conf  </li>
<li>cfg-update </li>
<li>etc-update </li>
</ul>
<p>The new configuration file named <code>._cfgxxx</code> under the same folder where old configuration exists.</p>
<p>Before we merge, we can optimize a little of <code>dispatch-conf</code>, since it uses <code>diff</code> to compare two files without colors, we can change that.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas nvim /etc/dispatch-conf.conf</span></span><br><span class="line"></span><br><span class="line">diff=&quot;diff --color=always -Nu &#x27;%s&#x27; &#x27;%s&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p>Now, it is time to merge.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas dispatch-conf</span></span><br></pre></td></tr></table></figure>


<h3 id="choose-other-repository"><a href="#choose-other-repository" class="headerlink" title="choose other repository"></a>choose other repository</h3><p>Gentoo has more than one <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Eselect/Repository" >repository<i class="fas fa-external-link-alt"></i></a>, we can add it by hand or use an old too called <code>layman</code>. But a modern way is using <code>eselect repository</code>.</p>
<ol>
<li><p>First we need to install it.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emerge --ask app-eselect/eselect-repository</span></span><br></pre></td></tr></table></figure></li>
<li><p>Make sure there already has a <code>/etc/portage/repo.conf</code> directory.</p>
</li>
<li><p>Make sure there already has a wget config file <code>wgetrc</code> in <code>~/.config</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: <span class="built_in">cp</span> /etc/wgetrc ~/.config/</span></span><br></pre></td></tr></table></figure></li>
<li><p>Run the command show all repositories.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: eselect repository list</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or only show currently configured repository</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: eselect repository list -i</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note:</p>
<ol>
<li>Installed, enabled repositories are suffixed with a * character.</li>
<li>Repositories suffixed with #, need their sync information updated (via disable/enable) or were customized by the user.</li>
<li>Repositories suffixed with @ are not listed by name in the official, published list.</li>
</ol>
</blockquote>
</li>
<li><p>Add an new ebuild repository</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> example add guru</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas eselect repository <span class="built_in">enable</span> guru</span></span><br></pre></td></tr></table></figure></li>
<li><p>Sync new repository</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emaint <span class="built_in">sync</span> -r guru</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="use-gentoolto"><a href="#use-gentoolto" class="headerlink" title="use gentoolto"></a>use <a class="link"   target="_blank" rel="noopener" href="https://github.com/InBetweenNames/gentooLTO" >gentoolto<i class="fas fa-external-link-alt"></i></a></h3><p>Gentoolto is a overlay instruction help us to optimize packages, shrink compile and launch time but get bigger package size.</p>
<ol>
<li><p>Add repository</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas eselect repository <span class="built_in">enable</span> <span class="built_in">mv</span> lto-overlay</span></span><br></pre></td></tr></table></figure></li>
<li><p>Sync repository</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emaint <span class="built_in">sync</span> -r <span class="built_in">mv</span></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emaint <span class="built_in">sync</span> -r lto-overlay</span></span><br></pre></td></tr></table></figure></li>
<li><p>Install ltoize</p>
<p>Unmask ltoize first</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">add this to /etc/portage/package.accept_keywords</span></span><br><span class="line"></span><br><span class="line">sys-config/ltoize ~amd64</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emerge --ask sys-config/ltoize</span></span><br></pre></td></tr></table></figure></li>
<li><p>Configure <code>make.conf.lto</code></p>
<p>Just uncomment the one github page shows, but <code>CPU_FLAGS_X86</code> need ourselves to add</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">run cpuid2cpuflags to show all matched flag</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: cpuid2cpuflags</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">then</span> add this flag to config file with same format, <span class="keyword">for</span> my cpu it is</span></span><br><span class="line">CPU_FLAGS_X86=&quot;aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>Rebuild system with lto</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emerge -e --keep-going @world</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="remove-unused-agetty"><a href="#remove-unused-agetty" class="headerlink" title="remove unused agetty"></a>remove unused agetty</h3><p>Every time i login system and launch htop, find there are agetty2…agetty6, in a fact, i never gone use the other agetty, so i decide to remove those. And it is quiet simple.</p>
<p>Edit <code>/etc/inittab</code>, under TERMINAL section, comment those unused(c2…c6).</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">TERMINALS</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">x1:12345:respawn:/sbin/agetty 38400 console linux</span></span><br><span class="line">c1:12345:respawn:/sbin/agetty --noclear 38400 tty1 linux</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">c2:2345:respawn:/sbin/agetty 38400 tty2 linux</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">c3:2345:respawn:/sbin/agetty 38400 tty3 linux</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">c4:2345:respawn:/sbin/agetty 38400 tty4 linux</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">c5:2345:respawn:/sbin/agetty 38400 tty5 linux</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">c6:2345:respawn:/sbin/agetty 38400 tty6 linux</span></span><br></pre></td></tr></table></figure>


<h3 id="use-eix"><a href="#use-eix" class="headerlink" title="use eix"></a>use eix</h3><p>Okay, what is <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Eix#Searching_for_packages" >eix<i class="fas fa-external-link-alt"></i></a>? It is a better version of <code>emerge --search</code>, much more faster and flexible.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas emerge --ask app-portage/eix</span></span><br></pre></td></tr></table></figure>

<p>After installation, we need to update the cache to index all packages on the system.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas eix-update</span></span><br></pre></td></tr></table></figure>

<h3 id="setting-cursor-theme"><a href="#setting-cursor-theme" class="headerlink" title="setting cursor theme"></a>setting cursor theme</h3><p>Because i don’t wanna to build my gentoo with any gtk or qt library, so there is no need to configure cursor theme for gtk or qt. And i find <a class="link"   target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Cursor_themes#XDG_specification" >arch wiki<i class="fas fa-external-link-alt"></i></a> is much better than gentoo wiki, since it introduce the XDG specification which is very important for me to configure cursor theme for firefox.</p>
<p>So, i only need to configure XDG and Xresources.</p>
<p>I don’t want to create <code>.icons</code> under home directory, so i need put cursor theme in <code>/usr/share/icons</code>.</p>
<ul>
<li><p>XDG configuration</p>
<p>The config should be put in <code>/usr/share/icons/default/index.theme</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/share/icons/default</span><br><span class="line">touch /usr/share/icons/default/index.theme</span><br></pre></td></tr></table></figure>

<p>Then add, make sure the cursor_theme_name is the theme directory name.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[icon theme] </span><br><span class="line">Inherits=cursor_theme_name</span><br></pre></td></tr></table></figure></li>
<li><p>Xresources</p>
<p>It is quite simple. Add to <code>~/.Xresources</code> or other use defined position.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Xcursor.theme: oreo_red_cursors</span><br><span class="line">Xcursor.size: 16</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="prevent-package-auto-update-or-build-a-local-repo"><a href="#prevent-package-auto-update-or-build-a-local-repo" class="headerlink" title="prevent package auto update or build a local repo"></a>prevent package auto update or build a local repo</h3><p>If we update the system and there is a new version of kernel, then the system will auto update kernel even the one <code>gentoo-source</code> which needs manually configured. But i don’t expect that happened, so i need a way to fix that. </p>
<p>There are <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Portage/CustomTree#Defining_a_custom_ebuild_repository" >several ways<i class="fas fa-external-link-alt"></i></a> to implement it:</p>
<ol>
<li>write package to <code>package.provided</code></li>
<li>add excluding package to <code>rsync_excludes</code></li>
<li>create a local ebuild repository</li>
</ol>
<hr>
<p>According to <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki//etc/portage/profile/package.provided" >this page<i class="fas fa-external-link-alt"></i></a>, we can write the package into <code>/etc/portage/profile/package.provided</code> file to prevent it auto update.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas <span class="built_in">touch</span> /etc/portage/profile/package.provided</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;sys-kernel/gentoo-sources-5.15.88&quot;</span> &gt;&gt; /etc/portage/profile/package.provided</span></span><br></pre></td></tr></table></figure>

<p>Just make sure the package’s version need to be specified also.</p>
<hr>
<p>In order to disable sync new ebuild, we can either remove <code>rsync-verify</code> USE flag of <code>portage</code> or set <code>sync-rsync-verify-metamanifest=on</code>. I think the second is better.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">edit /etc/portage/repos.conf/gentoo.conf and change</span></span><br><span class="line">sync-rsync-verify-metamanifest = no</span><br></pre></td></tr></table></figure>

<p>Then exclude the package and modify <code>make.conf</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">create file</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">touch</span> /etc/portage/rsync_excludes</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">write package to this file</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;gentoo-sources&quot;</span> &gt;&gt; /etc/portage/rsync_excludes</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">configure <span class="keyword">in</span> make.conf</span></span><br><span class="line">PORTAGE_RSYNC_EXTRA_OPTS=&quot;--exclude-from=/etc/portage/rsync_excludes&quot;</span><br></pre></td></tr></table></figure>

<hr>
<p>Create standard repo structure. Let’s call this repo with <code>localrepo</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">mkdir</span> -p /var/db/repos/localrepo/&#123;metadata,profiles&#125;</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">chown</span> -R portage:portage /var/db/repos/localrepo</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">echo</span> <span class="string">&#x27;localrepo&#x27;</span> &gt; /var/db/repos/localrepo/profiles/repo_name</span></span><br></pre></td></tr></table></figure>

<p>Specify no sync needed for this repo.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">edit /var/db/repos/localrepo/metadata/layout.conf</span> </span><br><span class="line">masters = gentoo</span><br><span class="line">auto-sync = false</span><br></pre></td></tr></table></figure>

<p>Enable/announce this repo in system.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">edit /etc/portage/repos.conf/localrepo.conf</span> </span><br><span class="line">[localrepo]</span><br><span class="line">location = /var/db/repos/localrepo</span><br></pre></td></tr></table></figure>


<h3 id="Automatic-Login-System"><a href="#Automatic-Login-System" class="headerlink" title="Automatic Login System"></a>Automatic Login System</h3><p>According to <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Automatic_login_to_virtual_console" >this page<i class="fas fa-external-link-alt"></i></a>, we can easily realize that.</p>
<p>Cause gentoo use sysvinit by default, we use the first method, add <code>--autologin &lt;username&gt;</code> to  <code>/etc/inittab</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1:12345:respawn:/sbin/agetty --autologin mandalorian --noclear 38400 tty1 linux</span><br></pre></td></tr></table></figure>


<h3 id="Add-Binary-Package-Host"><a href="#Add-Binary-Package-Host" class="headerlink" title="Add Binary Package Host"></a>Add Binary Package Host</h3><blockquote>
<p>Notices:</p>
<p>Even though this method is official but there are some problems when you upgrade, and the one i met is conflict Perl version, so i will not configure this.</p>
</blockquote>
<p>There is a way to add a <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Experimental_binary_package_host" >binary package host<i class="fas fa-external-link-alt"></i></a>, but the way to use it is different from adding a repository.</p>
<p>Create a file <code>/etc/portage/binrepos.conf</code> with this lines.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[binhost]</span><br><span class="line">priority = 9999</span><br><span class="line">sync-uri = https://gentoo.osuosl.org/experimental/amd64/binpkg/default/linux/17.1/x86-64/</span><br></pre></td></tr></table></figure>

<p>Add this opts to <code>/etc/portage/make.conf</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EMERGE_DEFAULT_OPTS=&quot;--binpkg-respect-use=y --getbinpkg=y&quot;</span><br></pre></td></tr></table></figure>

<p>Then in will automatically download and install binary packages whenever the version and use flag settings match. So there is nothing else needs us to do, we don`t choose which binary package to be installed.</p>
<h2 id="ISSUE"><a href="#ISSUE" class="headerlink" title="ISSUE"></a>ISSUE</h2><h3 id="Startx-cannot-open-dev-tty0"><a href="#Startx-cannot-open-dev-tty0" class="headerlink" title="Startx cannot open /dev/tty0"></a>Startx cannot open /dev/tty0</h3><p>In gentoo, after we installed, and we try to login window manager with <code>startx</code> command as a none root user, we will got this error message:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">startx</span></span><br><span class="line"></span><br><span class="line">parse_vt_settings: Cannot open /dev/tty0 (permission denied)</span><br></pre></td></tr></table></figure>

<p>The solution is <a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/Non_root_Xorg" >enabling elogind service<i class="fas fa-external-link-alt"></i></a> at boot time.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas rc-update add elogind boot</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">/etc/init.d/elogind start</span></span><br></pre></td></tr></table></figure>

<h3 id="etc-profile-doesn’t-take-effect"><a href="#etc-profile-doesn’t-take-effect" class="headerlink" title="/etc/profile doesn’t take effect"></a><code>/etc/profile</code> doesn’t take effect</h3><p><em>Cannot auto source <code>/etc/profile</code> when changing default shell from bash to zsh.</em></p>
<p>In archlinux, once i change default shell to zsh, everything works fine. But in gentoo, i got some problems, i find everything in <code>/etc/profile</code> doesn’t take effect.</p>
<p>After searching, i finally find <a class="link"   target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/537637/sshing-into-system-with-zsh-as-default-shell-doesnt-run-etc-profile" >the reason<i class="fas fa-external-link-alt"></i></a>, zsh shell doesn’t read <code>/etc/profile</code> but <code>/etc/zsh/zprofile</code>.</p>
<p>So the solution is writing everything we need to <code>/etc/zsh/zprofile</code> for system wide, or <code>~/.config/zsh/zprofile</code> for user wide.</p>
<h3 id="no-sound-by-default"><a href="#no-sound-by-default" class="headerlink" title="no sound by default"></a>no sound by default</h3><p>Alsa stands for advanced linux sound architecture which obtains the sound ability of kernel. In fact, we don’t need other tools to gain the sound, but the sound system is muted by default, so we need install <code>media-sound/alsa-utils</code> which contains <a class="link"   target="_blank" rel="noopener" href="https://github.com/alsa-project/alsa-utils" >some useful tools<i class="fas fa-external-link-alt"></i></a> help us to unmute sound and adjust it.</p>
<ul>
<li><p>Unmute sound system</p>
<p>We can use command <code>alsamixer</code> a ncurse tool to unmute sound first. But the system will still have no sound until we configured.</p>
</li>
<li><p><a class="link"   target="_blank" rel="noopener" href="https://wiki.gentoo.org/wiki/ALSA#Configuration_2" >Find sound device<i class="fas fa-external-link-alt"></i></a></p>
<p>Find the sound devices</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">aplay -L</span> </span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">front:CARD=Generic_1,DEV=0</span><br><span class="line">HD-Audio Generic, ALCS1200A Analog</span><br><span class="line">Front output / input</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Find the part of front, that is the information we need.</p>
</li>
<li><p>Configure sound</p>
<p>There are there places we can put our configuration:</p>
<ul>
<li><code>/etc/asound.conf</code></li>
<li><code>~/.asoundrc</code></li>
<li><code>~/.config/alsa/asoundrc</code></li>
</ul>
<p>As my case, i need this configuration to be put.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaults.pcm.!card Generic_1</span><br><span class="line">defaults.pcm.!device 0</span><br><span class="line">defaults.ctl.!card Generic_1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="cannot-find-libnss-so"><a href="#cannot-find-libnss-so" class="headerlink" title="cannot find libnss.so"></a>cannot find libnss.so</h3><p>When i start clash with <code>./cfw</code>, it shows some error messages: “libnss.so library missing”. If use emerge to search libnss, we cannot find the correct one. In a fact, the correct one is called <code>nss</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emerge --ask dev-libs/nss</span><br></pre></td></tr></table></figure>

<p>After installing, i can successfully launch the clash application.</p>
<h3 id="update-system-error"><a href="#update-system-error" class="headerlink" title="update system error"></a>update system error</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: emerge --<span class="built_in">sync</span></span></span><br><span class="line"></span><br><span class="line">gpg: refreshing 4 keys ...</span><br><span class="line">gpg: keyserver refresh failed...</span><br></pre></td></tr></table></figure>

<p>This problem maybe remote server problem, and a way to fix is use other sync method.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">user: doas emaint --auto <span class="built_in">sync</span></span></span><br></pre></td></tr></table></figure>

<h3 id="dbus-error"><a href="#dbus-error" class="headerlink" title="dbus error"></a>dbus error</h3><p>I use stack to install xmonad and xmobar since long time ago, cause it is a great way without system to install plenty of haskell modules preventing starting xmonad failure each time even one haskell module has been updated.</p>
<p>But this time in gentoo linux, maybe xmobar version has been updated, i can install xmobar, but failed to start it, and shows:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--- ~ » xmobar </span><br><span class="line">xmobar: SocketError &#123;socketErrorMessage = &quot;Network.Socket.connect: &lt;socket: 16&gt;: does not exist (No such file or directory)&quot;, socketErrorFatal = True, socketErrorAddress = Just (Address &quot;unix:path=/run/user/1000/bus&quot;)&#125;</span><br></pre></td></tr></table></figure>

<p>After searching, i tried this method(which turns to be a horrible mistake):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">add this two lines <span class="keyword">in</span> /etc/environment</span></span><br><span class="line">DBUS_SYSTEM_BUS_ADDRESS=unix:path=/run/dbus/system_bus_socket</span><br><span class="line">DBUS_SESSION_BUS_ADDRESS=unix:path=/run/dbus/system_bus_socket</span><br></pre></td></tr></table></figure>

<p>Yes, it really fixed the problem of xmobar, it can be launched successfully, but causes problems more than that. When i try to send a notification or create a new tab in firefox by scripts, all fail.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--- ~ » notify-send &quot;hello&quot;                                           1 ↵</span><br><span class="line">GDBus.Error:org.freedesktop.DBus.Error.ServiceUnknown: The name org.freedesktop.Notifications was not provided by any .service files</span><br><span class="line">--- ~ » firefox-bin --search --new-tab &quot;ls&quot;                           1 ↵</span><br><span class="line">[Parent 5156, Main Thread] WARNING: g_dbus_proxy_new: assertion &#x27;G_IS_DBUS_CONNECTION (connection)&#x27; failed: &#x27;glib warning&#x27;, file /builds/worker/checkouts/gecko/toolkit/xre/nsSigHandlers.cpp:167</span><br><span class="line"></span><br><span class="line">(firefox:5156): GLib-GIO-CRITICAL **: 04:00:23.853: g_dbus_proxy_new: assertion &#x27;G_IS_DBUS_CONNECTION (connection)&#x27; failed</span><br><span class="line">[Parent 5156, Main Thread] WARNING: g_dbus_proxy_new: assertion &#x27;G_IS_DBUS_CONNECTION (connection)&#x27; failed: &#x27;glib warning&#x27;, file /builds/worker/checkouts/gecko/toolkit/xre/nsSigHandlers.cpp:167</span><br><span class="line"></span><br><span class="line">(firefox:5156): GLib-GIO-CRITICAL **: 04:00:23.853: g_dbus_proxy_new: assertion &#x27;G_IS_DBUS_CONNECTION (connection)&#x27; failed</span><br></pre></td></tr></table></figure>

<p><img src="../.images/firefox-dbus-error.png" alt="firefox dbs error"></p>
<p>At first, i thought it was the problem of dbus software itself, there must be some problems of communication of process. Yeah, there really are problems of communication of process, but it caused by myself. Because i add that two dbus environment variables in <code>/etc/environment</code>.</p>
<p><strong>Solution:</strong></p>
<ol>
<li><p>solve the problem of dbus communication by removing dbus variable in <code>/etc/environment</code>.</p>
</li>
<li><p>solve the problem of xmobar by adding a softlink in <code>~/.xinitrc</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">fix xmobar cannot find /run/user/1000/bus</span></span><br><span class="line">ln -sf /run/dbus/system_bus_socket /run/user/1000/bus</span><br></pre></td></tr></table></figure></li>
</ol>
<p>It is a happy ending again, i am so happy to see that, cause i weak up in 3:00 AM(weak up by something of a mouse noise, i finally know this rent house has some mouses) and find the solution(i don’t know why i just realized where the problem is at this time, but it happened)!</p>
<h3 id="When-Upgrade-Gentoo-it-needs-to-install-golang"><a href="#When-Upgrade-Gentoo-it-needs-to-install-golang" class="headerlink" title="When Upgrade Gentoo, it needs to install golang"></a>When Upgrade Gentoo, it needs to install golang</h3><p>When i try to upgrade gentoo, i find it tries to auto install golang which is a very large size package. I cannot find the reason, why i need to install golang?</p>
<p>So, i write a post in <a class="link"   target="_blank" rel="noopener" href="https://www.reddit.com/r/Gentoo/comments/12ep98w/when_upgrade_gentoo_i_find_it_tries_to_install/" >reddit<i class="fas fa-external-link-alt"></i></a> and get lots of help and finally get the reason and fixed the problem.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">use --tree to see all dependencies as a tree.</span></span><br><span class="line">doas emerge --ask --verbose --update --deep --newuse --tree @world</span><br><span class="line"></span><br><span class="line">[nomerge       ] x11-terms/kitty-0.27.1::gentoo [0.26.5-r1::gentoo] USE=&quot;X -test -verify-sig -wayland&quot; PYTHON_SINGLE_TARGET=&quot;python3_10 -python3_9 -python3_11&quot; </span><br><span class="line">[ebuild  N     ]  dev-lang/go-1.20.2:0/1.20.2::gentoo  CPU_FLAGS_X86=&quot;sse2&quot; 25,566 KiB</span><br><span class="line">[ebuild  N     ]   dev-lang/go-bootstrap-1.18.6::gentoo  USE=&quot;(-big-endian)&quot; 139,654 KiB</span><br><span class="line">[ebuild     U  ]  x11-terms/kitty-shell-integration-0.27.1::gentoo [0.26.5::gentoo] 0 KiB</span><br></pre></td></tr></table></figure>

<p>It shows kitty depends on golang, so after uninstalled kitty, there is no need of golang again</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doas emerge --depclean x11-terms/kitty</span><br></pre></td></tr></table></figure>

<h3 id="qemu-system-x86-64-error"><a href="#qemu-system-x86-64-error" class="headerlink" title="qemu-system-x86_64 error"></a>qemu-system-x86_64 error</h3><p>While disabled <code>wayland</code> use flag globally, there is a problem to start virtual machine with <code>virsh</code> command or <code>virt-manager</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~ ❯ doas virsh start windows10</span><br><span class="line">error: Failed to start domain &#x27;windows10&#x27;</span><br><span class="line">error: internal error: Failed to start QEMU binary /usr/bin/qemu-system-x86_64 for probing: /usr/bin/qemu-system-x86_64: symbol lookup error: /usr/bin/qemu-system-x86_64: undefined symbol: gdk_wayland_display_get_type</span><br></pre></td></tr></table></figure>

<p>And i finally find the <a class="link"   target="_blank" rel="noopener" href="https://bugs.gentoo.org/677292" >resolution<i class="fas fa-external-link-alt"></i></a>.</p>
<p>It will work properly after rebuild <code>qemu</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doas emerge --ask --verbose qemu</span><br></pre></td></tr></table></figure>


<h2 id="COMPILED-FROM-SOURCE"><a href="#COMPILED-FROM-SOURCE" class="headerlink" title="COMPILED FROM SOURCE"></a>COMPILED FROM SOURCE</h2><h3 id="ddcutil"><a href="#ddcutil" class="headerlink" title="ddcutil"></a>ddcutil</h3><p>If we get a external monitor, we cannot adjust brightness with <code>xbrightness</code> command, so we need a tool called <code>ddcutil</code>, however in gentoo it is masked, so the best way is downloading the source code and compile it manually.</p>
<ul>
<li><p>Download <a class="link"   target="_blank" rel="noopener" href="https://github.com/rockowitz/ddcutil" >ddcuitl source file<i class="fas fa-external-link-alt"></i></a> from github</p>
</li>
<li><p>Follow <a class="link"   target="_blank" rel="noopener" href="https://www.ddcutil.com/building/" >this page<i class="fas fa-external-link-alt"></i></a> to compile ddcutil</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">cd</span> to unpacking directory</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">./autogen.sh</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">./configure</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">make</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas make install</span></span><br></pre></td></tr></table></figure>

<p>Then ddcutil will be installed in <code>/usr/local/bin/ddcutil</code>.</p>
</li>
<li><p>Load <code>i2c-dev</code> module</p>
<p>By default, we cannot run ddcutil command, cause <code>i2c-dev</code> device missing.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil detect                                       1 ↵</span></span><br><span class="line">No /dev/i2c devices exist.</span><br><span class="line">ddcutil requires module i2c-dev.</span><br></pre></td></tr></table></figure>

<p>Load missing module</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas modprobe i2c-dev</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">check whether loaded</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">lsmod |rg -i i2c</span></span><br><span class="line">i2c_dev                28672  0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note: we need to make sure i2c-dev already compiled in kernel.</p>
</blockquote>
</li>
<li><p>Detect display device</p>
<p>Most of the time it show device 10</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil getvcp ALL |rg -i brightness</span></span><br><span class="line">VCP code 0x10 (Brightness                    ): current value =    25, max value =   100</span><br></pre></td></tr></table></figure></li>
<li><p>Set/get brightness with ddcutil</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil setvcp 10 + 5</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas ddcutil getvcp 10</span></span><br><span class="line">VCP code 0x10 (Brightness                    ): current value =    25, max value =   100</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="picom"><a href="#picom" class="headerlink" title="picom"></a>picom</h3><p>Yeah, i love picom, but in gentoo repo i cannot find [pijulius/picom] but the original one, so i need to compile it from source.</p>
<ul>
<li><p>Download <a class="link"   target="_blank" rel="noopener" href="https://github.com/pijulius/picom" >source code<i class="fas fa-external-link-alt"></i></a></p>
</li>
<li><p>Download needed dependcies</p>
<p>One trick is that we don’t need to install all the dependcies from what github page says. We can only install the dependcies from what gentoo repo’s picom needs.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">find the needed dependcies</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">emerge --ask --pretend x11-misc/picom</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">install the need dependcies</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">doas emerge --ask uthash libev libconfig</span></span><br></pre></td></tr></table></figure></li>
<li><p>Compile source file</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash"><span class="built_in">cd</span> picom-implement-window-animations</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">git submodule update --init --recursive</span></span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">meson --buildtype=release . build</span> </span><br><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">ninja -C build</span></span><br></pre></td></tr></table></figure>

<p>Then the binary file will be installed in <code>./build/src/picom</code>.</p>
</li>
<li><p>Run picom</p>
<p>Make sure the configuration file is placed in proper location.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">user$ </span><span class="language-bash">picom --experimental-backends --config ~/.config/picom/picom.conf -b</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="xcolor"><a href="#xcolor" class="headerlink" title="xcolor"></a>xcolor</h3><p>In gentoo, i cannot find xcolor package, the great tool, so i have to install it from source.</p>
<ol>
<li><p>Download the <a class="link"   target="_blank" rel="noopener" href="https://github.com/Soft/xcolor" >source code<i class="fas fa-external-link-alt"></i></a>.</p>
</li>
<li><p>Extra package and compile.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xf Soft-xcolor-0.5.1-2-g969d652.tar.gz -C ~/.local/apps </span><br><span class="line">cd ~/.local/apps </span><br><span class="line">cargo install xcolor</span><br></pre></td></tr></table></figure></li>
<li><p>It’s binary file located in <code>~/.local/share/cargo/bin</code>, the better way add this path to environment variable.</p>
</li>
</ol>
<h2 id="links"><a href="#links" class="headerlink" title="links"></a>links</h2>
        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/gentoo/">#gentoo</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2023/02/06/weechat/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">weechat</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/11/30/use-entr-to-sync-task/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">use-entr-to-sync-task</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">shutterbug</a>
        </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MY-GENTOO-HANDBOOK"><span class="nav-number">1.</span> <span class="nav-text">MY GENTOO HANDBOOK</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#KERNEL"><span class="nav-number">1.1.</span> <span class="nav-text">KERNEL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-sound-card"><span class="nav-number">1.1.1.</span> <span class="nav-text">configure sound card</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-frame-buffer"><span class="nav-number">1.1.2.</span> <span class="nav-text">configure frame buffer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compile-fuse-as-module"><span class="nav-number">1.1.3.</span> <span class="nav-text">compile fuse as module</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-default-gpu-driver"><span class="nav-number">1.1.4.</span> <span class="nav-text">configure default gpu driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#configure-console-front"><span class="nav-number">1.1.5.</span> <span class="nav-text">configure console front</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#USAGE"><span class="nav-number">1.2.</span> <span class="nav-text">USAGE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Turn-Compile-Dir-To-Tmpfs"><span class="nav-number">1.2.1.</span> <span class="nav-text">Turn Compile Dir To Tmpfs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Change-Keyboard-Map"><span class="nav-number">1.2.2.</span> <span class="nav-text">Change Keyboard Map</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#correctly-configure-gpu-driver"><span class="nav-number">1.2.3.</span> <span class="nav-text">correctly configure gpu driver</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#add-guru-repository"><span class="nav-number">1.2.4.</span> <span class="nav-text">add guru repository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compile-kernel-with-correct-file"><span class="nav-number">1.2.5.</span> <span class="nav-text">compile kernel with correct file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#remove-sys-kernel-gentoo-kernel-bin"><span class="nav-number">1.2.6.</span> <span class="nav-text">remove sys-kernel&#x2F;gentoo-kernel-bin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unmask-a-package-or-get-the-latest-version"><span class="nav-number">1.2.7.</span> <span class="nav-text">unmask a package or get the latest version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#update-configuration-file"><span class="nav-number">1.2.8.</span> <span class="nav-text">update configuration file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#choose-other-repository"><span class="nav-number">1.2.9.</span> <span class="nav-text">choose other repository</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-gentoolto"><span class="nav-number">1.2.10.</span> <span class="nav-text">use gentoolto</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#remove-unused-agetty"><span class="nav-number">1.2.11.</span> <span class="nav-text">remove unused agetty</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-eix"><span class="nav-number">1.2.12.</span> <span class="nav-text">use eix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setting-cursor-theme"><span class="nav-number">1.2.13.</span> <span class="nav-text">setting cursor theme</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prevent-package-auto-update-or-build-a-local-repo"><span class="nav-number">1.2.14.</span> <span class="nav-text">prevent package auto update or build a local repo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Automatic-Login-System"><span class="nav-number">1.2.15.</span> <span class="nav-text">Automatic Login System</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Add-Binary-Package-Host"><span class="nav-number">1.2.16.</span> <span class="nav-text">Add Binary Package Host</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISSUE"><span class="nav-number">1.3.</span> <span class="nav-text">ISSUE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Startx-cannot-open-dev-tty0"><span class="nav-number">1.3.1.</span> <span class="nav-text">Startx cannot open &#x2F;dev&#x2F;tty0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#etc-profile-doesn%E2%80%99t-take-effect"><span class="nav-number">1.3.2.</span> <span class="nav-text">&#x2F;etc&#x2F;profile doesn’t take effect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#no-sound-by-default"><span class="nav-number">1.3.3.</span> <span class="nav-text">no sound by default</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cannot-find-libnss-so"><span class="nav-number">1.3.4.</span> <span class="nav-text">cannot find libnss.so</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#update-system-error"><span class="nav-number">1.3.5.</span> <span class="nav-text">update system error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dbus-error"><span class="nav-number">1.3.6.</span> <span class="nav-text">dbus error</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#When-Upgrade-Gentoo-it-needs-to-install-golang"><span class="nav-number">1.3.7.</span> <span class="nav-text">When Upgrade Gentoo, it needs to install golang</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qemu-system-x86-64-error"><span class="nav-number">1.3.8.</span> <span class="nav-text">qemu-system-x86_64 error</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COMPILED-FROM-SOURCE"><span class="nav-number">1.4.</span> <span class="nav-text">COMPILED FROM SOURCE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ddcutil"><span class="nav-number">1.4.1.</span> <span class="nav-text">ddcutil</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#picom"><span class="nav-number">1.4.2.</span> <span class="nav-text">picom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xcolor"><span class="nav-number">1.4.3.</span> <span class="nav-text">xcolor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#links"><span class="nav-number">1.5.</span> <span class="nav-text">links</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>






<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
