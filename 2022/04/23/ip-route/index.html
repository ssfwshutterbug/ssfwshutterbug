<!DOCTYPE html>
<html>
	<head>
		
<title>ip_route-Quiet</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/image/favicon.ico">

<link rel="stylesheet" href="/css/index.css">



<meta name="keywords" content="route,">
<meta name="description" content="">


<script src="/js/jquery.min.js"></script>


<script src="/js/index.js"></script>


<script src="/js/fancybox.umd.js"></script>


<script src="/js/fancybox-images.js"></script>


<script src="/js/gitalk.min.js"></script>


<script src="/js/hljs.min.js"></script>
 
<script>hljs.highlightAll();</script>

	<meta name="generator" content="Hexo 5.4.2"></head>

	<body>
		
	<div class="header">
		<div class="header-top" id="header-top">
			<div class="h-left">
				<a href="/">
					<img src="/image/logo.png" alt="Quiet">
				</a>
			</div>
			<div class="h-right">
				<ul>
					
						
								<li>
									<a href="/">
										HOME
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/archives">
										ARCHIVE
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/categories">
										CATEGORIES
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/tags">
										TAGS
									</a>
									<span class="dot"></span>
								</li>
								
									
				</ul>
			</div>
			<div class="h-right-close">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
					<path fill="none" d="M0 0h24v24H0z" />
					<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
				</svg>
			</div>
		</div>
	</div>
	<div class="sidebar">
    <div class="topo">
        <h2>Joey</h2>
    </div>
    <ul>
        
        <li>
            <a href="/">HOME</a>
        </li>
        
        <li>
            <a href="/archives">ARCHIVE</a>
        </li>
        
        <li>
            <a href="/categories">CATEGORIES</a>
        </li>
        
        <li>
            <a href="/tags">TAGS</a>
        </li>
        
    </ul>
    <div class="my_foot">
        
        <a target="_blank" rel="noopener" href="https://github.com/79E/hexo-theme-quiet">
            <img src="https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg/imggithub.png" alt="Quiet主题">
        </a>
        
    </div>
</div>
<div class='shelter'>
</div>
<style>
    .shelter{
        background-color: #333;
        opacity:0.5;
        cursor: pointer;
        display: none; 
        position: fixed;
        left: 0;
        top: 0; 
        right: 0;
        bottom: 0;
        z-index: 1998;
    }
    .sidebar {
        width: 66%;
        height: 100%;
        position: fixed;
        top: 0;
        right: -100%;
        bottom: 0;
        background: #fff;
        z-index: 1999;
        text-align: center;
        box-shadow: -6px 0 20px rgba(98, 94, 94, .815);
    }

    .topo {
        width: 100%;
        height: 200px;
        background: url(https://api.ixiaowai.cn/gqapi/gqapi.php) no-repeat;
        background-size: 100% 100%;
        position: relative;
        display: flex;
        align-items: flex-end
    }

    .topo h2 {
        color: #fff;
        z-index: 1;
        position: relative;
        margin: 0 0 10px 10px;
        font-size: 1.2em;
        box-sizing: border-box
    }

    .topo:before {
        content: '';
        background-image: url(/image/pattern.png);
        background-repeat: repeat;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 1
    }

    .sidebar ul {
        width: 100%;
        margin-top: 50px
    }

    .sidebar ul li {
        height: 50px;
        list-style: none;
        font-size: 1.2em;
        text-align: right;
        margin-right: 10px
    }

    .sidebar ul li a {
        display: grid;
        color: #5d606a;
        text-overflow: ellipsis;
        width: 100%;
        text-decoration: none
    }

    .my_foot {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        position: absolute;
        bottom: 0
    }

    .my_foot a {
        text-decoration: none;
        margin-right: 10px;
        display: inline-block
    }

    .my_foot a img {
        width: 30px;
        height: 30px
    }
</style>

<script>
    $( function () {
	$( '.h-right-close>svg' )
		.click( function () {
			$( '.sidebar' )
				.animate( {
					right: "0"
				}, 500 );
			$( '.shelter' )
				.fadeIn( "slow" )
		} );
	$( '.shelter' )
		.click( function ( e ) {
			$( '.sidebar' )
				.animate( {
					right: "-100%"
				}, 500 );
			$( '.shelter' )
				.fadeOut( "slow" )
		} )
} )

</script>

<div class="post">
    <div class="post-header-background post-header-img"
    style="background: url('https://api.ixiaowai.cn/gqapi/gqapi.php')" 
>
    <div class="post-header-background-content">
        <ul class="post-header-tag">
            
            
            <li><a href="/tags/route">route</a></li>
            
            
        </ul>
        
        <h1>ip_route</h1>
        <div class="post-header-info">
            <div class="post-header-info-author">
                
                    <svg t="1604839279282" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="2901" width="20" height="20">
                        <path
                            d="M513 956.3c-247.7 0-448-200.3-448-448S265.3 66.2 513 66.2s448 200.3 448 448-200.3 442.1-448 442.1z m0-830.9c-212.2 0-388.8 170.7-388.8 388.8C124.2 726.3 294.9 903 513 903c212.2 0 388.8-170.7 388.8-388.8S725.2 125.4 513 125.4z m0 430.2c-94.2 0-170.7-76.5-170.7-170.7S418.8 207.8 513 207.8s170.7 76.5 170.7 170.7S607.2 555.6 513 555.6z m0-289.1c-64.6 0-112 52.8-112 112s47.4 117.9 112 117.9 112-52.8 112-112-47.4-117.9-112-117.9z m0 689.8c-135.7 0-259-58.7-341.9-158.9l-11.8-17.8 11.8-17.8c76.5-117.9 206.2-188.5 347.8-188.5 135.7 0 265 64.6 341.9 182.6l11.8 17.8-11.8 17.8C778 897.1 648.7 956.3 513 956.3zM230.3 773.2C300.9 849.7 406.9 897 513 897c112 0 218.1-47.4 288.6-129.8-70.5-88.2-170.7-135.6-282.7-135.6s-218.1 53.3-288.6 141.6z"
                            p-id="2902" fill="#ffffff"></path>
                    </svg>
                    
                <span class="post-header-info-author-text"> <a href="../../about">Joey</a></span>
                <div class="post-header-info-author-categories">
                    
                         <a href="../../categories/learn/" target="_blank" >learn</a>
                    
                </div>
                <p>2022-04-23 23:04:20</p>
            </div>
        </div>
    </div>
</div>
    <div class="post-content" id="content">
  
  <div id="article" class="post-content-info">
    

    <h1 id="IP-addr-and-route"><a href="#IP-addr-and-route" class="headerlink" title="IP addr and route"></a>IP addr and route</h1><h2 id="ip-address-setting"><a href="#ip-address-setting" class="headerlink" title="ip address setting"></a>ip address setting</h2><p>Most of time we login a new system, there has no ip address and we cannot connect to the web and also cannot download packages with package manager. At this time, we have so many methods to configure a system with ip address.</p>
<p><em>if we have dhcpcd client or have network/NetworkManager installed</em></p>
<ol>
<li><p>the easily way is using <code>dhcpcd</code> or <code>dhcpcd network_interface</code> command to get a dynamic ip address. for instance:</p>
<pre><code class="shell">dhcpcd 
# or
dhcpcd wlan0
</code></pre>
</li>
<li><p>if the system use <code>network</code> or <code>NetworkManager</code> to manage network, we can configure static or dynamic ip address. for instance:</p>
<pre><code class="shell">cat /etc/sysconfig/network-scripts/ifcfg-enp0s3

TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static        # static mathod
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
NAME=enp0s3
UUID=9362a50a-b4fc-4943-ab54-a865b328ef0f
DEVICE=enp0s3
ONBOOT=yes                # auto start

IPADDR=10.10.10.10        # ip
PREFIX=24                # netmask
GATEWAY=10.10.10.1        # gateway
</code></pre>
<p>or simple dynamic ip</p>
<pre><code class="shell">cat /etc/sysconfig/network-scripts/ifcfg-enp0s3

TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp            # dhcp mathod
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
NAME=enp0s3
UUID=9362a50a-b4fc-4943-ab54-a865b328ef0f
DEVICE=enp0s3
ONBOOT=yes                # auto start
</code></pre>
<blockquote>
<p>Note: if we have a requirement of visiting website, we need set local DNS in <code>/etc/resolv.conf </code></p>
<p>​          eg: <code>echo nameserver 192.168.31.1 &gt; /etc/resolv.conf</code></p>
</blockquote>
</li>
</ol>
<p><em>if there has no dhcpcd and network/NetworkManager</em></p>
<ol>
<li><p>add a ip address and route by hand</p>
<pre><code class="shell">ip address add 192.168.31.33 dev enp0s3
</code></pre>
<p>then add route</p>
<pre><code class="shell">ip route add 192.168.31.0/24 dev enp0s3
</code></pre>
<p>add nameserver</p>
<pre><code class="shell">echo nameserver 192.168.31.1 &gt; /etc/resolv.conf
</code></pre>
<blockquote>
<p>Note: the configuration above we write is temporary, when we reboot the computer or restart network service the configuration will lost. </p>
<ol>
<li>If we use network/NetworkManager, the way to store route configuration is writing command to <code>/etc/sysconfig/network-scripts/route-*</code>, store ip configuration is writing command to <code>/etc/sysconfig/network-scripts/ifcfg-eth*</code>.</li>
<li>if we don’t use network service, the easiest way is writing commands to a start script such as <code>.xinitrc</code> or  setting a service with scripts to execute those commands.</li>
</ol>
</blockquote>
<p><strong>For Example</strong>:</p>
<pre><code class="shell"># add ip address
ip address add 192.168.31.31 dev enp0s3
ip address add 10.10.10.10 dev enp0s3
# add route
ip route add 10.10.10.0/24 dev enp0s3
ip route add 192.168.31.0/24 dev enp0s3
ip route add default via 192.168.31.1 dev enp0s3

# store route configure
cat /etc/sysconfig/network-scripts/route-enp0s3
10.10.10.0/24 dev enp0s3
192.168.31.0/24 dev enp0s3
default via 192.168.31.1 dev enp0s3

# store ip address
cat /etc/sysconfig/network-scripts/ifcfg-enp0s3
IPADDR1=192.168.31.31
PREFIX1=24
GATEWAY1=192.168.31.1

IPADDR2=10.10.10.10
PREFIX2=24
GATEWAY2=10.10.10.1
</code></pre>
</li>
</ol>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><p>if there has more than one network device and we need to configure it by hand where can we  find network interface and mac address?</p>
<p> if <code>ip link show</code> cannot find, we can find it in <code>/sys/class/net</code>.</p>
<p>where to find network interface mac address?</p>
<p>we can find it in <code>/sys/class/net/network_interface/address</code>.</p>
<h2 id="ip-address-alias"><a href="#ip-address-alias" class="headerlink" title="ip address alias"></a>ip address alias</h2><p>we can add more then one ip address to a network interface using</p>
<pre><code class="shell">ip address add 10.10.10.1 dev enp0s3
</code></pre>
<p>it may look like this</p>
<pre><code class="shell">
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:a9:ce:40 brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.10/24 brd 10.10.10.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet 192.168.31.33/32 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea9:ce40/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre>
<p>or we can use ip alias by using</p>
<pre><code class="shell">ip address add 12.12.12.12/24 dev enp0s3 label enp0s3:1
</code></pre>
<p>it may look like this</p>
<pre><code class="shell">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:a9:ce:40 brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.10/24 brd 10.10.10.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet 192.168.31.33/32 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet 12.12.12.12/24 scope global enp0s3:1    # alias
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea9:ce40/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre>
<p>the way to save ip alias configure is</p>
<pre><code class="shell">cd /etc/sysconfig/network-scripts/
cp ifcfg-enp0s3 ifcfg-enp0s3:1

cat ifcfg-enp0s3:1

IPADDR=12.12.12.12
PREFIX=24
GATEWAY=12.12.12.1
</code></pre>
<h2 id="nat-路由转发"><a href="#nat-路由转发" class="headerlink" title="nat 路由转发"></a>nat 路由转发</h2><p>可以连接外网的网段是192.168.31.0/24，自己组建局域网的网段是10.10.10.0/24，要用一个linux主机做路由转发，让10.10.10.0/24网段的主机可以连接外网。</p>
<h3 id="设备"><a href="#设备" class="headerlink" title="设备"></a>设备</h3><ul>
<li>一台做路由的linux主机，有两张网卡，分别为192网段和10网段ip</li>
<li>其它10.10.10.0/24网段的主机</li>
</ul>
<h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>用virtualbox启动两个centos7的系统：centos-nat分配两张网卡，centos7.1分配一张网卡。</p>
<p>centos-nat需要关闭默认的防火墙firewalld，然后才能使用iptables</p>
<p><em>centos-nat</em></p>
<pre><code class="shell"># centos-nat步骤


## 设置ip
ip address add 192.168.31.33/24 dev enp0s3
ip address add 10.10.10.10/24 dev enp0s8

## 设置路由
ip route add 192.168.31.0/24 dev enp0s3
ip route add 10.10.10.0/24 dev enp0s8
ip route add default via 192.168.31.33 dev enp0s3

## 关闭防火墙
systemctl stop firewalld

## 开启路由
echo 1 &gt; /proc/sys/net/ipv4/ip_forward

## 设置iptables nat转发策略
iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE
</code></pre>
<p><em>centos7.1</em></p>
<pre><code class="shell"># centos7.1步骤

## 设置ip
ip address add 10.10.10.11/24 dev enp0s3

## 设置默认路由
ip address add default via 10.10.10.10 dev enp0s3

## 设置DNS解析
echo nameserver 192.168.31.1 &gt; /etc/resolv.conf
</code></pre>
<p>然后centos7.1（10.10.10.0/24的主机）就可以连接外网了,done.</p>

  </div>
  <div id="gitalk-container"></div>
</div>

<script>
  
Fancybox.bind('[data-fancybox="fancybox-gallery-img"]', {
  dragToClose: true,
  Toolbar: true,
  closeButton: "top",
  Image: {
    zoom: true,
  },
  on: {
    initCarousel: (fancybox) => {
      const slide = fancybox.Carousel.slides[fancybox.Carousel.page];
      fancybox.$container.style.setProperty(
        "--bg-image",
        `url("${slide.$thumb.src}")`
      );
    },
    "Carousel.change": (fancybox, carousel, to, from) => {
      const slide = carousel.slides[to];
      fancybox.$container.style.setProperty(
        "--bg-image",
        `url("${slide.$thumb.src}")`
      );
    },
  },
});
</script>

<style>
    #noneimg img {
        display: none;
        z-index: 9999;
        /* width: 600px !important; */
        min-width: 0%;
        max-width: 90%;
        max-height: 80%;
        border-radius: 0px;
        position: fixed;
        box-shadow: 0 0 0px #c3c3c300 !important;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: auto !important;
    }

    @media screen and (max-width:600px) {
        #noneimg img {
            max-width: 88%
        }
    }
</style>

    <div class="post-paging">
    
    <a href="/2022/04/23/iptables/">
        <div class="post-paging-last">
            <span>上一篇</span>
            <p>iptables</p>
        </div>
    </a>
    

    
    <a href="/2022/04/23/haskell/">
        <div class="post-paging-next">
            <span>下一篇</span>
            <p>haskell</p>
        </div>
    </a>
    
</div>
</div>
		
<div class="footer">
	<div class="Copyright">
		©2022 By Joey. 主题：<a
			style="text-decoration: none;display: contents; color: #898F9F;"
			target="_blank" rel="noopener" href="https://github.com/79e/hexo-theme-quiet">Quiet</a>
	</div>
	<div class="contact">
		
		<a target="_blank" rel="noopener" href="https://github.com/79E/hexo-theme-quiet">
			<img src="https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg/imggithub.png" alt="Quiet主题">
		</a>
		
	</div>
</div>

<script src="/js/gotop.js"></script>


<style type="text/css">
    @media screen and (min-width: 600px) {
        .goTop>span {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            opacity: 0.8;
            background: rgba(18, 24, 58, 0.06);
            text-align: center;
            transition: border .5s;
            border: 1px solid rgba(18, 24, 58, 0.06);

            -moz-transition: border .5s;
            /* Firefox 4 */
            -webkit-transition: border .5s;
            /* Safari 和 Chrome */
            -o-transition: border .5s;
            /* Opera */
        }

        .goTop>span:hover {
            border: 1px solid #6680B3;
        }


        .goTop {
            position: fixed;
            right: 30px;
            bottom: 80px;
        }

        .goTop>span>svg {
            width: 20px;
            height: 20px;
            opacity: 0.7;
        }

    }

    @media screen and (max-width: 600px) {
        .goTop {
            display: none;
        }
    }
</style>
<div class="goTop" id="js-go_top">
    <span>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g>
                <path d="M13 12v8h-2v-8H4l8-8 8 8z"></path>
            </g>
        </svg>
    </span>
</div>
<script>
    $( '#js-go_top' )
	.gotoTop( {
		offset: 500,
		speed: 300,
		animationShow: {
			'transform': 'translate(0,0)',
			'transition': 'transform .5s ease-in-out'
		},
		animationHide: {
			'transform': 'translate(100px,0)',
			'transition': 'transform .5s ease-in-out'
		}
	} );
</script>


    <!-- Gitalk -->
    <script>
        const data = '{"clientID":"02b3c","clientSecret":"adfc7b4","repo":"gimment","owner":"duneng","admin":"duneng"}'
        const gitalk = new Gitalk({
            ...JSON.parse( data),
            id:location.pathname,
            distractionFreeMode:false
        })
        
        if(Boolean('true')){
            gitalk.render('gitalk-container')
        }
    </script>

<script>
	console.log('\n %c Hexo-Quiet 主题 %c https://github.com/79e/hexo-theme-quiet \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
</script>
	</body>
</html>

