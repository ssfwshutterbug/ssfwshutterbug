<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>openssh | shutterbug sweet diary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="opensshinstallin archlinux, openssh is a ssh toolkit, includes client ssh and server sshd.  pacman -S openssh  clientusage examples. remote connectconnect to remote pc with default port 22. ssh user@i">
<meta property="og:type" content="article">
<meta property="og:title" content="openssh">
<meta property="og:url" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/index.html">
<meta property="og:site_name" content="shutterbug sweet diary">
<meta property="og:description" content="opensshinstallin archlinux, openssh is a ssh toolkit, includes client ssh and server sshd.  pacman -S openssh  clientusage examples. remote connectconnect to remote pc with default port 22. ssh user@i">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/.images/image-20210303233558102-1627524858296.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/.images/image-20210303234044887-1627524858297.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/.images/image-20210303234221412-1627524858297.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/.images/image-20210726105921414.png">
<meta property="og:image" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/.images/image-20210726110546994.png">
<meta property="article:published_time" content="2022-04-23T15:07:42.000Z">
<meta property="article:modified_time" content="2022-04-23T15:08:09.723Z">
<meta property="article:author" content="shutterbug">
<meta property="article:tag" content="ssh">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/.images/image-20210303233558102-1627524858296.png">
  
    <link rel="alternate" href="/atom.xml" title="shutterbug sweet diary" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">shutterbug sweet diary</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-openssh" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/openssh/" class="article-date">
  <time datetime="2022-04-23T15:07:42.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      openssh
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="openssh"><a href="#openssh" class="headerlink" title="openssh"></a>openssh</h1><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>in archlinux, openssh is a ssh toolkit, includes client <code>ssh</code> and server <code>sshd</code>. </p>
<pre><code class="shell">pacman -S openssh
</code></pre>
<h2 id="client"><a href="#client" class="headerlink" title="client"></a>client</h2><p>usage examples.</p>
<h3 id="remote-connect"><a href="#remote-connect" class="headerlink" title="remote connect"></a>remote connect</h3><p>connect to remote pc with default port 22.</p>
<pre><code class="shell">ssh user@ip
</code></pre>
<p>connect to remote pc with specified port.</p>
<pre><code class="shell">ssh -p port user@ip
</code></pre>
<h3 id="file-copy"><a href="#file-copy" class="headerlink" title="file copy"></a>file copy</h3><p>we can download file from server and upload file to server in client.</p>
<blockquote>
<p>Note:</p>
<p>whatever we download or upload, we only need a ssh client tool called <code>scp</code>  in local machine, needless server in local. and server runs in remote machine</p>
</blockquote>
<p>download file from server</p>
<pre><code class="shell">scp server_user@server_ip:/file/directory /local/file/directory
</code></pre>
<p>upload file to server</p>
<pre><code class="shell">scp /local/file/directory server_user@server_ip:/file/directory
</code></pre>
<h3 id="root-login"><a href="#root-login" class="headerlink" title="root login"></a>root login</h3><p>add following to allow root user login</p>
<pre><code class="shell">PermitRootLogin yes
</code></pre>
<h3 id="change-default-port"><a href="#change-default-port" class="headerlink" title="change default port"></a>change default port</h3><p>change default port 22 to other ports</p>
<pre><code class="shell">nvim /etc/ssh/sshd_config

Port 40000
</code></pre>
<p>now, connect to the machine need specify port</p>
<pre><code class="shell">ssh -p 40000 user@ip
</code></pre>
<h3 id="login-without-password"><a href="#login-without-password" class="headerlink" title="login without password"></a>login without password</h3><ul>
<li><p><em>machine A: who want to connect to B</em></p>
</li>
<li><p><em>machine B: with ssh service running</em></p>
</li>
</ul>
<p>if we use ssh command often, we can configure it without password to login(A=&gt;B). there are two things we need to do:</p>
<ol>
<li><p>in machine A: need to product a public key</p>
<pre><code class="shell">ssh-keygen
# or Specifies the type of key to create.  The possible values are “dsa”, “ecdsa”, “ecdsa-sk”, “ed25519”, “ed25519-sk”, or “rsa”.
ssh-keygen -t rsa

# this step will create a public key (id_rsa.pub) in ~/.ssh
ls ~/.ssh
  id_rsa       id_rsa.pub       known_hosts
</code></pre>
</li>
<li><p>in machine A: copy public key <code>id_rsa.pub</code>  to B’s <code>~/.ssh/authorized_keys</code></p>
<pre><code class="shell"># in machine A we can use a command to do it, this will copy content to B automaticly
ssh-copy-id user_B@ip_B

# or we can login machine B, and copy content of id_rsa.pub to ~/.ssh/authorized_keys
scp .ssh/id_rsa.pub user_B@ip_B:/tmp
ssh user_B@ip_B
mkdir ~/.ssh
touch ~/.ssh/authorized_keys
cat /tmp/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</code></pre>
</li>
</ol>
<p>after the two steps, A can connect to B without password.</p>
<h2 id="issues"><a href="#issues" class="headerlink" title="issues"></a>issues</h2><h3 id="connect-to-an-old-version-ssh-server"><a href="#connect-to-an-old-version-ssh-server" class="headerlink" title="connect to an old version ssh server"></a>connect to an old version ssh server</h3><p><code>Unable to negotiate with x.x.x.x port 22: no matching host key type found. Their offer: ssh-rsa fatal: Could not read from remote repository.</code></p>
<p>this problem comes when the remote ssh encryption method is too old/weak such as isa1. since isa1 method  will be regarded unsafe.</p>
<p>in order to resolve this problem, there comes two methods:</p>
<ol>
<li><p>upgrade remote ssh version and then use the new encryption method such as isa2</p>
</li>
<li><p>write a config in <code>~/.ssh/config</code>, allow the connection specified</p>
</li>
</ol>
<pre><code class="shell">Host 192.168.1.80
    User root
    PubkeyAcceptedAlgorithms +ssh-rsa
    HostkeyAlgorithms +ssh-rsa
</code></pre>
<h2 id="ssh-tunnel"><a href="#ssh-tunnel" class="headerlink" title="ssh tunnel"></a>ssh tunnel</h2><p>there are two parts.</p>
<ul>
<li>local port forwarding</li>
<li>remote port forwarding</li>
</ul>
<img src=".images/image-20210303233558102-1627524858296.png" alt="ssh tunnel" style="zoom: 50%;" />

<h4 id="local-port-forwarding"><a href="#local-port-forwarding" class="headerlink" title="local port forwarding"></a>local port forwarding</h4><img src=".images/image-20210303234044887-1627524858297.png" alt="image-20210303234044887" style="zoom:50%;" />

<p>access local ip with port 8888 with redirect to remote server 192.168.1.3 with port 8080 though ssh server 44.11.22.33</p>
<pre><code class="shell">ssh -L local_port:remote_ip:remote_port ssh_user@ssh_ip
</code></pre>
<p>eg:</p>
<pre><code class="shell">ssh -L 10000:192.168.31.84:8080 root@192.168.31.116
</code></pre>
<p>above means i can visit <code>http://localhost:10000</code> in my pc to visit remote <code>http://192.168.31.84:8080</code> though ssh server <code>192.168.31.116</code>. it builds a ssh tunnel between local and ssh server.</p>
<h4 id="remote-port-forwarding"><a href="#remote-port-forwarding" class="headerlink" title="remote port forwarding"></a>remote port forwarding</h4><p><img src=".images/image-20210303234221412-1627524858297.png" alt="image-20210303234221412"></p>
<p>if any outside machine wanna to access local network service, we can create a ssh tunnel between local network machine with a outside ssh server, then any request to ssh server will redirect to local network service.</p>
<p>any request to ssh server 44.11.22.33 with port 8888 will redirect to 10.0.0.3 with port 8080.</p>
<pre><code class="shell">ssh -R remote_port:local_ip:local_port user@remote_ssh_ip
</code></pre>
<p><strong>much more important for remote port forwarding</strong></p>
<pre><code class="shell"># 192.168.31.214 has a website
# my machine and 192.168.31.214 are the same network, my machine and 192.168.31.221 are the other same network
# execute this command in my machine will create a ssh tunnel between my machine and 221
# then we can visit the website though https://192.168.31.221:4444

ssh -R 4444:192.168.31.214:443 healer@192.168.31.221 -N -f
# -N : don&#39;t allow to execute command in remote machine
# -f : run in background
</code></pre>
<blockquote>
<p>Note:</p>
<p>when the ssh tunnel created successfully, we can only access  website in 214 with localhost(described in <a target="_blank" rel="noopener" href="https://serverfault.com/questions/478171/reverse-ssh-tunnel-connexion-refused">this article</a>), becase ssh disabled gatewayport by default and it only listen on <code>127.0.0.1:port</code> <code>[::1]:port</code>. such as:</p>
</blockquote>
<p><img src=".images/image-20210726105921414.png" alt="image-20210726105921414"></p>
<p><strong>in order to access remote machine with ip address, we need enable gatewayport</strong></p>
<pre><code class="shell">vim /etc/ssh/sshd_config

GatewayPorts yes
</code></pre>
<p>then recreate ssh tunnel in my machine and  restart sshd of 214</p>
<p><img src=".images/image-20210726110546994.png" alt="image-20210726110546994"></p>
<p>then all will be okay</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/openssh/" data-id="cl9ktb7va001ndta8fhhxg4qr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/04/23/pandas/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          pandas
        
      </div>
    </a>
  
  
    <a href="/2022/04/23/noResponseGrub/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">noResponseGrub</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/learn/">learn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/think/">think</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">thinking</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E5%8E%86%E5%8F%B2/">读历史</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/anaconda/" rel="tag">anaconda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anbox/" rel="tag">anbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/archlinux/" rel="tag">archlinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boring/" rel="tag">boring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cursor-theme/" rel="tag">cursor theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ed/" rel="tag">ed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/" rel="tag">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/haskell/" rel="tag">haskell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inject-js-css/" rel="tag">inject js/css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mind/" rel="tag">mind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimized/" rel="tag">optimized</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pentablet/" rel="tag">pentablet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/positive/" rel="tag">positive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reality-is-aweful/" rel="tag">reality is aweful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/route/" rel="tag">route</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shield/" rel="tag">shield</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vbox/" rel="tag">vbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xmonad/" rel="tag">xmonad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zabbix/" rel="tag">zabbix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zk/" rel="tag">zk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/" rel="tag">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%9D%E7%BB%AA/" rel="tag">思绪</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A5%9E%E8%AF%9D/" rel="tag">神话</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%89%AF%E7%9F%A5/" rel="tag">良知</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/anaconda/" style="font-size: 10px;">anaconda</a> <a href="/tags/anbox/" style="font-size: 10px;">anbox</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/archlinux/" style="font-size: 10px;">archlinux</a> <a href="/tags/boring/" style="font-size: 10px;">boring</a> <a href="/tags/container/" style="font-size: 10px;">container</a> <a href="/tags/cursor-theme/" style="font-size: 10px;">cursor theme</a> <a href="/tags/ed/" style="font-size: 10px;">ed</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/haskell/" style="font-size: 10px;">haskell</a> <a href="/tags/inject-js-css/" style="font-size: 10px;">inject js/css</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/k8s/" style="font-size: 20px;">k8s</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mind/" style="font-size: 10px;">mind</a> <a href="/tags/optimized/" style="font-size: 10px;">optimized</a> <a href="/tags/pentablet/" style="font-size: 10px;">pentablet</a> <a href="/tags/positive/" style="font-size: 10px;">positive</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/reality-is-aweful/" style="font-size: 10px;">reality is aweful</a> <a href="/tags/route/" style="font-size: 10px;">route</a> <a href="/tags/rust/" style="font-size: 10px;">rust</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/shield/" style="font-size: 10px;">shield</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/vbox/" style="font-size: 10px;">vbox</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/xmonad/" style="font-size: 20px;">xmonad</a> <a href="/tags/zabbix/" style="font-size: 10px;">zabbix</a> <a href="/tags/zk/" style="font-size: 10px;">zk</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a> <a href="/tags/%E6%80%9D%E7%BB%AA/" style="font-size: 15px;">思绪</a> <a href="/tags/%E7%A5%9E%E8%AF%9D/" style="font-size: 10px;">神话</a> <a href="/tags/%E8%89%AF%E7%9F%A5/" style="font-size: 10px;">良知</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/23/our-body-may-cheat-ourselves-md/">our-body-may-cheat-ourselves.md</a>
          </li>
        
          <li>
            <a href="/2022/07/04/the-reality/">the-reality</a>
          </li>
        
          <li>
            <a href="/2022/06/25/%E4%BB%8E%E5%AE%B9/">从容</a>
          </li>
        
          <li>
            <a href="/2022/06/25/magic-of-xmonad/">magic-of-xmonad</a>
          </li>
        
          <li>
            <a href="/2022/06/24/xp-pentablet/">xp-pentablet</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 shutterbug<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>