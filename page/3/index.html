<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>shutterbug sweet diary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="shutterbug sweet diary">
<meta property="og:url" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/page/3/index.html">
<meta property="og:site_name" content="shutterbug sweet diary">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="shutterbug">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="shutterbug sweet diary" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">shutterbug sweet diary</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-zookeeper" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/zookeeper/" class="article-date">
  <time datetime="2022-04-23T15:15:22.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/zookeeper/">zookeeper</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>zk单机以及集群搭建（基于docker）</p>
</blockquote>
<h1 id="单机"><a href="#单机" class="headerlink" title="单机"></a>单机</h1><h2 id="创建并进入docker"><a href="#创建并进入docker" class="headerlink" title="创建并进入docker"></a>创建并进入docker</h2><p>创建docker，并将有安装包的主机挂载到docker中</p>
<pre><code>systemctl start docker
</code></pre>
<pre><code class="shell">docker run -d -it --name zk -v /home/qiyue/Downloads:/home centos
docker exec -it zk /bin/bash
</code></pre>
<h2 id="配置并启动zk"><a href="#配置并启动zk" class="headerlink" title="配置并启动zk"></a>配置并启动zk</h2><p>在容器中将安装包复制到<code>/opt</code>目录下</p>
<pre><code class="shell">cp /home/jdk-15.0.1 /opt -r
cp /home/apache-zookeeper-3.6.2-bin /opt -r
</code></pre>
<p>在<code>/etc/profile</code>中添加环境变量</p>
<pre><code class="shell">export JAVA_HOME=/opt/jdk-15.0.1
export ZK_HOME=/opt/apache-zookeeper-3.6.2-bin
export CLASSPATH=.:$JAVA_HOME/lib
export PATH=$PATH:$JAVA_HOME/bin:$ZK_HOME/bin
</code></pre>
<p>使环境变量生效</p>
<pre><code class="shell">source /etc/profile
</code></pre>
<p>创建data和logs文件夹</p>
<pre><code class="shell">cd /opt/apache-zookeeper-3.6.2-bin
touch data logs
</code></pre>
<p>修改配置文件<code>conf/zoo.cfg</code></p>
<pre><code class="shell"># 新建zoo.cfg
cd conf
cp zoo_sample.cfg zoo.cfg
</code></pre>
<pre><code class="shell"># 添加
dataDir=/opt/apache-zookeeper-3.6.2-bin/data
dataLog=/opt/apache-zookeeper-3.6.2-bin/logs

server.1=172.17.0.2:2888:3888
server.2=172.17.0.3:2888:3888
server.3=172.17.0.4:2888:3888
</code></pre>
<pre><code class="shell"># 添加
dataDir=/opt/apache-zookeeper-3.6.2-bin/data
</code></pre>
<p>启动/查看/停止运行状态</p>
<pre><code class="shell">zkServer.sh start
zkServer.sh status
zkServer.sh stop
</code></pre>
<h1 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h1><h2 id="创建并进入docker-1"><a href="#创建并进入docker-1" class="headerlink" title="创建并进入docker"></a>创建并进入docker</h2><p>创建docker，并将有安装包的主机挂载到docker中</p>
<pre><code>systemctl start docker
</code></pre>
<pre><code class="shell">docker run -d -it --name zk1 -v /home/qiyue/Downloads:/home centos
docker run -d -it --name zk2 -v /home/qiyue/Downloads:/home centos
docker run -d -it --name zk3 -v /home/qiyue/Downloads:/home centos
docker exec -it zk1 /bin/bash
docker exec -it zk1 /bin/bash
docker exec -it zk1 /bin/bash
</code></pre>
<h2 id="配置并启动zk-1"><a href="#配置并启动zk-1" class="headerlink" title="配置并启动zk"></a>配置并启动zk</h2><p>在容器中将安装包复制到<code>/opt</code>目录下</p>
<pre><code class="shell">cp /home/jdk-15.0.1 /opt -r
cp /home/apache-zookeeper-3.6.2-bin /opt -r
</code></pre>
<p>在<code>/etc/profile</code>中添加环境变量</p>
<pre><code class="shell">export JAVA_HOME=/opt/jdk-15.0.1
export ZK_HOME=/opt/apache-zookeeper-3.6.2-bin
export CLASSPATH=.:$JAVA_HOME/lib
export PATH=$PATH:$JAVA_HOME/bin:$ZK_HOME/bin
</code></pre>
<p>使环境变量生效</p>
<pre><code class="shell">source /etc/profile
</code></pre>
<p>创建data和logs文件夹</p>
<pre><code class="shell">cd /opt/apache-zookeeper-3.6.2-bin
touch data logs
</code></pre>
<p>创建myid文件(不同的容器中写入对应的id)</p>
<pre><code class="shell"># 第一个容器
echo 1 &gt; data/myid
# 第二个容器
echo 2 &gt; data/myid
# 第三个容器
echo 3 &gt; data/myid
</code></pre>
<p>修改配置文件<code>conf/zoo.cfg</code></p>
<pre><code class="shell"># 新建zoo.cfg
cd conf
cp zoo_sample.cfg zoo.cfg
</code></pre>
<pre><code class="shell"># 添加
dataDir=/opt/apache-zookeeper-3.6.2-bin/data
dataLog=/opt/apache-zookeeper-3.6.2-bin/logs

server.1=172.17.0.2:2888:3888
server.2=172.17.0.3:2888:3888
server.3=172.17.0.4:2888:3888
</code></pre>
<p>启动/查看/停止运行状态</p>
<pre><code class="shell">zkServer.sh start
zkServer.sh status
zkServer.sh stop
</code></pre>
<h1 id="选举机制"><a href="#选举机制" class="headerlink" title="选举机制"></a>选举机制</h1><p>与myid的大小和投票数有关：</p>
<ul>
<li>第一次都只会给自己投票，无法选出leader</li>
<li>第二次投票myid大的获胜，选出leader</li>
<li>第三次票数多的获胜，leader依然为leader，后启动的都是follower</li>
</ul>
<h1 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h1><ul>
<li><p><code>Client port found: 2181. Client address: localhost. Client SSL: false.</code></p>
<p>因为myid中写了id和ip，正确的应该只写id</p>
</li>
</ul>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="节点"><a href="#节点" class="headerlink" title="节点"></a>节点</h2><p>查看节点目录</p>
<pre><code class="shell">ls path
eg:
    ls /
# 递归
ls -R /
</code></pre>
<p>新增节点和数据</p>
<pre><code class="shell"># 新增节点并进行数据关联
create /node1 &quot;the fist node&quot;
</code></pre>
<p>查看节点数据</p>
<pre><code class="shell">get /node1
</code></pre>
<p>修改节点数据</p>
<pre><code class="shell">set /node1 &quot;the master node&quot;
</code></pre>
<p>删除节点和数据</p>
<pre><code class="shell">delete /node1
# 如果当前节点下还有子节点
deleteall /node1
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/zookeeper/" data-id="cl9ktb7vt0036dta8cy1rbkik" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zk/" rel="tag">zk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-zabbix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/zabbix/" class="article-date">
  <time datetime="2022-04-23T15:14:46.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/zabbix/">zabbix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="♥-ZABBIX"><a href="#♥-ZABBIX" class="headerlink" title="♥ ZABBIX"></a>♥ ZABBIX</h1><h2 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h2><ul>
<li><input checked="" disabled="" type="checkbox"> server: central component</li>
<li><input checked="" disabled="" type="checkbox"> database storage: data gathered and configuration stores</li>
<li><input checked="" disabled="" type="checkbox"> web interface: web UI support</li>
<li><input disabled="" type="checkbox"> proxy: optional, load balance support</li>
<li><input checked="" disabled="" type="checkbox"> agent: install on target machine to gather needed information</li>
</ul>
<p><img src=".images/zabbix-architecture.png" alt="zabbix-architecture"></p>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>zabbix can only be installed on specified OS, and the way to install is :</p>
<ol>
<li><p>using commands which can be find in <a target="_blank" rel="noopener" href="https://www.zabbix.com/download?zabbix=5.4&os_distribution=centos&os_version=7&db=&ws=">online official website</a></p>
</li>
<li><p>using ovf template directly without step to step to configure</p>
</li>
</ol>
<p>the version of 5.4 with centos7 has no server, so we cannot use it. then i choose <code>centos7-5.0LTS-mysql-nginx</code> </p>
<h4 id="detail-steps"><a href="#detail-steps" class="headerlink" title="detail steps:"></a>detail steps:</h4><blockquote>
<p>Note: </p>
<p>it is <strong>very important</strong> to disable <code>selinux</code> and <code>firewalld</code>, or it may meet this error message: “PID file /run/zabbix/zabbix_server.pid not readable (yet?) after start”. and zabbix-server cannot start successfully</p>
</blockquote>
<ol>
<li><p>security setting</p>
<pre><code class="shell">## selinux
# temporary
setenforce 0

# forever
vi /etc/selinux/config 

SELINUX=disabled


## firewalld
# disable
systemctl stop firewalld
systemctl disable firewalld

# or open some port
sudo firewall-cmd --add-port=&#123;10051/tcp,10050/tcp,80/tcp&#125; --permanent
sudo firewall-cmd --reload
</code></pre>
</li>
<li><p>install repository</p>
<pre><code class="shell">rpm -Uvh https://repo.zabbix.com/zabbix/5.0/rhel/7/x86_64/zabbix-release-5.0-1.el7.noarch.rpm
yum clean all 
</code></pre>
</li>
<li><p>install zabbix server and agent</p>
<pre><code class="shell">yum install zabbix-server-mysql zabbix-agent  -y
</code></pre>
</li>
<li><p>install zabbix frontend</p>
<pre><code class="shell">yum install centos-release-scl -y
</code></pre>
<p>edit <code>/etc/yum.repos.d/zabbix.repo</code> file, change <code>enabled</code> from <code>0</code> to <code>1</code></p>
<pre><code class="shell">vi /etc/yum.repos.d/zabbix.repo

[zabbix-frontend]
enabled=1
</code></pre>
<pre><code class="shell">yum install zabbix-web-mysql-scl zabbix-nginx-conf-scl -y
</code></pre>
</li>
<li><p>install mariadb</p>
<pre><code class="shell">yum install mariadb-server -y
</code></pre>
<pre><code class="shell">systemctl enable mariadb
systemctl start mariadb
</code></pre>
</li>
<li><p>configure mariadb</p>
<pre><code class="mysql">-- default no password
mysql -uroot -p 
create database zabbix character set utf8 collate utf8_bin;

-- specified your own passwd
create user zabbix@localhost identified by &#39;123456&#39;; 
grant all privileges on zabbix.* to zabbix@localhost;
quit;
</code></pre>
<p>if we wanna to change zabbix user’s password, follow this steps:</p>
<pre><code class="mysql">set password for zabbix@localhost = password(&#39;123456&#39;)
</code></pre>
<p>import data to <code>zabbix</code> database， enter the password of zabbix created before</p>
<pre><code class="shell">zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz | mysql -uzabbix -p zabbix 
</code></pre>
</li>
<li><p>configure zabbix with the ability of accessing DataBase</p>
<pre><code class="shell">vi /etc/zabbix/zabbix_server.conf

DBPassWord=123456
</code></pre>
</li>
<li><p>configure PHP for zabbix frontend</p>
<pre><code class="shell">vi     /etc/opt/rh/rh-nginx116/nginx/conf.d/zabbix.conf
listen 80;
server_name 192.168.31.114


vi /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf
listen.acl_users = apache,nginx
php_value[date.timezone] = Asia/Shanghai 
</code></pre>
</li>
<li><p>start zabbix server and agent process</p>
<pre><code class="shell">systemctl enable zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm 
systemctl restart zabbix-server zabbix-agent rh-nginx116-nginx rh-php72-php-fpm
</code></pre>
</li>
<li><p>access webpage with database password</p>
<pre><code class="shell">http://192.168.31.114

# default user name and password
Admin/zabbix
</code></pre>
<p><img src=".images/image-20210806232540221.png" alt="image-20210806232540221"></p>
<p><img src=".images/image-20210806232646109.png" alt="default startup page"></p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/zabbix/" data-id="cl9ktb7vs0033dta86le3d5ux" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zabbix/" rel="tag">zabbix</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vscode" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/vscode/" class="article-date">
  <time datetime="2022-04-23T15:14:21.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/vscode/">vscode</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="VSCODE"><a href="#VSCODE" class="headerlink" title="VSCODE"></a>VSCODE</h1><p>vscode is a code editor with lots of extension. now i will show u how to install and configure it.</p>
<h2 id="software-install"><a href="#software-install" class="headerlink" title="software install"></a>software install</h2><pre><code class="shell"># pacman -S visual-studio-code-bin
</code></pre>
<blockquote>
<p>Note: now it is not recommended to install this package. because it cannot download any extensions,  for some reasons that vscode the open project cannot use any extensions from microsoft’s virsul studio market. So, there comes <a target="_blank" rel="noopener" href="https://aur.archlinux.org/packages/vscodium-bin/">vscodium-bin</a> which can use the open market  <a target="_blank" rel="noopener" href="https://open-vsx.org/">the Open VSX registry</a> while <a target="_blank" rel="noopener" href="https://aur.archlinux.org/packages/vscodium-bin-marketplace/">vscodium-bin-marketplace</a> installed instead of microsoft one. However in our country we cannot visit github and some other websites, so we cannot download the open VSX market’s extension in code editor. The resolution is downloading extension from [market website](<a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/">Extensions for Visual Studio family of products | Visual Studio Marketplace</a>) manually and then run <code>vscodium --install-extension the-name-of-extension.vsix</code> to install it</p>
</blockquote>
<pre><code class="shell">paru -S vscodium-bin
paru -S vscodium-bin-marketplace

# install some downloaded extension
vscodium --install-extension xxx.vsix

# if there comes an error while installing extensions, we need to check whether we are in the correct markplace in website(visual studio code instead of visual studio)
</code></pre>
<p><img src=".images/2021-12-06_23-41-16.png" alt="correct markplace"></p>
<blockquote>
<p>Note: the good news is that old vscode extensions can be used again once we copy it to new vscodium’s extension location.</p>
</blockquote>
<pre><code class="shell">cp ~/.vscode/extensions ~/.vscode-oss/extensions
</code></pre>
<h2 id="sync-with-account"><a href="#sync-with-account" class="headerlink" title="sync with account"></a>sync with account</h2><p>i use microsoft account to sync my settings for vscode is developed by microsoft.</p>
<p><img src=".images/image-20210411111838253.png" alt="image-20210411111838253"></p>
<p>the benefit of login with account is that when we install a new vscode, the only thing that we need to do is login our account, then all extension and user specified setting will download and correctly configure.</p>
<h2 id="extension"><a href="#extension" class="headerlink" title="extension"></a>extension</h2><ul>
<li>Bracket Pair Colorizer 2: colorize parentheses</li>
<li>Code Runner: run code with shortcut</li>
<li>Python: python syntax highlight and autocomplete</li>
<li>go: golang syntax highlight and autocomplete</li>
</ul>
<h2 id="common-settings"><a href="#common-settings" class="headerlink" title="common settings"></a>common settings</h2><h3 id="font-size"><a href="#font-size" class="headerlink" title="font size"></a>font size</h3><ul>
<li><p>editor font size</p>
<p><img src=".images/image-20210411115931265.png" alt="image-20210411115931265"></p>
</li>
<li><p>debug fontsize</p>
<p><img src=".images/image-20210411120000837.png" alt="image-20210411120000837"></p>
</li>
<li><p>integrated fontsize</p>
<p><img src=".images/image-20210411120027471.png" alt="image-20210411120027471"></p>
</li>
</ul>
<h3 id="smooth-scroll"><a href="#smooth-scroll" class="headerlink" title="smooth scroll"></a>smooth scroll</h3><p><img src=".images/image-20210411120052899.png" alt="image-20210411120052899"></p>
<h3 id="run-in-terminal"><a href="#run-in-terminal" class="headerlink" title="run in terminal"></a>run in terminal</h3><p>configured only when code runner installed before</p>
<p><img src=".images/image-20210411120124332.png" alt="image-20210411120124332"></p>
<h3 id="run-before-clear"><a href="#run-before-clear" class="headerlink" title="run before clear"></a>run before clear</h3><p>configured only when code runner installed before</p>
<p><img src=".images/image-20210411120244102.png" alt="image-20210411120244102"></p>
<h3 id="save-file-before-run"><a href="#save-file-before-run" class="headerlink" title="save file before run"></a>save file before run</h3><p>configured only when code runner installed before</p>
<p><img src=".images/image-20210411120316147.png" alt="image-20210411120316147"></p>
<h3 id="shortcut"><a href="#shortcut" class="headerlink" title="shortcut"></a>shortcut</h3><p>configured only when code runner installed before. use <code>ctrl+enter</code> to run code</p>
<p><img src=".images/image-20210411120445623.png" alt="image-20210411120445623"></p>
<h3 id="disable-auto-check-update"><a href="#disable-auto-check-update" class="headerlink" title="disable auto check update"></a>disable auto check update</h3><p><img src=".images/image-20210731182051052.png" alt="image-20210731182051052"></p>
<p><img src=".images/image-20210731175535827.png" alt="image-20210731175535827"></p>
<h2 id="pretty-font-setting"><a href="#pretty-font-setting" class="headerlink" title="pretty font setting"></a>pretty font setting</h2><p>we know that we can use setting’s UI page to set this configuration. but edit file can reduce the time we search correct setting position.</p>
<p>press <code>ctrl+p</code> then type <code>settings.json</code> open the file to edit.</p>
<p>note that the font name can be find with <code>fc-list</code> in linux. only copy the font name, remember no any style or it makes no sense.</p>
<p>font weight is also important, without it, the font may look thin.</p>
<p>the font is introduced by <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=_Y2Yy7YYIsA">this video on Youtube</a>, <a target="_blank" rel="noopener" href="https://github.com/tonsky/FiraCode/wiki/VS-Code-Instructions">follow this web page</a>, we can find <code>Fira Code</code> font, it looks really beautiful while rendering math symbol.</p>
<p>in archlinux, we can download it use <code>pacman</code></p>
<pre><code class="shell">pacman -S nerd-fonts-fira-code
</code></pre>
<p><img src=".images/image-20210731175813452.png" alt="image-20210731175813452"></p>
<h2 id="conda"><a href="#conda" class="headerlink" title="conda"></a>conda</h2><p>i wanna to configure vscode debug with conda environment.</p>
<p>press <code>ctrl+p</code> and type <code>setting.json</code> then enter</p>
<p><img src=".images/image-20210417160752337.png" alt="image-20210417160752337"></p>
<p>and add <code>&quot;python.pythonPath&quot;: &quot;/home/blueocean/.local/apps/minicanda/envs/new/bin/python&quot;</code> the path of my conda python</p>
<p><img src=".images/image-20210417160904100.png" alt="image-20210417160904100"></p>
<p>at last, activate conda env by hand in integrate terminal</p>
<p><img src=".images/image-20210417161015205.png" alt="image-20210417161015205"></p>
<h2 id="amazing-Zen-mode"><a href="#amazing-Zen-mode" class="headerlink" title="amazing Zen mode"></a>amazing Zen mode</h2><p>That’s the feature i love vscode most,  pure clean.  press <code>ctrl+k</code> then release, after that press <code>z</code> to  switch Zen mode.</p>
<h2 id="troubleshoot"><a href="#troubleshoot" class="headerlink" title="troubleshoot"></a>troubleshoot</h2><p>when i use microsoft account to login vscode to sync settings, i get the error below. and find a solution in <a href="!%5Bimage-20210423210629533%5D(.images/image-20210423210629533.png)">this website</a></p>
<p><img src=".images/image-20210423210517405.png" alt="image-20210423210517405"></p>
<pre><code class="shell"># with archlinux, install the two packages
yay -S qtkeychain gnome-keyring
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/vscode/" data-id="cl9ktb7vn002rdta8bldr1vrt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vboxdiskResize" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/vboxdiskResize/" class="article-date">
  <time datetime="2022-04-23T15:13:14.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/vboxdiskResize/">vboxdiskResize</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Virtualbox-Disk-Resize"><a href="#Virtualbox-Disk-Resize" class="headerlink" title="Virtualbox Disk Resize"></a>Virtualbox Disk Resize</h1><p>check virtualbox disk size</p>
<p><img src=".images/image-20201209204329990.png" alt="image-20201209204329990"></p>
<p>now to resize disk size, unit is Mib. <code>--resize</code> is the size after extend whole disk size</p>
<p><img src=".images/image-20201209204406608.png" alt="image-20201209204406608"></p>
<p>now to check whether make effect</p>
<p><img src=".images/image-20201209204511139.png" alt="image-20201209204511139"></p>
<p>it seems that the partation has not added to C: drive</p>
<img src=".images/image-20201209203445007.png" alt="image-20201209203445007" style="zoom:80%;" />

<p>we need to manually add the partion to C: drive with Diskgenius application</p>
<img src=".images/image-20201209203828437.png" alt="image-20201209203828437" style="zoom: 67%;" />

<p>now, it is done!</p>
<img src=".images/image-20201209204118018.png" alt="image-20201209204118018" style="zoom: 80%;" />


      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/vboxdiskResize/" data-id="cl9ktb7vm002mdta87vqpcyiv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vbox/" rel="tag">vbox</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-terminal" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/terminal/" class="article-date">
  <time datetime="2022-04-23T15:12:34.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/terminal/">terminal</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="TERMINAL"><a href="#TERMINAL" class="headerlink" title="TERMINAL"></a>TERMINAL</h1><p>terminal is a topic include many many things, and i will complete it.</p>
<h2 id="SHORTCUT"><a href="#SHORTCUT" class="headerlink" title="SHORTCUT"></a>SHORTCUT</h2><p><strong>clean and movement</strong></p>
<pre><code class="shell">ctrl + l # clearn screen
</code></pre>
<pre><code class="shell">ctrl + a # move cursor to the begin
</code></pre>
<pre><code class="shell">ctrl + e # move cursor to the end
</code></pre>
<pre><code class="shell">alt + b # move cursor one word before
</code></pre>
<pre><code class="shell">alt + f # move cursor one word after
</code></pre>
<pre><code class="shell">ctrl + u # clear to the begin and yank to clipboard
</code></pre>
<pre><code class="shell">ctrl + k # clear to the end and yank to clipboard
</code></pre>
<pre><code class="shell">alt + backspace || ctrl + w # clear one word before
</code></pre>
<pre><code class="shell">ctrl + y # paste last command&#39;s last argument
</code></pre>
<blockquote>
<p>Note: in zsh, some of the key binding is not working by default. so we need <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18042685/list-of-zsh-bindkey-commands">add key binding by hand</a>.</p>
</blockquote>
<pre><code class="shell"># find all registered zle commands
zle -al

# bind personal key for zsh, add to .zshrc
bindkey ^K kill-line   
bindkey ^B backward-word 
bindkey ^F forward-word 
bindkey ^Y insert-last-word

# show all binded keys
bindkey
</code></pre>
<p><strong>display and process</strong></p>
<pre><code class="shell">ctrl + c # end process
</code></pre>
<pre><code class="shell">ctrl + z # stop current process and send to backend
</code></pre>
<pre><code class="shell">ctrl + d # end typing
</code></pre>
<pre><code class="shell">ctrl + s # hide character typed and output
</code></pre>
<pre><code class="shell">ctrl + q # get out of hide mode and display
</code></pre>
<h2 id="GREAT-WORKFLOW"><a href="#GREAT-WORKFLOW" class="headerlink" title="GREAT WORKFLOW"></a>GREAT WORKFLOW</h2><p>if you forget to type <code>sudo</code> at the beginning, there are two convenient ways. and i prefer the second one</p>
<pre><code class="shell"># first
ctrl + a
sudo

# second 
ctrl + u 
sudo
ctrl + y
</code></pre>
<h2 id="COMMAND"><a href="#COMMAND" class="headerlink" title="COMMAND"></a>COMMAND</h2><h3 id="wrap-terminal-long-line"><a href="#wrap-terminal-long-line" class="headerlink" title="wrap terminal long line"></a>wrap terminal long line</h3><p><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/20493/how-to-disable-line-wrap-in-a-terminal">view all message with this page</a></p>
<p>sometimes the terminal output is too long, in default the long line will wrap in several lines, and we cannot see each line’s begin.</p>
<p>there are several methods to solve this problem:</p>
<ol>
<li><p>edit terminal setting</p>
<pre><code class="shell"># such as in xterm disable line wrap
setterm --linewrap off
</code></pre>
</li>
<li><p>use <code>-S</code> of <code>less</code></p>
<pre><code class="shell"># such as 
ps -ef |grep code |less -S
</code></pre>
<p><img src=".images/image-20210520225316462.png" alt="image alt &lt;"></p>
</li>
</ol>
<h3 id="last-command"><a href="#last-command" class="headerlink" title="last command"></a>last command</h3><p>there i will show how to modify the last command since it is really very useful in our daily typing.</p>
<pre><code class="shell"># repeat last command
!!

# repeat second last command
!-2

# get last command first argument
!^

# get last command last argument
!$

# get last command Nth argument, n is numeric, such as 1,2...11...
!:n

# modify last command and execute
!:s/xxx/yyy
</code></pre>
<h3 id="mktemp"><a href="#mktemp" class="headerlink" title="mktemp"></a>mktemp</h3><p>在脚本中经常遇到需要创建临时文件或目录的情况，直接使用命令在<code>/tmp</code>目录下创建存在安全问题，所以更好的是使用<code>mktemp</code>命令</p>
<pre><code class="shell"># file
TEMPFILE=$(mktemp) || exit 1

# dir
TEMPFILE=$(mktemp -d) || exit 1
</code></pre>
<h3 id="trap"><a href="#trap" class="headerlink" title="trap"></a>trap</h3><p>临时文件或目录使用完后需要清理，可以搭配<code>trap</code>命令。trap命令放在文件最开头，这样可以包含所有后面的信号</p>
<pre><code class="shell">trap [command] [signal]
</code></pre>
<pre><code class="shell">#!/bin/bash

trap &quot;rm -rf $TEMPFILE&quot; EXIT
TEMPFILE=$(mktemp) || exit 1
</code></pre>
<pre><code class="shell"># 信号
HUP：编号1，脚本与所在的终端脱离联系。
INT：编号2，用户按下 Ctrl + C，意图让脚本中止运行。
QUIT：编号3，用户按下 Ctrl + 斜杠，意图退出脚本。
KILL：编号9，该信号用于杀死进程。
TERM：编号15，这是kill命令发出的默认信号。
EXIT：编号0，这不是系统信号，而是 Bash 脚本特有的信号，不管什么情况，只要退出脚本就会产生。
</code></pre>
<h3 id="sshfs"><a href="#sshfs" class="headerlink" title="sshfs"></a>sshfs</h3><p><code>sshfs</code>和<code>nfs</code>作用相同，都是挂载远程目录，但是sshfs更加简单，只需要在本地安装sshfs即可，因为连接使用的是ssh</p>
<pre><code class="shell"># install
apt install sshfs

# mount
sshfs root@192.168.31.121:/opt /opt

# umount
fusermount -u /opt
</code></pre>
<h3 id="stty"><a href="#stty" class="headerlink" title="stty"></a>stty</h3><p>修改终端的设置</p>
<pre><code class="shell"># show all setting
stty -a

# disable input echo
stty -echo

# enable input echo
stty echo
</code></pre>
<p>在有些程序中（例如ftp），按下回车键不能删除字符，而是显示<code>^H</code>，为了解决这个问题，可以在使用ftp之前进行设置</p>
<pre><code class="shell">stty erase ^H
</code></pre>
<p>设置之后回车即可删除，但是在shell下回车会变成<code>^?</code>，所以有必要改回来</p>
<pre><code class="shell">stty erase ^?
</code></pre>
<p>同时stty还可以查看/设置屏幕高度和宽度</p>
<pre><code class="shell">stty size
stty rows 100 cols 100
</code></pre>
<h3 id="qmv"><a href="#qmv" class="headerlink" title="qmv"></a>qmv</h3><p><code>qmv/qcp/qcmd</code>属于<code>renameutils</code>软件包，可以用编辑器快速对文件重命名，默认使用nano打开文件，可以指定vim打开进行更加高效的操作</p>
<pre><code class="shell">export EDITOR=vim

# rename all jpg
qmv *.jpg

# only show target column
qmv *.jpg -f do
</code></pre>
<p><img src=".images/qmv.gif" alt="qmv"></p>
<h3 id="pidof"><a href="#pidof" class="headerlink" title="pidof"></a>pidof</h3><p>查看进程的pid，效果等同于<code>pgrep</code></p>
<pre><code class="shell">pgrep xxx
pidof xxx
</code></pre>
<h3 id=""><a href="#" class="headerlink" title="$!"></a>$!</h3><p>check last backend jobs’s pid</p>
<pre><code class="shell"># if we have a backend jobs
sleep 100 &amp;

# then we can access its pid with
echo $!
</code></pre>
<h3 id="rg"><a href="#rg" class="headerlink" title="rg"></a>rg</h3><p><code>rg</code>(ripgrep), <code>ag</code>(the silver search) is the newest grep tool, much more faster than grep</p>
<pre><code class="shell"># almost the same useage of grep
rg xxx
</code></pre>
<h3 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h3><p><code>fd-find</code> is the newest find tool, much more faster then find</p>
<pre><code class="shell"># different with find, but more simple
fdfind md$ #
</code></pre>
<h3 id="exa"><a href="#exa" class="headerlink" title="exa"></a>exa</h3><p><code>exa</code> is the colorful tool of <code>ls</code></p>
<pre><code class="shell"># include tree display
exa -T
</code></pre>
<h3 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h3><p>crontab can not only used to execute regular task, but also at a specified time, such as reboot</p>
<pre><code class="shell"># execute at reboot
@reboot /location/to/script

# reboot and wait for a while
@reboot sleep 60 /location/to/script
</code></pre>
<h3 id="not-stores-in-history"><a href="#not-stores-in-history" class="headerlink" title="not stores in history"></a>not stores in history</h3><p>if we put a space before command, then it will not store in history</p>
<pre><code class="shell"> echo &quot;cannot find this command in history&quot;
</code></pre>
<h3 id="disown"><a href="#disown" class="headerlink" title="disown"></a>disown</h3><p>exit terminal but leave all processes running</p>
<pre><code class="shell">disown -a &amp;&amp; exit
</code></pre>
<h3 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h3><p>create a super fast ram disk</p>
<pre><code class="shell">mkdir /mnt/ram
mount -t tmpfs tmpfs /mnt/ram -o size=8G

# change mount size without reboot
mount -o remount,size=4G /mnt/ram
</code></pre>
<h3 id="long-commnad"><a href="#long-commnad" class="headerlink" title="long commnad"></a>long commnad</h3><p>use shortcut opening a editor to write long command or multi commands instead of the terminal</p>
<pre><code class="shell">ctrl+x+e
</code></pre>
<h3 id="fc"><a href="#fc" class="headerlink" title="fc"></a>fc</h3><p>open a editor to edit the last command you run and then execute it automatically</p>
<pre><code class="shell">vim /etc/sysconig/network-scripts/ifcfe-en980
fc
</code></pre>
<h3 id="catch-log-file"><a href="#catch-log-file" class="headerlink" title="catch log file"></a>catch log file</h3><p>if  the log file is not big enough, we can use <code>less +F</code> instead of <code>tail -f</code>, because with it we can do more control of output. such as we can see old message with <code>ctrl + c</code> and scroll , and than <code>shift + f</code> to the end with tailing</p>
<pre><code class="shell">less +F file_name

# or press shift + f after opening a file when we only use less command
less file_name
shift + f

# q to quit
q
</code></pre>
<p>also we can combine this option with <code>-S</code> to wrap long lines, pretty much useful</p>
<pre><code class="shell">less -S +F file_name
</code></pre>
<h3 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h3><p>there is no need to close and reopen you terminal to reset all the things such as variable setting. just typing <code>reset</code> , all will be done</p>
<pre><code class="shell">reset
</code></pre>
<h3 id="doas"><a href="#doas" class="headerlink" title="doas"></a>doas</h3><p>I will use <code>doas</code> instead of <code>sudo</code>, because i get confused when i find <code>/etc/sudoers</code> file includes <code>root</code> settings. I wonder why it includes root settings, root has the highest privileges by default. At last i know the reason that with the settings root can use <code>sudo</code> command.</p>
<pre><code class="shell"># in archlinux, install opendoas
pacman -S opendoas
</code></pre>
<p> in order to make it effects, we need create a configure file and write our configuration to it</p>
<pre><code class="shell"># allow all users belong to wheel group execute super user command without password
echo &quot;permit nopass :wheel&quot; &gt; /etc/doas.conf
</code></pre>
<blockquote>
<p>Note:</p>
<ol>
<li><code>nopass</code> allow us to run command without password</li>
<li>use <code>:</code> before <code>wheel</code> means wheel is a group</li>
</ol>
</blockquote>
<p>serveral days after, i find that i need reinstall <code>sudo</code> package, because some program need sudo, such as <code>psd</code>, build package with <code>aur</code>, without sudo there will be an error occurs.</p>
<h3 id="rsync"><a href="#rsync" class="headerlink" title="rsync"></a>rsync</h3><p><strong>rsync must be installed in two machines if the two machine need to sync files</strong></p>
<p>I have ever used linux nearlly 5 years, however i know the awesome command this days. the main features:</p>
<ol>
<li>It can implement <code>cp</code> <code>scp</code>, but more powerful</li>
<li>It can specified some file to skip</li>
<li>It can delete different files in destination</li>
</ol>
<blockquote>
<p>funny:</p>
<p>I have ever wrote a shell script to backup my linux configure file. There is a satulation that the configure file in linux i have deleted but the backup directory still has the file, it is hard to check which file should be delete, so i delete whole directory and then copy directory to destination. Now, with rsync it seems that much easier.</p>
</blockquote>
<pre><code class="shell"># --delete will delete destination file which not exists in source directory
rsync --include &#39;*.txt&#39; --exclude &#39;*.sh&#39; --delete -av remoteUser@ip:/remote/directory /local/directory
rsync --include &#39;*.txt&#39; --exclude &#39;*.sh&#39; --delete -av /local/directory remoteUser@ip:/remote/directory 
</code></pre>
<h3 id="bat"><a href="#bat" class="headerlink" title="bat"></a>bat</h3><p>a colorful repalcement of <code>cat</code></p>
<pre><code class="shell"># show text with line number and scroll like less
bat -pn

# show all text with line number at once
bat -ppn
</code></pre>
<h3 id="cpufetch"><a href="#cpufetch" class="headerlink" title="cpufetch"></a>cpufetch</h3><p>show detail informatioin of cpu</p>
<h3 id="xdotool"><a href="#xdotool" class="headerlink" title="xdotool"></a>xdotool</h3><p>xdotool can do lots of things, such as simulate mouse action, key press, get window properity and so on.</p>
<pre><code class="shell"># key press
xdotool key &quot;l&quot; &quot;s&quot; return return

# get current window class name
xdotool getwindownfocus getwindowclassname

# get mouse location
xdotool getmouselocation
</code></pre>
<h3 id="yad"><a href="#yad" class="headerlink" title="yad"></a>yad</h3><p>yad is gui dialog tool which can be used to launch a dialog for shell input. though i have ever not used xdialog, i think it is much better than xdialog.</p>
<pre><code class="shell"># setting with timeout,position,length,window title,label text,default placeholder,button position.
yad --entry --timeout=5 --center --fixed --title=&#39;change app transparence&#39; --entry-label=&quot;App name:&quot; --entry-text=&quot;$currentApp&quot; --buttons-layout=edge

# also can use text to specified window text
yad --entry --timeout=5 --center --fixed --title=&#39;change app transparence&#39; --entry-label=&quot;App name:&quot; --entry-text=&quot;$currentApp&quot; --buttons-layout=edge --text=&quot;CHANGE APP TRANSPARENCE&quot;
</code></pre>
<h3 id="mount-bind"><a href="#mount-bind" class="headerlink" title="mount bind"></a>mount bind</h3><p>it is a very useful tool much better than <code>ln -sf</code>, <code>ln</code> is a tool to create a link(file) redirect to other position, and <code>mount --bind</code> will mount some folder/file to a specified location at boot time in kernel. so <code>mount --bind</code>‘s operation makes effect to origin location.</p>
<pre><code class="shell"># temporary
mount --bind /mount/folder /to/mount/point

# permanent
vim /etc/fstab
/mount/folder /to/mount/point    none    rw,bind 0 0
</code></pre>
<h3 id="nsenter"><a href="#nsenter" class="headerlink" title="nsenter"></a>nsenter</h3><p>enter new namespace with <code>nsenter</code> command. it is a really useful tool with container if the container don’t have  <code>ip</code> command.  we can use this to  easily get container ip address and route table.</p>
<pre><code class="shell"># get container&#39;s  pid
pid=`podman inspect -f &#123;&#123;.State.Pid&#125;&#125; container_name`

# or use ps command
ps -ef |rg $(ps -ef |rg container_name |awk &#39;&#123;print $2&#125;&#39; |head -1) |tail -1 |awk &#39;&#123;print $2&#125;&#39;

# get container ip address
nsenter -t $pid -n ip -c a

# get container ip route table
nsenter -t $pid -n ip -c r
</code></pre>
<h3 id="ccze"><a href="#ccze" class="headerlink" title="ccze"></a>ccze</h3><p>with <code>ccze</code> the output in terminal will be colorized.</p>
<pre><code class="shell"># usage
ps -ef |rg firefox |ccze -A

podman images |ccze -A
</code></pre>
<h2 id="SHELL"><a href="#SHELL" class="headerlink" title="SHELL"></a>SHELL</h2><p>some userful, unusual, amazing usage or tips</p>
<h3 id="find-test-shortcut-meaning"><a href="#find-test-shortcut-meaning" class="headerlink" title="find test shortcut meaning"></a>find test shortcut meaning</h3><p>most of time i will forget what the shortcut in shell condition meaning, but now i find a way to find all the shortcut meaning.</p>
<pre><code class="shell">man test
</code></pre>
<h3 id="grant-privilege-to-normal-user-with-the-owner’s-permission"><a href="#grant-privilege-to-normal-user-with-the-owner’s-permission" class="headerlink" title="grant privilege to normal user with the owner’s permission"></a>grant privilege to normal user with the owner’s permission</h3><p>yeah, i remember to learn <code>setuid</code> and <code>setgid</code>. but still today, i really know <a target="_blank" rel="noopener" href="https://www.liquidweb.com/kb/how-do-i-set-up-setuid-setgid-and-sticky-bits-on-linux/">the right usage of them</a>, and i have to say they are very powerful for our daily use.</p>
<p>as we know some command need root privilege to execute, when i meet this requirement before, i often put this command to <code>sudoers</code> file to make it execute without password, in a fact this method is too stupid. it is simple to resolve with <code>setuid or setgid</code>.</p>
<p><code>setuid and setgid</code> or a command to be executed, it is a property of the command.</p>
<pre><code class="shell"># grant user privilege
chmod u+s /some/command

# grant group privilege
chmod g+s /some/command
</code></pre>
<h3 id="remote-X11-forward-with-ssh"><a href="#remote-X11-forward-with-ssh" class="headerlink" title="remote X11 forward with ssh"></a>remote X11 forward with ssh</h3><p>we can open remote machine’s GUI program in local  with ssh even though remote machine without a full X11 system installed. but local machine must has a full X11 system environment.</p>
<p><strong>remote machine:</strong></p>
<ul>
<li>install xauth and xhost(optional)</li>
<li><code>/etc/ssh/sshd_config</code> allow <code>X11Forwarding, AllowTcpForwarding, X11UseLocalhost</code> to <code>yes</code> and <code>X11DisplayOffset=10</code> </li>
<li>restart ssh</li>
</ul>
<p><strong>local machine:</strong></p>
<ul>
<li>install xauth</li>
</ul>
<pre><code class="shell"># specify X11 forwarding
ssh -X remote_user@remote_ip
# then open remote gui program such as xterm
xterm
</code></pre>
<h3 id="use-Xvfb-open-application-without-GUI"><a href="#use-Xvfb-open-application-without-GUI" class="headerlink" title="use Xvfb open application without GUI"></a>use Xvfb open application without GUI</h3><p>as we know there are so many programs load in background and they are be called daemons, however not all of the programs be designed like that, may be we have the need of opening some GUI applications in background and we don’t want to see the GUI each time the system starts.</p>
<p>with <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Xvfb">Xvfb</a> we can do that, it opens GUI application in virtual memory without showing any screen output. in archinux, we can install it with</p>
<pre><code class="shell">pacman -S xorg-server-xvfb
</code></pre>
<p>according to this <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/512356/is-there-any-way-to-launch-gui-application-without-gui">webpage</a>, if we want to run some GUI application in background, we can write like this</p>
<pre><code class="shell"># open a virtual frame buffer called :1
Xvfb :1 &amp;
# specify the application to start in virtual frame buffer :1
DISPLAY=:1 /location/to/gui/application &amp;
</code></pre>
<p>may be we can use it in browser testing, and starting pentablet app</p>
<h3 id="the-problem-of-num"><a href="#the-problem-of-num" class="headerlink" title="the problem of num"></a>the problem of num</h3><p>the way to get the hour of system will lead some problem while comparing with this nums, because all num begin with <code>0</code> is recognized as octonary</p>
<pre><code class="shell">hour=`date +%H`

[[ hour -eq 8 ]] || EXIT
#[[: 08: value too great for base (error token is &quot;08&quot;)
</code></pre>
<p>the way to fix the problem is adding <code>10#</code> at the begining</p>
<pre><code class="shell">hour=10#`date +%H`
[[ $hour -eq 8 ]] || EXIT
</code></pre>
<h3 id="the-problem-of-column-alignment"><a href="#the-problem-of-column-alignment" class="headerlink" title="the problem of column alignment"></a>the problem of column alignment</h3><p><code>column</code> can deal most of column’s alignment, however sometimes i don’t know why it fails, at last i find command  <code>expand</code> can work with <code>column</code> to <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/396223/bash-shell-script-output-alignment">fix the problem</a>.</p>
<p><img src=".images/image-20210809233020904.png" alt="image-20210809233020904"></p>
<h3 id="for-loop-in-shell"><a href="#for-loop-in-shell" class="headerlink" title="for loop in shell"></a>for loop in shell</h3><pre><code class="shell">for ((i=0; i&lt;5; i++))
do
    echo $i
done
</code></pre>
<h3 id="variable-expansion"><a href="#variable-expansion" class="headerlink" title="variable expansion"></a>variable expansion</h3><pre><code class="shell"># set default value
$&#123;var:-default&#125;
$&#123;var:=default&#125;
$&#123;var=default&#125;

# if variable not defined before then give a message
$&#123;var?message&#125;

# cut variable with index and length
$&#123;var:index:length&#125;

# cut variable with pattern
$&#123;var#*pattern&#125; #cut left to the first match
$&#123;var##*pattern&#125; #cut left to the last match
$&#123;var%pattern*&#125; #cut right to the first match
$&#123;var%%pattern*&#125; #cut right to the last match

# get variable length
$&#123;#var&#125;

# show all variables matched with begining of "pre"
$&#123;!pre*&#125;

# variable replace
$&#123;var/match/replace&#125; #replace the first one matched
$&#123;var//match/replace&#125; #replace all matched
$&#123;var/#match/replace&#125; #only replace the first one matched
$&#123;var/%match/replace&#125; #only replace the last one matched
```

### privilege of script

sometimes we may meet the problem of privilege in our script as a normal user, because some commands need to be executed with root privilege.

```shell
# one method is send root password to sudo
echo "password" |sudo -S command

# another way is giving the script privilege of without password
echo <username> ALL=(ALL) NOPASSWD: </location/to/script>
# then execute script with sudo
sudo </location/to/script>
```

### alias act as function

there is a concept in perl called one liner, with zsh, we can use function to write one liner, but bash cannot. however we can use alias, is it amazing? just think of it a little more deeper, both of them are block code.

```shell
# with zsh, function can write in one line
function autoline()&#123;for ((i=0;i<`tput cols`;i++));do echo -n "=";sleep 0.001;done&#125;

# unset to clear function define
unset -f autoline()

# amazing alias usage
alias autoline="for ((i=0;i<`tput cols`;i++));do echo -n "=";sleep 0.001;done"

# unalias to clear alias define
unalias autoline
```

### use : to complete syntax

sometimes we don't write code in one condition, but need to make sure syntax right, then `:` comes

```shell
if [ $&#123;a&#125; == 3 ];then
    :
else
    a=0
```

### use local to define a local variable

in shell, all variable are global by default, expect use `local` to define

```shell
var="global variables"
function show()&#123;
    local var="local variable"
    echo $var
&#125;
show
echo $var
```

### use type to check command's type

can check: alias, function, built-in, executable

```shell
type ls
```

### disable truncate file in global

we commanly use `>` to truncate a file, `>>` append to a file. and there has a method to disable truncate file in global in order to less mistake happend

```shell
# disable truncate file, now only append to file allowed
set -C

# enable truncate file
set +C
```

> Note:
> 
> unset has totally different usage, it is used for clear variable define: `var=5; unset var`

### array in shell

different shell has different usage

```shell
# in bash, it is complex with index
array=(1 2 3 4 5)
len=$&#123;#array[@]&#125;
for ((i=0; i<$len; i++))
do
echo $&#123;array[$i]&#125;
done

# simple usage without index
array=(1 2 3 4 5)
for i in $&#123;array[@]&#125;
do
echo $i
done

# in zsh, it is simple
array=(1 2 3 4 5)
for i in $array
do
echo $i
done
```

### map in shell

```shell
# create associate array
declare -A user 
user=([name]=xiaoxiao [age]=20 [score]=100) 
# simplify
declare -A user=([name]=xiaoxiao [age]=20 [score]=100) 

# add value
user[like]=apple

# get all keys
echo $&#123;!user[@]&#125;

# get all values
echo $&#123;user[@]&#125;

# get specified value
echo $&#123;user[name]&#125;

# get length
echo $&#123;#user[@]&#125;
```

### case convert

with `declare`, we can also convert upper case to low case, other side the same

```shell
string="hello world!"

# convert to upper case
declare -u var=$string
echo $var

# convert to lower case
declare -l var=$string
echo $var
```

### check run level

- 0：halt
- 1：single-user text mode
- 2：not used (user-definable)
- 3：full multi-user text mode
- 4：not used (user-definable)
- 5：full multi-user graphical mode
- 6：reboot

```shell
who -r
systemctl get-default
```

### get ip address

```shell
# use regex
ip a |rg -P '(\d+\.)&#123;3&#125;\d+'

# use ip command
ip -br -4 -c a

# some debian/redhat allow this
hostname -i
hostname -I

# use json format
ip -j a |jq '.[].addr_info[0].local'
```

### check live environment

```shell
# use systemd-detect-virt, almost make sense, owned by systemd
systemd-detect-virt

# use lscpu to check Hypervisor vendor
lscpu |grep "Hypervisor vendor"

# use hostnamectl to check Virtualization
hostnamectl |grep "Virtualization"

# even use parted to check Model
parted /dev/sda1 print |grep "Model"

# use dmesg to check Hypervisor
dmesg |grep "Hypervisor detected"

# maybe i will not use this forever, for it is so long
dmidecode -s system-manufacturer
```

### share terminal output to remote user

sometime we need to share our terminal output to other people who is not in local network, and there comes this method

```shell
# netcat is needed
pacman -S gnu-netcat

# for example: share our .vimrc to other people
bat -ppn .vimrc |nc seashells.io 1337

# then share the url link to other people
https://seashells.io/v/Zn3SnvKX

# we can change it to plain text with replacing /v to /p
https://seashells.io/p/Zn3SnvKX
```

### share terminal to remote user

be different from above, this method allows remote user to execute command with our local machine.

```shell
# install tmate
pacman -S tmate

# create ssh key if not exist
ssh-keygen

# start tmate
tmate

# share url link with others
tmate show-message
```

### sort ss port number via numeric

```shell
ss -Hatln |tr -t : \\t |sort -k6n |tr -t \\t :
```

### find process working directory

```shell
pwdx `pgrep [processname]`
ls -l /proc/`pgrep [processname]`/cwd
lsof -p `pgrep [processname]` |rg cwd
readlink -e /proc/`pgrep [processname]`/cwd
```

### loop until succeed

```shell
while ! ping www.bing.com; do sleep 3; done

until ping www.bing.com; do sleep 3; done
```

### execute one command in remote machine

sometimes, we don't need to login to remote machine if we only want to execute one command, we can use ssh to execute that command in local machine

```shell
ssh user@ip [command]

# for example:
ssh root@192.168.31.100 free -m
```

### simulate packages installation

simulation can help us to check whether there has some dependence we don't installed in the environment before we actually install packages

```shell
# most package managers have this function
rpm -ivh --test /location/to/rpm/package
```

### repeat history command with tag

this feature is actually a common usage, but almost the time we don't know it can be used  like this.

```shell
# with `#` we can tag a command
ip -br -c -4 a # ip4

# repeat with tag
!?#ip4
```

## [CTRL CHARACTER](https://stackoverflow.com/questions/3844311/how-do-i-replace-or-find-non-printable-characters-in-vim-regex/9277984)

linux: `\n` means return, and `$` renders as line ending

windows: `\r\n` means return, and `^M$` renders as line ending

> Note:
> 
> line ending character is not control character, it just renders as the ending of line.
> 
> in coding, we may use `\n` to act as a return action.

the way to show ctrl character:

```shell
cat -A fileName

# inside vim
:set list
# nolist to turn off
:set nolist
```

the way we type ctrl character in vim: `ctrl` + `v` + `ctrl_character`. such as `ctrl+v+c`: `^C`

```shell
# remove all ctrl character in vim
:%s/[[:cntrl:]]//g
```

## UlIMIT

there are serveral ways that we can change system limits temporarily or permanently. the simplest way we can find system resource limit is typing `ulimit -a`.

```shell
➜  ~  ulimit -a
-t: cpu time (seconds)              unlimited
-f: file size (blocks)              unlimited
-d: data seg size (kbytes)          unlimited
-s: stack size (kbytes)             8192
-c: core file size (blocks)         unlimited
-m: resident set size (kbytes)      unlimited
-u: processes                       63668
-n: file descriptors                1024
-l: locked-in-memory size (kbytes)  64
-v: address space (kbytes)          unlimited
-x: file locks                      unlimited
-i: pending signals                 63668
-q: bytes in POSIX msg queues       819200
-e: max nice                        0
-r: max rt priority                 0
-N 15:                              unlimited
```

the way to find program resource limit is `cat /proc/$pid/limits`

```shell
➜  ~  cat /proc/`pgrep firefox`/limits
Limit                     Soft Limit           Hard Limit           Units     
Max cpu time              unlimited            unlimited            seconds   
Max file size             unlimited            unlimited            bytes     
Max data size             unlimited            unlimited            bytes     
Max stack size            8388608              unlimited            bytes     
Max core file size        unlimited            unlimited            bytes     
Max resident set          unlimited            unlimited            bytes     
Max processes             63668                63668                processes 
Max open files            4096                 524288               files     
Max locked memory         65536                65536                bytes     
Max address space         unlimited            unlimited            bytes     
Max file locks            unlimited            unlimited            locks     
Max pending signals       63668                63668                signals   
Max msgqueue size         819200               819200               bytes     
Max nice priority         0                    0                    
Max realtime priority     0                    0                    
Max realtime timeout      50000                200000               us    
```

> Note:
> 
> we may find the difference between open files, we need to know that os resource limit only make effect when program not starts with service or systemd or no self defined, such as run program in terminal.

#### define os resource limit

**temporary**

```shell
ulimit -n 40960
ulimit -u 40960
```

**permanent**

```shell
# restarting os needed
vim /etc/security/limits.conf

* soft nofile 40960
* hard nofile 40960
* soft nproc 40960
* hard nproc 40960
```

#### service limit

no need to reboot os, stoping program and starting program will be okay(not restart).

```shell
vim /etc/liit/program_name.conf

limit nofile 40960 40960
limit nproc 40960 40960
```

then

```shell
service program_name stop
service program_name start
```

we can check it by

```shell
cat /proc/`pgrep program_name`/limits
```

#### systemd limit

no need to reboot os

```shell
vim /usr/lib/systemd/system/program_name.service

[Service]
LimitNOFILE=40960
LimitNPROC=40960
```

then

```shell
systemctl daemon-reload
systemctl restart program_name
```

different from service we can define all systemd resource limit with

```shell
vim /etc/systemd/system.conf

DefaultLimitNOFILE=40960
DefaultLimitNPROC=40960
```

#### modify resource limit for running program

In the new linux kernel we have a tool called `prlimit`, with which we can modify program limit when it's running.

```shell
prlimit -n40960 -p `pgrep program_name`
prlimit -u40960 -p `pgrep program_name`
```

 then check it

```shell
prlimit
```

## UFW

Uncomplicated Firewall

enable at **boot**, make sure `iptables.service` not active

```shell
systemctl enable ufw.service
```

**initialize** at the first time install the package

```shell
ufw enable
```

**query** rules being applied

```shell
ufw status
# or much more info
ufw status verbose
```

see **default** config

```shell
[root@s1 ~]# cat /etc/default/ufw |egrep '^[^#]'
IPV6=yes
DEFAULT_INPUT_POLICY="DROP"
DEFAULT_OUTPUT_POLICY="ACCEPT"
DEFAULT_FORWARD_POLICY="DROP"
DEFAULT_APPLICATION_POLICY="SKIP"
MANAGE_BUILTINS=no
IPT_SYSCTL=/etc/ufw/sysctl.conf
IPT_MODULES="nf_conntrack_ftp nf_nat_ftp nf_conntrack_netbios_ns"
```

**set** default policy

```shell
ufw default allow outgoing
ufw default deny incoming
```

make changes **effect**

```shell
ufw reload
```

three **actions**

```shell
allow    # allow connection
limit    # deny connections if an IP address attempts to initiate 6 or more connections within 30 seconds
deny    # deny connection
```

policy setting with **service name**

```shell
ufw limit ssh
ufw allow ftp
ufw deny http
```

policy setting with **port**

```shell
ufw limit 22
ufw allow 21
ufw deny 80
```

policy setting with **protocol**

```shell
ufw limit 22/tcp
ufw allow 21/tcp
ufw deny 80/tcp
```

**delete** policy

```shell
ufw delete allow 21ufw delete limit sshufw delete deny 80/tcp
```

via sort number

```shell
# check number
ufw status numbered

# delete via number
ufw delete &#123;&#123;number&#125;&#125;
</code></pre>
<p><strong>port range</strong></p>
<pre><code class="shell">ufw allow 10000:65535/tcp
</code></pre>
<p><strong>specified ip</strong></p>
<pre><code class="shell">ufw allow from 192.168.31.12
</code></pre>
<p><strong>ip range</strong></p>
<pre><code class="shell">ufw allow from 192.168.31.0/24
</code></pre>
<p><strong>ip and port</strong></p>
<pre><code class="shell">ufw allow from 192.168.31.12 to any port 80

# add protocol
ufw allow proto tcp from 10.10.10.10 to 192.168.31.13 port 80 
</code></pre>
<h2 id="SYSTEMD"><a href="#SYSTEMD" class="headerlink" title="SYSTEMD"></a>SYSTEMD</h2><p><strong>最实用命令</strong></p>
<pre><code class="shell"># 查看启动配置
systemctl cat xxx.service

# 查看远程服务信息
systemctl status xxx.service -H root@192.168.31.110
</code></pre>
<p><strong>系统电源控制</strong></p>
<pre><code class="shell">systemctl shutdown
systemctl reboot
systemctl halt
systemctl suspend
systemctl hibernate
</code></pre>
<h2 id="PORT-DETECT"><a href="#PORT-DETECT" class="headerlink" title="PORT DETECT"></a>PORT DETECT</h2><h3 id="4-ways-to-check-if-a-port-is-open-on-a-remote-linux"><a href="#4-ways-to-check-if-a-port-is-open-on-a-remote-linux" class="headerlink" title="4 ways to check if a port is open on a remote linux"></a>4 ways to check if a port is open on a remote linux</h3><ul>
<li>nc: netcat command</li>
<li>nmap: network mapper tool</li>
<li>telnet: telnet command</li>
<li>echo &gt; /dev/tcp/..</li>
</ul>
<p><strong>netcat</strong></p>
<pre><code class="shell">nc -zvw10 192.168.0.1 22
</code></pre>
<p><strong>nmap</strong></p>
<pre><code class="shell">namp 192.168.0.1 -p 22
</code></pre>
<p><strong>telnet</strong></p>
<pre><code class="shell">telnet 192.168.0.1 22
</code></pre>
<p><strong>echo</strong></p>
<p>the best way, because it is really less dependent only one  built in command <code>echo</code> </p>
<pre><code class="shell"># tcp
echo &gt; /dev/tcp/192.168.0.1/22 &amp;&amp; echo &quot;port tcp/22 is open&quot;

# udp
echo &gt; /dev/udp/192.168.0.1/22 &amp;&amp; echo &quot;port udp/22 is open&quot;
</code></pre>
<h3 id="3-ways-to-check-if-a-port-is-open-on-local-machine"><a href="#3-ways-to-check-if-a-port-is-open-on-local-machine" class="headerlink" title="3 ways to check if a port is open on local machine"></a>3 ways to check if a port is open on local machine</h3><ul>
<li>netstat</li>
<li>ss</li>
<li>lsof</li>
</ul>
<p><strong>netstat and ss have the same usage</strong></p>
<pre><code class="shell">netstat -atulpn

# ss more popular than netstat
ss -atulpn
</code></pre>
<p><strong>lsof</strong></p>
<pre><code class="shell">sudo lsof -i:22
</code></pre>
<blockquote>
<p>Note:</p>
<p>lsof need to be executed with <strong>root privilege</strong> because it need to search kernel file</p>
</blockquote>
<h2 id="KILLERS"><a href="#KILLERS" class="headerlink" title="KILLERS"></a>KILLERS</h2><p>if you don’t know this commands, i have not to say that you will die!</p>
<h3 id="SED"><a href="#SED" class="headerlink" title="SED"></a>SED</h3><h2 id="Selections"><a href="#Selections" class="headerlink" title="Selections"></a>Selections</h2><p>Clipboard is a buffer used for short-term data storage. It is mainly used to transfer data within and between applications, via <strong>cut</strong>, <strong>copy</strong> and <strong>paste</strong> operations. Clipboard is usually temporary and unnamed place that resides in your Computer’s <strong>RAM</strong>. </p>
<p>The clipboards are called <strong>“Selections”</strong> and there are three types of clipboards available in <strong>X11</strong> window system in Linux. They are:</p>
<ul>
<li><strong>PRIMARY</strong> - This is normally used when copy/paste data using Mouse middle button.</li>
<li><strong>SECONDARY</strong> - It is not used used much, but exists.</li>
<li><strong>CLIPBOARD</strong> - This is used for explicit copy/paste commands via Keyboard using <code>ctrl+c</code> and <code>ctrl+v</code> keys and via menu items.</li>
</ul>
<p>In xterm, we can use mouse button1 to select, button3 to paste with some configuration. In firefox, we can use addon <code>copy on select</code> </p>
<pre><code class="shell"># ~/.Xresources
&lt;Btn1Up&gt;: select-end(CLIPBOARD,PRIMARY,CUT_BUFFER0) 
&lt;Btn3Down&gt;: insert-selection(CLIPBOARD,PRIMARY,CUT_BUFFER0) 
</code></pre>
<h2 id="DISCUSS"><a href="#DISCUSS" class="headerlink" title="DISCUSS"></a>DISCUSS</h2><h4 id="how-centos-6-download-package-with-repository"><a href="#how-centos-6-download-package-with-repository" class="headerlink" title="how centos 6 download package with repository?"></a>how centos 6 download package with repository?</h4><p>centos7是可以直接使用yum下载安装包的，但是在centos6上不行，因为官方的镜像仓库已经下架。但是并不是说我们就真的无法使用了，<a target="_blank" rel="noopener" href="https://vault.centos.org/">这个网站</a>依旧有cantos6的镜像仓库，修改之后可可以了</p>
<pre><code class="shell"># we can access that website though linux.kernel.org or
# directly visit https://vault.centos.org to find the link we need
rpm -ivh http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
wget http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm
</code></pre>
<h4 id="how-centos-download-package-with-all-of-its-dependences"><a href="#how-centos-download-package-with-all-of-its-dependences" class="headerlink" title="how centos download package with all of its dependences?"></a>how centos download package with all of its dependences?</h4><p>centos上提供了一个下载插件，通过<code>downloadonly</code>可以下载软件及其依赖。需要注意只有在对应的系统版本上下载的依赖才不会导致其它依赖的版本冲突，所以确保下载安装包的系统和准备安装这些包的系统版本一致。</p>
<pre><code class="shell"># in centos6
yum install yum-plugin-downloadonly

# if our system has never install that package
yum install --downloadonly --downloaddir=&lt;directory&gt; &lt;package&gt;

# if the package already exist in our system
yum reinstall --downloadonly --downloaddir=&lt;directory&gt; &lt;package&gt;
</code></pre>
<p>还有另外一个软件也提供了相同的功能</p>
<pre><code class="shell"># yum-utils include yumdownloader package
yum install yum-utils
yumdownloader &lt;package&gt;
</code></pre>
<h4 id="how-WSL-download-python-using-China-repo"><a href="#how-WSL-download-python-using-China-repo" class="headerlink" title="how WSL download python using China repo?"></a>how WSL download python using China repo?</h4><p>首先需要下载gunpg，因为换源后需要key认证，默认没有这个软件，需提前下载</p>
<pre><code class="shell">sudo apt install gnupg
</code></pre>
<p>然后添加国内源: 添加以下信息添加到<code>/etc/apt/source.list</code>文件中</p>
<pre><code class="shell">deb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse
</code></pre>
<p>更新源会报错某些key无法识别，需要进行认证</p>
<pre><code class="shell"># eg:
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 82EB5823F4FE239D
</code></pre>
<p>重新更新源，并下载python</p>
<pre><code class="shell">sudo apt update
sudo apt install python3 python3-pip
</code></pre>
<h4 id="Why-was-I-able-to-delete-a-file-owned-by-root-in-my-home-directory-without-being-root"><a href="#Why-was-I-able-to-delete-a-file-owned-by-root-in-my-home-directory-without-being-root" class="headerlink" title="Why was I able to delete a file owned by root in my home directory without being root?"></a><a target="_blank" rel="noopener" href="https://serverfault.com/questions/726907/why-was-i-able-to-delete-a-file-owned-by-root-in-my-home-directory-without-being">Why was I able to delete a file owned by root in my home directory without being root?</a></h4><p>I got a situation that i cannot edit a file owned by root but can delete it in my home directory. And i was confused such a long time, finally find the answer. whether a file can be delete or not is depend on the folder where file stores in but not the permission of file, the file permission will decide whether you can modified it or not.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/terminal/" data-id="cl9ktb7vk002gdta8g63yeh58" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-tcp-3-handshake" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/tcp-3-handshake/" class="article-date">
  <time datetime="2022-04-23T15:12:03.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/tcp-3-handshake/">tcp_3_handshake</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="TCP-3-HandShake"><a href="#TCP-3-HandShake" class="headerlink" title="TCP 3 HandShake"></a>TCP 3 HandShake</h1><p>as we know that TCP(transmission control protocol) is much more security than UDP(user datagram protocol). so why? and what makes it?</p>
<h2 id="the-problem-of-transmission"><a href="#the-problem-of-transmission" class="headerlink" title="the problem of transmission"></a>the problem of transmission</h2><ol>
<li>data sending will be split into several packets, how do i(server/client) know the sequence order of packets and how to rebuild them?</li>
<li>how can i(server/client) know that you(client/server) really received my request? no data lost or hacked?</li>
</ol>
<h2 id="the-method-to-resolve-problem"><a href="#the-method-to-resolve-problem" class="headerlink" title="the method to resolve problem"></a>the method to resolve problem</h2><p>in order to resolve the problem 1, packet use <code>SYN</code> synchronize sequence number to confirm data beginning number.</p>
<p>in order to resolve the problem 2, server/client needs to confirm the <code>SYC</code> with <code>ACK</code> acknowledgement that it really received the <code>SYN</code>. (until receive ACK, server/client will resend <code>SYN</code>).</p>
<h2 id="the-way-it-works"><a href="#the-way-it-works" class="headerlink" title="the way it works"></a>the way it works</h2><p><strong>STEP1</strong>: client sends a syn <code>x</code> to server announce that client is likely start communication</p>
<p><strong>STEP2</strong>: server received the request and then send a ack <code>x + size of request packet</code>(equal 1) to client confirms let’s begin with packet with number x+1. then send a syn <code>y</code> to client announce that the data server sends to client begins with number of <code>y</code>.</p>
<p><strong>STEP3</strong>: client received the syn <code>y</code> of server and then announce that i will receive server’s data begins with number of <code>y + size of request packet</code>(equal 1).</p>
<p><img src=".images/tcp-3hk.png" alt="tcp-3hk"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/tcp-3-handshake/" data-id="cl9ktb7vi002adta8gc0neos3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-rust" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/rust/" class="article-date">
  <time datetime="2022-04-23T15:11:27.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/rust/">rust</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="RUST"><a href="#RUST" class="headerlink" title="RUST"></a>RUST</h1><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>by default rustup will be installed in <code>~/.rustup</code>, cargo will be installed in <code>~/.cargo</code>.<br>if we want to customize install location, we need to export variables before installation.</p>
<pre><code class="shell"># export rustup and cargo location
export RUSTUP_HOME=~/.local/apps/rust/rustup                  
export CARGO_HOME=~/.local/apps/rust/cargo                    
curl --proto &#39;=https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<p>after installation finish, <code>. /home/healer/.local/apps/rust/cargo/env</code> command will be automaticly configured to some environment files(such as .bashrc). however it is not enough, we also need to add the variables we export before installation. without this step, there will be an error called <code>error: no override and no default toolchain set</code>.</p>
<p>so, i write all of this to <code>~/.xinitrc</code></p>
<pre><code class="shell">export RUSTUP_HOME=$HOME/.local/apps/rust/rustup
export CARGO_HOME=$HOME/.local/apps/rust/cargo
source $HOME/.local/apps/rust/cargo/env
</code></pre>
<p>then check compiler and package manager version</p>
<pre><code class="shell">rustc --version
cargo --version
</code></pre>
<h2 id="vscode-extension"><a href="#vscode-extension" class="headerlink" title="vscode extension"></a>vscode extension</h2><p>since i cannot download extension in vscode, so i need download <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=rust-lang.rust">rust vsix</a> file in web site. then install it with command:</p>
<pre><code class="shell">vscodium --install-extension matklad.rust-analyzer-0.2.842.vsix
</code></pre>
<p>then we need to install <a target="_blank" rel="noopener" href="https://github.com/rust-lang/rls">rust language server(RSL)</a> with command:</p>
<pre><code class="shell">rustup component add rls rust-analysis rust-src
</code></pre>
<p>however i cannot download it since China cannot, so we need to <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/27782375">config mirror</a> with exporting this variables:</p>
<pre><code class="shell">RUSTUP_DIST_SERVER=http://mirrors.ustc.edu.cn/rust-static
RUSTUP_UPDATE_ROOT=http://mirrors.ustc.edu.cn/rust-static/rustup
</code></pre>
<p><strong>cargo mirror</strong></p>
<p>the same problem comes with cargo, so we need to config cargo mirror, add this to <code>$CARGO_HOME/config</code>:</p>
<pre><code class="shell">[source.crates-io]
registry = &quot;https://github.com/rust-lang/crates.io-index&quot;
replace-with = &#39;ustc&#39;
[source.ustc]
registry = &quot;https://mirrors.ustc.edu.cn/crates.io-index&quot;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/rust/" data-id="cl9ktb7vh0027dta8fyhm2dp7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rust/" rel="tag">rust</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-run-in-backend" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/run-in-backend/" class="article-date">
  <time datetime="2022-04-23T15:10:55.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/run-in-backend/">run_in_backend</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="run-in-backend"><a href="#run-in-backend" class="headerlink" title="run in backend"></a>run in backend</h1><p>okay, let’s check whether there is a program running in backend.</p>
<pre><code class="shell">jobs
</code></pre>
<p>if it shows like this then it has a program running in backend, if nothing, no program running in backend (always we can say like this).</p>
<pre><code class="shell">➜  ~  jobs
[1]  + suspended  xterm
</code></pre>
<p><code>[1]</code> is job number, <code>suspended</code> is program status, <code>xterm</code> is program name. if we wanna to see program pid, just type <code>jobs -l</code>.</p>
<h2 id="5-ways-running-in-backend"><a href="#5-ways-running-in-backend" class="headerlink" title="5 ways running in backend"></a>5 ways running in backend</h2><ol>
<li><p>when a terminal program runs, press <code>ctrl+z</code>, then program will stop and send to backend. after that type <code>bg %jobs_number</code>  will make background jobs running in backend.</p>
<pre><code class="shell">bg %job_number
</code></pre>
</li>
<li><p>add <code>&amp;</code> at the end of command running program.</p>
<pre><code class="shell">command &amp;
</code></pre>
</li>
<li><p>add <code>nohup</code> at the start of command and add <code>&amp;</code> at the end of command. it is much useful if we need logout of the system such as in a remote environment.</p>
<pre><code class="shell">nohup command &amp;
</code></pre>
</li>
<li><p>use <code>setsid</code></p>
<pre><code class="shell">setsid command_to_execute
</code></pre>
</li>
<li><p>use <code>(&amp;)</code></p>
<p><code>()</code> will expand command in a subshell, put <code>&amp;</code> after command in <code>()</code> will run in backend</p>
<pre><code class="shell">(command &amp;)
</code></pre>
</li>
</ol>
<blockquote>
<p>Note:</p>
<p>methods of 3,4,5 can resolve the problem when we logout the terminal but leaving the program execute continue.</p>
<p>if we use methods 1,2. we can also make it execute continue as 3,4,5 with <code>disown</code></p>
<pre><code class="shell"># change all jobs running in backend belongs to pid 1
disown -a

# change a specified job belongs to pid 1
disown %job_number
</code></pre>
</blockquote>
<h2 id="kill-program-in-backend"><a href="#kill-program-in-backend" class="headerlink" title="kill program in backend"></a>kill program in backend</h2><p>first find job number</p>
<pre><code class="shell">jobs
kill %job_number
</code></pre>
<p>or find program pid</p>
<pre><code class="shell">jobs -l
kill $pid
</code></pre>
<h2 id="start-program-in-backend"><a href="#start-program-in-backend" class="headerlink" title="start program in backend"></a>start program in backend</h2><p>with this command, we can make program in the backend with stop status running.</p>
<pre><code class="shell">bg %job_number
</code></pre>
<p>another way is using kill command</p>
<pre><code class="shell">kill -cont $pid
</code></pre>
<h2 id="pause-program-in-backend"><a href="#pause-program-in-backend" class="headerlink" title="pause program in backend"></a>pause program in backend</h2><p>with this command, we can pause program running in backend.</p>
<pre><code class="shell">kill -stop $pid
</code></pre>
<h2 id="put-backend-in-front"><a href="#put-backend-in-front" class="headerlink" title="put backend in front"></a>put backend in front</h2><p>with this command, we can put backend program in front.</p>
<pre><code class="shell">fg %job_number
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/run-in-backend/" data-id="cl9ktb7vg0024dta835089svy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-rancher" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/rancher/" class="article-date">
  <time datetime="2022-04-23T15:10:09.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/rancher/">rancher</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>rancher + k8s</p>
</blockquote>
<h1 id="ubuntu"><a href="#ubuntu" class="headerlink" title="ubuntu"></a>ubuntu</h1><h2 id="rancher"><a href="#rancher" class="headerlink" title="rancher"></a>rancher</h2><p>rancher是用来简化k8s集群管理的图形化web工具，它是运行在docker容器中的一个软件，所以安装rancher需要主机安装了docker，然后简单的通过一个命令将容器跑起来就可以了</p>
<h3 id="安装运行"><a href="#安装运行" class="headerlink" title="安装运行"></a>安装运行</h3><pre><code class="shell"># 下面这种方式，即使添加了国内源下载速度依然很慢
docker pull rancher/server

# 使用下面的命令下载很快
docker run -d -p 443:443 --name rancher --restart=unless-stopped \
    -e CATTLE_AGENT_IMAGE=&quot;registry.cn-hangzhou.aliyuncs.com/rancher/rancher-agent:v2.4.2&quot; \
    registry.cn-hangzhou.aliyuncs.com/rancher/rancher:v2.4.2
</code></pre>
<p>运行上面的命令后会进行镜像下载及运行。然后查看容器的ip，即可进行rancher的网页访问</p>
<pre><code class="shell"># 查看ipaddress
docker inspect rancher
</code></pre>
<p>访问rancher页面<code>https://localhost:443</code>或者<code>https://172.17.0.2</code>。首次运行需要设置admin用户密码，设置为admin</p>
<p><img src=".images/image-20201229161332693.png" alt="rancher"><br><img src=".images/image-20201229161332693.png" alt="rancher"></p>
<p>主界面</p>
<p><img src=".images/image-20201229161641760.png" alt="主界面"></p>
<p>设置默认镜像源为<code>registry.cn-hangzhou.aliyuncs.com</code></p>
<p><img src=".images/image-20201229171113848.png" alt="image-20201229171113848"></p>
<h2 id="k8s"><a href="#k8s" class="headerlink" title="k8s"></a>k8s</h2><p>k8s是用来集群化管理docker容器的一个工具，它直接安装在物理机中，依赖docker运行，所以如果要安装k8s首先是安装并配置好docker（docker还需进行一些特殊化配置）</p>
<h3 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h3><p>以ubuntu下的安装举例</p>
<p>安装docker</p>
<pre><code class="shell">apt install docker.io
</code></pre>
<p>修改cgroups，同时添加国内源</p>
<pre><code class="shell"># k8s使用的是systemd来进行进程隔离的，但docker默认使用cgroups，所以需要修改docker的进程隔离为systemd

vi /etc/docker/daemon.json
&#123;
  &quot;registry-mirrors&quot;: [
    &quot;https://dockerhub.azk8s.cn&quot;,
    &quot;https://reg-mirror.qiniu.com&quot;,
    &quot;https://quay-mirror.qiniu.com&quot;
  ],
  &quot;exec-opts&quot;: [ &quot;native.cgroupdriver=systemd&quot; ]
&#125;
</code></pre>
<p>重启docker</p>
<pre><code class="shell">systemctl daemon-reload
systemctl enable docker
systemctl start docker
</code></pre>
<p>检查是否修改成功</p>
<pre><code class="shell">docker info | grep -i cgroups
</code></pre>
<h3 id="k8s安装"><a href="#k8s安装" class="headerlink" title="k8s安装"></a>k8s安装</h3><h4 id="主要组件"><a href="#主要组件" class="headerlink" title="主要组件"></a>主要组件</h4><ul>
<li>kubelet 后台服务</li>
<li>kubeadm 集群部署操作</li>
<li>kubectl 普通用户操作</li>
</ul>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>k8s不能使用swap分区，需要提前关闭</p>
<pre><code class="shell"># 手动关闭开启的swap分区
swapoff -a

# 注释/etc/fstab中swap分区的信息
</code></pre>
<p><code>*</code>ubuntu的相关配置</p>
<pre><code class="shell"># 使得 apt 支持 ssl 传输
apt-get update &amp;&amp; apt-get install -y apt-transport-https
# 下载 gpg 密钥
curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - 
# 添加 k8s 镜像源
cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list
deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
EOF

apt-get update
apt-get install -y kubelet kubeadm kubectl
</code></pre>
<p>查看版本会报错，是因为还没有配置网络，可以忽略</p>
<pre><code class="shell">kubectl version

The connection to the server localhost:8080 was refused - did you specify the right host or port?
</code></pre>
<h3 id="k8s配置"><a href="#k8s配置" class="headerlink" title="k8s配置"></a>k8s配置</h3><p>master节点安装：</p>
<ul>
<li>初始化master节点</li>
<li>部署flannel网络</li>
<li>配置kubectl工具</li>
</ul>
<h4 id="初始化节点"><a href="#初始化节点" class="headerlink" title="初始化节点"></a>初始化节点</h4><p>使用init进行初始化，其它参数如下：</p>
<p><code>apiserver-advertise-address</code>为apiserver的ip，填写本机ip</p>
<p><code>image-repository</code>指定docker的源，初始化时需要进行在线docker镜像源的下载，如果不配置则会下载失败</p>
<p><code>pod-network-cidr</code>指定k8s的节点网络，k8s集群之间使用此网段进行通信，默认为10.244.0.0/16</p>
<p><code>ignore-preflight-errors</code>如果出现报错时，可以进行忽略，例如虚拟机中的cpu个数为1时会报错</p>
<pre><code class="shell">kubeadm init \
--apiserver-advertise-address=192.168.1.10 \
--image-repository registry.aliyuncs.com/google_containers \
--pod-network-cidr=10.244.0.0/16 \
--ignore-preflight-errors=CpuNum
</code></pre>
<p>运行成功后输出，最后的join语句为其它集群加入k8smaster节点需要运行的命令，如果丢失可在master节点使用<code>kubeadm token create --print-join-command</code>重新生成。如果过程中断可以使用<code>kubeadm reset</code>重置后再次初始化</p>
<p><img src=".images/image-20201229211643671.png" alt="image-20201229211643671"><br><img src=".images/image-20201229211643671.png" alt="image-20201229211643671"></p>
<h4 id="配置kubectl"><a href="#配置kubectl" class="headerlink" title="配置kubectl"></a>配置kubectl</h4><pre><code class="shell">  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</code></pre>
<p>然后查看是否可用kuberctl</p>
<pre><code class="shell"># 查看已加入的节点
kubectl get nodes
# 查看集群状态
kubectl get cs
</code></pre>
<h4 id="配置flannel网络"><a href="#配置flannel网络" class="headerlink" title="配置flannel网络"></a>配置flannel网络</h4><pre><code class="shell">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml
</code></pre>
<p>使用这个命令运行之后会报错<code>Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|0.0.0.0|:443... failed: Connection refused.</code>。百度上说是因为域名污染，在<code>/etc/hosts</code>文件中添加对应的ip</p>
<pre><code class="shell">199.232.28.133  raw.githubusercontent.com
</code></pre>
<p>之后再使用，依旧会报错，错误为<code>199.232.28.133  raw.githubusercontent.com</code></p>
<p>使用wget下载文件报ssl错误，不过在archlinux上可以使用wget下载一个yml文件，然后将此文件通过ssh传到ubuntu上</p>
<pre><code class="shell"> wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
</code></pre>
<p>手动加载此配置文件</p>
<pre><code class="shell">kubectl apply -f kube-flannel.yml
</code></pre>
<p><img src=".images/image-20201229223918885.png" alt="image-20201229223918885"><br><img src=".images/image-20201229223918885.png" alt="image-20201229223918885"></p>
<p>然后查看集群状态就ok了</p>
<pre><code class="shell">kubectl get nodes
</code></pre>
<p><img src=".images/image-20201229224015244.png" alt="image-20201229224015244"><br><img src=".images/image-20201229224015244.png" alt="image-20201229224015244"></p>
<hr>
<h1 id="centos"><a href="#centos" class="headerlink" title="centos"></a>centos</h1><p>centos下的docker安装就比较麻烦，首先是docker安装需要三个软件:<code>docker-ce,docker-ce-cli,containerd.io</code>，同时在centos8上的docker-ce要求container版本大于1.4，然而仓库中的版本为1.3，所以需要手动在网上下载container1.4的版本并安装，然后使用yum命令在线安装docker-ce和docker-ce-cli</p>
<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><h3 id="更新源"><a href="#更新源" class="headerlink" title="更新源"></a>更新源</h3><p>系统的镜像源没有提供docker的安装包，需要自己添加。命令yum-config-manager命令来进行添加源，此命令需要先安装yum-utils，device-mapper-persistent-data ，lvm2</p>
<pre><code class="shell">yum install -y  yum-utils device-mapper-persistent-data lvm2
</code></pre>
<pre><code class="shell">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre>
<h3 id="下载container"><a href="#下载container" class="headerlink" title="下载container"></a>下载container</h3><p>在<a target="_blank" rel="noopener" href="https://download.docker.com/linux/centos/8/x86_64/stable/Packages/">官网链接</a>下载container1.4版本，并进行安装</p>
<pre><code class="shell">wget https://download.docker.com/linux/centos/8/x86_64/stable/Packages/containerd.io-1.4.3-3.1.el8.x86_64.rpm

yum install -y ./containerd.io-1.4.3-3.1.el8.x86_64.rpm
</code></pre>
<h3 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h3><pre><code class="shell">yum install -y docker-ce docker-cli
</code></pre>
<h3 id="修改cgroup"><a href="#修改cgroup" class="headerlink" title="修改cgroup"></a>修改cgroup</h3><pre><code class="shell">vi /etc/docker/daemon.json
&#123;
  &quot;exec-opts&quot;: [ &quot;native.cgroupdriver=systemd&quot; ]
&#125;
</code></pre>
<h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><pre><code class="shell">systemctl enable docker
systemctl start docker
</code></pre>
<h2 id="rancher-1"><a href="#rancher-1" class="headerlink" title="rancher"></a>rancher</h2><p>下载rancher的docker镜像并启动</p>
<pre><code class="shell">docker run -d -p 443:443 --name rancher --restart=unless-stopped \
    -e CATTLE_AGENT_IMAGE=&quot;registry.cn-hangzhou.aliyuncs.com/rancher/rancher-agent:v2.4.2&quot; \
    registry.cn-hangzhou.aliyuncs.com/rancher/rancher:v2.4.2
</code></pre>
<p>rancher使用443端口，经过端口映射，可在centos上使用centos的ip进行访问。同时由于centos虚拟机与宿主机archlinux在同一网段，所以可在archlinux上使用浏览器输入centos的ip:port直接访问rancher<code>https://192.168.1.111:443</code></p>
<h2 id="k8s-1"><a href="#k8s-1" class="headerlink" title="k8s"></a>k8s</h2><p><em><strong>需要内存大于1.7G</strong></em></p>
<p>关闭swap分区</p>
<pre><code class="shell">swapoff -a

# 同时需要在/etc/fstab里面对swap分区进行注释
</code></pre>
<p>镜像配置</p>
<pre><code class="shell">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF
</code></pre>
<p>禁止防火墙（docker中不需要）</p>
<pre><code class="shell"># docker中不需要
setenforce 0

systemctl disable firewalld
systemctl stop firewalld
</code></pre>
<p>安装并启动kubenetes</p>
<pre><code class="shell">yum install -y kubelet kubeadm kubectl
# docker中没有systemctl，直接使用命令kubelet启动即可
systemctl enable kubelet &amp;&amp; systemctl start kubelet
</code></pre>
<p>初始化节点</p>
<pre><code class="shell">kubeadm init \
--apiserver-advertise-address=192.168.1.111 \
--image-repository registry.aliyuncs.com/google_containers \
--pod-network-cidr=10.244.0.0/16 \
--ignore-preflight-errors=CpuNum \
--apiserver-cert-extra-sans=192.168.1.111

kubeadm init \
--image-repository registry.aliyuncs.com/google_containers \
--pod-network-cidr=10.244.0.0/16 \
--ignore-preflight-errors=CpuNum \
--apiserver-cert-extra-sans=192.168.1.111
</code></pre>
<p>报错：</p>
<ul>
<li>docker版本太高，只支持到19.03</li>
<li>需要修改docker的cgroup为systemd</li>
<li>ram需要大于1.7G</li>
<li>需要enable kubelet</li>
</ul>
<pre><code class="shell"># 下载对应版本docker
 wget https://download.docker.com/linux/centos/8/x86_64/edge/Packages/docker-ce-19.03.13-3.el8.x86_64.rpm
 
 wget https://download.docker.com/linux/centos/8/x86_64/edge/Packages/docker-ce-cli-19.03.13-3.el8.x86_64.rpm
</code></pre>
<p>卸载之前的docker</p>
<pre><code class="shell">yum remove docker-ce
</code></pre>
<p>安装下载的docker</p>
<pre><code class="shell">yum install -y ./docker-ce-19.03.13-3.el8.x86_64.rpm
yum install -y ./docker-ce-cli-19.03.13-3.el8.x86_64.rpm
</code></pre>
<p>修改cgroup</p>
<pre><code class="shell">vim /etc/docker/daemon.json
&#123;
  &quot;exec-opts&quot;: [ &quot;native.cgroupdriver=systemd&quot; ]
&#125;
</code></pre>
<p>重新启动docker</p>
<pre><code class="shell">systemctl enable docker
systemctl start docker
</code></pre>
<p>重启机器增加内存为3G</p>
<p>重新初始化节点，需要5分钟左右下载，成功输出为：</p>
<pre><code class="shell">Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.1.111:6443 --token hzy655.b3l3x68qsyv0np8w \
    --discovery-token-ca-cert-hash sha256:89a0c3f88db476588e90109b56468f966b88be00139062f82359ef0b63f059ee 
</code></pre>
<p>根据输出进行配置</p>
<pre><code class="shell">  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

  export KUBECONFIG=/etc/kubernetes/admin.conf
</code></pre>
<p>此时查看节点状态为notready，配置网络后就ok了</p>
<pre><code class="shell">[root@localhost ~]# kubectl get nodes
NAME                    STATUS     ROLES                  AGE     VERSION
localhost.localdomain   NotReady   control-plane,master   2m50s   v1.20.1
</code></pre>
<p>配置flannel网络</p>
<pre><code class="shell"># 下载配置文件
wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

# 用配置文件配置网络
kubectl apply -f kube-flannel.yml
</code></pre>
<p>输出为下面即为配置成功</p>
<pre><code class="shell">podsecuritypolicy.policy/psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io/flannel configured
clusterrolebinding.rbac.authorization.k8s.io/flannel configured
serviceaccount/flannel unchanged
configmap/kube-flannel-cfg configured
daemonset.apps/kube-flannel-ds created
</code></pre>
<p>再次查看状态就为ready</p>
<pre><code class="shell">[root@localhost ~]# kubectl get nodes
NAME                    STATUS   ROLES                  AGE     VERSION
localhost.localdomain   Ready    control-plane,master   9m46s   v1.20.1
</code></pre>
<h2 id="k8s加入rancher"><a href="#k8s加入rancher" class="headerlink" title="k8s加入rancher"></a>k8s加入rancher</h2><p><img src=".images/image-20201231212113859.png" alt="image-20201231212113859"><br><img src=".images/image-20201231212113859.png" alt="image-20201231212113859"></p>
<p><img src=".images/image-20201231212149814.png" alt="image-20201231212149814"><br><img src=".images/image-20201231212149814.png" alt="image-20201231212149814"></p>
<p><img src=".images/image-20201231212220563.png" alt="image-20201231212220563"><br><img src=".images/image-20201231212220563.png" alt="image-20201231212220563"></p>
<p>在centos上运行上面的命令将k8s加入rancher，其中USER_ACCOUNT通过查看配置文件获取</p>
<pre><code class="shell"> cat .kube/config
</code></pre>
<p><img src=".images/image-20201231212602316.png" alt="image-20201231212602316"><br><img src=".images/image-20201231212602316.png" alt="image-20201231212602316"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/rancher/" data-id="cl9ktb7vf0021dta8a8hm7j5q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/learn/">learn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/think/">think</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">thinking</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E5%8E%86%E5%8F%B2/">读历史</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/anaconda/" rel="tag">anaconda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anbox/" rel="tag">anbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/archlinux/" rel="tag">archlinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boring/" rel="tag">boring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cursor-theme/" rel="tag">cursor theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ed/" rel="tag">ed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/" rel="tag">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/haskell/" rel="tag">haskell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inject-js-css/" rel="tag">inject js/css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mind/" rel="tag">mind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimized/" rel="tag">optimized</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pentablet/" rel="tag">pentablet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/positive/" rel="tag">positive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reality-is-aweful/" rel="tag">reality is aweful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/route/" rel="tag">route</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shield/" rel="tag">shield</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vbox/" rel="tag">vbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xmonad/" rel="tag">xmonad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zabbix/" rel="tag">zabbix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zk/" rel="tag">zk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/" rel="tag">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%9D%E7%BB%AA/" rel="tag">思绪</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A5%9E%E8%AF%9D/" rel="tag">神话</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%89%AF%E7%9F%A5/" rel="tag">良知</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/anaconda/" style="font-size: 10px;">anaconda</a> <a href="/tags/anbox/" style="font-size: 10px;">anbox</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/archlinux/" style="font-size: 10px;">archlinux</a> <a href="/tags/boring/" style="font-size: 10px;">boring</a> <a href="/tags/container/" style="font-size: 10px;">container</a> <a href="/tags/cursor-theme/" style="font-size: 10px;">cursor theme</a> <a href="/tags/ed/" style="font-size: 10px;">ed</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/haskell/" style="font-size: 10px;">haskell</a> <a href="/tags/inject-js-css/" style="font-size: 10px;">inject js/css</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/k8s/" style="font-size: 20px;">k8s</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mind/" style="font-size: 10px;">mind</a> <a href="/tags/optimized/" style="font-size: 10px;">optimized</a> <a href="/tags/pentablet/" style="font-size: 10px;">pentablet</a> <a href="/tags/positive/" style="font-size: 10px;">positive</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/reality-is-aweful/" style="font-size: 10px;">reality is aweful</a> <a href="/tags/route/" style="font-size: 10px;">route</a> <a href="/tags/rust/" style="font-size: 10px;">rust</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/shield/" style="font-size: 10px;">shield</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/vbox/" style="font-size: 10px;">vbox</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/xmonad/" style="font-size: 20px;">xmonad</a> <a href="/tags/zabbix/" style="font-size: 10px;">zabbix</a> <a href="/tags/zk/" style="font-size: 10px;">zk</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a> <a href="/tags/%E6%80%9D%E7%BB%AA/" style="font-size: 15px;">思绪</a> <a href="/tags/%E7%A5%9E%E8%AF%9D/" style="font-size: 10px;">神话</a> <a href="/tags/%E8%89%AF%E7%9F%A5/" style="font-size: 10px;">良知</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/23/our-body-may-cheat-ourselves-md/">our-body-may-cheat-ourselves.md</a>
          </li>
        
          <li>
            <a href="/2022/07/04/the-reality/">the-reality</a>
          </li>
        
          <li>
            <a href="/2022/06/25/%E4%BB%8E%E5%AE%B9/">从容</a>
          </li>
        
          <li>
            <a href="/2022/06/25/magic-of-xmonad/">magic-of-xmonad</a>
          </li>
        
          <li>
            <a href="/2022/06/24/xp-pentablet/">xp-pentablet</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 shutterbug<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>