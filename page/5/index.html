<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>shutterbug sweet diary</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="shutterbug sweet diary">
<meta property="og:url" content="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/page/5/index.html">
<meta property="og:site_name" content="shutterbug sweet diary">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="shutterbug">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="shutterbug sweet diary" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">shutterbug sweet diary</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-haskell" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/haskell/" class="article-date">
  <time datetime="2022-04-23T15:02:39.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/haskell/">haskell</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="HASKELL"><a href="#HASKELL" class="headerlink" title="HASKELL"></a>HASKELL</h1><h2 id="what-is-haskell"><a href="#what-is-haskell" class="headerlink" title="what is haskell?"></a>what is haskell?</h2><p><strong>Haskell is a <em>purely functional programming language</em>. don’t tell the computer what to do as such but rather you tell it what stuff <em>is</em></strong></p>
<h2 id="feature"><a href="#feature" class="headerlink" title="feature"></a>feature</h2><ul>
<li>unchangeable variable </li>
<li>no side-effects</li>
<li>pure function</li>
<li>function must return value</li>
<li>type static</li>
<li>compile language</li>
<li>lazy calculate</li>
<li>elegant and concise</li>
</ul>
<h2 id="environment"><a href="#environment" class="headerlink" title="environment"></a>environment</h2><p>haskell的环境搭建包含了三个部分：</p>
<ol>
<li><p>编译器</p>
<ul>
<li>编译器使用ghc或者hugs（在使用包管理器或安装脚本时会自动安装）</li>
</ul>
</li>
<li><p>模块</p>
<p>模块安装有多种方法：</p>
<ul>
<li><p>如果是使用debian，ubuntu等操作系统，<a target="_blank" rel="noopener" href="https://www.haskell.org/platform/">包管理器提供的有完整安装包</a>，这种安装方式会自动安装后面代码提示所需要的后台服务</p>
</li>
<li><p>如果所使用的系统不在列表中，可使用官方提供的<a target="_blank" rel="noopener" href="https://www.haskell.org/ghcup/">一键安装脚本</a>，安装所有组件，包含了ghc以及包管理cabal/stack（安装完有2Gib多的空间占用）</p>
</li>
<li><p>如果觉得上面安装的文件太大，可使用系统提供的包管理器安装选择性的安装，例如archlinux可以直接使用<code>pacman</code>安装。我使用的就是这种方式，比较轻量，需要什么就安装什么。</p>
</li>
</ul>
</li>
<li><p>编辑器的代码提示</p>
<p>包含两个部分：</p>
<ul>
<li><p>后台服务：模块安装后在vscode中编辑是没有代码提示的，因为还缺少一个<code>haskell-language-server</code>，这个软件会在后台提供自动补全等功能</p>
<pre><code class="shell">pacman -S haskell-language-server
</code></pre>
</li>
<li><p>IDE插件：vscode中安装对应的扩展插件：</p>
</li>
</ul>
<p><img src=".images/image-20210526004245891.png" alt="image-20210526004245891"></p>
</li>
</ol>
<h2 id="run"><a href="#run" class="headerlink" title="run"></a>run</h2><p><strong>虽然haskell是编译型语言，但编译器提供了直接运行的方式。虽然速度比编译后的慢</strong></p>
<pre><code class="shell">runhaskell file.hs
</code></pre>
<p><strong>编译后运行</strong></p>
<p>haskell的编译器有很多，但是这里使用ghc，archlinux下安装很简单:</p>
<pre><code class="shell">pacman -S ghc
</code></pre>
<blockquote>
<p>Note: </p>
<p>由于xmonad是使用haskell语言写的，所以安装xmonad时，已经安装了ghc，所以不需要再次下载了</p>
</blockquote>
<p><strong>交互命令行</strong></p>
<p>输入<code>ghci</code>进入交互式界面，输入<code>:quit</code>进行退出</p>
<pre><code class="haskell">➜  ~  ghci
GHCi, version 8.10.4: https://www.haskell.org/ghc/  :? for help
Prelude&gt; :quit
Leaving GHCi.
Prelude&gt; :set prompt &quot;ghci &gt; &quot;
ghci &gt;
</code></pre>
<p>haskell的脚本后缀为<code>.hs</code>，ghci中加载脚本文件为：<code>:l file.hs</code>. <code>:r</code>重新加载文件</p>
<h2 id="arithmetic"><a href="#arithmetic" class="headerlink" title="arithmetic"></a>arithmetic</h2><pre><code class="haskell">+    --add
-    --subtract
*    --multiply
/    --divide
mod    --remainder
rem    --remainder
</code></pre>
<h2 id="boolean-algebra"><a href="#boolean-algebra" class="headerlink" title="boolean algebra"></a>boolean algebra</h2><p>与：<code>&amp;&amp;</code></p>
<p>或：<code>||</code></p>
<p>非：<code>not</code></p>
<p>等：<code>==</code></p>
<p>不等：<code>/=</code></p>
<pre><code class="haskell">ghci &gt;&gt; False &amp;&amp; True
False
ghci &gt;&gt; False || True
True
ghci &gt;&gt; not False
True
ghci &gt;&gt; 1 == 0
False
ghci &gt;&gt; &quot;a&quot; == &quot;b&quot;
False
ghci &gt;&gt; &quot;a&quot; == &quot;a&quot;
True
</code></pre>
<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><ol>
<li>list use <code>[]</code></li>
<li>value in list must be the <code>same type</code></li>
<li><code>String</code> is a syntactic sugar of list</li>
<li>use <code>++</code> put lists together</li>
<li><code>++</code> method will work though the first list. however <code>:</code> cons will not</li>
<li>list can be compared if the stuff they contain can be compared</li>
<li>use <code>!!</code> to get element out of a list by index. the begin index is 0</li>
<li>enumerated value can use <code>..</code> to expand needed value</li>
<li>don’t use <code>..</code> operation with float value</li>
<li><code>[1..]</code> explains all the values of nature</li>
<li><code>_</code> will ignore one value (means drop)</li>
</ol>
<p><strong>some built in function:</strong></p>
<pre><code class="haskell">Prelude&gt; list = [1..10]
Prelude&gt; head list
1
Prelude&gt; tail list
[2,3,4,5,6,7,8,9,10]
Prelude&gt; init list
[1,2,3,4,5,6,7,8,9]
Prelude&gt; last list
10
Prelude&gt; list !! 4
5
Prelude&gt; length list
10
Prelude&gt; null list
False
Prelude&gt; reverse list
[10,9,8,7,6,5,4,3,2,1]
Prelude&gt; take 4 list
[1,2,3,4]
Prelude&gt; drop 4 list
[5,6,7,8,9,10]
Prelude&gt; maximum list
10
Prelude&gt; minimum list
1
Prelude&gt; sum list
55
Prelude&gt; product list
3628800
Prelude&gt; elem 5 list
True
Prelude&gt; 5 `elem` list
True
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>some function be write in the middle of two value, such as `5 elem [1..10]`
</code></pre>
</blockquote>
<pre><code class="haskell">-- expand value
Prelude&gt; [1..10]
[1,2,3,4,5,6,7,8,9,10]
Prelude&gt; [&#39;a&#39;..&#39;z&#39;]
&quot;abcdefghijklmnopqrstuvwxyz&quot;
Prelude&gt; [&#39;A&#39;..&#39;Z&#39;]
&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;

-- define steps
Prelude&gt; [1,3..20]
[1,3,5,7,9,11,13,15,17,19]
Prelude&gt; [&#39;A&#39;,&#39;D&#39;..&#39;Z&#39;]
&quot;ADGJMPSVY&quot;
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>reverse order list must define step
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; [10..1]
[]
Prelude&gt; [10,9..1]
[10,9,8,7,6,5,4,3,2,1]
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>`take` function is very important, it works well with haskell&#39;s lazy feather
                                
`take 5 [1,5..]`
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; take 20 $ cycle [1..5]
[1,2,3,4,5,1,2,3,4,5,1,2,3,4,5,1,2,3,4,5]
Prelude&gt; take 4 $ repeat [1..5]
[[1,2,3,4,5],[1,2,3,4,5],[1,2,3,4,5],[1,2,3,4,5]]
Prelude&gt; replicate 20 1
[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
</code></pre>
<p><strong>list comprehension</strong></p>
<p>list comprehension allows us do more operations with each element or filter them and return a new list.</p>
<blockquote>
<p>Note:</p>
<pre><code>`[ return expression | variable &lt;- list, filter1, filter2]`
                                
`&lt;-` means bind each element to variable
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; [ x^2 | x &lt;- [1..10]]
[1,4,9,16,25,36,49,64,81,100]
Prelude&gt; [ x^2 | x &lt;- [1..10], x `mod` 3 /= 0]
[1,4,16,25,49,64,100]
Prelude&gt; [ x^2 | x &lt;- [1..10], x `mod` 3 /= 0, x `mod` 2 == 0]
[4,16,64,100]
Prelude&gt; [ x+y | x &lt;- [1..3], y &lt;- [(-1),(-2)..(-3)]]
[0,-1,-2,1,0,-1,2,1,0]
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>we can use function to deliver list with parameter
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; plus2 xs = [ x*2 | x &lt;- xs]
Prelude&gt; plus2 [1..5]
[2,4,6,8,10]
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>we can not only operator list itself, but also use list as a condition
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; color xs = [ if x==0 then &quot;red&quot; else if x==1 then &quot;yellow&quot; else &quot;blue&quot; | x &lt;- xs, x==0 || x==1 || x==2]
Prelude&gt; color [1,4,0,3,2,10]
[&quot;yellow&quot;,&quot;red&quot;,&quot;blue&quot;]
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>we can use `_` to ignore some value
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; length&#39; xs = sum [ 1 | _ &lt;- xs]
Prelude&gt; length&#39; [1..10]
10
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>deal with list of lists
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; lists = [[2,3,4],[3,4,5],[4,5,6]]
Prelude&gt; [[x+1 | x&lt;-xs] | xs &lt;- lists]
[[3,4,5],[4,5,6],[5,6,7]]
</code></pre>
<h2 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h2><ol>
<li>tuple use <code>()</code></li>
<li>can contain different type values</li>
<li>tuple’s type depend on the length of tuple (means different length of tuple stands of different type) and the type of tuple’s value</li>
</ol>
<blockquote>
<p>Note:</p>
<ol>
<li><p>i still not find a good way to index the tuple, one way to index tuple is use <code>_</code> to filter no needed data. one little complex way is using <code>pattern match</code></p>
</li>
<li><p>but if the tuple only has two value, we can use two function get the value</p>
</li>
</ol>
</blockquote>
<pre><code class="haskell">yohe = (20,170,&quot;12312823@gmail.com&quot;)

-- define function with pattern match
getAge xs =
    let (age,_,_) = xs
    in  print age
-- haskell will return last value be default, so `print` is optional
getScho0l xs = let (_,school,_) = xs in school
-- a more convient way is 
getEmail (_,_,email) = email


-- we can write above in a file, then we can call it by function
getAge yohe
getSchool yohe
getEmail yohe
</code></pre>
<pre><code class="haskell">Prelude&gt; yohe = (20, &quot;2398422@gmail.com&quot;)
Prelude&gt; fst yohe
20
Prelude&gt; snd yohe
&quot;2398422@gmail.com&quot;
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>`zip` to combine two list into one tuple
                                
`unzip` can abstract tuple into two list
</code></pre>
</blockquote>
<pre><code class="haskell">Prelude&gt; zip [1..10] [&#39;a&#39;..&#39;z&#39;]
[(1,&#39;a&#39;),(2,&#39;b&#39;),(3,&#39;c&#39;),(4,&#39;d&#39;),(5,&#39;e&#39;),(6,&#39;f&#39;),(7,&#39;g&#39;),(8,&#39;h&#39;),(9,&#39;i&#39;),(10,&#39;j&#39;)]

Prelude&gt; a = zip [1..10] [&#39;a&#39;..&#39;z&#39;]
Prelude&gt; unzip a
([1,2,3,4,5,6,7,8,9,10],&quot;abcdefghij&quot;)
</code></pre>
<h2 id="type-and-typeclass"><a href="#type-and-typeclass" class="headerlink" title="type and typeclass"></a>type and typeclass</h2><p>in other languages such as python, data also has type, if we write <code>1 - True</code> in file will lead a error in compile time. so how about haskell? okay, we need to say in haskell everything has a type, data, function, expression (in fact, data is included in expression)</p>
<pre><code class="haskell">Prelude&gt; :t 3
3 :: Num p =&gt; p
Prelude&gt; :t sum
sum :: (Foldable t, Num a) =&gt; t a -&gt; a
Prelude&gt; :t (1+1)
(1+1) :: Num a =&gt; a
</code></pre>
<p><strong>benefit of type</strong></p>
<ol>
<li>type told the expression or function what data type it needs</li>
<li>make it much easier to know what the function/expression means while reading type define</li>
<li>check syntax in compile time</li>
</ol>
<blockquote>
<p>Note:</p>
<ol>
<li>type is capital case in start : <code>Int, Integer, Float, Double, Bool, Char, String</code></li>
<li>use <code>::</code> to announce type definition</li>
<li>use <code>-&gt;</code> to separate parameters</li>
<li>there are two ways:<ul>
<li>with function, <code>function_name :: parameter1_type -&gt; parameter2_type -&gt; return_type</code></li>
<li>with data, <code>data :: data_type</code></li>
</ul>
</li>
</ol>
</blockquote>
<pre><code class="haskell">getEmail :: String -&gt; String
getEmail xs = let (_,_,email) = xs in  email

Prelude&gt; 3 + 4
7
Prelude&gt; 3 + 4 :: Float
7.0
</code></pre>
<p><strong>type variable</strong></p>
<p>some functions not only allow one unchanged data type, this kind of function called <em>polymorphic function</em>. we need to use type variable, often use single lower case character (a~z). it stands for all kinds of types</p>
<pre><code class="haskell">-- head allow String and Int type and others...
Prelude&gt; :t head
head :: [a] -&gt; a
Prelude&gt; head &quot;string&quot;
&#39;s&#39;
Prelude&gt; head [1..10]
1
Prelude&gt; head [1.0..10.0]
1.0
</code></pre>
<p><strong>typeclass</strong></p>
<p>A typeclass is a sort of interface that defines some behavior. If a type is a part of a typeclass, that means that it <code>supports and implements</code> the behavior the typeclass describes.</p>
<pre><code class="haskell">Prelude&gt; :t (==)
(==) :: Eq a =&gt; a -&gt; a -&gt; Bool
</code></pre>
<p>Everything before the <strong>=&gt;</strong> symbol is called a <em>class constraint</em>. We can read the previous type declaration like this: the equality function takes any two values that are of the same type and returns a <strong>Bool</strong>. The type of those two values must be a member of the <strong>Eq</strong> class (this was the class constraint)</p>
<ol>
<li><p>we use <code>=&gt;</code> to announce typeclass</p>
</li>
<li><p>basic typeclass:</p>
<pre><code class="haskell">Eq             used for comparing:it&#39;s implement has method of `==` `/=`
Ord             ordering: `&gt;` `&lt;` `&gt;=` `&lt;=`
Show        present as string    `show`
Read        read string and return a type of Read    `read`
Enum        sequentially ordered types    `succ` `pred`
Bounded        have an upper and a lower bound
Num            numeric typeclass
Integral    only integral (whole) numbers    `fromIntegral`
Floating    includes only floating point numbers
</code></pre>
</li>
<li><p>if one type belongs to one typeclass, then this type can act like other type the typeclass defined.</p>
<pre><code class="haskell">-- 5 belongs to Num typeclass, so it can be Int or Float or Double
Prelude&gt; :t 5
5 :: Num p =&gt; p
Prelude&gt; 5 :: Int
5
Prelude&gt; 5 :: Float
5.0
Prelude&gt; 5 :: Double
5.0
</code></pre>
</li>
</ol>
<blockquote>
<p>Note:</p>
<ol>
<li><p>length function will return a Int value, which may lead many inconvenient</p>
<pre><code class="haskell">Prelude&gt; :t length
length :: Foldable t =&gt; t a -&gt; Int
                                
Prelude&gt; length &quot;hello&quot; + 4.5
                                
&lt;interactive&gt;:235:18: error:
    • No instance for (Fractional Int) arising from the literal ‘4.5’
    • In the second argument of ‘(+)’, namely ‘4.5’
      In the expression: length &quot;hello&quot; + 4.5
      In an equation for ‘it’: it = length &quot;hello&quot; + 4.5
</code></pre>
<p>so why <code>fromIntegral</code> comes up</p>
<pre><code class="haskell">Prelude&gt; :t fromIntegral
fromIntegral :: (Integral a, Num b) =&gt; a -&gt; b
Prelude&gt; fromIntegral (length &quot;hello&quot;) + 4.5
9.5
</code></pre>
</li>
</ol>
</blockquote>
<p><strong>type annotations</strong></p>
<p>some functions don’t know what kind of type it will return, so we need to tell it, that’s type annotations</p>
<p>use <code>:: data_type</code> after data</p>
<pre><code class="haskell">Prelude&gt; :t read
read :: Read a =&gt; String -&gt; a
Prelude&gt; read &quot;3&quot; :: Int
3
</code></pre>
<h2 id="function"><a href="#function" class="headerlink" title="function"></a>function</h2><ol>
<li>function will return last calculate value by default, so  <code>return</code> keyword is optiona</li>
<li><code>return</code> keyword only told function return a value rather than pause, so the code below <code>return</code> will run continue</li>
<li>function name starts with lower case</li>
<li>args split with blank space</li>
</ol>
<p><strong>pattern matching</strong></p>
<p>much more different than any other languages, this feature in my opinion is really cool for it can do some match with parameters.</p>
<pre><code class="haskell">-- how sum comes
-- for list end with [], this may lead function runs error, with pattern match, we can avoid it
sum&#39; [] = 0
-- with pattern match, we can sperate list into two parts: head value and the rest of value
sum&#39; (x:xs) = x + sum&#39; xs
</code></pre>
<pre><code class="haskell">-- without pattern match, function like this
yeho = (20，170，“293848389@gmail.com”)
getEmail xs = let (_,_,email) = xs in email

-- however we can directly match with parameter,cool?
yeho = (20，170，“293848389@gmail.com”)
getEmail (_,_,email) = email

-- without pattern match, head like this
head&#39; [] = error &quot;empty list&quot;
head&#39; x = x !! 0
-- with parameter match, head like this, cool?
head&#39; [] = error &quot;empty list&quot;
head&#39; (x:_) = x
</code></pre>
<p>pattern matching also can act like if statement</p>
<pre><code class="haskell">color 0 = &quot;red&quot;
color 1 = &quot;yellow&quot;
color 2 = &quot;blue&quot;
color _ =  &quot;not origion triple color&quot;
</code></pre>
<p><strong>guard</strong></p>
<p>guards are a way of testing whether some property of a value (or several of them) are true or false. much more like if statement.</p>
<ol>
<li>no <code>=</code> sign after parameter</li>
<li>use <code>|</code> to sign begin</li>
</ol>
<pre><code class="haskell">adjudge :: (Ord a, Num a) =&gt; a -&gt; [Char]
adjudge score
    | score &gt;= 90 = &quot;perfect&quot;
    | score &gt;= 80 = &quot;good&quot;
    | score &gt;= 60 = &quot;not bad&quot;
    | score &gt;= 0 = &quot;not pass&quot;
    | otherwise = &quot;error score&quot;
</code></pre>
<p><code>otherwise</code> is optional, but it is often useful for catching everything</p>
<p>with <strong>where</strong> we can also use local variables in guard</p>
<pre><code class="haskell">total :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a -&gt; [Char]
total math english history
    | score &gt; lineup = &quot;perfect&quot;
    | score &gt; passline = &quot;good&quot;
    | otherwise = &quot;hurry up&quot;
    where score = math + english + history
          lineup = 400
          passline = 200 
</code></pre>
<blockquote>
<p>Note:</p>
<ol>
<li>the indent below where is hard to specify, for it is not 2 tab but 6 blank space (1tab + 2black space)</li>
<li>in where binding, we can define variable</li>
<li>in where binding, we can use pattern match</li>
<li>in where binging, we can use function</li>
</ol>
</blockquote>
<pre><code class="haskell">total :: (Ord a, Num a) =&gt; a -&gt; a -&gt; a -&gt; [Char]
total math english history
    | score &gt; lineup = &quot;perfect&quot;
    | score &gt; passline = &quot;good&quot;
    | otherwise = &quot;hurry up&quot;
    where score = math + english + history
          (lineup,passline) = (400,200)
</code></pre>
<pre><code class="haskell">import Data.List.Split

email :: [Char] -&gt; [Char]
email addr
    | end == &quot;gmail.com&quot; = &quot;gmail&quot;
    | end == &quot;qq.com&quot; = &quot;qq&quot;
    | end == &quot;163.com&quot; = &quot;163&quot;
    | otherwise = &quot;error email address&quot;
    where [_,end] = splitOn &quot;@&quot; addr
 
-- run result
*Main&gt; email &quot;20398442@qq.com&quot;
&quot;qq&quot;
</code></pre>
<pre><code class="haskell">zip&#39; xs ys = [f x y | x &lt;- xs, y &lt;- ys]
    where f x y = (x, y)
</code></pre>
<p><strong>let</strong> works similar like where, but it can write in anywhere in function not only in the end</p>
<p>syntax: <code>let binding in expression</code></p>
<p><strong>the difference between let and where is that let binding itself is expression</strong></p>
<pre><code class="haskell">(let (a,b,c) = (1,2,3) in a+b+c) * 100
</code></pre>
<p><code>if else</code> statement is an expression and we can cram it in almost anywhere, so do <code>let</code> binding. and i wanna to say let binding is so flexible and cool</p>
<pre><code class="haskell">-- simple calculate expression
3 + (let a=2 in a^2) + 1

-- list expression
[ m | x &lt;- [1..10], let m = x * 2 + 1, m &gt; 8]

-- function expression
let add1 x = x + 1 in (add1 1, add1 2, add1 3)

-- pattern match
let (a,b,c) = (1,2,3) in a^2 + b^2 + c^2
</code></pre>
<h2 id="case-expression"><a href="#case-expression" class="headerlink" title="case expression"></a>case expression</h2><p>case is expression,so what about it? that means we can use pattern matching with case value</p>
<pre><code class="haskell">-- syntax
case expression of pattern -&gt; result
                   pattern -&gt; result
                   pattern -&gt; result
                   ...
</code></pre>
<pre><code class="haskell">head&#39; :: [a] -&gt; a
head&#39; xs = case xs of [] -&gt; error &quot;empty list&quot;
                      (x:xs) -&gt; x
</code></pre>
<h2 id="recursion"><a href="#recursion" class="headerlink" title="recursion"></a>recursion</h2><p>for haskell is a language that higher than any other languages, and it ignores how to do it but tells what it is, so the implementation of loop will be instead of recursion. that is why recursion so important in haskell.</p>
<pre><code class="haskell">max&#39; :: Ord a =&gt; [a] -&gt; a 
-- edge condition with pattern match
max&#39; [] = error &quot;empty list&quot;
max&#39; [x] = x
max&#39; (x:xs)
-- don&#39;t need to do loop condition, but to say head number greater than 
-- tail numbers (rest of the list number)
    | x &gt; restList = x
    | otherwise = restList
    where restList = max&#39; xs
</code></pre>
<pre><code class="haskell">take&#39; :: Int -&gt; [a] -&gt; [a]
take&#39; _ [] = []
take&#39; n (x:xs)
    | n &lt;= 0 = []
    | otherwise = x : take&#39; (n-1) xs
</code></pre>
<pre><code class="haskell">reverse&#39; :: [a] -&gt; [a]
reverse&#39; [] = []
reverse&#39; (x:xs) = reverse&#39; xs ++ [x]
</code></pre>
<pre><code class="haskell">repeat&#39; :: a -&gt; [a]
repeat&#39; x = x:repeat&#39; x
</code></pre>
<pre><code class="haskell">-- notice the type define
zip&#39; :: [a] -&gt; [b] -&gt; [(a,b)]
zip&#39; [] _ = []
zip&#39; _ [] = []
zip&#39; (x:xs) (y:ys) = (x,y) : zip&#39; xs ys
</code></pre>
<pre><code class="haskell">elem&#39; :: Eq a =&gt; a -&gt; [a] -&gt; Bool 
elem&#39; m [] = False
elem&#39; m (x:xs) 
    | m == x = True 
    | otherwise = elem&#39; m xs
</code></pre>
<pre><code class="haskell">dropBlank&#39; :: String -&gt; String
dropBlank&#39; [] = []
dropBlank&#39; (x:xs)
    | x == &#39; &#39; = &quot;&quot; ++ dropBlank&#39; xs
    | otherwise = x:dropBlank&#39; xs
</code></pre>
<p><strong>quick sort</strong></p>
<pre><code class="haskell">quicksort :: Ord a =&gt; [a] -&gt; [a]
quicksort [] = []
quicksort (x:xs) =
    let smallsort = quicksort [m | m &lt;- xs, m &lt;= x]
        bigsort = quicksort [m | m &lt;- xs, m &gt; x]
    in smallsort ++ [x] ++ bigsort
</code></pre>
<h2 id="modules-import"><a href="#modules-import" class="headerlink" title="modules import"></a>modules import</h2><p>syntax for importing modules</p>
<pre><code class="haskell">-- in haskell file
-- in this way, we can call the module&#39;s function name directly
import module_name

-- in ghci
:m + module_name

-- import some of function in module
import module_name (func1,func2)

-- import all function in module expect someone
import module_name hiding (func)

-- in some case, two or more modules contains the function with the same name
-- in order to distinguish the function, we can use qualified keyword
-- if the module imported with qualified, the way to call function need to 
-- be prefixed with module name
import qualified module_name
-- call function
module_name.func

-- in order to simplify above calling style, we can use alias to instead the 
-- long syntax of calling function
import qualified module_name as alias_name
-- call function
alias_name.func
-- eg:
import qualified Data.Map as M
M.filter
</code></pre>
<h2 id="higher-order-function"><a href="#higher-order-function" class="headerlink" title="higher order function"></a>higher order function</h2><p><strong>curried function</strong></p>
<p>another part that function program is different with other language is <code>curried function</code> (one function takes more than one parameters). it is a <code>concept </code> which helps us to think functions in another way. in order to understand the concept, we need to know the following point:</p>
<ol>
<li>putting a space between two things is simply <code>function application</code></li>
<li>every function in haskell officially only takes one parameter</li>
<li>if a function need more than one parameters, the one we write that function with too few parameters is called <code>function on the fly (or called partial application)</code> . we can pass it to another function as parameter</li>
</ol>
<p>so, we may though, okay, i know that’s it, and what does it helpful for my coding? let’s see this function and you will understand how powerful this concept</p>
<pre><code class="haskell">-- * is also a function which need two parameters
-- (*2) is a function on the fly
plus2 xs = map (*2) xs

-- / is a function which need two parameters
-- (/10) is a function on the fly
divideByTen x = (/10) x
</code></pre>
<p>if without curried function, above may need to be write as this</p>
<pre><code class="haskell">sum&#39; (x:xs) = x + sum&#39; xs
plus2 xs = map (\x -&gt; x*2) xs
</code></pre>
<p>with this concept we can though a function with many parameters is a function take one parameter then return a new function, the new function takes another parameter and then return a new function and so on…</p>
<pre><code class="haskell">multithree :: Num a =&gt; a -&gt; a -&gt; a -&gt; a
multithree x y z = x * y * z

-- with curried function concept, we can write type as this
multithree :: Num a =&gt; a -&gt; (a -&gt; (a -&gt; a))
multithree x y z = x * y * z
</code></pre>
<blockquote>
<p>Note:</p>
<p>function on the fly don’t means a function only takes one parameter,  it can take more than one parameter. both of them can be called function on the fly.</p>
<p>eg: <code>multithree x</code> is a function on the fly, <code>multithree x y</code> is also a function on the fly</p>
</blockquote>
<p><em>variable name of function on the fly</em></p>
<p>have we notice that a function takes one (or more) parameter <strong>returns a new function</strong>, how great this means? now we can write above function like this:</p>
<pre><code class="haskell">plus2 = map (*2)
divideByTen = (/10)
</code></pre>
<blockquote>
<p>Note:</p>
<p><strong>it is not means we ignore function parameters, left side is just a new function name (yeah a variable)</strong></p>
<p>in this way, function can be greatly simplified.</p>
</blockquote>
<p><strong>function as a parameter</strong></p>
<p>we know that function can take function as parameter and also return functions</p>
<pre><code class="haskell">applyTwice :: (a -&gt; a) -&gt; a -&gt; a  
applyTwice f x = f (f x)  

-- then we can pass function to it
applyTwice (3:) 1
</code></pre>
<p>notice that the function we pass to it is a function on the fly. in this way we abstract function as a variable or called parameter, so we can pass different function to it.</p>
<pre><code class="haskell">zipWith&#39; :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
zipWith&#39; _ [] _ = []
zipWith&#39; _ _ [] = []
zipWith&#39; f (x:xs) (y:ys) = f x y : zipWith&#39; f xs ys
</code></pre>
<p><strong>higher order function</strong></p>
<pre><code class="haskell">-- combine two list into one list with specified function
zipWith f x y

zipWith&#39; :: (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
zipWith&#39; _ [] _ = []
zipWith&#39; _ _ [] = []
zipWith&#39; f (x:xs) (y:ys) = f x y : zipWith&#39; f xs ys

-- apply specified function to all elements of list
map f x

map&#39; :: (a -&gt; b) -&gt; [a] -&gt; [b]
map&#39; _ [] = []
map&#39; f (x:xs) = f x : map&#39; f xs

-- filter all list elements to specified function
filter f x

filter&#39; :: (a -&gt; Bool) -&gt; [a] -&gt; [a]
filter&#39; _ [] = []
filter&#39; f (x:xs)
    | f x = x : filter&#39; f xs
    | otherwise = filter&#39; f xs
</code></pre>
<p><strong>lambda</strong></p>
<p>we know higher order function need a parameter of function, normally, we pass a lambda to it.</p>
<pre><code class="haskell">-- syntax
(\parameter1 parameter2 -&gt; function body)
</code></pre>
<blockquote>
<p>Note</p>
<p>partial application can do the same thing as lambda when the function is simple. so consider use partial application first if it can</p>
</blockquote>
<pre><code class="haskell">-- we can do simple pattern match in lambda
map (\(a,b) -&gt; a + b) [(1,2),(3,4),(4,5),(5,6)]
</code></pre>
<p><strong>fold</strong></p>
<p>some functions encapsulate common pattern <code>(x:xs)</code> with edge condition (such as map) and return one value are called fold.</p>
<pre><code class="haskell">-- fold function need a start value and a accumulator
-- eg : start value &quot;False&quot; accumulator &quot;acc&quot;
elem&#39; :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool 
elem&#39; m xs = foldl (\acc x -&gt; if m == x then True else acc) False xs

-- this function can be simplified to 
elem&#39; :: (Eq a) =&gt; a -&gt; [a] -&gt; Bool 
elem&#39; m = foldl (\acc x -&gt;  m == x || acc) False
</code></pre>
<p><code>foldl</code> work though list from left, <code>foldr</code> work though list from right. </p>
<pre><code class="haskell">sum&#39; xs = foldl (\acc x -&gt; acc + x) 0 xs

sum&#39; xs = foldr (\x acc -&gt; x + acc) 0 xs
</code></pre>
<p><code>acc</code>‘s position is very important.</p>
<pre><code class="haskell">-- foldr will take start value as the second parameter
map&#39; f xs = foldr (\x acc -&gt; f x : acc) [] xs
-- foldl will take start value as the first parameter
map&#39; f xs = foldl (\acc x -&gt; acc ++ [f x]) [] xs
</code></pre>
<p><code>foldl1</code> <code>foldr1</code> almost the same as <code>foldl</code> <code>foldr</code>. only <code>foldl1</code> and <code>foldr1</code> take list’s first/last value as the starting value, so we don’t need to write. with this, we need to confirm the list is not empty, or it may crash</p>
<pre><code class="haskell">sum&#39; xs = foldl1 (\acc x -&gt; acc + x) xs
sum&#39; xs = foldr1 (\x acc -&gt; x + acc) xs
</code></pre>
<p><strong>function application with $</strong></p>
<p>function application with <code>$</code> is right-associative, which act as <code>()</code></p>
<pre><code class="haskell">sum ([1..10] ++ [2..20])
-- with $
sum $ [1..10] ++ [2..20]
</code></pre>
<p><strong>function composition with .</strong></p>
<p>function composition with <code>.</code> compose two functions into one, and it is also right-associative</p>
<pre><code class="haskell">f . g = \x f (g x)
</code></pre>
<pre><code class="haskell">map (\x -&gt; (+1) (x/10)) [1..10]
map ((+1) . (/10)) [1..10]
</code></pre>
<blockquote>
<p>Note:</p>
<ol>
<li><p>the principle that we can write compose function is the right function return value’s type is the same as left function parameter</p>
</li>
<li><p>if the right function takes more than one value, we need pass other parameters to the function</p>
</li>
</ol>
</blockquote>
<pre><code class="haskell">show . replicate 3 . max 6 $ 8
</code></pre>
<h2 id="type-and-typeclass-1"><a href="#type-and-typeclass-1" class="headerlink" title="type and typeclass"></a>type and typeclass</h2><p>so, what the data type can help me?</p>
<ol>
<li>with value constructor, help me to store data with associate relationship and with default method to get them out</li>
<li>without value constructor, help me to store data with the value name</li>
</ol>
<h3 id="data-type"><a href="#data-type" class="headerlink" title="data type"></a>data type</h3><p>haskell has already provided us basic data type like <code>Int, Float, Bool, String</code>. we can also define ourself data type</p>
<pre><code class="haskell">-- syntax: 
-- type_name should be capital case
data type_name = value_constructor
</code></pre>
<h3 id="value-parameter"><a href="#value-parameter" class="headerlink" title="value parameter"></a>value parameter</h3><p>after value constructor, we can add some data types define the value it will contain</p>
<pre><code class="haskell">-- Circle , Rectangle are value constructor
data Shape = Circle Float Float Float | Rectangle Float Float Float Float 
</code></pre>
<blockquote>
<p>Note:</p>
<ol>
<li><p>we can thought value constructor as function, it returns a data type</p>
</li>
<li><p>however we can not directly call value constructor, because it has no method to display our data.</p>
</li>
<li><p>we can apply <em><strong><code>deriving (basic typeclass)</code></strong></em> to data type, then the data type will has the properity of basic typeclass</p>
</li>
<li><p>we can use pattern match with value constructor</p>
</li>
</ol>
</blockquote>
<pre><code class="haskell">data Shape = Circle Float Float Float | Rectangle Float Float Float Float deriving (Show)

surface :: Shape -&gt; Float
surface (Circle _ _ r) = pi * r ^ 2
surface (Rectangle x1 y1 x2 y2) = (abs $ x1 -x2) * (abs $ y1 -y2)
</code></pre>
<pre><code class="haskell">*Main&gt; surface $ Circle 3 4 5
78.53982
*Main&gt; Circle 3 4 5
Circle 3.0 4.0 5.0
</code></pre>
<p>for value constructor can act as function, we can use partial application with it</p>
<pre><code class="haskell">*Main&gt; map (Circle 3 4) [1..5]
[Circle 3.0 4.0 1.0,Circle 3.0 4.0 2.0,Circle 3.0 4.0 3.0,Circle 3.0 4.0 4.0,Circle 3.0 4.0 5.0]
</code></pre>
<blockquote>
<p>Note:</p>
<p>often we write data type name  the same as value constructor name if there is only one value constructor</p>
</blockquote>
<pre><code class="haskell">data Point = Point Float Float deriving (Show)
</code></pre>
<p>we can use the data type in other data type define</p>
<pre><code class="haskell">data Shape = Circle Point Float | Rectangle Point Point deriving (Show)
</code></pre>
<p>in this way, we can make Shape data type more readable</p>
<pre><code class="haskell">surface :: Shape -&gt; Float
surface (Circle _ r) = pi * r ^ 2
surface (Rectangle (Point x1 y1) (Point x2 y2)) = (abs $ x1 -x2) * (abs $ y1 -y2)
</code></pre>
<h3 id="record-syntax"><a href="#record-syntax" class="headerlink" title="record syntax"></a>record syntax</h3><p>the way above data type define is not bad, but there are some inconvenient : </p>
<p>such as :</p>
<ol>
<li><p>how to get the value of a data type?  </p>
</li>
<li><p>how to easily distinguish each value?</p>
</li>
</ol>
<pre><code class="haskell">-- sign each type a variable name, seperate with comma
data Person = Person &#123; age :: Int  
                     , height :: Float  
                     , phoneNumber :: String  
                     &#125; deriving (Show)   
</code></pre>
<p>By using record syntax to create this data type, Haskell <em><strong>automatically make these functions with the name of type name:</strong></em> age height phoneNumber</p>
<blockquote>
<p>Note:</p>
<p><strong>with the default method, we can get specified value we need out of the data type</strong></p>
</blockquote>
<pre><code class="haskell">john = Person &#123;age=20, height=170, phoneNumber=&quot;2837109292&quot;&#125;

*Main&gt; age john
20
*Main&gt; phoneNumber john
&quot;2837109292&quot;

class = map (Person 20 170) [&quot;4532232&quot;, &quot;9023482&quot;, &quot;0923842&quot;]
*Main&gt; map phoneNumber classes
[&quot;4532232&quot;,&quot;9023482&quot;,&quot;0923842&quot;]
*Main&gt; phoneNumber $ classes !! 0
&quot;4532232&quot;
</code></pre>
<h3 id="type-parameter"><a href="#type-parameter" class="headerlink" title="type parameter"></a>type parameter</h3><p>the same as value parameter,  <em><strong>type constructors</strong></em> can take types as parameters to produce new types</p>
<pre><code class="haskell">-- eg: a after Maybe is a type parameter
data Maybe a = Nothing | Just a  
</code></pre>
<p>with a parameter, we call data type as <strong>data constructor</strong></p>
<p>the benefit of type parameter is that the data type depends on what we pass to it.</p>
<pre><code class="haskell">data Person a b c = Person &#123; age :: a  
                             , height :: b  
                             , phoneNumber :: c  
                             &#125; deriving (Show) 
</code></pre>
<p>without value constructor store data with value name</p>
<pre><code class="haskell">data Day = Monday | Tuesday | Wednesday | Thursday | Friday | Saturday | Sunday   
    deriving (Eq, Ord, Show, Read, Bounded, Enum)  
</code></pre>
<pre><code class="haskell">Monday --with Show, call directly
Monday == Monday --with Eq, compare directly
read &quot;Monday&quot; :: Day --with Read, convert value from String
MinBound --with Bounded, get min/max value
[Monday..Sunday] --with Enum, list range with value
</code></pre>
<h3 id="type-synonyms"><a href="#type-synonyms" class="headerlink" title="type synonyms"></a>type synonyms</h3><p>data type’s alias, with it we can make our type declaration more clearly</p>
<pre><code class="haskell">-- String is alias of [Char]
type String = [Char]
</code></pre>
<pre><code class="haskell">-- can have parameters
type AssocList k v = [(k,v)]  
-- can partically apply type parameters
type IntMap v = Map Int v  
-- or ignore
type IntMap = Map Int  
</code></pre>
<h2 id="third-module"><a href="#third-module" class="headerlink" title="third module"></a>third module</h2><p><a target="_blank" rel="noopener" href="https://hackage.haskell.org/packages/">haskell官方</a>提供了丰富的模块，可以根据需要选择对应的模块进行下载。</p>
<h3 id="Shell-Script"><a href="#Shell-Script" class="headerlink" title="Shell Script"></a>Shell Script</h3><p>haskell的<code>turtle</code>模块嵌入了shell脚本，实现了很多的unix命令，方便我们使用haskell写shell脚本。同时还支持直接调用系统的命令</p>
<pre><code class="shell"># install turtle in archlinux
pacman -S haskell-turtle
</code></pre>
<p><strong>print text to screen</strong></p>
<pre><code class="haskell">-- 不使用turtle模块,使用内置的System.IO
main = do
    putStrLn &quot;hello world!&quot;
    print &quot;hello world!&quot;
    
-- 使用turtle模块的echo命令
import Turtule
import qualified Data.Text as T
import Data.Maybe

main = do
    -- echo 需要Line数据类型,使用repr可获得Line
    echo $ repr &quot;hello world!&quot;
    -- 或者使用Data.Text来获取Text，使用textToLine获取Maybe Line,使用fromJust 获取Line
    -- 需要导入Data.Maybe Data.Text
    echo $ fromJust $ textToLine $ T.pack &quot;hello world!&quot;
</code></pre>
<p>上面这种方式太麻烦，实际上是在文件开头添加<code>&#123;-# LANGUAGE OverloadedStrings #-&#125;</code>，这样String会成为Text类型</p>
<pre><code class="shell">&#123;-# LANGUAGE OverloadedStrings #-&#125;

import Turtle

main = do
    shell &quot;ls -alh /home&quot; empty
</code></pre>
<p><strong>get command output</strong></p>
<pre><code class="haskell">import Turtle

main = do
    dir &lt;- pwd 
    echo $ repr dir

    time &lt;- date 
    echo $ repr time
</code></pre>
<p><strong>execute system command</strong></p>
<pre><code class="haskell">import Turtle
import qualified Data.Text as T

main = do
    -- 打开浏览器
    -- shell需要接受一个Text数据类型
    let cmd = T.pack &quot;firefox&quot;
    shell cmd empty
    
    -- ps查看进程
    shell (T.pack &quot;ps -ef |grep firefox&quot;)  empty
    
    -- 调用ls命令，内置的ls命令无法添加参数，使用这种方式可以加参数
    shell (T.pack &quot;ls -alh $HOME&quot; |grep rc)  empty
</code></pre>
<h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><h4 id="problem-of-dynamic-link"><a href="#problem-of-dynamic-link" class="headerlink" title="problem of dynamic link"></a>problem of dynamic link</h4><p><strong>Err：</strong>vscode中运行正常，但是编译报错无法找到Prelude</p>
<p><img src=".images/image-20210527200039979.png" alt="image-20210527200039979"></p>
<p><strong>Cause:</strong> <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Haskell#Configuration">ghc 8.0.2-1</a>版本只支持动态链接库，而编译默认使用的是静态链接。</p>
<p><strong>Fix:</strong></p>
<ol>
<li><p>编译的时候添加动态链接参数</p>
<pre><code class="shell">ghc --dynamic file_name.hs
</code></pre>
<p>为了方便，可以用alias重写ghc</p>
<pre><code class="shell"># add to ~/.zshrc
alias ghc=&quot;ghc -dynamic&quot;
</code></pre>
<ol start="2">
<li>配置cabal/stack使用动态库，配置方法参考<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Haskell#Configuration">arch wiki</a></li>
</ol>
</li>
</ol>
<h4 id="cannot-find-module-which-has-been-installed"><a href="#cannot-find-module-which-has-been-installed" class="headerlink" title="cannot find module which has been installed"></a>cannot find module which has been installed</h4><p><strong>Err:</strong> 使用cabal安装模块后，依然无法导入，报错无法找到模块</p>
<p><strong>Cause:</strong> 在安装cabal之前系统已经存在ghc，导致安装cabal时编译的是系统的ghc</p>
<p><strong>Fix：</strong>解决方法很简单，使用系统的ghc就可以了（注释掉安装时配置的环境变量）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/haskell/" data-id="cl9ktb7v0000ydta8a9l2chc3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/haskell/" rel="tag">haskell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-go" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/go/" class="article-date">
  <time datetime="2022-04-23T15:02:12.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/go/">go</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="GO"><a href="#GO" class="headerlink" title="GO"></a>GO</h1><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>follow <a target="_blank" rel="noopener" href="https://golang.org/doc/install">this document</a>, download compressed file and extract to the place where application stores.</p>
<pre><code class="shell"># i install go in .local/apps.
tar -xzf Downloads/go1.16.3.linux-amd64.tar.gz -C .local/apps
</code></pre>
<p>configure go env</p>
<pre><code class="shell"># add to /etc/profile or ~/.zshrc. i put it in .xinitrc
export PATH=$PATH:/home/blueocean/.local/apps/go/bin
</code></pre>
<p>after source configure file we can check whether it makes effect</p>
<pre><code class="shell">go env
</code></pre>
<h2 id="config-workspace"><a href="#config-workspace" class="headerlink" title="config workspace"></a>config workspace</h2><p><code>GOPATH</code> is the place of our workspace which can be find by running <code>go env</code>, we can change it by running</p>
<pre><code class="shell">go env -w GOPATH=&quot;$HOME/Public/code/go&quot;
</code></pre>
<p>the command will write go environment variable to <code>~/.config/go/env</code> file.</p>
<p>below is the standard workspace structure</p>
<pre><code class="shell">Public/code/go
├── bin
├── pkg
└── src
    └── github.com
        └── blueocean
            └── go_project_1
                └── helloworld
                    └── main.go
</code></pre>
<ul>
<li>bin: compiled file stores, when we run <code>go install xx.go</code> will create binary file to the folder</li>
<li>pkg: other people package, the package/module we download will store in the folder</li>
<li>src: source code file, the place we write go code</li>
</ul>
<p>why there are github.com/username? it is useful when we work in a team. the folder name is the same as github.</p>
<h2 id="vscode-go-plugin"><a href="#vscode-go-plugin" class="headerlink" title="vscode go plugin"></a>vscode go plugin</h2><p>i will write code with vscode editor, first install <code>go</code> extension. then when we write go code, there will be a prompt suggests us to install other extensions. and just click install all. however it may failed because we can not access github file in our country.</p>
<p>but there comes a method can resolve this problem with proxy. <code>goproxy.io</code> is a proxy of go</p>
<pre><code class="shell">go env -w GO111MODULE=on
go env -w GOPROXY=https://goproxy.io,direct
</code></pre>
<p>then reinstall all will be fine</p>
<blockquote>
<p>Note:</p>
<p>while install go plugin, there comes a error message: <strong>Writing login information to the keychain failed with error ‘The name org.freedesktop.secrets was not provided by any .service files’.</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/MicrosoftDocs/live-share/issues/224">resolve method:</a></p>
<pre><code class="shell">sudo pacman -S gnome-keyring libsecret
</code></pre>
</blockquote>
<h2 id="run-or-compile-file"><a href="#run-or-compile-file" class="headerlink" title="run or compile file"></a>run or compile file</h2><p>though go is a compile language, go tools allow us to run code without compile. we can just type</p>
<pre><code class="shell">go run go_file.go
</code></pre>
<p>if we wanna to compile it to binary file</p>
<pre><code class="shell"># this will product a binary file in current location
go build go_file.go
</code></pre>
<p>we can also compile file with <code>go install</code>, and it will put binary file to bin directory</p>
<pre><code class="shell">go install go_file.go
</code></pre>
<h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h2><pre><code class="go">package main

import &quot;fmt&quot;

func main() &#123;
    fmt.Println(&quot;hello world!&quot;)
&#125;
</code></pre>
<p>we need to know that in an application there are many go files and each of them need to belong to a package. the name of package can be customized, however there must to be a package name main for progarm will start running with this file. and there must be a function named main for program will start running with main function.</p>
<p>we can import other packages by keyword <code>import</code>. neither build in packages or download from internet with <code>go get</code></p>
<pre><code class="go">import &quot;fmt&quot;
import &quot;math&quot;

// or use parenthense
import (
    &quot;fmt&quot;
    &quot;math&quot;
)
</code></pre>
<h2 id="naming-rule"><a href="#naming-rule" class="headerlink" title="naming rule"></a>naming rule</h2><p><strong>in Go, a name is exported if it begins with a capital letter.</strong></p>
<ul>
<li>function name and variable always begins with lowercase。</li>
<li>except the package need to be imported by other packages as a module, then function name begin with capital letter</li>
</ul>
<h2 id="constan"><a href="#constan" class="headerlink" title="constan"></a>constan</h2><p>the value that can not be changed is called constan. we can define it by <code>const</code></p>
<pre><code class="go">const name = &quot;john&quot;
</code></pre>
<h2 id="variables"><a href="#variables" class="headerlink" title="variables"></a>variables</h2><p>as we know go is a compile language, we need to define a variable before we use it.</p>
<p>there are two principles we need follow:</p>
<ol>
<li>define a variable before we use it.</li>
<li>every defined variable need to be used</li>
</ol>
<p>there are three ways to define a variable:</p>
<ol>
<li><p>use var keyword</p>
<pre><code class="go">var variable_name type
</code></pre>
<p>eg:</p>
<pre><code class="go">var name string
var age int
var high float32
var ptr *int
</code></pre>
</li>
<li><p>initialize without type</p>
<pre><code class="go">var variable_name = value
</code></pre>
<p>eg:</p>
<pre><code class="go">var name = &quot;Azon&quot;
var age = 12
var ptr = &amp;age
</code></pre>
</li>
<li><p>inside function use short sign</p>
<blockquote>
<p>Note:</p>
<p>this method can only used inside function</p>
</blockquote>
<pre><code class="go">variable_name := value
</code></pre>
<p>eg:</p>
<pre><code class="go">name := &quot;Azon&quot;
age := 12
ptr = &amp;age
</code></pre>
</li>
</ol>
<p>define same type variables in one line</p>
<pre><code class="go">var name, age int
</code></pre>
<p>define serveral variables with parentheses</p>
<pre><code class="go">var (
    name string
    age int
    ptr *int
)
// or sign value
var (
    name = &quot;Azon&quot;
    age = 12
    ptr = &amp;age
)
</code></pre>
<blockquote>
<p>note:</p>
<p>​    second and third used often. and third can only be used in function</p>
</blockquote>
<h2 id="basic-type"><a href="#basic-type" class="headerlink" title="basic type"></a>basic type</h2><pre><code class="go">bool

string

int  int8  int16  int32  int64
uint uint8 uint16 uint32 uint64 uintptr

byte // alias for uint8

rune // alias for int32
     // represents a Unicode code point

float32 float64

complex64 complex128
</code></pre>
<h2 id="array"><a href="#array" class="headerlink" title="array"></a>array</h2><p>the length of array is part of array’s type. and the size can not be changed</p>
<p><strong>define array with fixed size</strong></p>
<pre><code class="go">var array_name [length]type
</code></pre>
<p><strong>define array with values</strong></p>
<pre><code class="go">var array_name = [length]type &#123;value1, value2...&#125;
// or use `...`, in this way the length of array is the initial length of value elements. it may common to use
var array_name = [...]type&#123;v1,v2,v3,v4&#125;
</code></pre>
<p><strong>use short syntax</strong></p>
<pre><code class="go">array_name := [length]type &#123;value1, value2...&#125;
</code></pre>
<p><strong>change array value</strong></p>
<pre><code class="go">nums := [2]int&#123;1, 2&#125;
nums[0] = 2
</code></pre>
<p><strong>array index</strong></p>
<pre><code class="go">arr[0] //first
arr[len(arr)-1] //last
</code></pre>
<p><strong>two ways to loop array value</strong></p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
)

func main() &#123;
    dataJson := [...]string&#123;&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;1&quot;, &quot;2&quot;, &quot;3&quot;&#125;
    // range
    for _, v := range dataJson &#123;
        fmt.Println(v)
    &#125;
    // index
    for i := 0; i &lt; len(dataJson); i++ &#123;
        fmt.Println(dataJson[i])
    &#125;
&#125;
</code></pre>
<p><strong>compare two arrays</strong></p>
<p>if the element type of the array is comparable, then the array type is also compartable</p>
<pre><code class="go">package main

import &quot;fmt&quot;

func main() &#123;
    arr1 := [...]int&#123;1, 2, 3&#125;
    arr2 := [3]int&#123;1, 2, 3&#125;
    fmt.Println(arr1 == arr2)
&#125;
</code></pre>
<h2 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h2><p>slice is the reference of array, it doesn’t store any data but the describe of data. </p>
<ul>
<li>no specified size</li>
<li>change slice will change array which slice describes</li>
</ul>
<p><strong>define array with changeable length</strong></p>
<p>slice <code>[]type&#123;v1,v2,v3&#125;</code> truely creates an array <code>[3]type&#123;v1,v2,v3&#125;</code> and then builds a slice that references it</p>
<pre><code class="go">var slice_name = []type&#123;value1, value2...&#125;

// or
slice_name := []type&#123;value1, value2...&#125;

// use pointer
slice_name := &amp;[]type&#123;&#125;

// specified with exist array
var array_name = [3]int&#123;v1,v2,v3&#125;
slice_name1 := array_name[0:2]
slice_name2 := array_name[:]
slice_name3 := array_name[0:]
slice_name4 := array_name[:2]

// use make to create slice
slice_name := make([]type, len_of_array, cap_of_array)
// eg:
num := make([]int, 0, 5)
</code></pre>
<pre><code class="go">package main

import &quot;fmt&quot;


func main() &#123;
    var num = [4]int&#123;1, 2, 3, 4&#125;
    a := num[0:4]
    a[0] = 8
    fmt.Println(num)
&#125;
//[8 2 3 4]
</code></pre>
<p><strong>add value to changeable length array</strong></p>
<pre><code class="go">nums := []int&#123;1, 2&#125;
nums = append(nums, 3)
</code></pre>
<p><strong>slice has length and capacity</strong></p>
<ul>
<li><p>The length of a slice is the number of elements it contains.  </p>
</li>
<li><p>The capacity of a slice is the number of elements in the underlying array,     counting from the first element in the slice.  </p>
</li>
</ul>
<pre><code class="go">var sum = []int&#123;1, 2, 3, 4, 5&#125;
num := sum[:0]
fmt.Println(len(num), cap(num))
</code></pre>
<p><strong>slice of slice</strong></p>
<pre><code class="go">package main

import &quot;fmt&quot;

func main() &#123;
    nums := [][]int&#123;
        []int&#123;&#125;,
        []int&#123;&#125;,
        []int&#123;&#125;,
    &#125;
    fmt.Println(nums)
&#125;
// [[] [] []]
</code></pre>
<h2 id="nil"><a href="#nil" class="headerlink" title="nil"></a>nil</h2><p>The <strong>zero value</strong> of a slice is <code>nil</code>.  </p>
<p>A nil slice has a <strong>length</strong> and <strong>capacity</strong> of <strong>0</strong>  and has <strong>no underlying array.</strong>  </p>
<pre><code class="go">package main

import &quot;fmt&quot;

func main() &#123;
    var num []int
    if num == nil &#123;
        fmt.Println(num, len(num), cap(num))
    &#125;
&#125;
</code></pre>
<h2 id="range"><a href="#range" class="headerlink" title="range"></a>range</h2><p><code>_</code> used to ignore some value</p>
<pre><code class="go">package main

import &quot;fmt&quot;

func main() &#123;
    nums := [][]int&#123;
        []int&#123;1, 2, 3&#125;,
        []int&#123;4, 5, 6&#125;,
        []int&#123;7, 8, 9&#125;,
    &#125;
    fmt.Println(nums)
    for _, v := range nums &#123;
        fmt.Println(v)
    &#125;
&#125;
</code></pre>
<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><pre><code class="go">// define syntax
var map_name = make(map[key_type]value_type)
</code></pre>
<pre><code class="go">var student = make(map[string]int)
student[&quot;xiaozhan&quot;] = 23
student[&quot;xiaoli&quot;] = 22
fmt.Println(student, student[&quot;xiaozhan&quot;])

// without define
var student = map[string]int&#123;
    &quot;xiaozhan&quot;: 23,
    &quot;xiaoli&quot;:   22,
&#125;
fmt.Println(student, student[&quot;xiaozhan&quot;])
</code></pre>
<p>however the way map most useful is combining with struct</p>
<pre><code class="go">import &quot;fmt&quot;

type People struct &#123;
    name      string
    age       int
    graduate  bool
    email     string
    address   string
    telephone string
&#125;

func main() &#123;
    var student = map[int]People&#123;
        1: &#123;&quot;xiaozhan&quot;, 12, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;,
        2: &#123;&quot;johnsemi&quot;, 23, false, &quot;johnsemi@gmail.com&quot;, &quot;American&quot;, &quot;98234222&quot;&#125;,
    &#125;

    // update value
    student[1] = People&#123;&quot;xiaozhan&quot;, 18, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;
    fmt.Println(student[1].age)

    // delete element
    delete(student,2)

    // check whether key exist
    _, exist := student[2]
    fmt.Println(exist)
&#125;
</code></pre>
<blockquote>
<p>Note: </p>
<p>can’t change values associated with keys in a map, only if we use pointer</p>
</blockquote>
<pre><code class="go">package main

import &quot;fmt&quot;

type People struct &#123;
    name      string
    age       int
    graduate  bool
    email     string
    address   string
    telephone string
&#125;

func main() &#123;
    var student = map[int]*People&#123;
        1: &#123;&quot;xiaozhan&quot;, 12, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;,
        2: &#123;&quot;johnsemi&quot;, 23, false, &quot;johnsemi@gmail.com&quot;, &quot;American&quot;, &quot;98234222&quot;&#125;,
    &#125;
    student[1] = &amp;People&#123;&quot;xiaozhan&quot;, 18, true, &quot;129381@qq.com&quot;, &quot;China&quot;, &quot;1337649393&quot;&#125;
    student[1].age = 22
    fmt.Println(student[1].age)
&#125;
</code></pre>
<h2 id="struct"><a href="#struct" class="headerlink" title="struct"></a>struct</h2><p>A <code>struct</code> is a collection of fields.  </p>
<ul>
<li>Struct fields are accessed using a dot.</li>
<li>Struct fields can be accessed through a struct pointer.  and has a short write <code>(*p).x</code> with <code>p.x</code></li>
<li>Struct literal  used to make new data field</li>
</ul>
<pre><code class="go">package main

import &quot;fmt&quot;

type People struct &#123;
    name  string
    age   int
    email string
&#125;

func main() &#123;
    no1 := People&#123;&quot;xiaoming&quot;, 12, &quot;823739@qq.com&quot;&#125;
    no2 := People&#123;name: &quot;xiaozhan&quot;, age: 13&#125;
    no3 := &amp;People&#123;age: 12&#125;
    fmt.Println(no1, no1.age+no2.age, no3.age)
&#125;
</code></pre>
<h2 id="for-loop"><a href="#for-loop" class="headerlink" title="for loop"></a>for loop</h2><p>in golang, there is no while loop, however for loop can do the same thing as while.</p>
<pre><code class="go">// infinite loop
for &#123;

&#125;

// for each
for i,v := range xxx &#123;

&#125;

// break or continue
for &#123;
    if ...... &#123;
        break
    &#125; else &#123;
        continue
    &#125;
&#125;
</code></pre>
<h2 id="basic-function"><a href="#basic-function" class="headerlink" title="basic function"></a>basic function</h2><p>the way to define function with keyword <code>func</code></p>
<pre><code class="go">func func_name(arg type) return_type &#123;
    //function content
&#125;

// more than one return value use `()`
func func_name(arg1 type, arg2 type) (return_type, return_type) &#123;
    //function content
&#125;

// named return
// combine same type
func func_name(arg1, arg2 type) (x,y return_type) &#123;
    x = xxx
    y = xxx
    return
&#125;
</code></pre>
<p>eg:</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
)

func sum(a, b int) int &#123;
    return a + b
&#125;

func reverse(a, b string) (string, string) &#123;
    return b, a
&#125;

func minormax(a, b int) (max1, min1 int) &#123;
    var max, min int
    if a &gt; 0 &amp;&amp; b &gt; 0 &#123;
        if a &gt; b &#123;
            max = a
            min = b
        &#125; else &#123;
            max = b
            min = a
        &#125;
        for i := min; i &gt; 1; i-- &#123;
            if max%i == 0 &amp;&amp; min%i == 0 &#123;
                max1 = i
            &#125;
        &#125;
        for i := max; i &gt; 0; i++ &#123;
            if i%max == 0 &amp;&amp; i%min == 0 &#123;
                min1 = i
                // add break here or it cannot stop
                break
            &#125;
        &#125;
    &#125;
    return
&#125;

func main() &#123;
    a := sum(1, 2)
    b, c := reverse(&quot;hello&quot;, &quot;world&quot;)
    d, e := minormax(8, 10)
    fmt.Println(a, &quot;\t&quot;, b, c, &quot;\t&quot;, d, e)
&#125;
</code></pre>
<h2 id="usage"><a href="#usage" class="headerlink" title="... usage"></a><code>...</code> usage</h2><p>two ways:</p>
<ul>
<li>pass <code>...</code> before function input type: this way can let function accept values which the number we are not sure</li>
<li>pass <code>...</code> after array/slice: this way can parse them out of array/slice without <code>for</code> loop</li>
</ul>
<pre><code class="go">// pass ... to function type
package main

import &quot;fmt&quot;

func Sum(a ...float32) float32 &#123;
    var sum float32 = 0
    for _, v := range a &#123;
        sum = sum + v
    &#125;
    return sum
&#125;

func main() &#123;
    fmt.Println(Sum(56, 78, 60.5, 89.5, 93, 76))
    // or 
    // fmt.Println(Sum(score...))
&#125;
</code></pre>
<pre><code class="go">// pass ... to array/slice
package main

import &quot;fmt&quot;

func main() &#123;
    score := []float32&#123;56, 78, 60.5, 89.5, 93, 76&#125;
    var array = []float32&#123;&#125;
    array = append(array, score...)
    fmt.Println(array)
&#125;
</code></pre>
<h2 id="function-value"><a href="#function-value" class="headerlink" title="function value"></a>function value</h2><ul>
<li>Functions are values too. They can be passed around just like other values.  </li>
<li>Function values may be used as function arguments and return values.  </li>
</ul>
<pre><code class="go">package main

import &quot;fmt&quot;

func plu(fn1 func(float32, float32) float32, fn2 func(float32, float32) float32) float32 &#123;
    return fn1(2, 3) * fn2(2, 3)
&#125;

func main() &#123;
    a := func(x, y float32) float32 &#123;
        return x + y
    &#125;
    b := func(x, y float32) float32 &#123;
        return x - y
    &#125;

    c := plu(a, b)
    fmt.Println(c)
&#125;
</code></pre>
<h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><h5 id="initialize-struct-data-with-functions-and-return-a-struct-data-type"><a href="#initialize-struct-data-with-functions-and-return-a-struct-data-type" class="headerlink" title="initialize struct data with functions and return a struct data type."></a>initialize struct data with functions and return a struct data type.</h5><pre><code class="go">package main

import &quot;fmt&quot;

// define a struct type
type people struct &#123;
    name string
    age  int
&#125;

// initialize struct with function and return a struct
func who(name string, age int) *people &#123;
    people := &amp;people&#123;
        name: name,
        age:  age,
    &#125;
    return people
&#125;

// function to get struct data
func (p people) getName() string &#123;
    return p.name
&#125;

func main() &#123;
    // used like this: method().method()
    res := who(&quot;libai&quot;, 12).getName()
    fmt.Println(res)
&#125;
</code></pre>
<h5 id="read-from-file-and-write-file"><a href="#read-from-file-and-write-file" class="headerlink" title="read from file and write file"></a>read from file and write file</h5><pre><code class="go">package main

import (
    &quot;log&quot;
    &quot;os&quot;
)

func main() &#123;
    // read content form ori and write to filePath file
    var filePath string = &quot;/mnt/c/Users/qiyue/Desktop/test.txt&quot;
    var ori string = &quot;/mnt/c/Users/qiyue/Desktop/go.md&quot;

    // open write file
    new_file, err := os.OpenFile(filePath, os.O_WRONLY|os.O_TRUNC, 0777)
    defer new_file.Close()
    if err != nil &#123;
        log.Fatal(err)
    &#125;

    // open content file
    ori_file, err := os.ReadFile(ori)
    if err != nil &#123;
        log.Fatal(err)
    &#125;

    // write content
    if _, err := new_file.Write(ori_file); err != nil &#123;
        log.Fatal(err)
    &#125;
&#125;
</code></pre>
<h2 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h2><p>Go does not have classes. However, you can define methods on types.  </p>
<ul>
<li>A method is a function with a special <em>receiver</em> argument.  </li>
<li>The receiver appears in its own argument list between the <code>func</code> keyword and  the method name.</li>
</ul>
<pre><code class="go">// method with struct
type type_name struct &#123;&#125;
func (v type_name) func_name() return_type &#123;&#125;

// use method
v := type_name&#123;&#125;
v.func_name()
</code></pre>
<pre><code class="go">// method with none-struct type
type type_name value_type
func (v type_name) func_name() return_type&#123;&#125;

// use method
v := type_name()
v.func_name()
</code></pre>
<p><strong>pointer receiver</strong></p>
<pre><code class="go">// with pointer receiver, we can change struct data self
type type_name struct &#123;&#125;
func (v *type_name) func_name() return_type&#123;&#125;

// change struct data with function
v := type_name&#123;&#125;
v.func_name()
</code></pre>
<p>method with pointer receiver can be called either a value or a pointer</p>
<pre><code class="go">// method with pointer receiver
type type_name struct &#123;&#125;
func (v *type_name) func_name() return_type&#123;&#125;

// called by value
v := type_name&#123;&#125;
v.func_name()
// callled by pointer
v := &amp;type_name&#123;&#125;
v.func_name()
</code></pre>
<p>method with value receiver can be called either a value or a pointer</p>
<pre><code class="go">// normal value receiver
type type_name struct &#123;&#125;
func (v type_name) func_name() return_type &#123;&#125;

// can be call with value or pointer
v1 := type_name&#123;&#125;
v1.func_name()

v2 := &amp;type_name&#123;&#125;
v2.func_name()
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code>1. even though both can work fine, however only pointer receiver has the capacity to change struct data itself
2. pointer receiver don&#39;t copy data struct, which can minimize memory usage
</code></pre>
</blockquote>
<h2 id="interfaces"><a href="#interfaces" class="headerlink" title="interfaces"></a>interfaces</h2><p><strong>An <em>interface type</em> is defined as a set of method signatures.</strong>  </p>
<ul>
<li>A value of interface type can hold any value that implements those methods.  </li>
</ul>
<pre><code class="go">package main

import &quot;fmt&quot;

type Cal interface &#123;
    Abs() float32
&#125;

type Sum struct &#123;
    a, b float32
&#125;
// function of sum implement Cal interface
func (s *Sum) Abs() float32 &#123;
    return float32(s.a + s.b)
&#125;

type Div struct &#123;
    a, b float32
&#125;
// function of div implement Cal interface
func (d *Div) Abs() float32 &#123;
    return float32(d.a / d.b)
&#125;

func main() &#123;
    // apply any value to interface variable which has implemented interface methods
    var a Cal
    a = &amp;Sum&#123;2, 3&#125;
    fmt.Println(a.Abs())
    a = &amp;Div&#123;2, 3&#125;
    fmt.Println(a.Abs())
&#125;
//5
//0.6666667
</code></pre>
<p><strong>The interface type that specifies zero methods is known as the <em>empty interface</em></strong></p>
<pre><code class="go">interface&#123;&#125;
</code></pre>
<ul>
<li><p>An empty interface may hold values of any type.     (Every type implements at least zero methods.)  </p>
</li>
<li><p>Empty interfaces are used by code that handles values of unknown type.     For example, <code>fmt.Print</code> takes any number of arguments of type <code>interface&#123;&#125;</code>.  </p>
</li>
</ul>
<pre><code class="go">package main

import &quot;fmt&quot;

func main() &#123;
    // empty interface `interface&#123;&#125;` as a value type
    var num interface&#123;&#125;
    num = 5
    fmt.Println(num)
    num = &quot;justin&quot;
    fmt.Println(num)
&#125;
</code></pre>
<p><strong>type assertions</strong></p>
<pre><code class="go">// define a variable of empty interface
var i interface&#123;&#125;
i = &quot;hello&quot;

// use i.(type) to check the type of i is true. ok&#39;s value is true || false
_,ok := i.(type)

// eg :
package main

import &quot;fmt&quot;

func main() &#123;
    var i interface&#123;&#125;
    i = &quot;hello&quot;
    _, ok := i.(int)
    fmt.Println(ok)
&#125;
//false
</code></pre>
<p><strong>type switch</strong></p>
<p>use type assertions with <code>switch case</code> to ignore value’s type or deal value with different types.</p>
<pre><code class="go">package main

import &quot;fmt&quot;

func do(i interface&#123;&#125;) &#123;
    switch t := i.(type) &#123;
    case int:
        fmt.Println(t * 2)
    case string:
        fmt.Println(&quot;words:&quot;, t)
    default:
        fmt.Println(&quot;noknown type !&quot;)
    &#125;
&#125;

func main() &#123;
    do(20)
    do(&quot;hello world&quot;)
    do(12.232)
&#125;
</code></pre>
<blockquote>
<p>Note:</p>
<pre><code class="go">type Stringer interface &#123;
    String() string
&#125;
</code></pre>
<p><code>fmt</code> package will look for Stringer interface to print values by default. it is be defined in <code>fmt</code> package</p>
</blockquote>
<pre><code class="go">// Exercise: Stringer
// Make the IPAddr type implement fmt.Stringer to print the address as a dotted quad.
// For instance, IPAddr&#123;1, 2, 3, 4&#125; should print as &quot;1.2.3.4&quot;. 

package main

import &quot;fmt&quot;

type IPAddr [4]byte

var hosts = map[string]IPAddr&#123;
    &quot;loopback&quot;:  &#123;127, 0, 0, 1&#125;,
    &quot;googledns&quot;: &#123;8, 8, 8, 8&#125;,
&#125;

func (ip IPAddr) String() string &#123;
    return fmt.Sprintf(&quot;%v.%v.%v.%v&quot;, ip[0], ip[1], ip[2], ip[3])
&#125;

func main() &#123;
    for name, ip := range hosts &#123;
        fmt.Printf(&quot;%v:\t%v\n&quot;, name, ip)
    &#125;
&#125;
</code></pre>
<h2 id="goroutines"><a href="#goroutines" class="headerlink" title="goroutines"></a>goroutines</h2><p>A <em>goroutine</em> is a lightweight thread managed by the Go runtime.  </p>
<pre><code class="go">package main

import &quot;fmt&quot;

var num = [10]int&#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10&#125;

func main() &#123;
    for _, j := range num &#123;
        go fmt.Println(j)
        fmt.Println(j)
        fmt.Println(&quot;ordered&quot;)
    &#125;
&#125;
</code></pre>
<h2 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h2><p>Channels are a typed conduit through which you can send and receive values with the channel operator, <code>&lt;-</code>.  </p>
<pre><code class="go">// create channel
ch := make(chan int)

// send v to channel ch
ch &lt;- v
// receive from ch, and assign value to v
v := &lt;- ch
</code></pre>
<p><strong>buffered channels</strong></p>
<p>Channels can be <em>buffered</em>.  Provide the buffer length as the second argument to <code>make</code> to initialize a buffered channel:  </p>
<pre><code>ch := make(chan int, 100)
</code></pre>
<p>Sends to a buffered channel block only when the buffer is full. Receives block when the buffer is empty.  </p>
<h2 id="execute-shell-command"><a href="#execute-shell-command" class="headerlink" title="execute shell command"></a>execute shell command</h2><p>go has a built in module <code>os/exec</code>, which can execute shell command in the system.</p>
<ul>
<li><code>Output()</code>: run command and show stdout, exit code</li>
<li><code>Run()</code>: run command and wait it to finish, only show stderr</li>
<li><code>Start()</code>: run command in background, only show stderr</li>
</ul>
<pre><code class="go">// 1. use log.Printf() to pretty output with date showing
// 2. check command exists in system first
// 3. output isn&#39;t string, use string() converts
// 4. exec.Command() can not use `|` and multi commands, so 
// we need use `bash -c` to wrap multi commands and pipeline
// 5. use `return` to exit program while error appears

package main

import (
    &quot;fmt&quot;
    &quot;log&quot; // output with date
    &quot;os/exec&quot;
)

var commands = [3]string&#123;&quot;/bin/bash&quot;, &quot;ps&quot;, &quot;wc&quot;&#125;

func main() &#123;
    // LookPath to check whether the system contains this commands
    for _, c := range commands &#123;
        _, err := exec.LookPath(c)
        if err != nil &#123;
            log.Printf(&quot;%v: not find in path&quot;, c)
            return
        &#125;
    &#125;

    // Command execute, output is stream
    cmd := exec.Command(&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;ps -ef |wc -l&quot;)
    stream, err := cmd.Output()
    if err != nil &#123;
        log.Println(err)
        return
    &#125;
    // convert to character with string function
    fmt.Println(string(stream))

    // Run() don&#39;t show a stdout value
    error := exec.Command(&quot;ls&quot;, &quot;-l&quot;).Run()
    if error != nil &#123;
        log.Println(error)
    &#125;
&#125;
</code></pre>
<h2 id="find-the-type-of-variable"><a href="#find-the-type-of-variable" class="headerlink" title="find the type of variable"></a>find the type of variable</h2><p><strong>3 ways to check</strong></p>
<ul>
<li><code>Using reflect.TypeOf Function</code></li>
<li><code>Using reflect.ValueOf.Kind() Function</code></li>
<li><code>Using %T with Printf</code></li>
</ul>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;os&quot;
    &quot;reflect&quot;
)

func main() &#123;
    file, err := os.Open(&quot;./test/examples/README.md&quot;)
    defer file.Close()
    if err != nil &#123;
        log.Println(err)
    &#125;

    // first
    fmt.Printf(&quot;%T\n&quot;, file)

    // second
    tp := reflect.TypeOf(file)
    fmt.Println(tp)

    // third
    tp = reflect.ValueOf(file).Type()
    fmt.Println(tp)
&#125;
</code></pre>
<h2 id="deal-with-file"><a href="#deal-with-file" class="headerlink" title="deal with file"></a>deal with file</h2><h3 id="read-file"><a href="#read-file" class="headerlink" title="read file"></a>read file</h3><p>read file include two parts:</p>
<ol>
<li>open a file handler</li>
<li>get the content with handler</li>
</ol>
<p>however some function combine the two parts into one, and that’s fine</p>
<blockquote>
<p>Note:</p>
<p>while opening a file, need to colse it</p>
</blockquote>
<p><strong>simple open a file, leave a file handler, without dealing with it.</strong></p>
<pre><code class="go">package main

import (
    &quot;log&quot;
    &quot;os&quot;
)

func main() &#123;
    file, err := os.Open(&quot;./test/examples/README.md&quot;)
    defer file.Close()
    if err != nil &#123;
        log.Println(err)
    &#125;

    // show file state
    fmt.Println(file.Stat())
&#125;
</code></pre>
<p><strong>read whole file content with one function at once, don’t use it with large file</strong></p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;os&quot;
)

func main() &#123;
    // don&#39;t need to colse file manually
    content, err := os.ReadFile(&quot;./test/examples/README.md&quot;)
    if err != nil &#123;
        fmt.Println(err)
    &#125;
    fmt.Println(string(content))
&#125;
</code></pre>
<p><strong>read file by chunks</strong></p>
<p>we don’t take it all completely in memory but instead we load it by  chunking. It’s very important to read large files in chunk to avoid out  of memory errors.</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;log&quot;
    &quot;os&quot;
)

func main() &#123;
    file, err := os.Open(&quot;./test/examples/README.md&quot;)
    defer file.Close()
    if err != nil &#123;
        log.Print(err)
    &#125;

    // create slice
    chunk := make([]byte, 8)

    // for loop
    for &#123;
        // read content to chunk and return a chunk size
        size, err := file.Read(chunk)
        if err != nil &#123;
            if err != io.EOF &#123;
                log.Print(err)
            &#125;
            return
        &#125;
        fmt.Printf(string(chunk[:size]))
    &#125;
&#125;
</code></pre>
<p><strong>use bufio</strong></p>
<p>line by line</p>
<pre><code class="go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;os&quot;
)

func main() &#123;
    file, err := os.Open(&quot;./test/examples/README.md&quot;)
    defer file.Close()
    if err != nil &#123;
        log.Print(err)
    &#125;

    scanner := bufio.NewScanner(file)
    for scanner.Scan() &#123;
        fmt.Println(scanner.Text())
    &#125;
&#125;
</code></pre>
<p><strong>read file word by word</strong></p>
<pre><code class="go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;log&quot;
    &quot;os&quot;
)

func main() &#123;
    file, err := os.Open(&quot;./test/examples/README.md&quot;)
    defer file.Close()
    if err != nil &#123;
        log.Print(err)
    &#125;

    scanner := bufio.NewScanner(file)
    scanner.Split(bufio.ScanWords) // add one line to split line into word
    for scanner.Scan() &#123;
        fmt.Println(scanner.Text())
    &#125;
&#125;
</code></pre>
<h3 id="write-file"><a href="#write-file" class="headerlink" title="write file"></a>write file</h3><p>simplest way, easy for writing small size file</p>
<pre><code class="go">package main

import (
    &quot;fmt&quot;
    &quot;os&quot;
)

func main() &#123;
    loc := &quot;./data.txt&quot;
    file, err := os.OpenFile(loc, os.O_CREATE|os.O_APPEND|os.O_RDWR, 0755)
    if err != nil &#123;
        fmt.Println(err)
    &#125;
    defer file.Close()

    // write to file directorily
    file.WriteString(&quot;hello world!&quot;)

    // read file
    content, err := os.ReadFile(loc)
    fmt.Println(string(content))
&#125;
</code></pre>
<p>we can use bufio to write content to file, more useful for large file to write</p>
<ul>
<li>use <code>os.OpenFile()</code> for more control</li>
<li>it does a write when <code>writer.Fulsh()</code> is called</li>
</ul>
<pre><code class="go">package main

import (
    &quot;bufio&quot;
    &quot;fmt&quot;
    &quot;os&quot;
)

func main() &#123;
    // create file if none with permistion of 0755, or append to a exist file 
    loc := &quot;./data.txt&quot;
    file, err := os.OpenFile(loc, os.O_CREATE|os.O_APPEND|os.O_RDWR, 0755)
    if err != nil &#123;
        fmt.Println(err)
    &#125;
    defer file.Close()

    // store string to buffer
    writer := bufio.NewWriter(file)
    writer.WriteString(&quot;hello world!&quot;)
    if err != nil &#123;
        fmt.Println(err)
    &#125;
    // write buffer all at once to file when we use flush function
    writer.Flush()

    // reopen file to show content
    file, _ = os.Open(loc)
    scanner := bufio.NewScanner(file)
    for scanner.Scan() &#123;
        fmt.Println(&quot;text:&quot;, scanner.Text())
    &#125;
    file.Close()
&#125;
</code></pre>
<h2 id="get-request-and-json-convert"><a href="#get-request-and-json-convert" class="headerlink" title="get request and json convert"></a>get request and json convert</h2><pre><code class="go">package main

import (
    &quot;crypto/tls&quot;
    &quot;encoding/json&quot;
    &quot;fmt&quot;
    &quot;io/ioutil&quot;
    &quot;net/http&quot;
)

var URL string = &quot;https://192.168.31.214:8080&quot;
var USER string = &quot;admin&quot;
var PASSWD string = &quot;xFkwBNzwtA6ufGGLwSXzCwU8k9VGX4hcbhxemEUhBxyUkesSupynBBemEX8CK3Do&quot;

// join string
func url(api string) string &#123;
    return URL + api
&#125;

func get(url string) []byte &#123;
    http.DefaultTransport.(*http.Transport).TLSClientConfig = &amp;tls.Config&#123;InsecureSkipVerify: true&#125;

    r, err := http.NewRequest(&quot;GET&quot;, url, nil)
    r.SetBasicAuth(USER, PASSWD)

    c := &amp;http.Client&#123;&#125;
    resp, err := c.Do(r)
    if err != nil &#123;
        fmt.Println(err)
    &#125;
    defer resp.Body.Close()

    // return resp.Body, remove `[]`
    content, _ := ioutil.ReadAll(resp.Body)
    return content[1 : len(content)-2]
&#125;

// create struct to parse json, notice captial case
type Data struct &#123;
    Code             string `json:&quot;code&quot;`
    virtual          string
    state            string
    agentsetgroup    string
    labelgroup       string
    agentsetrole     string
    agentsetfwstate  string
    microfwstate     string
    usernumber       int
    expiredtimestamp int
    blocklog         string
    updateduser      string
    updatedtimestamp int
&#125;

func main() &#123;
    content := get(url(&quot;/default/activationcode&quot;))
    fmt.Println(string(content))

    var md Data
    // convert to json
    json.Unmarshal(content, &amp;md)
    fmt.Println(md.Code)
&#125;
</code></pre>
<h2 id="practice"><a href="#practice" class="headerlink" title="practice"></a>practice</h2><pre><code class="go">package main

import (
    &quot;crypto/tls&quot;
    &quot;encoding/json&quot;
    &quot;flag&quot;
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;net/http&quot;
    &quot;time&quot;
)

// define some variables
var NEW Data
var OLD Data

// create data struct of service request [&#123;k:v,k:[&#123;k:v&#125;,&#123;k:v&#125;...]&#125;,k:v]
type Data []struct &#123;
    Uuid             string  `json:&quot;uuid&quot;`
    Service          Service `json:&quot;service&quot;`
    Updatedtimestamp int     `json:&quot;updatedtimestamp&quot;`
&#125;
type Service []struct &#123;
    Protocol string `json:&quot;protocol&quot;`
    Port     string `json:&quot;port&quot;`
    Listen   string `json:&quot;listen&quot;`
    Name     string `json:&quot;name&quot;`
    Exe      string `json:&quot;exe&quot;`
&#125;

// commind line parse
func parseCmd() (string, uint, string, string) &#123;
    url := flag.String(&quot;url&quot;, &quot;192.168.31.53&quot;, &quot;QCC url&quot;)
    interval := flag.Uint(&quot;time&quot;, 300, &quot;interval time(seconds)&quot;)
    api := flag.String(&quot;api&quot;, &quot;rh8FeGiGZhGBFWawrCvFYLaMHHQBVr9ZEmKmLAJAiCfqkB5kRkGs4cwgToELFV5L&quot;, &quot;qcc api&quot;)
    user := flag.String(&quot;user&quot;, &quot;admin&quot;, &quot;api user name&quot;)
    flag.Parse()
    return *url, *interval, *api, *user
&#125;

// function of api url
func apiUrl(url, api string) string &#123;
    return &quot;https://&quot; + url + &quot;:8080&quot; + api
&#125;

// get http request raw data
func rawData(url, user, api string) []byte &#123;
    http.DefaultTransport.(*http.Transport).TLSClientConfig = &amp;tls.Config&#123;InsecureSkipVerify: true&#125;

    r, err := http.NewRequest(&quot;GET&quot;, url, nil)
    r.SetBasicAuth(user, api)

    c := &amp;http.Client&#123;&#125;
    resp, err := c.Do(r)
    if err != nil &#123;
        fmt.Println(err)
    &#125;
    defer resp.Body.Close()

    // return resp.Body
    content, _ := io.ReadAll(resp.Body)
    return content
&#125;

// compare data with x minutes interval
func compareData(data Data, tsleep uint) string &#123;
    NEW = data
    for &#123;
        if OLD == nil &#123;
            OLD = NEW
            continue
        &#125;
        // condition
        time.Sleep(time.Duration(tsleep) * time.Second)
        return &quot;one&quot;
    &#125;
&#125;

// main function
func main() &#123;
    url, interval, api, user := parseCmd()
    fmt.Println(url, interval, api, user, apiUrl(url, &quot;/default/workloadservice&quot;))
    content := rawData(apiUrl(url, &quot;/default/workloadservice&quot;), user, api)
    // fmt.Println(apiUrl(&quot;/default/workloadservice&quot;))
    // fmt.Printf(&quot;%T\n&quot;,content)
    // fmt.Printf(&quot;%s\n&quot;,content)

    var data Data
    err := json.Unmarshal(content, &amp;data)
    if err != nil &#123;
        fmt.Println(err)
    &#125;

    result := compareData(data, interval)
    fmt.Println(result)
    // fmt.Printf(&quot;%T\n&quot;,data)
    // fmt.Println(data[0].Service)
&#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/go/" data-id="cl9ktb7uz000vdta827jt2xsa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/" rel="tag">go</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/git/" class="article-date">
  <time datetime="2022-04-23T15:01:38.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/git/">git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="git"><a href="#git" class="headerlink" title="git"></a>git</h1><p>git是一个版本控制软件，可以仅仅在本地进行版本管理，也可以连接github进行多终端访问协作</p>
<h2 id="common-command-quick-look"><a href="#common-command-quick-look" class="headerlink" title="common command quick look"></a>common command quick look</h2><pre><code class="shell">git init                    #initialize a new repo
git status                    #check modified/stage area status
    git checkout &lt;file&gt;        #reverse modified
git add                     #add changes to stage area
    git reset HEAD &lt;file&gt;    #reverse changes out of stage area
git commit                    #commit as a check point
git log                        #check commit info
    git reset                #reverse to a specified commit(check point)
    
git branch --list            #show all branchs
git branch &lt;branchname&gt;        #create new branch
git checkout &lt;branchname&gt;    #change to new branch
git checkout -b &lt;branchname&gt;#easily create new branch and change to it
git merge &lt;branchname&gt;        #merge from branch
git branch -d &lt;branchname&gt;    #delete a branch

git tag                        #show tag
git tag &lt;tagname&gt;            #create tag
git tag -d &lt;tagname&gt;        #delete tag
</code></pre>
<h2 id="change-defalut-branch-name"><a href="#change-defalut-branch-name" class="headerlink" title="change defalut branch name"></a>change defalut branch name</h2><p>在使用git之前，非常值得做的一件事就是修改默认branch的名字，如你所知的一些事，master通常是一个不能体现平等的词，所以github上可以看见创建的默认repo也是main。但是git命令在本地创建仓库的时候还是master，所以为了避免这些麻烦，需要手动修改一下配置</p>
<pre><code class="shell"># change default branch name from master to main
git config --global init.defaultBranch main

# if you already have a branch named master, it&#39;s easy to change it to main
git branch -m main
</code></pre>
<h2 id="initialize"><a href="#initialize" class="headerlink" title="initialize"></a>initialize</h2><p>git仓库的初始化，可以是一个空的文件夹，或者是有文件的文件夹，git的初始化仅仅在在当前目录下创建一个<code>.git</code>目录</p>
<pre><code class="shell">git init
</code></pre>
<h2 id="configuration"><a href="#configuration" class="headerlink" title="configuration"></a>configuration</h2><ul>
<li>configuration level</li>
<li>createing your identity includes username and email</li>
<li>setting up default editor</li>
</ul>
<p>git config分为三个等级，而通常使用global就可以了</p>
<ul>
<li>local：配置仅仅对当前的目录起作用，配置写入<code>.git/config</code></li>
<li>global：配置对一个系统的当前用户起作用，配置写入<code>~/.gitconfig</code></li>
<li>system：配置对操作系统的所有用户起作用，配置写入<code>/etc/gitconfig</code></li>
</ul>
<p>git config的用户和邮件地址的作用仅仅是在git commit时作为一个用户标识，是必须设置的，但是并不需要和github上的一致</p>
<pre><code class="shell"># this only need to be configured once
git config --global user.name &quot;your_user_name&quot;
git config --global user.email &quot;your_email_addr&quot;
</code></pre>
<p>git config可设置默认的编辑器，因为在使用某些命令时会调用编辑器（比如运行<code>git commit</code>时）</p>
<pre><code class="shell"># this is optional but suggests to config
git config --global core.editor &quot;vim&quot;
</code></pre>
<p>查看所有的配置</p>
<pre><code class="shell"># show all config
git config --list

# or only show the one you wanna to see: eg. user.name
git config user.name

# or we can directly cat the config file
cat ~/.gitconfig
</code></pre>
<h2 id="add-to-git"><a href="#add-to-git" class="headerlink" title="add to git"></a>add to git</h2><p>包含两个方面：</p>
<ul>
<li><p>初始化将目录或文件加入git track，可以是整个目录，或者是一部分</p>
</li>
<li><p>将修改过的文件加入stage area</p>
</li>
</ul>
<pre><code class="shell"># added file will be put in a stage area, waitting for commit
git add .

# or only one specified file
git add readme.md
</code></pre>
<p>当add之后，可以回退</p>
<pre><code class="shell">git reset HEAD &lt;file_name&gt;
</code></pre>
<h2 id="ignore-some-dir-file"><a href="#ignore-some-dir-file" class="headerlink" title="ignore some dir/file"></a>ignore some dir/file</h2><p>如果某些文件或者目录是我们不想通过git进行管理的，可以进行设置</p>
<pre><code class="shell"># create a new file named .gitignore where .git directory exists
touch .gitignore

# then add file name or directory name to .gitignore, cannot write in one line
# each line only one file name or directory
</code></pre>
<h2 id="commit-changes"><a href="#commit-changes" class="headerlink" title="commit changes"></a>commit changes</h2><p>通常我们的修改不会进行提交，提交的目的是作为一个check point，方便我们回退。只有在加入一个新的特性或者整体作为一个备份点，这时才有必要提交</p>
<pre><code class="shell"># without any argument will open a text editor for writing comments
git commit

# sure can write comment directly
git commit . -m &quot;your comments&quot;

# before we commit, we can checkout what is the differenct between now and last time before we change
git diff
</code></pre>
<h2 id="reverse-changes"><a href="#reverse-changes" class="headerlink" title="reverse changes"></a>reverse changes</h2><p>每次提交都会被git记录，uuid作为唯一标识符，可以通过查看log找到回退的点</p>
<pre><code class="shell"># show all the message we commit
git log

# or only show simple nice oneline
git log --pretty=oneline

# reverse with the uuid before we find
git reset --hard &lt;uuid&gt;

# a simple way to reverse one version before without check uuid
git reset --hard HEAD^
</code></pre>
<p>通过上面的方式回到了某个之前的版本，但所有的这些修改并不会被git删除，所以在回退之后还可以前进到最新的版本，方式同上，只需找到对应的uuid即可</p>
<h2 id="use-github-as-remote-repo"><a href="#use-github-as-remote-repo" class="headerlink" title="use github as remote repo"></a>use github as remote repo</h2><p>本地使用git可以满足一个人的需求，如果在多个终端/多个人协作就需要一个公共访问的远端仓库，github就满足这个要求</p>
<pre><code class="shell"># at first create a empty repository in github , such as named test

# second make sure locally has created a local repo and commited all the changes

# checkout whether exists remote configure
git remote --verbose

# then config remote repo&#39;s info，where the url link finds will be described below
# now we can use origin instead of the long url link
git remote add origin &lt;https://github.com/your_github_username/test.git&gt;

# push local to remote repo&#39;s(origin) main branch
git push -u origin main
</code></pre>
<p>github仓库的链接地址可以通过点击code找到</p>
<p><img src=".images/image-20210729150458342.png" alt="image-20210729150458342"></p>
<p>或者直接在web的url后面添加<code>.git</code>即可</p>
<p><img src=".images/image-20210729150641206.png" alt="image-20210729150641206"></p>
<p>通常会需要输入github的username，password。当然可以在github上进行配置省去输入:</p>
<ul>
<li>本地生成id_rsa.pub公钥并上传到github指定repo的配置中或者github的配置（适用于所有的repo）</li>
<li>修改git remove中origin的url链接方式为ssh</li>
</ul>
<pre><code class="shell"># first, create a ssh public key locally in ~/.ssh/id_rsa.pub
ssh-keygen

# then add the content of ~/.ssh/id_rsa.pub to github config
</code></pre>
<p><img src=".images/image-20210729171000037.png" alt="image-20210729171000037"></p>
<p>选择ssh方式</p>
<p><img src=".images/image-20210729175340540.png" alt="image-20210729175340540"></p>
<p>修改本地remote link配置</p>
<pre><code class="shell"># first remove exist config
git remote remove origin

# add ssh link to configuration
git remote add origin &lt;git@github.com:ssfwshutterbug/note.git&gt;
</code></pre>
<p>然后就不需要输入username和password了</p>
<h2 id="clone-from-github-existing-repo"><a href="#clone-from-github-existing-repo" class="headerlink" title="clone from github existing repo"></a>clone from github existing repo</h2><p>前面是本地仓库同步到github，如果github仓库已有内容，那么只需要clone下来即可</p>
<pre><code class="shell"># the github repo link described above, use https
git clone &lt;https://github.com/your_github_username/test.git&gt;

# use ssh link without username and password needed
git clone &lt;git@github.com:ssfwshutterbug/note.git&gt;

# clone a specified branch
git clone --single-branch --branch &lt;main&gt; &lt;git@github.com:ssfwshutterbug/note.git&gt;
</code></pre>
<h2 id="create-delete-branch"><a href="#create-delete-branch" class="headerlink" title="create/delete branch"></a>create/delete branch</h2><p>分支通常作为beta测试，稳定后会融入stable版本main</p>
<pre><code class="shell"># create branch
git branch &lt;branch_name&gt;

# display all the branch
git branch --list

# change to specified branch
git checkout &lt;branch_name&gt;

# delete a specified branch
git branch --delete &lt;branch_name&gt;
</code></pre>
<p>删除github上的分支</p>
<pre><code class="shell"># locally delete github branch
git push origin --delete &lt;branch_name&gt;
</code></pre>
<h2 id="merge-branch"><a href="#merge-branch" class="headerlink" title="merge branch"></a>merge branch</h2><p>切换到分支对其它的分支进行合并：只需记住从别的分支融合到当前分支（merge from）</p>
<pre><code class="shell"># merge to main and auto create a commit, has the ability to reverse
git merge --no-ff -m &quot;your comments&quot;

# simple merge without commit, cannot reverse, not suggest
git merge &lt;branch_name&gt;
</code></pre>
<h2 id="show-difference"><a href="#show-difference" class="headerlink" title="show difference"></a>show difference</h2><p>我们可以通过对比两个分支，两个commit，当前修改与最后一次修改的不同……</p>
<pre><code class="shell"># shou difference between now with last commit
git diff

# or specified a file to compare
git diff &lt;file_name&gt;

# show difference between two commits
git diff &lt;uuid1&gt; &lt;uuid2&gt;

# show difference between two branchs
git diff &lt;branch1&gt; &lt;branch2&gt;
</code></pre>
<h2 id="discuss"><a href="#discuss" class="headerlink" title="discuss"></a>discuss</h2><p>while pull main branch to local, show this error message:</p>
<pre><code class="shell">git pull origin main    

From github.com:ssfwshutterbug/note
 * branch            main       -&gt; FETCH_HEAD
fatal: refusing to merge unrelated histories
</code></pre>
<p>fixed with below</p>
<pre><code class="shell">git pull origin main --allow-unrelated-histories
</code></pre>
<h2 id="credential"><a href="#credential" class="headerlink" title="credential"></a>credential</h2><p>I am in a work with azure devops platform. And sometimes some users ask for my help of git authorized issues.</p>
<p>There are two ways that a user can be used to authorize:</p>
<ul>
<li>ssh</li>
<li>http</li>
</ul>
<p>with ssh method, i clearly know that we need produce a pub key in local machine, and store the pub key to azure devops platform. After that we can download repository without username and password typing.</p>
<p>however, i really don’t know how the way of http works. I searched online and get nothing. Until one day i see my teamwork to modify the username and password in control pannel, and i finally know that.</p>
<p>There are two ways of http authorization works:</p>
<ol>
<li>with no configure, then we need to type username and password each time we download</li>
<li>with a credential helper, and this can be split with three methods:<ol>
<li>cache: store username and password in memory, with a timeout.</li>
<li>store: store username and password in a file, permanently.</li>
<li>other softwares: in win10, is called manager. in win11, called manger-core</li>
</ol>
</li>
</ol>
<p><strong>cache and store methods will use the OS’s own ability to encrypt username and password</strong></p>
<p>with configure, there are three kinds of level:</p>
<ul>
<li>system: write in <code>/etc/gitconfig</code></li>
<li>global: write in <code>~/.gitconfig</code></li>
<li>local: write in repo’s <code>.git/config</code></li>
</ul>
<p>the low level can override the above level, for example: if we write a configre in local repo, then user local configure instead of system’s.</p>
<p>and if no low level setting, the above level can be used by whole system.</p>
<pre><code class="shell"># list all system config
git config --system --list

# list all global config
git config --global --list

# list all local config
git config --local --list
git config --list

# set win10 credential helper to manager
git config --system credential.helper manager
# set win11 credential helper to manager-core
git config --system credential.helper manager-core
# and then we can find stored info in contrl pannel&#39;s windows credental

# set local credential helper to cache(default 900 seconds)
git config credential.helper &quot;cache --timeout 900&quot;

# clean cached username and password
git config --unset credential.helper
# then reset to cache
git config credential.helper cache
# or kill the process
pkill git-credential-helper

# if we set several method credential helper and want to clean
git config --unset-all credential.helper
</code></pre>
<blockquote>
<p>why we use git bash without configure and it used windows credential in default?</p>
<p>because when we install git bash, there comes a config setting in default</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/git/" data-id="cl9ktb7uv000pdta85qlyec97" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/ed/" class="article-date">
  <time datetime="2022-04-23T15:01:01.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/ed/">ed</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ED"><a href="#ED" class="headerlink" title="ED"></a>ED</h1><p><a target="_blank" rel="noopener" href="https://www.gnu.org/software/ed/manual/ed_manual.html">ed</a>是一个unix默认的编辑器，是操作系统自带的编辑器，如果在某些场景下没有vim编辑器，那么ed就可以派上用场的</p>
<p>大多数ed的命令和vim一致</p>
<p><strong>simple open / quit file</strong></p>
<pre><code class="shell"># ed without parameter open a text buffer
ed

# ed with a filename open a file and make changes to the copy of file buffer
ed file.txt

# exit ed with warn
q

# exit without warn
Q

# write changes to file
w

# open content to file
f filename

# open content file and write to file
f filename
w

# or
w filename
</code></pre>
<p><strong>prompt/command mode and input mode</strong></p>
<p>while opening file, will locate in the last line of file with prompt mode</p>
<pre><code class="shell"># default will enter prompt mode, in this mode we can execute command
# `P` toggles prompt on or off 
P

# trun display error message on
H

# !command allow us to execute shell command
!command

# read output of command and write to buffer
r !command

# enter input mode: `a` append; `i` insert; `c` change
a
i
c

# `.` exit input mode
.
</code></pre>
<p><code>,</code> usage</p>
<pre><code class="shell"># `,` means all lines

# print last line, in default, will show the last line
p

# print all lines
,p

# delete one line
d

# delete all lines
,d
</code></pre>
<p><code>#</code> usage</p>
<pre><code class="shell"># `#` in prompt mode means ignore
# this line will be ignored

# `#` in input mode means nothing but a character
</code></pre>
<p>num to locate</p>
<pre><code class="shell"># in default, will locate the last line, num will locate other line
# 1 locate line 1
1

# enter will locate to end line one by one

# move option after num
2s/hell/hello

# move current line to line 1
m0

# move line 10 to line 1 and print
10m0p
</code></pre>
<p>line address</p>
<pre><code class="shell">.    #The current line (address) in the buffer.
$    #The last line in the buffer.
n    #The nth line in the buffer, where n is a number in the range &#39;0,$&#39;.
+n   #The nth next line, where n is a non-negative number.
-n   #The nth previous line, where n is a non-negative number.
+    #The next line. This is equivalent to &#39;+1&#39; and may be repeated with cumulative effect.
-    #The previous line. This is equivalent to &#39;-1&#39; and may be repeated with cumulative effect.
,    #The first through last lines in the buffer. This is equivalent to the address range &#39;1,$&#39;.
;    #The current through last lines in the buffer. This is equivalent to the address range &#39;.;$&#39;.
/re/ #The next line containing the regular expression re. The search wraps to the beginning of the               buffer and continues down to the current line, if necessary.
?re? #The previous line containing the regular expression re. The search wraps to the end of the buffer      and continues up to the current line, if necessary.
&#39;x   #The apostrophe-x character pair addresses the line previously marked by a &#39;k&#39; (mark) command,           where &#39;x&#39; is a lower case letter from the portable character set &#39;[a-z]&#39;.
</code></pre>
<p>other important command</p>
<pre><code class="shell"># print line with line number
,n

# undo changes
u

# copy current line to specified line
t2

# show content with keyword position. eg:display content from starting with `#` to now.
?^#?,.p

# global search
1,$g/&lt;pattern&gt;/p
# or
,g/&lt;pattern&gt;/p
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/ed/" data-id="cl9ktb7ur000jdta8etwgayhn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ed/" rel="tag">ed</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ansible" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/ansible/" class="article-date">
  <time datetime="2022-04-23T15:00:12.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/ansible/">ansible</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h1><p>ansible is a software without the concept of server or client, but it can do the job of cluster management. the magic is that it uses ssh to connect to other os, that’s it. it can do all of the thing what you do in hosts.</p>
<h2 id="features"><a href="#features" class="headerlink" title="features"></a>features</h2><ul>
<li>no client</li>
<li>via ssh</li>
<li>moduled</li>
<li>yaml file</li>
<li>parallel</li>
</ul>
<h2 id="function"><a href="#function" class="headerlink" title="function"></a>function</h2><ul>
<li>software deployment, install software via ansible</li>
<li>configuration management, configure system via ansible</li>
<li>software provisioning</li>
</ul>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>in centos</p>
<pre><code class="shell">yum install epel-release -y
yum install ansible -y
</code></pre>
<p>in archlinux</p>
<pre><code class="shell">pacman -S ansible
</code></pre>
<h2 id="syntax"><a href="#syntax" class="headerlink" title="syntax"></a>syntax</h2><pre><code class="shell">ansible host_pattern action
# or
ansible-playbook host_pattern
</code></pre>
<h2 id="inventory-file"><a href="#inventory-file" class="headerlink" title="inventory file"></a>inventory file</h2><p>if only one ip address to connect, we can write it directly. if more than one ip address we can write it in a special file called <code>inventory file</code>.</p>
<p>inventory file is a file that ansible store variable messages(such as ip, login user name, password etc). the default file is <code>/etc/ansible/hosts</code>. we can simplily put ip in the file, however the way much better is group hosts.</p>
<pre><code class="shell">[group_name]
host_ip_1
host_ip_2
host_ip_3
</code></pre>
<p>eg:</p>
<pre><code class="shell">[testCentos]
192.168.31.114
</code></pre>
<p>then we can list all host in this file by</p>
<pre><code class="shell"># ansible all --list-hosts
  hosts (1):
    192.168.31.114
</code></pre>
<p>if we know group name, we can specify group to show</p>
<pre><code class="shell"># ansible testCentos --list-hosts
  hosts (1):
    192.168.31.114
</code></pre>
<p>we can also specify ourself inventory file. there are two methords.</p>
<ol>
<li><p>change the default location in <code>/etc/ansible/ansible.cfg</code></p>
<pre><code class="shell">inventory      = /any/other/file/location
</code></pre>
</li>
<li><p>specify by parameter</p>
<p>make personal inventory file</p>
<pre><code class="shell">echo &quot;
[testCentos]
192.168.31.114
&quot; &gt;&gt; ip_addr.txt
</code></pre>
<p>use <code>--inventory</code> to define.</p>
<pre><code class="shell">ansible --inventory ./ip_addr.txt all --list-hosts
</code></pre>
</li>
</ol>
<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p>module in ansible is command collection. we can find module help by</p>
<pre><code class="shell">ansible-doc module_name
</code></pre>
<p>such as find shell module usage </p>
<pre><code class="shell">ansible-doc shell
</code></pre>
<p>check total module in local machine</p>
<pre><code class="shell">ansible-doc --list | wc -l
</code></pre>
<p>we can use those modules by <code>--module-name</code>.</p>
<h2 id="Ad-hoc"><a href="#Ad-hoc" class="headerlink" title="Ad-hoc"></a>Ad-hoc</h2><p>Ad-hoc commands in ansible means those one-line commands run in hosts. it is easy, simple without multi tasks to run. so if we just wanna to do a simple task, we can write Ad-hoc. for example check connection with machine.</p>
<p>one ip can write directly</p>
<pre><code class="shell">ansible 192.168.31.114 --module-name ping
</code></pre>
<pre><code class="shell"># ansible all --module-name ping
The authenticity of host &#39;192.168.31.114 (192.168.31.114)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:LzEdo+P7rgs1gJgODVWJaPFgHKk+Zl8/9ULzGN6z/8Q.
Are you sure you want to continue connecting (yes/no/[fingerprint])? no
192.168.31.114 | UNREACHABLE! =&gt; &#123;
    &quot;changed&quot;: false,
    &quot;msg&quot;: &quot;Failed to connect to the host via ssh: Host key verification failed.&quot;,
    &quot;unreachable&quot;: true
&#125;
</code></pre>
<p>if we have ever not connect to the hosts, it may get an error msg, at this time we need to type password by adding <code>--ask-pass</code></p>
<pre><code class="shell"># ansible all --module-name ping --ask-pass
SSH password: 
192.168.31.114 | FAILED! =&gt; &#123;
    &quot;msg&quot;: &quot;Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host&#39;s fingerprint to your known_hosts file to manage this host.&quot;
&#125;
</code></pre>
<p>okay, it says that the default config has enabled host key check, so we need disable it</p>
<pre><code class="shell">vim /etc/ansible/ansible.cfg

# uncomment to disable host key check
host_key_checking = False
</code></pre>
<p>then, run command again</p>
<pre><code class="shell"># ansible all --module-name ping --ask-pass
SSH password: 
192.168.31.114 | SUCCESS =&gt; &#123;
    &quot;ansible_facts&quot;: &#123;
        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;
    &#125;,
    &quot;changed&quot;: false,
    &quot;ping&quot;: &quot;pong&quot;
&#125;
</code></pre>
<p>yes, we get it. <code>&quot;changed&quot;: false</code> above means we don’t change anything in remote machine.</p>
<blockquote>
<p>Note:</p>
<ol>
<li>instead of typing password every times, the recommand way is configuring ansible machine connects to remote machine without password (put ansible ssh public key to remote machine).</li>
<li>if we don’t specify a login user, it will use ansible machine login user name, we can use <code>--user user_name</code> to specify other login user.</li>
<li>we can use <code>--ask-pass</code> to input login user password</li>
</ol>
</blockquote>
<pre><code class="shell"># ansible testCentos --ask-pass --user root --module-name shell --args &quot;ip -c -br a&quot;           
SSH password: 
192.168.31.114 | CHANGED | rc=0 &gt;&gt;
lo               UNKNOWN        127.0.0.1/8 ::1/128 
enp0s3           UP             192.168.31.114/24 fe80::cd8e:43e4:458d:9ab3/64
</code></pre>
<blockquote>
<p>Note:</p>
<p><code>command</code> module can only be used in one command with its parameter, one liner command(several commands connected with <code>&amp;&amp;, ;, |, &gt;</code>) need use <code>shell</code> module.</p>
</blockquote>
<p>sometimes, we cannot login directly with root user, but we need root priviledge. there are two ways:</p>
<ol>
<li> if the login user has <code>sudo</code> priviledge</li>
</ol>
<pre><code class="shell">ansible all --user login_user --ask-pass --become --become-user root --ask-become-pass --module-name shell --args &quot;systemctl restart network&quot;
</code></pre>
<ol start="2">
<li><p>if the login user has no sudo priviledge, then we need to change to root user with <code>su</code></p>
<pre><code class="shell">ansible all --user login_user --ask-pass --become --become-user root --become-method su --ask-become-pass --module-name shell --args &quot;systemctl restart network&quot;
</code></pre>
</li>
</ol>
<h2 id="variable-of-user-name-and-password"><a href="#variable-of-user-name-and-password" class="headerlink" title="variable of user name and password"></a>variable of user name and password</h2><p>okay, as we write above, if we want to execute some command in remote machine, a login user and password is needed. we can use <code>--user</code> and <code>--ask-pass</code> then typing in terminal, and there is another way without typing.</p>
<p>ansible has already defined this variables. the thing that we need to do is sign a value to it. there are four  ways.</p>
<ol>
<li><p>write in inventory file.</p>
<p>if we only specify a group login info, we can use <code>[group_name:vars]</code>. if we define global login info, we can use <code>[all:vars]</code>.</p>
<pre><code class="shell">[testCentos]
192.168.31.114

[testCentos:vars]
ansible_ssh_user=test
ansible_ssh_pass=123
ansible_become_pass=123456
</code></pre>
<p>then execute without password input</p>
<pre><code class="shell">ansible --inventory ./hosts all --module-name shell --args &quot;ps -ef|grep sshd&quot; --become --become-user root --become-method su
</code></pre>
</li>
<li><p>write in playbook file <code>playbook.yml</code></p>
<pre><code class="shell">touch playbook.yml
</code></pre>
<pre><code class="yaml">---
- hosts: testCentos
  vars:
    ansible_ssh_user: test
    ansible_ssh_pass: 123
    ansible_become_pass: 123456
  gather_facts: no
  tasks:
    - name: copy file to remote
      become: yes
      become_user: root
      become_method: su
      copy:
          src: /tmp/hosts
       dest: /root
</code></pre>
<p>then execute</p>
<pre><code class="shell">ansible --inventory ./hosts playbook.yml
</code></pre>
</li>
<li><p>write in a seperate variable file</p>
<p>in this way , we need to import the file in playbook</p>
<pre><code class="shell"># touch ansible_vars.yml

---
ansible_ssh_user=test
ansible_ssh_pass=123
ansible_become_pass=123456
</code></pre>
<pre><code class="yaml"># import variable file in playbook

- hosts: testCentos
  vars_files:
    - ./ansible_vars.yml
  gather_facts: no
  tasks:
    - name: check sshd status
      become: yes
      become_user: root
      become_method: su
      shell: ps -ef|grep sshd|grep -v grep
</code></pre>
</li>
<li><p>write in specify floder <code>group_vars</code></p>
<p>in the way, we write a yaml variable’s file in group_vars and named with the same group name as inventory file.  and we don’t need to import the variable file by this way.</p>
<pre><code class="shell"># in ansible working folder make a folder named group_vars
mkdir group_vars

# in group_vars, make group name file and write variables
touch testCentos
echo &quot;
---
ansible_ssh_user=test
ansible_ssh_pass=123
ansible_become_pass=123456
&quot; &gt;&gt; testCentos
</code></pre>
<p><em>note: if we wanna to define global variable, we need to make a file named <code>all</code></em></p>
</li>
</ol>
<blockquote>
<p>Note:</p>
<p><code>become_method: su</code> is very useful , default is use sudo method, however most of time we are not in sudo group. but with su method, we login with root then execute command.</p>
</blockquote>
<ul>
<li><code>vars</code>: collection of variables</li>
<li><code>name</code>: what kind of thing the task does</li>
<li><code>ansible_ssh_user</code>: login user name</li>
<li><code>ansible_ssh_pass</code>: login user password</li>
<li><code>ansible_become_pass</code>: root user password</li>
<li><code>gather_facts</code>: whether will we collect remote machine info, don’t gather saves lot of time</li>
<li><code>become</code>: change user or not </li>
<li><code>become_user</code>:  default </li>
<li>use sudo to run the tasks</li>
<li><code>become_method: su</code>: don’t use sudo, login with root. it is very userful when we have no sudo priviledge </li>
<li><code>shell</code>: run linux shell command.</li>
</ul>
<h2 id="playbook"><a href="#playbook" class="headerlink" title="playbook"></a>playbook</h2><p>what is playbook? playbook is a set of Ad-hoc tasks writing in a yaml file. the method to execute playbook different from Ad-hoc. use <code>ansible-playbook</code> instead of <code>ansible</code></p>
<pre><code class="shell"># such as i make a playbook file named playbook.yml
ansible-playbook playbook.yml
</code></pre>
<p>for example</p>
<pre><code class="yaml"># hosts file

[testCentos]
192.168.31.114
</code></pre>
<pre><code class="yaml"># playbook

---
- hosts: testCentos
  gather_facts: no
  become: yes
  become_user: root
  become_method: su
  vars:
    ansible_ssh_user: test
    ansible_ssh_pass: 123
    ansible_become_pass: 123456
    pkgname: nginx
  tasks:
    - name: add nginx resource
      shell: rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
    - name: install &#123;&#123;pkgname&#125;&#125;
      yum: name=&#123;&#123;pkgname&#125;&#125; state=present
      notify:
        - restart &#123;&#123;pkgname&#125;&#125;
    - name: start at boot
      systemd: name=&#123;&#123;pkgname&#125;&#125; state=started enabled=yes
    - name: open firewalld 80 port
      shell: |
        firewall-cmd --zone=public --permanent --add-port=80/tcp
        firewall-cmd --reload
  handlers:
    - name: restart &#123;&#123;pkgname&#125;&#125;
      systemd: name=&#123;&#123;pkgname&#125;&#125; state=restarted
</code></pre>
<p>execute</p>
<pre><code class="shell">ansible-playbook --inventroy hosts playbook.yml
</code></pre>
<p>then we can visit nginx web page at <a target="_blank" rel="noopener" href="http://192.168.31.114/">http://192.168.31.114</a></p>
<p>above we used modules: </p>
<p>​    <code>shell</code> to execute shell command </p>
<p>​    <code>yum</code> to download nginx </p>
<p>​    <code>systemd</code> to start and enable nginx auto start.</p>
<p>we also used <code>notify</code>: when task execute successfully, it will raise a notify.</p>
<p>we also used <code>handlers</code>: to receive notify and execute others</p>
<p>we also used <code>vars</code>: it anounced serveral variables, and we can call it with <code>&#123;&#123;variable_name&#125;&#125;</code></p>
<blockquote>
<p>note:</p>
<p>we may say we can use shell instead of yum or systemd module, yeah, you can do it like that, but the best way is using available modules.</p>
<p>use <code>|</code> to combine multi line into one line. it is useful to execute more than one command.</p>
</blockquote>
<h3 id="condition"><a href="#condition" class="headerlink" title="condition"></a>condition</h3><p>we use <code>when</code> condition to do logical judge. <code>register</code> to store return value. <code>failed_when:no</code> to continue when return value isn’t true(in default task will stop when return value is false).</p>
<p>as we write above, if we execute again, it may failed because we already have a nginx repo. so what should we do? we need to check whether exists nginx repo. if exists then jump</p>
<pre><code class="yaml">...
  tasks:
    - name: check whether nginx repo added
      shell: ls /etc/yum.repos.d/ | grep nginx
      register: repo
      failed_when: no
    - name: add nginx resource
      shell: rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
      when: repo.rc == 1
...
</code></pre>
<h3 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h3><p>we can use loop syntax in ansible playbook. use <code>with_items</code> to loop list. the variable default </p>
<pre><code class="yaml">---
- hosts: testCentos
  gather_facts: no
  become: yes
  become_user: root
  become_method: su
  tasks:
    - name: install software
      yum: name=&#123;&#123; item &#125;&#125; state=present
      with_items:
        - curl
        - wget
</code></pre>
<pre><code class="shell">ansible » ansible-playbook --inventory hosts playbook.yml                                                                         

PLAY [testCentos] **************************************************************************************************************************************************************************

TASK [install software] ********************************************************************************************************************************************************************
changed: [192.168.31.114] =&gt; (item=[&#39;curl&#39;, &#39;wget&#39;])

PLAY RECAP *********************************************************************************************************************************************************************************
192.168.31.114             : ok=1    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
</code></pre>
<h3 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h3><p>with tags, we can specify which task to be execute in shell command</p>
<ol>
<li><p>write tag at the end of task</p>
<pre><code class="yaml">---
- hosts: testCentos
  gather_facts: no
  become: yes
  become_user: root
  become_method: su
  tasks:
    - name: install curl
      yum: name=curl state=present
      tags:
        - curl
    - name: install wget
      yum: name=wget state=present
      tags:
        - wget
</code></pre>
</li>
<li><p>specify which task should be execute by using <code>--tags tag_name</code></p>
</li>
</ol>
<pre><code class="shell">ansible » ansible-playbook --inventory hosts playbook.yml --tags wget                                                         
 
 PLAY [testCentos] **************************************************************************************************************************************************************************
 
 TASK [install wget] ************************************************************************************************************************************************************************
 ok: [192.168.31.114]
 
 PLAY RECAP *********************************************************************************************************************************************************************************
 192.168.31.114             : ok=1    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
</code></pre>
<h3 id="block"><a href="#block" class="headerlink" title="block"></a>block</h3><p><code>block</code> can help us execute multi task in one condition.</p>
<pre><code class="shell">---
- hosts: testCentos
  gather_facts: no
  become: yes
  become_user: root
  become_method: su
  tasks:
    - name: check network
      shell: ping www.baidu.com -c 3
      register: connect
    - name: install curl
      block:
        - yum: name=curl state=present
        - yum: name=wget state=present
      when: connect.rc == 0
</code></pre>
<h1 id="Ansible-Tower"><a href="#Ansible-Tower" class="headerlink" title="Ansible Tower"></a>Ansible Tower</h1><p>ansible tower is a paid software(not free) aiming provide an easy usage gui for ansible. before install, we need to know the minimal machine requirement</p>
<ul>
<li>cpu: 2 core</li>
<li>mem: 4Gib</li>
<li>software size: almost 2 Gib</li>
</ul>
<h2 id="install-1"><a href="#install-1" class="headerlink" title="install"></a>install</h2><p>download tar.gz it from <a target="_blank" rel="noopener" href="https://releases.ansible.com/ansible-tower/setup/">this website</a>, then extract</p>
<pre><code class="shell">tar -xzf ansible-tower-setup-3.6.0-1.tar.gz -C /opt
</code></pre>
<p>before installing, we need to add password to inventory configure file</p>
<pre><code class="shell">cd /opt/ansible-tower-setup-3.6.0-1

# for example, not exactly the same as below. but need to fill all empty password
admin_password=&#39;ansible&#39;
pg_password=&#39;ansible&#39;
rabbitmq_password=&#39;ansible&#39;
</code></pre>
<p>then install with a shell script. may be a coffee time</p>
<pre><code class="shell">./setup.sh
</code></pre>
<p>when all tasks execute successfully. we can visit the web page with <code>https://ip</code></p>
<p><img src=".images/image-20210327235730512.png" alt="image-20210327235730512"></p>
<p>the default user name is <code>admin</code>, and the password is what you typed in inventory file.</p>
<h2 id="license-hack"><a href="#license-hack" class="headerlink" title="license hack"></a>license hack</h2><p>as we mentioned before, ansible tower is a paid software, so we cannot login the main page. however there is a way to hack the license and making it valid forever.</p>
<pre><code class="shell"># add epel repo
yum -y install epel-release

# install pip
yum -y install python-pip

# download reverse compile module
pip install uncompyle6

# change to license diretory
cd /var/lib/awx/venv/awx/lib/python3.6/site-packages/tower_license

# reverse compile init file
uncompyle6 __init__.pyc &gt; __init__.py

# change reversed compile file
vi __init__.py

# at line 84, remove last character &quot;L&quot;

# after line 89, add a new line with &quot;return True&quot;

# compile it
python -m py_compile __init__.py
python -O -m py_compile __init__.py

# restart ansible-tower-service
ansible-tower-service restart
</code></pre>
<p>file <code>__init__.py</code> changed like this:</p>
<p><img src=".images/image-20210328001646132.png" alt="image-20210328001646132"></p>
<p>then we can login the main page, and check it’s license.</p>
<p><img src=".images/image-20210328001906174.png" alt="image-20210328001906174"></p>
<p>the default main page of ansible tower looks like this</p>
<p><img src=".images/image-20210328002019561.png" alt="image-20210328002019561"></p>
<h1 id="template"><a href="#template" class="headerlink" title="template"></a>template</h1><p>a template to execute command in remote and check remote service status</p>
<p><strong>ip_info</strong></p>
<pre><code>[client1]
192.168.31.197
192.168.31.196

[client2]
192.168.31.182

[client1:vars]
ansible_ssh_user=ngus
ansible_ssh_pass=123
ansible_become_pass=123456

[client2:vars]
ansible_ssh_user=dba
ansible_ssh_pass=321
ansible_become_pass=654321
</code></pre>
<p><strong>yaml file</strong>: playbook.yaml</p>
<pre><code class="yaml">---
- hosts: all
  gather_facts: no
  become: yes
  become_user: root
  become_method: su
  tasks:
      - name: install client
        shell: &#123;&#123;command here&#125;&#125;
        register: install_status
        failed_when: no
        tags:
          - install
      - name: check client status
        shell: ps -ef |grep service_name
        tags: 
          - check
...
</code></pre>
<p>run with command</p>
<pre><code class="shell">## install
ansible-playbook --inventory ip_info playbook.yaml --tag install
## check
ansible-playbook --inventory ip_info playbook.yaml --tag check
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/ansible/" data-id="cl9ktb7um000adta8gu1z34ao" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-anbox" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/anbox/" class="article-date">
  <time datetime="2022-04-23T14:58:51.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/anbox/">anbox</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Anbox"><a href="#Anbox" class="headerlink" title="Anbox"></a>Anbox</h1><p>In this article i will show you how to install anbox with snap and compare snap with flatpak.  anbox is a container-based software for running Android in linux. be different from virtual machine, anbox uses kernel module <code>binder</code> and <code>ashmem</code> to share and devide system source, thus it starts up very quickly.</p>
<h2 id="snap-vs-flatpak"><a href="#snap-vs-flatpak" class="headerlink" title="snap vs flatpak"></a>snap vs flatpak</h2><p>snap or flatpak is a cross platform package manager in different linux OS, which stores packages in a independent environment and improves security of system. whatever to say, both of them are not perfect as what i want. why i use it? i hope to install large size software in another disk partition but not the system tree in linux, if there is a need to reinstall the system, i don’t need to reinstall the software itself, one thing i need  is installing the snap package.</p>
<p><strong>disadvantages:</strong></p>
<ul>
<li>snap doesn’t allow to specify package location, so we need to mount bind to that location.</li>
<li>flatpak doesn’t have above disadvantages but the software size is too large and has less software than snap.</li>
</ul>
<p>i choose snap at last, the main reason in this case is that only snap has anbox package.</p>
<h2 id="change-kernel"><a href="#change-kernel" class="headerlink" title="change kernel"></a>change kernel</h2><p><strong>kernel module</strong></p>
<p>default linux kernel doesn’t has anbox needed modules, a simple way is installing a <code>linux-zen</code> kernel</p>
<pre><code class="shell">pacman -S linux-zen
</code></pre>
<p>then we need edit <code>/boot/grub/grub.cfg</code> file, adding a sub entry with the new kernel. once we boot in grub, we can choose the  new kernel by hand.</p>
<pre><code class="shell">    menuentry &#39;Arch Linux, with Linux-zen linux&#39; --class arch --class gnu-linux --class gnu --class os $menuentry_id_option &#39;gnulinux-linux-advanced-20f94885-274b-4a99-b067-a0adf09a1723&#39; &#123;
        .
        .
        .
        echo    &#39;Loading Linux-zen linux ...&#39;
        linux    /boot/vmlinuz-linux-zen root=UUID=20f94885-274b-4a99-b067-a0adf09a1723 rw  loglevel=3 quiet
        echo    &#39;Loading initial ramdisk ...&#39;
        initrd    /boot/initramfs-linux-zen.img
    &#125;
</code></pre>
<h2 id="snap-install"><a href="#snap-install" class="headerlink" title="snap install"></a>snap install</h2><p><strong>snap package location change</strong></p>
<p>snap has no method to specify package location, but we can use mount bind to mount other location to the package folder</p>
<pre><code class="shell"># snap package folder is  /var/lib/snapd
# before install snap, mount folder to that folder
mkdir /home/healer/Public/snapd
sudo mkdir /var/lib/snapd
sudo mount --bind /home/healer/Public/snapd /var/lib/snapd
</code></pre>
<p>above command will make effect until reboot, so we need write mount command to <code>/etc/fstab</code> in order to auto mount after system reboot.</p>
<pre><code class="shell">sudo vim /etc/fstab

/home/healer/Public/snapd    /var/lib/snapd    none    bind    0 0
</code></pre>
<p><strong>install snap</strong></p>
<pre><code class="shell">paru -S snapd
</code></pre>
<p><strong>start snap</strong></p>
<pre><code class="shell">sudo systemctl enable --now snapd.socket
</code></pre>
<p><strong>add hosts entry</strong></p>
<p>by default the speed snap downloads is slow, we need add dns to hosts file</p>
<pre><code class="shell">echo &quot;151.101.62.217  fastly.cdn.snapcraft.io&quot; &gt;&gt; /etc/hosts
</code></pre>
<p><strong>some snap commands</strong></p>
<pre><code class="shell"># update
snap refresh
# search
snap find package-name
# install
snap install package-name
# uninstall
snap uninstall package-name
# list installed package 
snap list
</code></pre>
<h2 id="anbox-install"><a href="#anbox-install" class="headerlink" title="anbox install"></a>anbox install</h2><p>we can find all snap packages <a target="_blank" rel="noopener" href="https://snapcraft.io/store">in this website</a></p>
<pre><code class="shell">snap install --devmode --beta anbox
</code></pre>
<p>run anbox first time</p>
<pre><code class="shell">/var/lib/snapd/snap/bin/anbox launch --package=org.anbox.appmgr --component=org.anbox.appmgr.AppViewActivity
</code></pre>
<p>after system reboot we can start anbox via system launch app or dmenu</p>
<h2 id="install-apk-in-anbox"><a href="#install-apk-in-anbox" class="headerlink" title="install apk in anbox"></a>install apk in anbox</h2><p>by default, anbox has no app store in it, so we need install a app store to it. the method we use is adb</p>
<pre><code class="shell"># adb is part of android-tools package
sudo pacman -S android-tools
</code></pre>
<pre><code class="shell"># such as download a coolan apk from web browser and install it to anbox
adb install Coolapk-11.4.2-2109281-coolapk-app-sign.apk
</code></pre>
<h2 id="flatpak"><a href="#flatpak" class="headerlink" title="flatpak"></a>flatpak</h2><p><strong>install</strong></p>
<p>at last, i want to record the flatpak installation and usage. in a fact that flatpak is really easy to install or use.</p>
<pre><code class="shell"># install
sudo pacman -S flatpak
</code></pre>
<p><strong>add repo</strong></p>
<p>we need to know that the package store location is defined by <code>--user</code> parameter. however the parameter takes effect only when we specify the user repo before. by default our repository is system, so we need add user repository manually.</p>
<pre><code class="shell"># system
flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
# user
flatpak remote-add --user --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
# check repo
flatpak remotes
</code></pre>
<p><strong>usage</strong></p>
<p>find support packages and package install commands <a target="_blank" rel="noopener" href="https://flathub.org/home">in this website</a></p>
<pre><code class="shell"># eg:
# install firefox in user location
flatpak install --user flathub org.mozilla.firefox
</code></pre>
<p>user package location is <code>~/.local/share/flatpak</code></p>
<pre><code class="shell"># start with command
flatpak run org.mozilla.firefox

# or directly
firefox

# or find it in package launch manager such as dmenu or rofi
</code></pre>
<p>some commands</p>
<pre><code class="shell"># update
flaptak update
# search 
flatpak search package-name
# install
flatpak install package-name
# uninstall
flatpak uninstall package-name
# list installed package
flatpak list
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/anbox/" data-id="cl9ktb7ul0009dta8b5pkf6y3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/anbox/" rel="tag">anbox</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-anaconda" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/anaconda/" class="article-date">
  <time datetime="2022-04-23T14:57:59.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/anaconda/">anaconda</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h1><p>one year ago, i heared anaconda when i learned python in oneline video tutorial. and how, what is anaconda, it is just a virtual environment of python. why i need it? i have python in my local machine! seems useless</p>
<p>today, i finally realized that it is a amazing tool. since i wrote a python script with python3, it runs perfect locally. however in the real environment(remote machine), i cannot run it. because remote machine is python2.6 and also cannot install modules oneline. i tried several ways: such as packing modules, compiling python3 from source. all failed!</p>
<p>finally, i remember it, yeah, anaconda! and it is really so good, it can be installed in different os without dependent error and includes all modules which i need. amazing!</p>
<h2 id="features"><a href="#features" class="headerlink" title="features"></a>features</h2><ul>
<li><p>easily in use</p>
</li>
<li><p>purely installed without dependence error in whatever os</p>
</li>
<li><p>include many modules what we used daily</p>
</li>
<li><p>multi different virtual environment, each of them without any relation</p>
</li>
<li><p>without any affect to local environment</p>
</li>
</ul>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p><a target="_blank" rel="noopener" href="https://www.anaconda.com/products/individual#Downloads">download from website</a>, it has two choice:</p>
<ol>
<li>anaconda: include 1500+ modules, especially scientific packages and 3 GB storage disk needed </li>
<li>minianaconda: without scientific packages, but enough for daily usage and 400Mib storage disk needed</li>
</ol>
<p>i download the minimal package</p>
<p>the installation in linux is easy</p>
<ul>
<li><p>download package</p>
</li>
<li><p>grant priviledge and execute</p>
<pre><code class="shell">chmod u+x Miniconda3-py39_4.9.2-Linux-x86_64.sh
./Miniconda3-py39_4.9.2-Linux-x86_64.sh
</code></pre>
</li>
<li><p>step by step</p>
<blockquote>
<p>note: </p>
<p>   the place anaconda installed should be a folder that doesn’t exist</p>
</blockquote>
<pre><code class="shell">Do you accept the license terms? [yes|no]
[no] &gt;&gt;&gt; yes

Miniconda3 will now be installed into this location:
/home/blueocean/miniconda3

  - Press ENTER to confirm the location
  - Press CTRL-C to abort the installation
  - Or specify a different location below

[/home/blueocean/miniconda3] &gt;&gt;&gt; /home/blueocean/.local/apps/minicanda

Do you wish the installer to initialize Miniconda3
by running conda init? [yes|no]
[no] &gt;&gt;&gt; yes

modified      `/home/blueocean/.zshrc`
</code></pre>
</li>
<li><p>reopen terminal or source the environment variables where conda’s config stores, in my case it is in <code>~/.zshrc</code> </p>
</li>
<li><p>disable auto enter conda base environment</p>
<p>in default conda will auto active when we start up a terminal. that’s not i want, so change it.</p>
<pre><code class="shell">conda config --set auto_activate_base false
# and check
conda config --show|grep base
</code></pre>
</li>
</ul>
<h2 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h2><p>full document follow <a target="_blank" rel="noopener" href="https://conda.io/projects/conda/en/latest/user-guide/getting-started.html#managing-envs">this page</a></p>
<h3 id="login-logout-environment"><a href="#login-logout-environment" class="headerlink" title="login/logout environment"></a>login/logout environment</h3><p>after installation completes without error, we can reopen terminal or source the file where installation modified with <code>source ~/.zshrc</code></p>
<pre><code class="shell">~ » source .zshrc                                                                         
(base) ~ »         
</code></pre>
<p>it is obviously that the promt changed, we can also modify prompt with <code>--set env_prompt</code></p>
<pre><code class="shell">conda config --set env_prompt &#39;(&#123;conda&#125;)&#39;
</code></pre>
<p>after source file, we enter the default <code>base</code> environment which was created while installing. we can list the environment that we have created with <code>conda env list</code></p>
<pre><code class="shell">(base) ~ » conda env list                                                                 
# conda environments:
#
base                  *  /home/blueocean/.local/apps/minicanda
</code></pre>
<p><strong>check conda version</strong></p>
<pre><code class="shell">(base) ~ » conda --version                                                               
conda 4.9.2
</code></pre>
<ul>
<li><p>if versions prior to 4.6</p>
<ul>
<li><p><strong>enter environment</strong></p>
<pre><code class="shell">source activate conda_env_name
</code></pre>
</li>
<li><p><strong>exit environment</strong></p>
<pre><code class="shell">source deactivate
</code></pre>
</li>
</ul>
</li>
<li><p>if versions higher than 4.6</p>
<ul>
<li><p><strong>enter environment</strong></p>
<pre><code class="shell">conda activate conda_env_name
</code></pre>
</li>
<li><p><strong>exit environment</strong></p>
<pre><code class="shell">conda deactivate
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="create-new-environment"><a href="#create-new-environment" class="headerlink" title="create new environment"></a>create new environment</h3><p>before we install packages, we need config download mirrors, without configure will lead to installation failed for slowly download speed.</p>
<pre><code class="shell">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
</code></pre>
<p>if the channel added is wrong, we can remove it by</p>
<pre><code class="shell">conda config --remove channels mirrors_url
# such as
conda config --remove channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
</code></pre>
<p>check channels config now</p>
<pre><code class="shell">conda config --show channels
</code></pre>
<p>create environment </p>
<pre><code class="shell"># syntax
conda create --name conda_env_name install_module_name
</code></pre>
<p>when we don’t specify python version, conda will install the newest python version. if we want to use a different versin of python, for example python 2.6, simply create a new environment and specify the version of Python that you want.</p>
<pre><code class="shell">conda create --name snowflakes python2.6
</code></pre>
<p>if we have multi modules need to be installed, we should write in one line to avoid depences missing.</p>
<pre><code class="shell"># such as install pandas xlwt pathlib module
conda create --name sky pandas xlwt pathlib
</code></pre>
<p>check new environment</p>
<pre><code class="shell">conda env list
</code></pre>
<h2 id="pack-environment"><a href="#pack-environment" class="headerlink" title="pack environment"></a>pack environment</h2><p>with conda-pack, we can pack environment to any other location and any other os.</p>
<blockquote>
<p>note:</p>
<p>   os means the same platform, such as cannot pack one linux environment to windows</p>
</blockquote>
<p><strong>install conda-pack with conda</strong></p>
<p>it is recommended to install conda-pack into <code>base</code> environment, since it can be used in all other sub environment</p>
<pre><code class="shell">conda install conda-pack
</code></pre>
<p><strong>pack environment</strong></p>
<pre><code class="shell"># pack into ./env_name.tar.gz
conda pack --name env_name

# pack into /specified/location/path/env_name.tar.gz
conda pack --prefix /store/location/path

# change out name
conda pack --output my_env_name.tar.gz
</code></pre>
<p><strong>unpack environment</strong></p>
<p>the condition we can use conda-pack is that there has a conda installed on the target machine.</p>
<blockquote>
<p>note:</p>
<pre><code>the place we unpack can be two parts:
1. under base environment `envs` floder
2. any other folder
</code></pre>
</blockquote>
<pre><code class="shell"># create a folder named the same as package
mkdir /environment/stored/env_name

# or store it in default base envs
mkdir /path/to/base/envs

# extract package
tar -xzf env_name.tar.gz -C /path/to/create/folder

# if not in base envs, activate environment, this will add env_name/bin to your path
source env_name/bin/activate
# if in base envs, activate environment with conda directory
conda activate env_name

# unpack 
conda-unpack

# deactivate if not in default base envs, this will remove it from you path
source env_name/bin/deactivate
# if in base envs, activate environment with conda directory
conda deactivate
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/anaconda/" data-id="cl9ktb7uj0007dta8ep489co4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/anaconda/" rel="tag">anaconda</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-learn-from-shield" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/learn-from-shield/" class="article-date">
  <time datetime="2022-04-23T14:55:16.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/think/">think</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/learn-from-shield/">learn_from_shield</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I watched “agents of SHIELD”, and learned a lot from it. Especially Skye’s response when Coulson told her the truth of her past life.</p>
<p>Coulson said: “what i told her shattered her world,her lifelong search led to stories of murder and now it’s too difficult to continue. her search is over, her story ends here. but you know what she said? she said no, her story started here. her whole life, she though she wasn’t wanted, that she didn’t belong, that every family that took her in, didn’t want her to stay, didn’t care. but all that time, it was shield protecting her, looking after her, that’s what she took away from the story, not the family she’ll never have but the one she’s always had. here i am telling her something that could destroy her faith in humanity. and somehow, she manages to repair a little piece of mine. “</p>
<p>the world is full of evil and lies and pain and death, and you can’t hide from it, you can only face it. the question is, when you do, how do you respond? who do you become? </p>
<p>I have a great inspiration of that. There has a long time i just feel so disappointed and can not  find any happiness of life, because i realize that the government i live is full of lies, they don’t treat people as human, there is on faith, no fair, on freedom and so on.</p>
<p>However when i see the story of Skye, i realize that i need to change my mind. I know the country is so bad, it is truth. And i cannot change any thing, i can’t hide from it, can only face it. And the question is how i respond.  If i feel sad every day then my life is broke, whatever to say, it is not the worst  situation. I can alive, can do almost the thing which i wanna to dive in, there is no war, no death of threat. And that’s enough. </p>
<p>Each day on earth is the day need to be treasured, since it can never come back. The really bad is not the environment but the heart of failure. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/learn-from-shield/" data-id="cl9ktb7v6001edta86nmp30h5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shield/" rel="tag">shield</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-archlinux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/04/23/archlinux/" class="article-date">
  <time datetime="2022-04-23T07:10:56.000Z" itemprop="datePublished">2022-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/learn/">learn</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/04/23/archlinux/">archlinux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="archlinux"><a href="#archlinux" class="headerlink" title="archlinux"></a>archlinux</h1><p>This document includes all the knowledges of using archlinux, from basic installing to daily using, all in one.</p>
<p>[TOC]</p>
<h2 id="base-system-install"><a href="#base-system-install" class="headerlink" title="base system install"></a>base system install</h2><p>first of all, we need to install the system. take it ease, step by  step, and you can own it.</p>
<h3 id="adjust-console-font"><a href="#adjust-console-font" class="headerlink" title="adjust console font"></a>adjust console font</h3><p>may be the default console font is too small, we can change it temporarily and make it much bigger.</p>
<pre><code class="shell">cd /usr/share/kbd/consolefonts
setfont iso01-12x22.psfu.gz
</code></pre>
<h3 id="connect-network"><a href="#connect-network" class="headerlink" title="connect network"></a>connect network</h3><ul>
<li><p>if plug in the cabel, use <code>dhcpcd</code> to get a ip address.</p>
</li>
<li><p>if use wireless, use <code>iwctl</code> to config the netwrok</p>
<pre><code class="shell"># the iwd.server is running by default
iwctl
# list network interface
device list
# start scaning network
station device scan
# show scan result
station device get-networks
# connect to one wifi
station device connect ssid
# get dynamic ip address
dhcpcd
</code></pre>
</li>
</ul>
<h3 id="change-mirror-list"><a href="#change-mirror-list" class="headerlink" title="change mirror list"></a>change mirror list</h3><p>modify <code>/etc/pacman.d/mirrorlist</code> file, move China mirror list to the head.</p>
<blockquote>
<p>note: this configure will sync to new installed system.</p>
</blockquote>
<pre><code class="shell">head /etc/pacman.d/mirrorlist

## China
Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
Server = http://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch
Server = https://mirrors.ustc.edu.cn/archlinux/$repo/os/$arch
Server = http://mirrors.163.com/archlinux/$repo/os/$arch
Server = http://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch
Server = https://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch
</code></pre>
<h3 id="update-system-clock"><a href="#update-system-clock" class="headerlink" title="update system clock"></a>update system clock</h3><p>enable ntp to ensure the system clock is accurate.</p>
<pre><code class="shell">timedatectl set-ntp true
</code></pre>
<h3 id="partition-disk"><a href="#partition-disk" class="headerlink" title="partition disk"></a>partition disk</h3><p>we can use tools like <code>cfdisk</code> ,<code>parted</code> to parted disk. whatever tool we choose, there are some things need to be done the same.</p>
<ol>
<li>format entire disk with gpt table</li>
<li>one efi partition to install grub</li>
</ol>
<blockquote>
<p>note: efi partition cannot used as lvm part, lvm can only be recognized after grub loading.</p>
</blockquote>
<p>lvm example: </p>
<ul>
<li>esp: 100M</li>
<li>root(lvm): 30G</li>
<li>home(lvm):  last space</li>
</ul>
<pre><code class="shell">parted /dev/nvme0n1 mktable gpt
parted /dev/nvme0n1 mkpart fat 0% 100Mib
parted /dev/nvme0n1 mkpart ext4 100Mib 100%

pvcreate /dev/nvme0n1p2
vgcreate linux /dev/nvme0n1p2
lvcreate -L 30G linux -n root 
lvcreate -l +100%FREE linux -n home

mkfs.fat -F 32 /dev/nvme0n1p1
mkfs.ext4 /dev/linux/root
mkfs.ext4 /dev/linux/home
</code></pre>
<h3 id="mount-partition-and-install-system"><a href="#mount-partition-and-install-system" class="headerlink" title="mount partition and install system"></a>mount partition and install system</h3><pre><code class="shell"># mount root and home partition
mount /dev/linux/root /mnt
mkdir /mnt/home &amp;&amp; mount /dev/linux/home /mnt/home

# chroot mnt and install base system
pacstrap /mnt base linux linux-firmware lvm2 vim
</code></pre>
<h3 id="generate-mount-configure"><a href="#generate-mount-configure" class="headerlink" title="generate mount configure"></a>generate mount configure</h3><blockquote>
<p>note: efi partition not need to be mount.</p>
</blockquote>
<pre><code class="shell">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>
<h3 id="chroot-new-system"><a href="#chroot-new-system" class="headerlink" title="chroot new system"></a>chroot new system</h3><pre><code class="shell">arch-chroot /mnt
</code></pre>
<h3 id="timezone"><a href="#timezone" class="headerlink" title="timezone"></a>timezone</h3><pre><code class="shell">ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc
</code></pre>
<h3 id="system-language"><a href="#system-language" class="headerlink" title="system language"></a>system language</h3><p>uncomment <code>/etc/locale.gen</code>  with <code>en_us.UTF-8</code> and <code>zh_CN.UTF-8</code> then run</p>
<pre><code class="shell">locale-gen

# set default system language
echo &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf
</code></pre>
<h3 id="network"><a href="#network" class="headerlink" title="network"></a>network</h3><pre><code class="shell"># add hostname
echo &quot;notebook&quot; &gt; /etc/hostname

# add hosts
echo &quot;
127.0.0.1    localhost
::1        localhost
127.0.1.1    hostname.localdomain    hostname
&quot; &gt;&gt; /etc/hosts
</code></pre>
<h3 id="initramfs"><a href="#initramfs" class="headerlink" title="initramfs"></a>initramfs</h3><blockquote>
<p>note: if we don’t use lvm, this step can be ignored.</p>
</blockquote>
<p>edit /etc/mkinitcpio.conf, add <code>lvm2</code> between <code>block</code> and <code>filesystems</code></p>
<pre><code class="shell">mkinitcpio -P
</code></pre>
<h3 id="install-netwrok-tool"><a href="#install-netwrok-tool" class="headerlink" title="install netwrok tool"></a>install netwrok tool</h3><p>we can choose iwd or netctl to configure network</p>
<ul>
<li>iwd</li>
</ul>
<pre><code class="shell">pacman -S iwd dhcpcd
systemctl enable iwd
</code></pre>
<ul>
<li>netctl</li>
</ul>
<pre><code class="shell">pacman -S netctl wpa_supplicant dialog  dhcpcd
</code></pre>
<h3 id="install-grub"><a href="#install-grub" class="headerlink" title="install grub"></a>install grub</h3><p>first mount efi partition to <code>/boot/efi</code></p>
<pre><code class="shell">mkdir /boot/efi
mount /dev/nvme0n1p1 /boot/efi

pacman -S grub efibootmgr
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB --removable
grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
<h3 id="set-root-passwd"><a href="#set-root-passwd" class="headerlink" title="set root passwd"></a>set root passwd</h3><pre><code class="shell">passwd root
</code></pre>
<h3 id="umount-and-reboot"><a href="#umount-and-reboot" class="headerlink" title="umount and reboot"></a>umount and reboot</h3><pre><code class="shell">exit and umount -R /mnt
reboot
</code></pre>
<h2 id="general-configure"><a href="#general-configure" class="headerlink" title="general configure"></a>general configure</h2><p>the step below is general configure, that is to say it’s basic and cannot be ignored.</p>
<h3 id="connect-network-1"><a href="#connect-network-1" class="headerlink" title="connect network"></a>connect network</h3><ul>
<li><p>we can use <code>iwd</code> to set wifi connection, only need using <code>dhcpcd</code> to get a dynamic ip address</p>
<p><strong>static ip</strong></p>
<p>create a config file  <code>/etc/iwd/main.conf</code> to enable static network config by adding</p>
<pre><code class="shell">cat /etc/iwd/main.conf

[General]
EnableNetworkConfiguration=true
</code></pre>
<p>add static ip address config to <code>wifi_name.psk file</code> under <code>/var/lib/iwd</code></p>
<pre><code class="shell">cat &gt;&gt; /var/lib/iwd/qiyue.psk

[IPv4]
Address=192.168.31.31
Netmask=255.255.255.0
Gateway=192.168.31.1
</code></pre>
</li>
<li><p>if we use <code>netctl</code>(wifi/ethernet), we can use a gui tool named wifi-menu to connect network</p>
<pre><code class="shell">sudo wifi-menu
</code></pre>
<p>when we connect correct there will be a configure file in /etc/netctl, in order to auto connect network, we need enable it.</p>
<pre><code class="shell">cd /etc/netctl
# it must be file name not localtion path and without super priviledge
netctl enable confirure_file_name
</code></pre>
<p><strong>static ip</strong></p>
<pre><code class="shell">sudo cp /etc/netctl/examples/wireless-wpa-static /etc/netctl

Description=&#39;A simple WPA encrypted wireless connection using a static IP&#39;
Interface=wlo1
Connection=wireless
Security=wpa
ESSID=&#39;wifi-essid&#39; # modify
Key=&#39;password&#39; # modify
IP=static
Address=&#39;192.168.0.104/24&#39; # modify
Gateway=&#39;192.168.0.1&#39;    # modify
DNS=(&#39;114.114.114.114&#39;) # modify
</code></pre>
<p>some command of netctl</p>
<pre><code class="shell">netctl disable wireless-wpa-static-old
netctl enable wireless-wpa-static
netctl restart wireless-wpa-static
</code></pre>
</li>
</ul>
<h3 id="install-some-software"><a href="#install-some-software" class="headerlink" title="install some software"></a>install some software</h3><p>if there comes some error message shows cannot find package, we need to config China repository first.</p>
<ul>
<li><p>man page</p>
<pre><code class="shell">pacman -S man-db man-pages texinfo
</code></pre>
</li>
<li><p>base-devel</p>
<p>it includes <code>sudo, gcc, make, sed, grep, which</code> and etc usual command</p>
<pre><code class="shell">pacman -S base-devel
</code></pre>
</li>
<li><p>install doas or sudo</p>
<pre><code class="shell">pacman -S sudo
pacman -S doas
</code></pre>
<p>then create a file <code>/etc/doas.conf</code> and write something to it</p>
<pre><code class="shell">echo &quot;permit nopass :wheel&quot; &gt; /etc/doas.conf
</code></pre>
</li>
<li><p>xmonad window manager</p>
<p>xmonad window manager uses xterm by default.</p>
<pre><code class="shell">pacman -S xmonad xmonad-contrib xmobar xterm
</code></pre>
</li>
<li><p>poybar</p>
<p>i use it with xmonad as default status bar</p>
<pre><code class="shell">pacman -S polybar
</code></pre>
</li>
<li><p>input method</p>
<p>install all of packages of fcitx5-im, fcitx5-material-color is the skin which really likes windows 10</p>
<pre><code class="shell">pacman -S fcitx5-im fcitx5-material-color fcitx5-rime
</code></pre>
</li>
<li><p>transparent tools</p>
<p>transset-df can transparent the xterm</p>
<pre><code class="shell">yay -S transset-df
</code></pre>
</li>
<li><p>animate action</p>
<p>picom has some good effect like fade in fade out and etc. and aur’s <a target="_blank" rel="noopener" href="https://github.com/jonaburg/picom">picom-jonaburg-git</a> has motion effect</p>
<pre><code class="shell">yay -S picom-jonaburg-git
</code></pre>
<p><img src=".images/picom-motion.gif"></p>
</li>
<li><p>package search tool</p>
<p>we can use <code>dmenu</code> or <code>rofi</code>, i use dmenu much more, but rofi can help me to find how many applications i have ever installed and which one should i launch once a time forgot its name with some keywords.</p>
<pre><code class="shell">pacman -S dmenu rofi
</code></pre>
</li>
<li><p>font</p>
<p>proper font will make some software works well like xterm and polybar</p>
<pre><code class="shell"># the font can show icons in terminal, and font for vscode
# Cascadia and Firacode become my favorite fonts now, even use it as system application font
pacman -S nerd-fonts-iosevka nerd-fonts-fira-code nerd-fonts-cascadia-code

# the two fonts can show chinese and korean proper in polybar
pacman -S adobe-source-han-sans-cn-fonts adobe-source-han-sans-kr-fonts 
</code></pre>
</li>
<li><p>notify tool</p>
<p>it can show notify message in desktop with highly configurable.</p>
<pre><code class="shell">pacman -S dunst
</code></pre>
</li>
<li><p>clip tool</p>
<p>it is a clip tool with great useage, such as clip standard output, one file even though an image</p>
<pre><code class="shell">pacman -S xclip
</code></pre>
</li>
<li><p>youdao dictionary</p>
<p>i have wrote a shell translate copy sentense which depends on this</p>
<pre><code class="shell">pacman -S ydcv-rs-git
</code></pre>
</li>
<li><p>screenshot</p>
<p>useful screenshot tool</p>
<pre><code class="shell">pacman -S flameshot
</code></pre>
</li>
<li><p>file manager</p>
<p>w3m is a plug in to show photo</p>
<pre><code class="shell">pacman -S ranger w3m
</code></pre>
</li>
<li><p>download tool</p>
<pre><code class="shell">pacman -S wget curl
</code></pre>
</li>
<li><p>audio and video player</p>
<pre><code class="shell">pacman -S mpg123 mplayer
</code></pre>
</li>
<li><p>performance monitor</p>
<pre><code class="shell">pacman -S glances htop neofetch

# htim is a replace of htop with vim typle keybing, after install it, type htop as usual
yay -S htim
</code></pre>
</li>
<li><p>browser</p>
<pre><code class="shell">pacman -S firefox
</code></pre>
</li>
<li><p>writer</p>
<pre><code class="shell"># use marktext-git instead of typora, since typora is not open source
pacman -S marktext-git
</code></pre>
</li>
<li><p>code</p>
<pre><code class="shel">pacman -S visual-studio-code-bin
</code></pre>
</li>
<li><p>screen capture</p>
<pre><code class="shell">pacman -S obs-studio
</code></pre>
</li>
<li><p>sql client tool</p>
<pre><code class="shell">pacman -S dbeaver
</code></pre>
</li>
<li><p>stickypad</p>
<pre><code class="shell">pacman -S xpad
</code></pre>
</li>
<li><p>chat</p>
<pre><code class="shell">pacman -S skypeforlinux-stable-bin
</code></pre>
</li>
<li><p>gui dialog tool</p>
<pre><code class="shell">pacman -S yad
</code></pre>
</li>
<li><p>simulate</p>
<pre><code class="shell">pacman -S xdotool
</code></pre>
</li>
<li><p>cli music player </p>
<pre><code class="shell">pacman -S cmus
</code></pre>
</li>
<li><p>chinese date</p>
<pre><code class="shell">pacman -S cdate
</code></pre>
</li>
<li><p>cpu information</p>
<pre><code class="shell">pacman -S cpufetch
</code></pre>
</li>
<li><p>image viewer</p>
<pre><code class="shell">pacman -S gthumb
</code></pre>
</li>
<li><p>wire sniff tool</p>
<pre><code class="shell">pacman -S wireshark
</code></pre>
</li>
<li><p>fake like hackers tool</p>
<pre><code class="shell">cmatrix no-more-secrets-git
</code></pre>
</li>
<li><p>analysis disk usage</p>
<pre><code class="shell">pacman -S ncdu
</code></pre>
</li>
</ul>
<h3 id="add-user"><a href="#add-user" class="headerlink" title="add user"></a>add user</h3><p>install zsh shell first</p>
<pre><code class="shell">sudo pacman -S zsh oh-my-zsh-git
</code></pre>
<p>add user with wheel group and zsh as default shell</p>
<pre><code class="shell">useradd -m -G wheel -s /bin/zsh username
</code></pre>
<p>set passwd</p>
<pre><code class="shell">passwd username
</code></pre>
<p>then adjust priviledges, such as sudo priviledge, run command without password</p>
<pre><code class="shell"># uncomment below in /etc/sudoers
%wheel ALL=(ALL) ALL
%wheel ALL=(ALL) NOPASSWD: ALL
</code></pre>
<h3 id="install-xorg"><a href="#install-xorg" class="headerlink" title="install xorg"></a>install xorg</h3><pre><code class="shell">pacman -S xorg
</code></pre>
<p>in order to use <code>startx</code> to login to gui, we need to install xorg-xinit</p>
<pre><code class="shell">pacman -S xorg-xinit
</code></pre>
<h3 id="video"><a href="#video" class="headerlink" title="video"></a>video</h3><p>there comes three choice: </p>
<ul>
<li>intel with video card integrated</li>
<li>nvidia indepedent</li>
<li>amd video driver</li>
</ul>
<p>if we use intel video card, we need to install intel drive</p>
<pre><code class="shell">pacman -S xf86-video-intel

# install package to adjust screen backlight, only intel works
pacman -S xorg-xbacklight

# we can also adjust screen backlight by hand, only intel works
vim /sys/class/backlight/intel_backlight
</code></pre>
<p>if we use nvidia video card, we need to install nvidia drive</p>
<pre><code class="shell">pacman -S nvidia
</code></pre>
<p>amd gpu</p>
<pre><code class="shell">pacman -S xf86-video-amdgpu
</code></pre>
<h3 id="audio"><a href="#audio" class="headerlink" title="audio"></a>audio</h3><pre><code class="shell">sudo pacman -S pulseaudio pulseaudio-alsa pamixer
</code></pre>
<p>when we installed those software, we can also not get voice, because it is mute by default. so we need enable it</p>
<pre><code class="shell">pamixer --unmute
</code></pre>
<h2 id="personal-configure"><a href="#personal-configure" class="headerlink" title="personal configure"></a>personal configure</h2><p>why it is personal? because there are too many choice for user to choose, and i myself use the system serveral years and have wrote a shell script to copy the old configure file to the system without configure it step by step. so i will describe it in two part.</p>
<ul>
<li>one is auto config</li>
<li>another is step by step</li>
</ul>
<h3 id="auto-config"><a href="#auto-config" class="headerlink" title="auto config"></a>auto config</h3><p> all my backup file locate in <code>~/Data/linux</code>, so i need to copy old data to new machine. there are several ways to do the thing, such as a usb drive, use scp, startup a ftp in old machine…</p>
<p>and find a script named <code>filesync</code> in <code>linux/.local/bin</code> which we copied from old machine. and run:</p>
<pre><code class="shell">./filesync install
</code></pre>
<p> most of things will be done automaticly.</p>
<h3 id="step-by-step"><a href="#step-by-step" class="headerlink" title="step by step"></a>step by step</h3><p>the section below will show you how to config system step by step.</p>
<h4 id="install-AUR-package-installer"><a href="#install-AUR-package-installer" class="headerlink" title="install AUR package installer"></a>install AUR package installer</h4><p>using <code>yay</code> or <code>paru</code> we can download software in AUR. and suggest use paru, because it can search both pacman and aur at the same time.</p>
<pre><code class="shell">pacman -S paru
# pacman -S yay
</code></pre>
<h4 id="add-China-repository"><a href="#add-China-repository" class="headerlink" title="add China repository"></a>add China repository</h4><p><strong>pacman repository</strong></p>
<p>write info to <code>/etc/pacman.conf</code></p>
<pre><code class="shell">[archlinuxcn]
Server = https://mirrors.aliyun.com/archlinuxcn/$arch
</code></pre>
<p>then refresh the database</p>
<pre><code class="shell">pacman -Sy
</code></pre>
<p>we don’t need to install chinese keyring right now, just install it while there is a message shows we need to import some keyring.</p>
<pre><code class="shell">pacman -S archlinuxcn-keyring
</code></pre>
<p><strong>aur repository</strong></p>
<pre><code class="shell"># if use yay to download aur package
yay --aururl &quot;https://aur.tuna.tsinghua.edu.cn&quot; --save
</code></pre>
<p>this will create yay config in <code>~/.config/yay/config.json</code></p>
<pre><code class="shell"># can check config with commands
yay -P -g
</code></pre>
<h4 id="default-location-config"><a href="#default-location-config" class="headerlink" title="default location config"></a>default location config</h4><p>when we use xorg, there is a way to config where the data to be stored. even though not all the software follow the rules, but it is much better than no.</p>
<p>added to <code>~/.pam_environment</code></p>
<pre><code class="shell"># environment variable to set xdg base directory
XDG_CONFIG_HOME=/home/blueocean/.config
XDG_CACHE_HOME=/home/blueocean/.cache
XDG_DATA_HOME=/home/blueocean/.local/share
XDG_DATA_DIRS=/usr/local/share:/usr/share
XDG_CONFIG_DIRS=/etc/xdg
</code></pre>
<h4 id="fcitx5-configure"><a href="#fcitx5-configure" class="headerlink" title="fcitx5 configure"></a>fcitx5 configure</h4><p>in order to make fcitx5 works well, there are several variable to be configed in <code>~/.pam_environment</code></p>
<pre><code class="shell"># environment variable for fcitx5
INPUT_METHOD  DEFAULT=fcitx5
GTK_IM_MODULE DEFAULT=fcitx5
QT_IM_MODULE  DEFAULT=fcitx5
XMODIFIERS    DEFAULT=\@im=fcitx5
</code></pre>
<p>add startup command to <code>~/.xinitrc</code> file :<code>fcitx5 &amp;</code> </p>
<p>short keys: <code>ctrl +alt +h </code> :enable/disable completion</p>
<p>if not simple chinese, use “ctrl+`” to change</p>
<h4 id="xmonad-config"><a href="#xmonad-config" class="headerlink" title="xmonad config"></a>xmonad config</h4><p>copy configure file <code>xmonad.hs</code>  to <code>~/.xmonad/</code></p>
<p>then compile it:</p>
<pre><code class="shell">xmonad --recompile
</code></pre>
<p>write start xmonad command to <code>~/.xinitrc</code></p>
<pre><code class="shell"># if home directory has no .xinitrc then copy 
[ ! -f ~/.xinitrc ] &amp;&amp; cp /etc/X11/xinit/xinitrc ~/.xinitrc

# write to the end of the file
exec xmonad    
</code></pre>
<h4 id="polybar-config"><a href="#polybar-config" class="headerlink" title="polybar config"></a>polybar config</h4><p>if there has no configure file, we can download configure from website</p>
<pre><code class="shell">[ ! -f ~/.config/polybar/config ] &amp;&amp; touch ~/.config/polybar/config
</code></pre>
<p>add start command in <code>~/.xinitrc</code></p>
<pre><code class="shell">sh ~/.config/polybar/launch.sh
</code></pre>
<h4 id="disable-touchpad"><a href="#disable-touchpad" class="headerlink" title="disable touchpad"></a>disable touchpad</h4><p>if we have a touchpad and don’t wanna use, we can disable it</p>
<p>first of all, install the command:</p>
<pre><code class="shell">pacman -S xorg-xinput
</code></pre>
<p>add below to <code>~/.xinitrc</code> to disable it</p>
<pre><code class="shell">xinput | grep Touchpad | grep -E &#39;=[0-9]&#123;2&#125;&#39; -o | grep -E &#39;[0-9]&#123;2&#125;&#39; -o | xargs xinput disable
</code></pre>
<h4 id="cursor-style"><a href="#cursor-style" class="headerlink" title="cursor style"></a>cursor style</h4><p>make sure xsetroot tools has been installed</p>
<pre><code class="shell">pacman -S xorg-xsetroot
</code></pre>
<p>write below to <code>~/.xinitrc</code></p>
<pre><code class="shell">xsetroot -cursor_name left_ptr
</code></pre>
<h4 id="window-effect"><a href="#window-effect" class="headerlink" title="window effect"></a>window effect</h4><p>make sure picom has been installed, then write below to <code>~/.xinitrc</code></p>
<pre><code class="shell">picom  --experimental-backends --config .config/picom/picom.conf -b
</code></pre>
<h4 id="xterm-transparent"><a href="#xterm-transparent" class="headerlink" title="xterm transparent"></a>xterm transparent</h4><p>make sure transset-df has been installed, then write below to <code>~/.zshrc</code>. we can change transparent with <code>-m</code> parameter.</p>
<pre><code class="shell">[ -n &quot;$XTERM_VERSION&quot; ] &amp;&amp; transset-df -m 0.95 --id &quot;$WINDOWID&quot; --dec 0.1 &gt;/dev/null
</code></pre>
<h4 id="ntfs-file-system-recognize"><a href="#ntfs-file-system-recognize" class="headerlink" title="ntfs file system recognize"></a>ntfs file system recognize</h4><p>in order to recognize windows file system, the tool need to be installed. and without it we cannot modify windows file by normal user.</p>
<pre><code class="shell">pacman -S ntfs-3g

# mount example
mount -t ntfs-3g /dev/sdaX /mnt
</code></pre>
<h4 id="home-directory"><a href="#home-directory" class="headerlink" title="home directory"></a>home directory</h4><p>with <code>xdg-user-dirs</code> add “well known” user directories in /home/user</p>
<pre><code class="shell">pacman -S xdg-user-dirs
</code></pre>
<p>then run <code>xdg-user-dirs-update</code> to product</p>
<pre><code class="shell">xdg-user-dirs-update
</code></pre>
<h4 id="fat-partition-recognize"><a href="#fat-partition-recognize" class="headerlink" title="fat partition recognize"></a>fat partition recognize</h4><p>in order to mount fat partition or use mkfs.fat format a disk, we need to install <code>dosfstools</code> first.</p>
<pre><code class="shell">pacman -S dosfstools
</code></pre>
<h2 id="other-settings"><a href="#other-settings" class="headerlink" title="other settings"></a>other settings</h2><p>some configure which seems not very important.</p>
<h3 id="grub-theme"><a href="#grub-theme" class="headerlink" title="grub theme"></a>grub theme</h3><ul>
<li><p>gnome look or pacman</p>
<p>   download from the <a href="gnomelook.org">web site</a> or install by pacman and mv to <code>/boot/grub/theme</code> directory</p>
<pre><code class="shell">unzip arch-silence-master.zip                    
mv arch-silence-master /boot/grub/theme/    
</code></pre>
<p>   now tell grub use the new theme, modify <code>/etc/default/grub    </code></p>
<pre><code class="shell">GRUB_THEME=&quot;/boot/grub/themes/arch-silence-master/theme/theme.txt&quot;
</code></pre>
<p>   rebuild <code>grub.cfg</code></p>
<pre><code class="shell">grub-mkcofig -o /boot/grub/grub.cfg
</code></pre>
</li>
<li><p>git hub</p>
<p>   download from <a target="_blank" rel="noopener" href="https://gitee.com/ulomo/grub2-themes">website</a>, unzip and change directory to it and run</p>
<pre><code class="shell">sudo ./install.sh -b -t tela
</code></pre>
<p>   <img src=".images/image-20210224232446970.png" alt="image-20210224232446970"></p>
<p>   uninstall run <code>sudo ./install.sh -r -t tela</code></p>
</li>
</ul>
<h3 id="show-boot-message"><a href="#show-boot-message" class="headerlink" title="show boot message"></a>show boot message</h3><p>in default the boot message is hidden, we can make it showing again.modify <code>/etc/default/grub</code>, remove <code>quiet</code> flag</p>
<pre><code class="shell">GRUB_CMDLINE_LINUX_DEFAULT=&quot;loglevel=3&quot;
</code></pre>
<p>rebuild grub.cfg</p>
<pre><code class="shell">grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
<h3 id="coloize-pacman"><a href="#coloize-pacman" class="headerlink" title="coloize pacman"></a>coloize pacman</h3><p>in default the search result of pacman has no colors, we can change it. modify <code>/etc/pacman.conf</code>, uncomment <code>color</code></p>
<h3 id="colorls"><a href="#colorls" class="headerlink" title="colorls"></a>colorls</h3><p>it is a colorized ls command which can show icons (make sure u have patched font with graph support. such as nerd-fonts-iosevka)</p>
<pre><code class="shell"># it is writed in rube
pacman -S ruby

# then use gem which ruby package manager install colorls
gem install colorls

# follow install output config environment. such as add to .zshrc
source $(dirname $(gem which colorls))/tab_complete.sh

# add path to /etc/profile
append_path &#39;/home/blueocean/.local/share/gem/ruby/2.7.0/bin&#39;
</code></pre>
<p>alias ls to colorls</p>
<pre><code class="shell"># in .zshrc
alias ls=&quot;colorls&quot;

# make effect
source /etc/profile
source ~/.zshrc
</code></pre>
<p><img src=".images/image-20210418125422704.png" alt="image-20210418125422704"></p>
<p>if ruby upgrades, run <code>gem install colorls</code> to upgrade colorls also.</p>
<h3 id="bluetooth"><a href="#bluetooth" class="headerlink" title="bluetooth"></a>bluetooth</h3><p><strong>install base package</strong></p>
<p>use bluetooth to connect device. intall package first</p>
<pre><code class="shell">pacman -S bluez
</code></pre>
<p>provide cli tool</p>
<pre><code class="shell">pacman -S bluez-utils
</code></pre>
<p>provide sounds for bluetooth</p>
<pre><code class="shell">pacman -S pulseaudio-bluetooth
</code></pre>
<p><strong>add user to lp group</strong></p>
<p>it is needed to add user to lp group</p>
<pre><code class="shell">usermod -a -G lp `whoami`
</code></pre>
<p><strong>start bluetooth</strong></p>
<p>check whether or not driver has been launched</p>
<pre><code class="shell">lsmod | grep btusb
</code></pre>
<p>if not launched by hand</p>
<pre><code class="shell">modprobe btusb
</code></pre>
<p>launch service, a reboot needed</p>
<pre><code class="shell">systemctl enable bluetooth.service
systemctl start bluetooth.service
</code></pre>
<blockquote>
<p>note: we need enable bluetooth to start up automaticly, otherwise there will be a error msg of failed</p>
</blockquote>
<p>connect devices the first time</p>
<pre><code class="shell">bluetoothctl
agent KeyboardOnly
default-agent
power on
scan on
pair xxxx
connect xxxx
</code></pre>
<p>a paired device can be connect directory</p>
<pre><code class="shell"># show paired devices
devices
# then connect
connect xxxx
</code></pre>
<h3 id="adjust-video-fan-speed"><a href="#adjust-video-fan-speed" class="headerlink" title="adjust video fan speed"></a>adjust video fan speed</h3><p>make sure nvidia-settings has been installed already.</p>
<pre><code class="shell"># enable fan speed adjust
nvidia-xconfig --cool-bits=4

# then add below to ~/.xinitrc, replace n with the fan speed percentage. such as 10
nvidia-settings -a &quot;[gpu:0]/GPUFanControlState=1&quot; -a &quot;[fan:0]/GPUTargetFanSpeed=n&quot;
</code></pre>
<h3 id="cursor-theme"><a href="#cursor-theme" class="headerlink" title="cursor theme"></a>cursor theme</h3><p>full document can visit <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Cursor_themes#XDG_specification">arch wiki</a> page.</p>
<p>the default cursor theme is bad, i need to change it. before start up, i need to make it clearly there are 3 part should be changed</p>
<ol>
<li>xdg settting for X11</li>
<li>gtk theme setting</li>
<li>terminal setting</li>
</ol>
<p>first download cursor theme you liked <a target="_blank" rel="noopener" href="https://www.gnome-look.org/browse/cat/107/ord/rating/">in this website</a></p>
<p><strong>xdg setting</strong></p>
<pre><code class="shell"># create ~/.icons folder
mkdir ~/.icons

# extract theme folder to ~/.icons
tar -xzf theme.tar.gz -C ~/.icons

# create theme configure file
mkdir ~/.icons/default
touch ~/.icons/default/index.theme

echo &quot;
[icon theme]
Inherits=oreo_spark_blue_cursors
&quot; &gt; ~/.icons/default/index.theme
</code></pre>
<p><strong>gtk setting</strong></p>
<pre><code class="shell"># create theme config file
touch ~/.config/gtk-3.0/settings.ini

echo &quot;
[Settings]
gtk-cursor-theme-name=oreo_spark_blue_cursors
&quot; &gt; ~/.config/gtk-3.0/settings.ini

# polybar use gtk-2.0, so we need copy above setting to gtk2 folder
cp ~/.config/gtk-3.0/settings.ini ~/.config/gtk-2.0/settings.ini
</code></pre>
<p><strong>terminal setting</strong></p>
<pre><code class="shell"># write this in ~/.Xresources
Xcursor.theme: oreo_spark_blue_cursors
Xcursor.size: 16
</code></pre>
<p><strong>make it effect</strong></p>
<pre><code class="shell">xrdb ~/.Xresources
</code></pre>
<p>then relogin desktop</p>
<h3 id="gtk-application-theme-and-icon-theme"><a href="#gtk-application-theme-and-icon-theme" class="headerlink" title="gtk application theme and icon theme"></a>gtk application theme and icon theme</h3><p>it is a long time for google, and cannot find how to set system application theme and icon theme. finally i get it.</p>
<p><strong>First,</strong> we need to know there are two different frames in our application:</p>
<ol>
<li>GTK style</li>
<li>QT style</li>
</ol>
<p>it depends on what kind of language the application to be wrote. not depends on our theme chooseing.</p>
<p><strong>Second,</strong> we need to know there are there kind of themes we can download:</p>
<ol>
<li>application theme. the frame of application which stores in <code>~/.themes</code> or <code>/usr/share/themes</code></li>
<li>icon theme, the icon of application which stores in <code>~/.icons</code> or <code>/usr/share/icons</code></li>
<li>cursor theme, cursor style which stores in <code>~/.icons</code> or <code>/usr/share/icons</code></li>
</ol>
<p><strong>I</strong> follow <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/GTK#GTK_and_Qt">wiki page</a> to configure themes:</p>
<ol>
<li><p>download theme from <a target="_blank" rel="noopener" href="http://opendesktop.org/">this website</a></p>
</li>
<li><p>then extract gtk theme in<code>~/.themes</code>. </p>
<p>extract icon theme in <code>~/.icons</code></p>
<pre><code class="shell">tar -xJf Downloads/WhiteSur-light.tar.xz -C ~/.themes
</code></pre>
<pre><code class="shell">tar -xJf 01-WhiteSur.tar.xz -C ~/.icons
</code></pre>
</li>
<li><p>edit two files</p>
<blockquote>
<p>Note:</p>
<p>i find a more beautiful font rather than <code>Cantarell</code></p>
<p>use <code>CaskaydiaCove Nerd Font 10</code> instead of <code>Cantarell 11</code></p>
</blockquote>
<p>gtk2 application need to edit file <code>/usr/share/gtk-2.0/gtkrc</code> or <code>.config/gtk-2.0/gtkrc</code></p>
<pre><code class="shell">cat /usr/share/gtk-2.0/gtkrc 
gtk-icon-theme-name = &quot;WhiteSur-light&quot;
gtk-theme-name = &quot;WhiteSur-light&quot;
gtk-font-name = &quot;Cantarell 11&quot;
</code></pre>
<p>gtk3 application can edit <code>/usr/share/gtk-3.0/settings.ini</code> or <code>.config/gtk-3.0/settings.ini</code></p>
<pre><code class="shell">cat ~/.config/gtk-3.0/settings.ini 
[Settings]
gtk-cursor-theme-name = oreo_spark_blue_cursors
gtk-icon-theme-name = WhiteSur-light
gtk-theme-name = WhiteSur-light
gtk-font-name = Cantarell 11
</code></pre>
</li>
</ol>
<p>then relogin desktop, most of applications will show specified theme correctly. however some of applications such as vbox still the same as before shows like this:</p>
<p><img src=".images/image-20210808000347792.png" alt="image-20210808000347792"></p>
<p>and at last i find that it is because the application writes by QT, so we cannot apply GTK theme to it. and i find the fixed method: <strong>make QT application use GTK theme <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Uniform_look_for_Qt_and_GTK_applications#Using_a_GTK_icon_theme_in_Qt_apps">in this page</a></strong></p>
<pre><code class="shell"># write this to ~/.xinitrc if i use window manager
export DESKTOP_SESSION=gnome
</code></pre>
<p>relogin desktop, and then the virtualbox shows correct themes, it is really amazing!</p>
<p><img src=".images/image-20210808000209103.png" alt="image-20210808000209103"></p>
<p><strong>only for one specified app</strong></p>
<p>above setting will change all app theme, however we can define some app with specified theme.</p>
<pre><code class="shell"># go to this folder
cd /usr/share/applications
# find which app should be change
vim leafpad.desktop

# find Exec line
Exec=leafpad %F
# change it to specified theme
Exec=env GTK_THEME=WhiteSur-light:light leafpad %F
</code></pre>
<p>restart app, theme will make effect. but it seems that it’s only make effect if we have no theme setting by default.</p>
<h3 id="font-setting"><a href="#font-setting" class="headerlink" title="font setting"></a>font setting</h3><p>at first, we need to know the category of fonts.</p>
<ul>
<li>bitmap: often used in system console</li>
<li>latin script:<ul>
<li>serif: shows great in large font, no good in small font. often used in title and printing.</li>
<li>sans-serif: shows great in small font and web page.</li>
<li>monospace: often used in coding.</li>
<li>family: include above there fonts.</li>
</ul>
</li>
<li>non-latin script: chinese/japanese and others</li>
<li>emoji and symbols</li>
<li>math</li>
<li>other operating system fonts</li>
</ul>
<p>so in a GUI operation system, we often use latin for english and non-latin for chinese. emoji and math is optional. notice that console can use bitmap only.</p>
<blockquote>
<p>user font can be set in <code>~/.local/share/fonts</code></p>
<p>then use <code>fc-cache</code> to build font cache.</p>
</blockquote>
<p>in order to configure font manually, we need two step:</p>
<ol>
<li> make effect of user setting</li>
</ol>
<pre><code class="shell">mkdir ~/.config/fontconfig/conf.d
ln -s /usr/share/fontconfig/conf.avail/50-user.conf ~/.config/fontconfig/conf.d
</code></pre>
<ol start="2">
<li><p>manually font setting</p>
<pre><code class="shell">touch ~/.config/fontconfig/fonts.conf
</code></pre>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &quot;fonts.dtd&quot;&gt;
&lt;fontconfig&gt;
    &lt;match target=&quot;font&quot;&gt;
        &lt;edit name=&quot;autohint&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;false&lt;/bool&gt; &lt;/edit&gt;
        &lt;edit name=&quot;antialias&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;true&lt;/bool&gt; &lt;/edit&gt;
        &lt;edit name=&quot;hinting&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;true&lt;/bool&gt; &lt;/edit&gt;
        &lt;edit name=&quot;hintstyle&quot; mode=&quot;assign&quot;&gt; &lt;const&gt;hintslight&lt;/const&gt; &lt;/edit&gt;
        &lt;edit name=&quot;rgba&quot; mode=&quot;assign&quot;&gt; &lt;const&gt;rgb&lt;/const&gt; &lt;/edit&gt;
        &lt;edit name=&quot;lcdfilter&quot; mode=&quot;assign&quot;&gt; &lt;const&gt;lcddefault&lt;/const&gt; &lt;/edit&gt;
        &lt;edit name=&quot;embeddedbitmap&quot; mode=&quot;assign&quot;&gt; &lt;bool&gt;false&lt;/bool&gt; &lt;/edit&gt;
    &lt;/match&gt;

    &lt;!--fallback font order--&gt;
    &lt;alias&gt;
        &lt;family&gt;serif&lt;/family&gt;
        &lt;prefer&gt;
            &lt;family&gt;DejaVu Serif&lt;/family&gt;
            &lt;family&gt;Source Han Sans CN&lt;/family&gt;
        &lt;/prefer&gt;
    &lt;/alias&gt;
    &lt;alias&gt;
        &lt;family&gt;sans-serif&lt;/family&gt;
        &lt;prefer&gt;
            &lt;family&gt;Inter&lt;/family&gt;
            &lt;family&gt;Source Han Sans CN&lt;/family&gt;
        &lt;/prefer&gt;
    &lt;/alias&gt;
    &lt;alias&gt;
        &lt;family&gt;monospace&lt;/family&gt;
        &lt;prefer&gt;
            &lt;family&gt;Ubuntu&lt;/family&gt;
            &lt;family&gt;Source Han Sans CN&lt;/family&gt;
        &lt;/prefer&gt;
    &lt;/alias&gt;
&lt;/fontconfig&gt;
</code></pre>
</li>
</ol>
<p>i use <code>DejaVu Serif</code> for serif, <code>Inter</code> for sans-serif, <code>Ubuntu</code> for monospace. the same setting for firefox and it shows great.</p>
<h3 id="virtual-machine"><a href="#virtual-machine" class="headerlink" title="virtual machine"></a>virtual machine</h3><h4 id="virtualbox"><a href="#virtualbox" class="headerlink" title="virtualbox"></a>virtualbox</h4><p><strong>load kernel module</strong></p>
<p>before we can run virtual machine, we need load <code>vboxdrv</code> kernel module before</p>
<pre><code class="shell">modprobe vboxdrv
</code></pre>
<p>when we launch a virtualbox os with desktop environment, the most import thing is the size of window, for what the default size is to small.</p>
<p>if we use windows we can directily click the top bar menu and choose install third extension, after finish, we can login windows and click install extension.</p>
<p><strong>screen size with command</strong></p>
<p>however in linux, it is much complex, one method i find good enough is use command to specify to size without install extension and working fine.</p>
<pre><code class="shell"># first use cvt to product the screen size info
cvt length width

# second install xorg-xrandr and use it to set size
pacman -S xorg-xrandr

# add the standout of cvt 
xrandr --newmode 

# add a new mode
xrandr --addmode Virtual-1 lengthxwidth_refreshrate

# change screen size
xrandr --output Virtual-1 --mode lengthxwidth_refreshrate


# for example
cvt 2550 1406
xrandr --newmode &quot;2552x1406_60.00&quot;  302.75  2552 2736 3008 3464  1406 1409 1419 1458 -hsync +vsync
xrandr --addmode Virtual-1 2552x1406_60.00
xrandr --output Virtual-1 --mode 2552x1406_60.00
</code></pre>
<p><strong>screen size with iso file</strong></p>
<p>yeah, there comes <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/310320/cant-get-fullscreen-resolution-on-ubuntu-hosted-on-virtualbox">another method</a> which work most of the time i find in the website.The most important thing, <strong>do not use</strong> THE “GUEST  ADDITIONS CD” come along with the Oracle VirtualBox, which you usually  find in the menu “Devices” - “Insert Guest Additions CD Image”. <strong>But</strong> download the latest VBoxAdditions iso file from the <a target="_blank" rel="noopener" href="http://download.virtualbox.org/virtualbox/">official webpage</a>, mount the image file in your virtual machine and then run the shell file “VBoxLinuxAdditions.run”:</p>
<pre><code class="shell">sudo sh  VBoxLinuxAdditions.run
</code></pre>
<p>Type in the password when prompted. Restart your virtual machine, then everything should work now.</p>
<h4 id="kvm"><a href="#kvm" class="headerlink" title="kvm"></a>kvm</h4><p>I have used virtualbox so many years when i first heard of it, it is quiet simple, free and i like it very much. However today when i see DT’s video, he introduces virt-manager to manager virtual machine, i think i need try it. Because kvm is the kernel based virtual machine, its performance may improved a lot then virtualbox. At first we need to know some concept:</p>
<ul>
<li><p>kvm: kernel based virtual machine,  provide the ability to start virtual machine.</p>
</li>
<li><p>qemu: machine emulator which can use kvm hypervisor or others. </p>
</li>
<li><p>libvirt: libs(network, storage and etc), daemon, command utility(virsh)</p>
</li>
<li><p>virt-manager: gui tool for easily build/manage virtual machine.</p>
</li>
</ul>
<p>at first, check whether support kvm</p>
<pre><code class="shell">LC_ALL=C lscpu | grep Virtualization
</code></pre>
<p>if the output not empty, then we can install the needed tools</p>
<pre><code class="shell"># virt-manager includes libvirt
pacman -S qemu virt-manager

# other tool that libvirtd need
pacman -S ebtables dnsmasq dmidecode
</code></pre>
<blockquote>
<p>Note: </p>
<ol>
<li><p><code>ebtables</code> and <code>dnsmasq</code> is very important for virt-manager to manage/build host network bridge and dnsmasq in iptables, without them the network in virtual machine may be faild to connect.</p>
</li>
<li><p>dmidecode used for showing host information in virt-manager.</p>
</li>
<li><p>so,  in host machine iptables must be enabled and started for virt-manager to manage virtual machine network.</p>
</li>
</ol>
</blockquote>
<p>then enable and start libvirtd daemon</p>
<pre><code class="shell">systemctl enable --now libvirtd
</code></pre>
<p>after start up, we need add our user to libvirt group. </p>
<blockquote>
<p> Note: without this step, there may be some auth errors.</p>
</blockquote>
<pre><code class="shell">usermod -a -G libvirt [user_name]
</code></pre>
<p>finally, we can launch virt-manager to build/manage virtual machine.</p>
<p><strong>add new image location</strong></p>
<p>the default image location is <code>/var/lib/libvirt/images</code>, we can add a new storage location via virt-manager</p>
<p><img src="./.images/2021-12-04-13-56-30-image.png" alt="virt-manager"></p>
<p><strong>convert virtualbox images to kvm images</strong></p>
<pre><code class="shell"># for example convert archlinux.vdi to archlinux
# er, i convert serveral images from vdi to qcow2 and all of them faild in find disk with UUID
qemu-img convert -f vdi -O qcow2 archlinux.vdi ~/Public/kvm/images/archlinux
</code></pre>
<p><strong>add uefi support</strong></p>
<p>install edk2-ovmf to support uefi</p>
<pre><code class="shell">pacman -S edk2-ovmf

# then restart libvertd
systemctl restart libvertd
</code></pre>
<p><strong><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/107633/how-do-i-get-my-mouse-back-from-qemu-kvm">get mouse back from virt-manager</a></strong></p>
<p>use <code>left ctrl + left alt</code> to release focus in virt-manager. or <code>left ctrl + left alt + g</code> when use GTK fronted of qemu.</p>
<p><strong>some important virsh command</strong></p>
<p><code>virsh</code> is libvirt’s command line tool, include commands which can operate the virtual machine instead of virt-manager, however it is much complex.</p>
<p><em>virtual machine is called domain in libvirt</em></p>
<pre><code class="shell"># list all running machines/domains (include id/domain-name)
sudo virsh list

# list all machines/domains
sudo virsh list --all

# list all networks
sudo virsh net-list

# list all pools/images storage position
sudo virsh pool-list

# list all volumes/images
sudo virsh vol-list [pool-name]

# list domain/machine info
sudo virsh dominfo [domain-name/id]

# list domain/machine ipaddress
sudo virsh domifaddr [domain-name/id]

# start/shutdown/suspend domain/machine
sudo virsh start/shutdown/suspend [domain-name/id]

# start network
sudo virsh net-start [network-name]
</code></pre>
<p><strong>user comand line to start up a virtual machine</strong></p>
<pre><code class="shell"># start up network
sudo virsh net-list
sudo virsh net-start [network-name]
# start virtual machine
sudo virsh list --all
sudo virsh start [domain-name/id]
# get virtual machine&#39;s ip address
sudo virsh domifaddr [domain-name/id]
# then use ssh to connect remote linux or rdesktop to connect windows
</code></pre>
<p><strong>fix cannot adjust resolution</strong></p>
<p>most of time we start up a new virtual machine in virt-manager, the resolution cannot adjust correctly, the way to fix it is change virt-manager video model.</p>
<p>we can change <code>QXL</code> to <code>Virtio</code> or <code>VGA</code></p>
<p><strong>share folder</strong></p>
<p>for example make host’s <code>Desktop</code> folder as a share folder, we need to change Desktop folder’s permistion to 777</p>
<pre><code class="shell">chmod 777 ~/Desktop
</code></pre>
<p>in virt-manager create a new file filesystem and mount to <code>/mnt</code> for example</p>
<p>in virtual machine use command to mount the new share folder</p>
<pre><code class="shell"># for example mount share folder to Desktop
mount -t 9p -o trans=virtio /mnt Desktop
</code></pre>
<p><strong>use qemu command to create/start virtual machine with GUI</strong></p>
<p><em>shortcut</em>:</p>
<ul>
<li>fullscreen: ctrl+alt+f</li>
<li>menu: ctrl+alt+m</li>
<li>grab mouse: ctrl+alt+g (effect only when menu bar shows)</li>
</ul>
<pre><code class="shell"># create a file block to install virtual machine
qemu-img create -f qcow2 [virtual-name] [disk-size]

# eg:
qemu-img create -f qcow2 android.img 10G


# install OS to file block
qemu-system-x86_64 -enable-kvm -cdrom android.iso -drive file=./android.img 

# start virtual machine
# cpu: host has the best performance
# smp: cpu thread
# m: memory
# vga: video method
# soundhw: sound device

# eg:
qemu-system-x86_64 -enable-kvm -drive file=./android.img -cpu host -smp 4 -m 4G -vga virtio -display sdl,ql=on -soundhw=hda

qemu-system-x86_64 -enable-kvm -drive file=win11.qcow2 -cpu host -smp 4 -m 4G -vga virtio -display gtk,gl=on,full-screen=on -soundhw hda
</code></pre>
<h3 id="connect-remote-windows"><a href="#connect-remote-windows" class="headerlink" title="connect remote windows"></a>connect remote windows</h3><p>windows remote desktop via udp/3389, so if i wanna to connect to windows in linux machine, i need to install a client with the ability to connect windows supported protocol. there are a lot of tools, but i choose the <code>rdesktop</code>, since it is a simple command line tool.</p>
<pre><code class="shell">pacman -S rdesktop
</code></pre>
<pre><code class="shell"># better rander
rdesktop -g 100% -r sound:local -x l -M -K  -P -z 192.168.122.157:3389
</code></pre>
<ul>
<li><p><code>-g 100%</code>: automatically scale the geometry to fit screen.</p>
</li>
<li><p><code>-r sound:local</code>: redirect remote machine sound to local.</p>
</li>
<li><p><code>-M</code>: use linux system’s mouse instead of remote machine’s mouse.</p>
</li>
<li><p><code>-K</code>: use linux window manager instead of remote machine’s window manager.</p>
</li>
<li><p><code>-x l</code>: rander remote desktop’s wallpaper, window motion. </p>
</li>
<li><p><code>-P</code>: enable bitmap cache to disk to improve performance.</p>
</li>
<li><p><code>-z</code>: enable compress rdp datastream.</p>
</li>
<li><p><code>192.168.122.157:3389</code>: remote mahine’s ip and port.</p>
</li>
</ul>
<pre><code class="shell"># low level rander
rdesktop -g 100% -r sound:local -x m -M -K -P -z -b 192.168.122.157:3389
</code></pre>
<blockquote>
<p>Note: when use <code>-P</code> option, will create a directory  <code>~/.rdesktop/cache</code>, in order to speed up the access time, we can mount this directory to memory.</p>
</blockquote>
<pre><code class="shell"># nvim /etc/fstab

tmpfs    /home/healer/.rdesktop/cache    tmpfs   rw,nodev,nosuid    0 0
</code></pre>
<h3 id="auto-login"><a href="#auto-login" class="headerlink" title="auto login"></a>auto login</h3><p>archlinux use agetty to manage virtual console, we can use it to automatic login system without password. </p>
<pre><code class="shell">mkdir /etc/systemd/system/getty@tty1.service.d
touch /etc/systemd/system/getty@tty1.service.d/override.conf

# change username with login user name
echo &quot;
[Service]
ExecStart=
ExecStart=-/usr/bin/agetty --autologin username --noclear %I $TERM
&quot; &gt; /etc/systemd/system/getty@tty1.service.d/override.conf
</code></pre>
<p>relogin system will make effect.</p>
<p>if we also want to login desktop environment, we can do it like this.</p>
<pre><code class="shell">echo &quot;
if [[ ! $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]]; then
    exec startx &amp;&gt;/dev/null
fi
&quot; &gt; ~/.zprofile
</code></pre>
<h3 id="connect-remote-linux"><a href="#connect-remote-linux" class="headerlink" title="connect remote linux"></a>connect remote linux</h3><p>in linux, there is no default remote service installed by default, so if we wanna to connect to remote linux with GUI interface, we need install a VNC server in remote linux and then install a VNC client in local machine to connect to remote.</p>
<p><strong>in remote</strong></p>
<p>the easiest way is to install <code>x11vnc</code></p>
<pre><code class="shell">pacman -S x11vnc
</code></pre>
<p>then create a connection passwd</p>
<pre><code class="shell">x11vnc -storepasswd
</code></pre>
<p>the command above will create a passwd file in <code>~/.vnc/passwd</code> by default.</p>
<p>then start vnc server</p>
<pre><code class="shell">x11vnc -display :0
</code></pre>
<p><strong>in local</strong></p>
<p>remmina is a common GUI tool that support lots of protocol</p>
<pre><code class="shell">pacman -S remmina
pacman -S libvncserver
</code></pre>
<h3 id="auto-suspend"><a href="#auto-suspend" class="headerlink" title="auto suspend"></a>auto suspend</h3><p>in order to save power while we don’t use computer with a specified time. we can use <code>slock</code> and <code>xautolock</code></p>
<p><strong>suspend with shortcut</strong></p>
<pre><code class="shell"># write this in xmonad.hs and triger with shortcut
((0 , xK_l), spawn &quot;slock &amp; systemctl suspend&quot;)
</code></pre>
<p><strong>auto suspend with specified time</strong></p>
<p>run <code>xautolock</code> while system startup and auto sleep with specified time</p>
<pre><code class="shell"># write this in xmonad.hs which will run while login desktop (30 minites)
spawnOnce &quot;xautolock -time 30 -locker &#39;systemctl suspend&#39; -detectsleep&quot;

# or write this in .xinitrc
xautolock -time 30 -locker &#39;systemctl suspend&#39; -detectsleep
</code></pre>
<h3 id="cache-browser-data-to-memory"><a href="#cache-browser-data-to-memory" class="headerlink" title="cache browser data to memory"></a>cache browser data to memory</h3><p>install</p>
<pre><code class="shell"># install psd
pacman -S  profile-sync-daemon

# first run create configure file
~ » psd                                                                                                                                                                                               ~  
 First time running psd so please edit /home/healer/.config/psd/psd.conf to your liking and run again.
</code></pre>
<p>configure</p>
<pre><code class="shell"># enable
systemctl --user enable psd

# configure overlay and browser
vim ~/.config/psd/psd.conf

USE_OVERLAYFS=&quot;yes&quot;
BROWSERS=(firefox)
</code></pre>
<h3 id="cache-anything-to-RAM"><a href="#cache-anything-to-RAM" class="headerlink" title="cache anything to RAM"></a>cache anything to RAM</h3><p>the benefit of <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Anything-sync-daemon">asd</a> is that it can speed the access of some <strong>folder</strong> (not file) and makes the file to store in physical possible.</p>
<pre><code class="shell">sudo pacman -S anything-sync-daemon
</code></pre>
<p>edit <code>/etc/asd.conf</code></p>
<pre><code class="shell"># put the folder which i want to load to memory
WHATTOSYNC=(
&#39;/home/healer/.oh-my-zsh/his&#39;
)
</code></pre>
<blockquote>
<p>Note:</p>
<p>by default <code>.zsh_history</code> stores in <code>$HOME</code>, but asd can only sync folders. And <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/265957/zsh-histfile-still-read-from-zsh-history">there is a way</a> to set history to another folder: define <code>HISTFILE</code> variable before oh-my-zsh in <code>~/.zshrc</code></p>
<pre><code class="shell">HISTFILE=~/.oh-my-zsh/his/.zsh_history
source $ZSH/oh-my-zsh.sh
</code></pre>
</blockquote>
<p>at last enable asd service at boot time and start asd</p>
<pre><code class="shell">sudo systemctl enable --now asd
</code></pre>
<h3 id="screen-rotation"><a href="#screen-rotation" class="headerlink" title="screen rotation"></a>screen rotation</h3><p>use <code>xrandr</code> described in <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Tablet_PC#Screen_rotation">wiki page</a></p>
<pre><code class="shell"># add a key binding in xmonad
# output name can be find with xrandr
xrandr --output HDMI-A-0 --rotate left
xrandr --output HDMI-A-0 --rotate normal
</code></pre>
<h3 id="firefox-adds-on"><a href="#firefox-adds-on" class="headerlink" title="firefox adds-on"></a>firefox adds-on</h3><p>some useful adds-on</p>
<p><img src=".images/image-20210817102719051.png" alt="image-20210817102719051"></p>
<h3 id="burn-dvd"><a href="#burn-dvd" class="headerlink" title="burn dvd"></a>burn dvd</h3><p>I have to say that the idea why i want to use dvd is because of one youtuber called DT, he has a video told why he uses dvd still today, and i thought it is a perfect idea.</p>
<p>The main reason i use dvd is that can store long times without information lose, and has a feeling of old life in such a fast society.</p>
<p>there are two things need to be noticed:</p>
<ol>
<li>new blank DVD-R cannot be mounted, it needs to burn data first.</li>
<li>a toolset <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Optical_disc_drive#Burning">dvd+rw-tools</a> contains the tool <code>growisofs</code> which can burn data to DVD-R.</li>
</ol>
<pre><code class="shell"># install toolset
pacman -S dvd+rw-tools

# insert new DVD-R to DVD burn machine
# burn data to new DVD-R
growisofs -Z /dev/sr0 -R -J /some/files

# append data to DVD-R
growisofs -M /dev/dvd -R -J /more/files
</code></pre>
<p>after burning data to DVD-R we can mount it</p>
<pre><code class="shell">mount /dev/sr0 /mnt
</code></pre>
<h3 id="email-receiving"><a href="#email-receiving" class="headerlink" title="email receiving"></a>email receiving</h3><p><code>mutt</code> is a linux CLI application of email client. although GUI mail applications such as MailSpring, BlueMail are very friendly use, but the size of GUI packages are much bigger than CLI applications.</p>
<pre><code class="shell">sudo pacman -S mutt
</code></pre>
<p>mutt’s default configure can be set in <code>~/.config/mutt/muttrc</code></p>
<pre><code class="shell"># create local mail store loction and mutt configuration file
mkdir ~/.local/share/Mail ~/.config/mutt
touch ~/.config/mutt/muttrc
</code></pre>
<p><code>muttrc</code> configuration </p>
<pre><code class="shell"># RECEIVING EMAIL SETTING (IMAP)
# user and password
set imap_user       = 1025096440@qq.com
set imap_pass       = lcfqrejgdeggbcic
# address of colud mailbox
set folder          = imaps://1025096440@imap.qq.com/
set spoolfile       = +INBOX
# architure of cloud mailbox checking
mailboxes           = +INBOX +SENT
# receiving of sending file local store position
set folder          = &quot;$HOME/.local/share/Mail&quot;; set record=&quot;+sent&quot;
set imap_keepalive  = 300
set mail_check      = 5
set sort            = reverse-date

# SENDING EMAIL SETTING (SMAP)
# user name of sending from
set realname        = shutterbug
# address and password of sending from
set from            = $imap_user
set smtp_pass       = $imap_pass 
# cloud SMAP server address
set smtp_url        = smtps://1025096440@qq.com@smtp.qq.com
# use ssl enforce
set ssl_force_tls   = yes



# style and editor define
set arrow_cursor
#set folder_format=&quot;%2C %t %N %8s %d %f&quot;
set sidebar_short_path  = yes
set sidebar_width       = 22
set sidebar_visible     = yes
set sidebar_format      = &quot;%B%* %N/%S &quot;
set index_format=&quot;%3C %-5Z %&#123;%b %d      &#125; %-25.20L (%?l?%4l&amp;%4c?) %s&quot;
set editor          = vim
# html render with w3m
set mailcap_path    = $HOME/.config/mutt/mailcap
auto_view text/html
alternative_order text/plain text/html
# key binding
bind pager j next-line
bind pager k previous-line
bind attach,index,pager \CD next-page
bind attach,index,pager \CU previous-page
bind pager g top
bind pager G bottom
bind attach,index g first-entry
bind attach,index G last-entry
bind index,pager B sidebar-toggle-visible 
# color scheme
color hdrdefault blue black
color quoted blue black
color signature blue black
color attachment red black
color prompt brightmagenta black
color message brightred black
color error brightred black
color indicator red black 
color status brightgreen blue
color tree blue black
color normal white black
color markers red black
color search white black
color tilde brightmagenta black
color index blue black ~F
color index red black &quot;~N|~O&quot;
</code></pre>
<p>by default mutt cannot render html page, however we can use w3m to resolve it with the configuration file <code>$HOME/.config/mutt/mailcap</code></p>
<pre><code class="shell">text/html; w3m -I %&#123;charset&#125; -T text/html; copiousoutput;
</code></pre>
<p>we can type <code>mutt</code> to launch the email client use <code>space</code> key to open the content of email</p>
<p>sending email is little difference</p>
<pre><code class="shell"># launch text editor to edit message
mutt -s &#39;tile&#39; user@email.com

# or message from file content
mutt -s &quot;Subject&quot; somejoeorjane@someserver.com &lt; /var/log/somelog

# or append some file
mutt -s &quot;Subject&quot; somejoeorjane@someserver.com -a somefile &lt; /tmp/sometext.txt
</code></pre>
<blockquote>
<p>Note:</p>
<p>change sidebar folder press <code>c</code>, then press <code>tab</code> twice</p>
</blockquote>
<h3 id="external-monitor-brightness"><a href="#external-monitor-brightness" class="headerlink" title="external monitor brightness"></a>external monitor brightness</h3><p>when i use a monitor display, i cannot adjust the brightness with <code>xbacklight</code> tool. today, i find the reason why i cannot adjust it <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/backlight#setpci">in this website</a>. simple to say, external monitor needs other tools to change brightness.</p>
<pre><code class="shell"># it need a kernel module to be loaded
sudo modprobe i2c-dev

# install a tool called ddcutil
sudo pacman -S ddcutil

# then find which feature can adjust the brightness
sudo ddcutil capabilities |grep -i brightness


➜  acpi_video0 sudo ddcutil capabilities |grep -i brightness
   Feature: 10 (Brightness)
# i find it is 10, then i can adjust it
# 10 is the feature number
sudo ddcutil setvcp 10 30
# increase/decrease
sudo ddcutil setvcp 10 + 5
sudo ddcutil setvcp 10 - 5

# and check it
sudo ddcutil getvcp 10
</code></pre>
<p>finally i need the module to be loaded at boot time, we can add this feature as describe <a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Kernel_module#Automatic_module_loading_with_systemd">in this website</a>. </p>
<pre><code class="shell">sudo touch /etc/modules-load.d/i2c-dev.conf
sudo echo i2c_dev &gt; /etc/modules-load.d/i2c-dev.conf
</code></pre>
<p>change <code>ddcutil</code> permission to let normal user can execute it</p>
<pre><code class="shell"># setuid can make normal user execute some file with the file&#39;s owner permission
sudo chmod u+s /usr/bin/ddcutil
</code></pre>
<p>then add shortcut to xmonad</p>
<pre><code class="haskell">((mod1Mask, xK_F6), spawn &quot;ddcutil setvcp 10 - 5&quot;)
((mod1Mask, xK_F8), spawn &quot;ddcutil setvcp 10 + 5&quot;)
</code></pre>
<h2 id="command-software-usage"><a href="#command-software-usage" class="headerlink" title="command/software usage"></a>command/software usage</h2><p>common command and software usage.</p>
<h3 id="journal"><a href="#journal" class="headerlink" title="journal"></a>journal</h3><p>journal is the logging system of systemd. default log location in <code>/var/log/journal</code>. in default setting the size of log will increate until 10% of total disk.</p>
<pre><code class="shell"># we can change the default setting, unit Mib
vim /etc/systemd/journald.conf

SystemMaxFiles=10
</code></pre>
<p>we can clean by hand</p>
<pre><code class="shell"># show disk usage
journalctl --disk-usage

# clean 
# vacuum cannot remove active or unarchived file. and rotate can archive active file.
journalctl --rotate --vacuum-size=1
journalctl --rotate --vacuum-time=1
</code></pre>
<h3 id="format-convert"><a href="#format-convert" class="headerlink" title="format convert"></a>format convert</h3><blockquote>
<p>note:</p>
<p>   utf-8 and gbk are both character encoding, and they are differect, we need to know utf-8 is much better than gbk, for utf-8 support more.</p>
</blockquote>
<p>if software cannot show text normally, we have two method to repair it.</p>
<ol>
<li>change software setting to display normally if software has the ability</li>
<li>change file encoding to which software use with tools</li>
</ol>
<p>for example:</p>
<p>as we know windows file encode with gbk, and it cannot display normally in linux vim editor in default, we can add vim setting to support it</p>
<pre><code class="shell">vim ~/.vimrc

set fileencodings=utf-8,gb18030,gbk
</code></pre>
<p>another method is change file encoding</p>
<pre><code class="shell">iconv -f gbk -t utf-8 1.txt -o 2.txt
</code></pre>
<ul>
<li><code>-f</code> from</li>
<li><code>-t</code> to</li>
<li><code>-o</code> output file</li>
</ul>
<h3 id="qv2ray-amp-v2ray-core"><a href="#qv2ray-amp-v2ray-core" class="headerlink" title="qv2ray &amp; v2ray-core"></a>qv2ray &amp; v2ray-core</h3><blockquote>
<p>Note:</p>
<ol>
<li>buy proxy, i buy though iGG. with iGG i can get scribe url</li>
<li>install software to config scribe url</li>
</ol>
</blockquote>
<p>because yay cannot download software from github, most time will failed to install some software. so need to install a software to proxy.</p>
<p>Qv2ray is a v2ray client gui tool for configing v2ray. and v2ray-core is the core of v2ray.</p>
<ul>
<li><p>download</p>
<p>download <a target="_blank" rel="noopener" href="https://github.com/Qv2ray/Qv2ray/releases">qv2ray</a> , i choose appimage, it can be run directory without install</p>
<p>download <a target="_blank" rel="noopener" href="https://github.com/v2fly/v2ray-core/releases">v2ray-core</a>, a 64bit zip file</p>
</li>
<li><p>configure qv2ray</p>
<p>follow <a target="_blank" rel="noopener" href="https://iguge.app/helper/?p=257">this website</a></p>
<pre><code class="shell"># create a app folder
mkdir .local/apps/qv2ray
# move appimage to qv2ray
mv Downloads/Qv2ray.v2.6.3.linux-x64.AppImage .local/apps/qv2ray
# then run this app
chmod u+x ./Qv2ray.v2.6.3.linux-x64.AppImage
./Qv2ray.v2.6.3.linux-x64.AppImage

# create v2ray-core folder
mkdir .local/apps/qv2ray/vcore
# unzip v2ray-core to new folder
unzip Download/v2ray-linux-64.zip -d .local/apps/qv2ray/vcore
# then configure in gui app
</code></pre>
<p>change file location and click “ok”</p>
<p><img src=".images/image-20210505013851544.png" alt="image-20210505013851544"></p>
</li>
<li><p>and follow website to add scribe address, then we can use proxy to visit website</p>
</li>
<li><p>the way to allow yay(git) to proxy follow <a target="_blank" rel="noopener" href="https://iguge.app/helper/?p=152">this website</a></p>
<pre><code class="shell">-- git
# http https
git config --global http.proxy http://127.0.0.1:8889
git config --global https.proxy https://127.0.0.1:8889
# socks5
git config --global http.proxy socks5://127.0.0.1:1089
git config --global https.proxy socks5://127.0.0.1:1089
</code></pre>
<p>– speed github</p>
</li>
</ul>
<h1 id="configure-http-https-proxy"><a href="#configure-http-https-proxy" class="headerlink" title="configure http https proxy"></a>configure http https proxy</h1><p>  git config –global http.<a target="_blank" rel="noopener" href="https://github.com.proxy/">https://github.com.proxy</a> <a target="_blank" rel="noopener" href="https://127.0.0.1:8889/">https://127.0.0.1:8889</a><br>  git config –global https.<a target="_blank" rel="noopener" href="https://github.com.proxy/">https://github.com.proxy</a> <a target="_blank" rel="noopener" href="https://127.0.0.1:8889/">https://127.0.0.1:8889</a></p>
<h1 id="configure-socks5-proxy-this-is-what-yay-used"><a href="#configure-socks5-proxy-this-is-what-yay-used" class="headerlink" title="configure socks5 proxy, this is what yay used"></a>configure socks5 proxy, this is what yay used</h1><p>  git config –global http.<a target="_blank" rel="noopener" href="https://github.com.proxy/">https://github.com.proxy</a> socks5://127.0.0.1:1089<br>  git config –global https.<a target="_blank" rel="noopener" href="https://github.com.proxy/">https://github.com.proxy</a> socks5://127.0.0.1:1089</p>
<pre><code>the port we can find in gui configure

![image-20210505014434826](.images/image-20210505014434826.png)

- after configure, if i need to use yay, first choose a proxy and enable it, then use yay to download software, speed fast.

![image-20210505015404595](.images/image-20210505015404595.png)

- at last create a soft link to appimage

```shell
cd .local/bin
ln -sf ~/.local/apps/qv2ray/Qv2ray.v2.7.0-pre2.linux-x64.AppImage v2ray
</code></pre>
<pre><code class="shell"># usage: such as reconnect last connect
v2ray --reconnect
</code></pre>
<h3 id="terminal-proxy"><a href="#terminal-proxy" class="headerlink" title="terminal proxy"></a>terminal proxy</h3><p>above v2ray setting can allow git / github /browser proxy, but terminal cannot. below will show how to proxy terminal.</p>
<p>the setting can work correctly depend on above v2ray work fine</p>
<pre><code class="shell">sudo pacman -S proxychains-ng 
</code></pre>
<p>modify configure file</p>
<pre><code class="shell"># add this to file end
#socks4         127.0.0.1 9050
http    127.0.0.1 8889
socks5  127.0.0.1 1089
</code></pre>
<p>proxy terminal</p>
<pre><code class="shell">proxychains bash
</code></pre>
<p><img src=".images/image-20210505021635397.png" alt="image-20210505021635397"></p>
<p><img src=".images/image-20210505021703497.png" alt="image-20210505021703497"></p>
<h3 id="cronie-notify"><a href="#cronie-notify" class="headerlink" title="cronie notify"></a>cronie notify</h3><p>i use cronie to edit time task</p>
<pre><code class="shell">pacman -S cronie
</code></pre>
<p>in default, cronie use <code>vi</code> to edit task. we can change it vim</p>
<pre><code class="shell">EDITOR=vim crontab -e
</code></pre>
<p>there are some principles we need to follow:</p>
<ol>
<li>message cannot send to dbus directorily</li>
<li>crontab don’t know system variables, we need to announce it</li>
<li>stdout not support pipline</li>
<li>cannot recognize local command such as <code>~/.local/bin</code></li>
</ol>
<p>in order to use notify and sound we need announce variables either in script or crontab command</p>
<pre><code class="shell">## sound variable
# check variable&#39;s value
echo $XDG_RUNTIME_DIR
# 1. write in script
export XDG_RUNTIME_DIR=/run/user/1000

# 2. or announce in crontab
env XDG_RUNTIME_DIR=/run/user/1000


## nofify
# check variable&#39;s value
echo $DBUS_SESSION_BUS_ADDRESS
# 1. write in script
export DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
# 2. or announce in crontab
env DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/1000/bus
</code></pre>
<p>we can write crontab like this:</p>
<pre><code class="shell">* * * * * env DBUS_SESSION_BUS_ADDRESS=unix:path=&quot;/run/user/1000/bus&quot; XDG_RUNTIME_DIR=&quot;/run/user/1000&quot; dunstify &quot;`~/.local/bin/filesync`&quot;
</code></pre>
<p>however, there is a problem. if we send nothing, the dunst will also show a none notify. we can fix it by writing command in script, and then execute script</p>
<pre><code class="shell">function log()&#123;
    exec 1&gt;&amp;4
    if [ $# -gt 0 ];then
        info=$@
        echo &quot;[$(date &#39;+%F %H:%M&#39;)] :: $info&quot;
        # send notify in script
        dunstify &quot;[$(date &#39;+%F %H:%M&#39;)] :: $info&quot;
    fi
    exec 1&gt;/dev/null
    unset info
&#125;
</code></pre>
<p>then execute script with crontab</p>
<pre><code class="shell">* * * * * env DBUS_SESSION_BUS_ADDRESS=unix:path=&quot;/run/user/1000/bus&quot; XDG_RUNTIME_DIR=&quot;/run/user/1000&quot; ~/.local/bin/filesync
</code></pre>
<h3 id="oneko"><a href="#oneko" class="headerlink" title="oneko"></a>oneko</h3><p>oneko is a application that displays a cute cat chases cursor.</p>
<pre><code class="shell"># AUR install
paru -S oneko

# add to xmonad startup app
spawnOnce &quot;oneko &amp;&quot;
</code></pre>
<h3 id="downgrade-application"><a href="#downgrade-application" class="headerlink" title="downgrade application"></a>downgrade application</h3><p>sometimes we want to use an old version application, we can use <code>downgrade</code> command to downgrade.</p>
<pre><code class="shell">pacman -S downgrade

# downgrade a software
downgrade app_name
# then choose a number to downgrade
</code></pre>
<h2 id="使用shoadowsocks上google"><a href="#使用shoadowsocks上google" class="headerlink" title="使用shoadowsocks上google"></a>使用shoadowsocks上google</h2><p>安装shadowsocks代理以及proxychains协议转换</p>
<pre><code class="shell">sudo pacman -S proxychains-ng shadowsocks
</code></pre>
<p>修改proxychains配置文件</p>
<pre><code class="shell">sudo vim /etc/proxychains.conf
#socks4         127.0.0.1 9050        #注释
socks5  127.0.0.1 1080                #添加
</code></pre>
<p>添加本地域名解析</p>
<pre><code class="shell">sudo vim /etc/hosts
#添加
104.31.74.55  youneed.win
104.31.74.54  www.youneed.win
</code></pre>
<p><em>添加脚本变量路径</em></p>
<pre><code class="shell">vim .xinitrc
export PATH=$PATH:~/.local/bin
</code></pre>
<p>在<code>~/.local/bin</code>下建立软链接，指向脚本</p>
<pre><code class="shell">cd ~/.local/bin
ln -s ~/Documents/script/shell/shadowshocks.sh sslink
</code></pre>
<p>运行脚本启动代理</p>
<pre><code class="shell">proxychains firefox        #浏览器代理
proxychains bash        #终端代理
</code></pre>
<h2 id="安装virtualbox"><a href="#安装virtualbox" class="headerlink" title="安装virtualbox"></a>安装virtualbox</h2><pre><code class="shell">#由于使用的是linux内核，所以选择virtualbox-host-modules-arch 
sudo pacman -S virtualbox virtualbox-host-modules-arch 
</code></pre>
<p>在启动虚拟机之前，需要加载模块</p>
<pre><code class="shell">modprobe vboxdrv
</code></pre>
<p>启动virtualbox的几种方式：</p>
<p>1.GUI图形界面的启动，这也是大部分时候都在使用的方式，即运行virtualbox软件</p>
<p>2.命令启动，即使用命令无界面启动。后来发现这种方式启动和xmonad很搭，因为不会存在热键冲突的问题，那么xmonad中的所有窗口操作的快捷键依然有效。</p>
<pre><code class="shell">vboxsdl --startvm &#39;kali linux&#39;        #由于系统名字中有空格，所以要使用引号
</code></pre>
<p>3.同样是命令启动，但这种大多数时候是作为服务器使用的方式，即没有任何界面，只能通过ssh去连接主机（就像在windows中使用xshell一个意思）</p>
<pre><code class="shell">vboxheadless -s &#39;kali linux&#39;
</code></pre>
<h2 id="解决xorg问题"><a href="#解决xorg问题" class="headerlink" title="解决xorg问题"></a>解决xorg问题</h2><p>自从安装系统之后就发现一个问题，那就是xorg每次启动都要花个20多秒。所以首先是查看日志</p>
<pre><code class="shell">#xorg的日志在家目录下
vim .local/share/xorg/Xorg.0.log
#然后查看EE报错的地方，发现每次都是在启动nouveau驱动的时候卡了20多秒，然后启动失败了
#原因是我没有安装nouveau驱动，没有安装的原因就是安装之后启动倒是挺迅速的，但是退出xorg之后，或者想要关机的时候就会卡住。
#我想为什么就不能让它不去检测这个驱动呢？终于google到了答案：就是强制让xorg使用intel显卡，而忽略n卡

cd /etc/X11/xorg.conf.d/
touch nonvidia.conf
#添加如下代码：
Section &quot;Device&quot;
    Identifier  &quot;Intel Card&quot;
    Driver      &quot;intel&quot;
EndSection

Section &quot;Device&quot;
    Identifier  &quot;Nvidia Card&quot;
    Driver      &quot;nouveau&quot;
EndSection

Section &quot;Screen&quot;
    Identifier  &quot;My Screen&quot;
    Device      &quot;Intel Card&quot;
EndSection
</code></pre>
<p>然后reboot，startx，果然一下子就打开了图形界面，虽然查看了一下日志，依然有报错，但是它直接跳过之后的等待以及检测了。以上介绍在wiki上也有讲，只是我不知道咋写啊。这也算是基本完成了系统安装以及之后的错误修复了吧！</p>
<h2 id="安装系统之后博客迁移"><a href="#安装系统之后博客迁移" class="headerlink" title="安装系统之后博客迁移"></a>安装系统之后博客迁移</h2><p>安装必要软件</p>
<pre><code class="shell">#这些都要安装
sudo pacman -S git nodejs npm
sudo npm install -g hexo-cli
npm install --save hexo-deployer-git
npm audit fix
npm audit fix --force
npm install hexo-generator-searchdb --save
</code></pre>
<p>当然我又安装了这个加密插件，结果我错了</p>
<pre><code class="shell">npm install --save hexo-blog-encrypt    #然后我哭了
</code></pre>
<p>搞了半天老是报错，什么tostring不能为空，我的密码明明有啊，查看了一下js配置文件，发现确实有password.tostring()这个</p>
<p>然后我用数字做密码试了一下不报错，但是我之前加密的文章全部没加密了？我觉得这是一个bug，至少前面应该做一下判断。所以去你的加密，索性不用了，然后一切都好了。</p>
<pre><code class="shell">ssh-keygen
cat ~/.ssh/id_rsa.pub
</code></pre>
<p>然后在github设置中将sshkey添加进去</p>
<p>当然这后面还有两步，如果没有这两步，推送的时候会提示的</p>
<pre><code class="shell">git config --global user.email &quot;2935549510@qq.com&quot;
git config --global user.name &quot;narcissus&quot;
</code></pre>
<p>再编译，推送</p>
<pre><code class="shell">hexo g
hexo d
</code></pre>
<h2 id="与Android手机连接"><a href="#与Android手机连接" class="headerlink" title="与Android手机连接"></a><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Media_Transfer_Protocol#Android_File_Transfer">与Android手机连接</a></h2><p>这里是使用了USB与手机连接</p>
<pre><code class="shell">sudo pacman -S android-file-transfer    #安装软件
</code></pre>
<p>手机通过USB与电脑连接，同时开启MTP传输。</p>
<pre><code class="shell">sudo aft-mtp-mount /mnt                    #挂载
</code></pre>
<p>然后就可以直接进入<code>/mnt</code>目录查看手机中的文件了</p>
<hr>
<h2 id="更新key失败"><a href="#更新key失败" class="headerlink" title="更新key失败"></a>更新key失败</h2><p>加入archlinuxcn源后，下载archlinuxcn-keyring时失败。</p>
<pre><code class="shell"># 删除gpg数据库
rm -rf /etc/pacman.d/gunpg
# 重新获取
pacman-key --init
pacman-key --populate
pacman-key --refresh-keys
pacman -Syu
</code></pre>
<p>另外一个解决方法是通过调整时间，出问题的根本原因在于时间不一致，但是这次时间看似都正常，因此用第一种方法解决了</p>
<pre><code class="shell"># 查看系统时间
date
# 查看硬件时钟
hwclock --show
# 修改硬件时钟
timedatectl set-time &quot;2019-11-24 09:56:00&quot;
# 重新更新
pacman -Syu
</code></pre>
<h2 id="discuss"><a href="#discuss" class="headerlink" title="discuss"></a>discuss</h2><p>some problems i meet while installing the system.</p>
<h3 id="cannot-find-the-grub-info-in-bios"><a href="#cannot-find-the-grub-info-in-bios" class="headerlink" title="cannot find the grub info in bios"></a>cannot find the grub info in bios</h3><p>this time i installed system in msi, grub installation and configuration were right, but cannot find the grub in bios. </p>
<p>i know the boot info was stored in NVRAM, so i find wheather it has the boot info with my archlinux.</p>
<pre><code class="shell">efibootmgr -v
</code></pre>
<p> there has nothing info of my archlinux, so i added it by myself.</p>
<pre><code class="shell"># the efi partition is /dev/sda1 and efi installed in /boot/efi with directory /boot/efi/EFI/GRUB/grubx64.efi
efibootmgr --create --disk /dev/sda --part 1 --loader /EFI/GRUB/grubx64.efi --label &quot;archlinux bootloader&quot; --verbose
</code></pre>
<p>then i checked weather it has the archlinux boot info, and got correct info</p>
<pre><code class="shell">efibootmgr -v

Boot0006* archlinux bootloader  PciRoot(0x0)/Pci(0x17,0x0)/Sata(2,65535,0)/HD(1,GPT,fd816945-085d-4dca-aabc-734244e1ff5f,0x800,0x31800)/File(\EFI\BOOT\BOOTX64.EFI)
</code></pre>
<p>however when i reboot the system, there has nothing what i added before.</p>
<p>at last i find the problem:</p>
<p><img src=".images/image-20210206170411522.png" alt="image-20210206170411522"></p>
<p>that’s why the info i added disappeard. so while installing the grub, i need add a <code>removable</code> parameter. and then the grub configure will rename to BOOTX and store in another directory where the UEFI firmware can recognize.</p>
<pre><code class="shell"># correctly command
grub-install --efi-directory=/boot/efi --bootloader-id=GRUB --removable
</code></pre>
<p> now the directory likes this:</p>
<pre><code class="shell">/boot/efi
└── EFI
    └── BOOT
        └── BOOTX64.EFI
</code></pre>
<p>the grub configure  producted before can be removed or leave it alone since it will not be used.</p>
<h3 id="xterm-or-ranger-cannot-show-icons"><a href="#xterm-or-ranger-cannot-show-icons" class="headerlink" title="xterm or ranger cannot show icons"></a>xterm or ranger cannot show icons</h3><p>sometimes while installing nerd-font and ranger plug-icons we may find terminal cannot show icons, and the problem was leaded by error system font  setting. we need to change whether the configure properly</p>
<pre><code class="shell">~ » cat /etc/locale.conf                                                                                                                                                                              ~  
LANG=en_US.UTF-8
</code></pre>
<h3 id="xterm-cannot-show-Chinese"><a href="#xterm-cannot-show-Chinese" class="headerlink" title="xterm cannot show Chinese"></a>xterm cannot show Chinese</h3><p>at first, checking whether we have setted the correct locale</p>
<pre><code class="shell"># make sure exist &quot;en_US.UTF-8&quot;
locale -a

# make sure have &quot;LANG=en_US.UTF-8&quot;
cat /etc/locale.conf

# if not run this
echo &quot;LANG=en_US.UTF-8&quot; &gt; /etc/locale.conf
# or use localectl
localectl set-locale LANG=en_US.UTF-8
</code></pre>
<p>if locale setting makes no effect, we need force xterm use utf8</p>
<pre><code class="shell"># add this to .Xresource

XTerm*locale: false
XTerm*utf8: true
</code></pre>
<p>run <code>xrdb .Xresource</code> to make effect of changes </p>
<h3 id="AMD-virtualize-failed"><a href="#AMD-virtualize-failed" class="headerlink" title="AMD virtualize failed"></a>AMD virtualize failed</h3><p>when use virtualbox to launch a virtual machine, there comes a error, it is leaded by disabled cpu virtual in bios which is in default.</p>
<p><strong>ERROR MSG:</strong> <code>AMD-V is disabled in the BIOS (or by the host OS) (VERR_SVM_DISABLED).</code></p>
<p><strong>FIX:</strong> enable <code>svm mode</code></p>
<p><img src=".images/MSI_SnapShot-1621141601481.bmp"></p>
<h3 id="yay-install-failed-with-strip-binary"><a href="#yay-install-failed-with-strip-binary" class="headerlink" title="yay install failed with strip binary"></a>yay install failed with strip binary</h3><p><strong>ERROR:</strong> <code>Cannot find the strip binary required for object file stripping.</code></p>
<p><strong>WHY:</strong> miss some application</p>
<p><strong>FIX:</strong> install <code>base-devel</code></p>
<h3 id="mirror-version-error"><a href="#mirror-version-error" class="headerlink" title="mirror version error"></a>mirror version error</h3><p><strong>ERROR:</strong> <code> error while loading shared libraries: libicui18n.so.69</code></p>
<p><strong>WHY:</strong> version problem</p>
<p><strong>FIX:</strong> uncomment community mirror and run system update: <code>pacman -Syu</code></p>
<h3 id="pycharm-error-in-xmonad"><a href="#pycharm-error-in-xmonad" class="headerlink" title="pycharm error in xmonad"></a>pycharm error in xmonad</h3><p>if in windows environment, it works fine. but in xmonad, there comes a error: <code>WARN - s.impl.EditorColorsManagerImpl - Cannot find scheme: Vibrant Ink from plugin: com.intellij.database</code>.</p>
<p>fixed by exporting a environment variable</p>
<pre><code class="shell">export _JAVA_AWT_WM_NONREPARENTING=1
</code></pre>
<p>in order to simply usage, write it with alias</p>
<pre><code class="shell">alias pycharm=&#39;export _JAVA_AWT_WM_NONREPARENTING=1 &amp;&amp; ~/pycharm-2019.3.3/bin/pycharm.sh &amp;&gt;/dev/null &amp;&#39;
</code></pre>
<h3 id="obs-cannot-record-microphone-sound"><a href="#obs-cannot-record-microphone-sound" class="headerlink" title="obs cannot record microphone sound"></a>obs cannot record microphone sound</h3><p>the default setting after installing obs-studio cannot record microphone. In a fact that it’s not the problem of obs, it is the error of system sound setting. The default system setting mutes the sound of microphone, we need install a software called <code>pavucontrol</code> to configure it.</p>
<p><strong>gui tool</strong></p>
<p><img src=".images/image-20210731235537332.png" alt="image-20210731235537332"></p>
<pre><code class="shell">pacman -S pavucontrol
</code></pre>
<p>click the icon to disable muting, then every thing works fine.</p>
<p><img src=".images/image-20210801000011984.png" alt="image-20210801000011984"></p>
<p><img src=".images/obs.gif" alt="obs"></p>
<p><strong>cli tool</strong></p>
<p>another method is install a cli tool, much light than gui tool.</p>
<pre><code class="shell"># install
pacman -S pulsemixer

# list all audio device
pulsemixer --list

# find the mute one and unmute it
pulsemixer --id &lt;source-2&gt; --unmute
</code></pre>
<h3 id="invalid-or-corrupted-package-pgp-signature"><a href="#invalid-or-corrupted-package-pgp-signature" class="headerlink" title="invalid or corrupted package(pgp signature)"></a>invalid or corrupted package(pgp signature)</h3><p>after adding china mirror to <code>pacman.conf</code> and running update, package install will meet <a target="_blank" rel="noopener" href="https://bbs.archlinux.org/viewtopic.php?id=233480">this problem</a></p>
<pre><code class="shell">error: jansson: signature from &quot;Eli Schwartz &lt;eschwartz@archlinux.org&gt;&quot; is marginal trust
:: File /var/cache/pacman/pkg/jansson-2.10-3-x86_64.pkg.tar.xz is corrupted (invalid or corrupted package (PGP signature)).
</code></pre>
<p>method to resolve the problem</p>
<pre><code class="shell"># eg:
pacman-key --list-sigs |rg &#39;Eli&#39;
pacman-key --delete 91FFE0700E80619CEB73235CA88E23E377514E00
pacman-key --populate archlinux
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://raw.githubusercontent.com/ssfwshutterbug/ssfwshutterbug.github.io/main/2022/04/23/archlinux/" data-id="cl9ktb7uw000rdta8fvbsf3wo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/archlinux/" rel="tag">archlinux</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/learn/">learn</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/think/">think</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">thinking</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E5%8E%86%E5%8F%B2/">读历史</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/anaconda/" rel="tag">anaconda</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anbox/" rel="tag">anbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/" rel="tag">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/archlinux/" rel="tag">archlinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boring/" rel="tag">boring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/container/" rel="tag">container</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cursor-theme/" rel="tag">cursor theme</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ed/" rel="tag">ed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grub/" rel="tag">grub</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/haskell/" rel="tag">haskell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inject-js-css/" rel="tag">inject js/css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/" rel="tag">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/life/" rel="tag">life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mind/" rel="tag">mind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimized/" rel="tag">optimized</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pentablet/" rel="tag">pentablet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/positive/" rel="tag">positive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reality-is-aweful/" rel="tag">reality is aweful</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/route/" rel="tag">route</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rust/" rel="tag">rust</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shield/" rel="tag">shield</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/" rel="tag">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/" rel="tag">tcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vbox/" rel="tag">vbox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xmonad/" rel="tag">xmonad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zabbix/" rel="tag">zabbix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zk/" rel="tag">zk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zsh/" rel="tag">zsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%9D%E7%BB%AA/" rel="tag">思绪</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A5%9E%E8%AF%9D/" rel="tag">神话</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%89%AF%E7%9F%A5/" rel="tag">良知</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/anaconda/" style="font-size: 10px;">anaconda</a> <a href="/tags/anbox/" style="font-size: 10px;">anbox</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/archlinux/" style="font-size: 10px;">archlinux</a> <a href="/tags/boring/" style="font-size: 10px;">boring</a> <a href="/tags/container/" style="font-size: 10px;">container</a> <a href="/tags/cursor-theme/" style="font-size: 10px;">cursor theme</a> <a href="/tags/ed/" style="font-size: 10px;">ed</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/grub/" style="font-size: 10px;">grub</a> <a href="/tags/haskell/" style="font-size: 10px;">haskell</a> <a href="/tags/inject-js-css/" style="font-size: 10px;">inject js/css</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/k8s/" style="font-size: 20px;">k8s</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mind/" style="font-size: 10px;">mind</a> <a href="/tags/optimized/" style="font-size: 10px;">optimized</a> <a href="/tags/pentablet/" style="font-size: 10px;">pentablet</a> <a href="/tags/positive/" style="font-size: 10px;">positive</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/reality-is-aweful/" style="font-size: 10px;">reality is aweful</a> <a href="/tags/route/" style="font-size: 10px;">route</a> <a href="/tags/rust/" style="font-size: 10px;">rust</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/shield/" style="font-size: 10px;">shield</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/tcp/" style="font-size: 10px;">tcp</a> <a href="/tags/vbox/" style="font-size: 10px;">vbox</a> <a href="/tags/vscode/" style="font-size: 10px;">vscode</a> <a href="/tags/xmonad/" style="font-size: 20px;">xmonad</a> <a href="/tags/zabbix/" style="font-size: 10px;">zabbix</a> <a href="/tags/zk/" style="font-size: 10px;">zk</a> <a href="/tags/zsh/" style="font-size: 10px;">zsh</a> <a href="/tags/%E6%80%9D%E7%BB%AA/" style="font-size: 15px;">思绪</a> <a href="/tags/%E7%A5%9E%E8%AF%9D/" style="font-size: 10px;">神话</a> <a href="/tags/%E8%89%AF%E7%9F%A5/" style="font-size: 10px;">良知</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/23/our-body-may-cheat-ourselves-md/">our-body-may-cheat-ourselves.md</a>
          </li>
        
          <li>
            <a href="/2022/07/04/the-reality/">the-reality</a>
          </li>
        
          <li>
            <a href="/2022/06/25/%E4%BB%8E%E5%AE%B9/">从容</a>
          </li>
        
          <li>
            <a href="/2022/06/25/magic-of-xmonad/">magic-of-xmonad</a>
          </li>
        
          <li>
            <a href="/2022/06/24/xp-pentablet/">xp-pentablet</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 shutterbug<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>